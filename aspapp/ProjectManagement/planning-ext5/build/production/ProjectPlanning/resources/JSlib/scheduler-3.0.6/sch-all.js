Ext.define("Sch.locale.Locale",{l10n:null,legacyMode:true,localeName:null,namespaceId:null,constructor:function(){if(!Sch.locale.Active){Sch.locale.Active={};this.bindRequire()}var d=this.self.getName().split(".");var e=this.localeName=d.pop();this.namespaceId=d.join(".");var f=Sch.locale.Active[this.namespaceId];if(!(e=="En"&&f&&f.localeName!="En")){this.apply()}},bindRequire:function(){var b=Ext.ClassManager.triggerCreated;Ext.ClassManager.triggerCreated=function(e){b.apply(this,arguments);if(e){var f=Ext.ClassManager.get(e);for(var a in Sch.locale.Active){Sch.locale.Active[a].apply(f)}}}},applyToClass:function(n,h){var m=this,j=m.self.getName();h=h||Ext.ClassManager.get(n);if(h&&(h.activeLocaleId!==j)){var i=m.l10n[n];if(typeof i==="function"){i(n)}else{if(h.singleton){h.l10n=Ext.apply({},i,h.prototype&&h.prototype.l10n)}else{Ext.override(h,{l10n:i})}}if(m.legacyMode){var k;if(h.prototype){k=h.prototype}else{if(h.singleton){k=h}}if(k&&k.legacyMode){if(k.legacyHolderProp){if(!k[k.legacyHolderProp]){k[k.legacyHolderProp]={}}k=k[k.legacyHolderProp]}for(var l in i){if(typeof k[l]!=="function"){k[l]=i[l]}}}}h.activeLocaleId=j;if(h.onLocalized){h.onLocalized()}}},apply:function(j){if(this.l10n){var k=this;if(j){if(!Ext.isArray(j)){j=[j]}var n,h;for(var m=0,i=j.length;m<i;m++){if(Ext.isObject(j[m])){if(j[m].singleton){h=j[m];n=Ext.getClassName(Ext.getClass(h))}else{h=Ext.getClass(j[m]);n=Ext.getClassName(h)}}else{h=null;n="string"===typeof j[m]?j[m]:Ext.getClassName(j[m])}if(n&&n in this.l10n){k.applyToClass(n,h)}}}else{Sch.locale.Active[this.namespaceId]=this;for(var l in this.l10n){k.applyToClass(l)}}}}});Ext.define("Sch.locale.En",{extend:"Sch.locale.Locale",singleton:true,constructor:function(b){Ext.apply(this,{l10n:{"Sch.util.Date":{unitNames:{YEAR:{single:"year",plural:"years",abbrev:"yr"},QUARTER:{single:"quarter",plural:"quarters",abbrev:"q"},MONTH:{single:"month",plural:"months",abbrev:"mon"},WEEK:{single:"week",plural:"weeks",abbrev:"w"},DAY:{single:"day",plural:"days",abbrev:"d"},HOUR:{single:"hour",plural:"hours",abbrev:"h"},MINUTE:{single:"minute",plural:"minutes",abbrev:"min"},SECOND:{single:"second",plural:"seconds",abbrev:"s"},MILLI:{single:"ms",plural:"ms",abbrev:"ms"}}},"Sch.panel.TimelineGridPanel":{loadingText:"Loading, please wait...",savingText:"Saving changes, please wait..."},"Sch.panel.TimelineTreePanel":{loadingText:"Loading, please wait...",savingText:"Saving changes, please wait..."},"Sch.mixin.SchedulerView":{loadingText:"Loading events..."},"Sch.plugin.CurrentTimeLine":{tooltipText:"Current time"},"Sch.plugin.EventEditor":{saveText:"Save",deleteText:"Delete",cancelText:"Cancel"},"Sch.plugin.SimpleEditor":{newEventText:"New booking..."},"Sch.widget.ExportDialog":{generalError:"An error occured, try again.",title:"Export Settings",formatFieldLabel:"Paper format",orientationFieldLabel:"Orientation",rangeFieldLabel:"Export range",showHeaderLabel:"Add page number",showFooterLabel:"Add footer",orientationPortraitText:"Portrait",orientationLandscapeText:"Landscape",completeViewText:"Complete schedule",currentViewText:"Current view",dateRangeText:"Date range",dateRangeFromText:"Export from",pickerText:"Resize column/rows to desired value",dateRangeToText:"Export to",exportButtonText:"Export",cancelButtonText:"Cancel",progressBarText:"Exporting...",exportersFieldLabel:"Export mode",adjustCols:"Adjust column width",adjustColsAndRows:"Adjust column width and row height",specifyDateRange:"Specify date range"},"Sch.plugin.Export":{fetchingRows:"Fetching row {0} of {1}",builtPage:"Built page {0} of {1}",requestingPrintServer:"Please wait..."},"Sch.plugin.exporter.AbstractExporter":{name:"Exporter"},"Sch.plugin.exporter.SinglePage":{name:"Single page"},"Sch.plugin.exporter.MultiPageVertical":{name:"Multiple pages (vertically)"},"Sch.plugin.exporter.MultiPage":{name:"Multiple pages"},"Sch.preset.Manager":{hourAndDay:{displayDateFormat:"G:i",middleDateFormat:"G:i",topDateFormat:"D d/m"},secondAndMinute:{displayDateFormat:"g:i:s",topDateFormat:"D, d g:iA"},dayAndWeek:{displayDateFormat:"m/d h:i A",middleDateFormat:"D d M"},weekAndDay:{displayDateFormat:"m/d",bottomDateFormat:"d M",middleDateFormat:"Y F d"},weekAndMonth:{displayDateFormat:"m/d/Y",middleDateFormat:"m/d",topDateFormat:"m/d/Y"},weekAndDayLetter:{displayDateFormat:"m/d/Y",middleDateFormat:"D d M Y"},weekDateAndMonth:{displayDateFormat:"m/d/Y",middleDateFormat:"d",topDateFormat:"Y F"},monthAndYear:{displayDateFormat:"m/d/Y",middleDateFormat:"M Y",topDateFormat:"Y"},year:{displayDateFormat:"m/d/Y",middleDateFormat:"Y"},manyYears:{displayDateFormat:"m/d/Y",middleDateFormat:"Y"}}}});this.callParent(arguments)}});Ext.define("Sch.util.Patch",{target:null,minVersion:null,maxVersion:null,reportUrl:null,description:null,applyFn:null,ieOnly:false,macOnly:false,overrides:null,onClassExtended:function(d,c){if(Sch.disableOverrides){return}if(c.ieOnly&&!Ext.isIE){return}if(c.macOnly&&!Ext.isMac){return}if((!c.minVersion||Ext.versions.extjs.equals(c.minVersion)||Ext.versions.extjs.isGreaterThan(c.minVersion))&&(!c.maxVersion||Ext.versions.extjs.equals(c.maxVersion)||Ext.versions.extjs.isLessThan(c.maxVersion))){if(c.applyFn){c.applyFn()}else{Ext.ClassManager.get(c.target).override(c.overrides)}}}});if(!Ext.ClassManager.get("Sch.patches.BufferedRenderer")){Ext.define("Sch.patches.BufferedRenderer",{extend:"Sch.util.Patch",requires:["Ext.grid.plugin.BufferedRenderer"],target:"Ext.grid.plugin.BufferedRenderer",overrides:{onRangeFetched:function(){this.tableTopBorderWidth=this.tableTopBorderWidth||0;return this.callParent(arguments)},refreshSize:function(g,e){var h=this,f=h.view;if(f.body.dom){this.callParent(arguments)}}}})}if(!Ext.ClassManager.get("Sch.patches.NodeStore")){Ext.define("Sch.patches.NodeStore",{extend:"Sch.util.Patch",requires:["Ext.data.NodeStore"],target:"Ext.data.NodeStore",ieOnly:true,maxVersion:"5.1.1",overrides:{afterEdit:function(d,c){if(this.getNode()&&c){if(Ext.Array.indexOf(c,"loaded")!==-1){return this.add(this.retrieveChildNodes(d))}if(Ext.Array.indexOf(c,"expanded")!==-1){return this.filter()}if(Ext.Array.indexOf(c,"sorted")!==-1){return this.sort()}}Ext.data.Store.prototype.afterEdit.apply(this,arguments)}}})}Ext.define("Sch.patches.ColumnResizeTree",{override:"Sch.panel.TimelineTreePanel",afterRender:function(){this.callParent(arguments);var b=this.lockedGrid.headerCt.findPlugin("gridheaderresizer");if(b){b.getConstrainRegion=function(){var e=this,a=e.dragHd.el,f;if(e.headerCt.forceFit){f=e.dragHd.nextNode("gridcolumn:not([hidden]):not([isGroupHeader])");if(!e.headerInSameGrid(f)){f=null}}return e.adjustConstrainRegion(Ext.util.Region.getRegion(a),0,e.headerCt.forceFit?(f?f.getWidth()-e.minColWidth:0):e.maxColWidth-a.getWidth(),0,e.minColWidth)}}}});if(!Ext.ClassManager.get("Sch.patches.RowSynchronizer")){Ext.define("Sch.patches.RowSynchronizer",{extend:"Sch.util.Patch",requires:["Ext.grid.locking.RowSynchronizer"],target:"Ext.grid.locking.RowSynchronizer",minVersion:"5.1.0",overrides:Ext.versions.extjs.isGreaterThan("5.1.0")?{finish:function(b){if(!b){return}return this.callParent(arguments)}}:{}})}if(!Ext.ClassManager.get("Sch.patches.NodeCache")){Ext.define("Sch.patches.NodeCache",{extend:"Sch.util.Patch",requires:["Ext.view.NodeCache"],target:"Ext.view.NodeCache",minVersion:"5.1.0",overrides:{scroll:function(g,h,e){var f;if(g.length===0){f=[]}else{f=this.callParent(arguments)}return f}}})}Ext.define("Sch.patches.TouchScroll",{extend:"Sch.util.Patch",requires:["Ext.scroll.TouchScroller"],target:"Ext.scroll.TouchScroller",minVersion:"5.1.0",overrides:{privates:{onEvent:function(c){var d=this;if(!d[d.listenerMap[c.type]]){return}return this.callParent(arguments)}}}});Ext.define("Sch.patches.PartnerScroll",{extend:"Sch.util.Patch",requires:["Ext.scroll.Scroller"],minVersion:"5.1.0",maxVersion:"5.1.1",applyFn:function(){if(Ext.isMac||Ext.isGecko){Ext.ClassManager.get("Ext.scroll.Scroller").override({constructor:function(d){var c=this;c.callParent([d]);this.doNotCall={}},privates:{onPartnerScrollEnd:function(){this.doNotCall={}},invokePartners:function(i,h,j){var l=this._partners,g,k;if(!this.suspendSync){for(k in l){g=l[k];if(!g.suspendSync&&!this.doNotCall[g.scroller.id]){g.scroller[i](this,h,j)}else{if(!g.scroller.component.isTableView){delete this.doNotCall[g.scroller.id]}}}}},onPartnerScroll:function(h,f,g){var e=h._partners[this.getId()].axis;if(e){if(e==="x"){g=null}else{if(e==="y"){f=null}}}this.doNotCall[h.id]=true;this.doScrollTo(f,g,null,false)}}})}}});Ext.define("Sch.patches.View",{extend:"Sch.util.Patch",requires:["Ext.view.View"],target:"Ext.view.View",minVersion:"5.1.0",overrides:{handleEvent:function(g){var h=this,e=h.keyEventRe.test(g.type),f=h.getNavigationModel();g.view=h;if(e){g.item=f.getItem();g.record=f.getRecord()}if(!g.item){g.item=g.getTarget(h.itemSelector)}if(g.item&&!g.record){g.record=h.getRecord(g.item)}if(h.processUIEvent(g)!==false){h.processSpecialEvent(g)}if(e&&!Ext.fly(g.target).isInputField()){if(g.getKey()===g.SPACE||g.isNavKeyPress(true)){g.preventDefault()}}}}});Ext.define("Sch.patches.TableView",{extend:"Sch.util.Patch",requires:["Ext.view.Table"],target:"Ext.view.Table",minVersion:"5.1.0",overrides:{getLastFocused:function(){var b=this.callParent(arguments);return b||this.navigationModel.lastFocused}}});Ext.define("Sch.patches.Collection",{extend:"Sch.util.Patch",requires:["Ext.util.Collection"],target:"Ext.util.Collection",minVersion:"5.1.0",overrides:{updateKey:function(h,l){var i=this,m=i.map,j=i.indices,n=i.getSource(),k;if(n&&!n.updating){n.updateKey(h,l)}else{if(m[l]&&(k=i.getKey(h))!==l){if(l in m||m[k]!==h){if(l in m){delete m[l]}i.updating++;i.generation++;m[k]=h;if(j){j[k]=j[l];delete j[l]}i.notify("updatekey",[{item:h,newKey:k,oldKey:l}]);i.updating--}}}}}});if(!Ext.ClassManager.get("Sch.patches.TreeStore")){Ext.define("Sch.patches.TreeStore",{extend:"Sch.util.Patch",requires:["Ext.data.TreeStore"],target:"Ext.data.TreeStore",minVersion:"5.1.0",overrides:{getRejectRecords:function(){return this.getModifiedRecords()},rejectChanges:function(){this.removed=this.removedNodes;this.callParent(arguments)},remove:function(c){if(c.isModel){c.remove()}else{if(c instanceof Array&&c[0].isModel){for(var d=0;d<c.length;d++){c[d].remove()}}else{this.callParent(arguments)}}}}})}Ext.define("Sch.patches.TreeStoreInternalIdMap",{extend:"Sch.util.Patch",requires:["Ext.data.TreeStore"],target:"Ext.data.TreeStore",minVersion:"5.1.1",overrides:{registerNode:function(f,e){var d=this;if(!d.byInternalIdMap){d.byInternalIdMap={}}d.byInternalIdMap[f.internalId]=f;d.callParent(arguments)},unregisterNode:function(f,e){var d=this;if(d.byInternalIdMap){delete d.byInternalIdMap[f.internalId]}d.callParent(arguments)},updateRoot:function(){this.byInternalIdMap={};this.callParent(arguments)}}});Ext.define("Sch.patches.ToolTip",{extend:"Sch.util.Patch",requires:["Ext.tip.ToolTip"],target:"Ext.tip.ToolTip",minVersion:"5.1.0",overrides:{setTarget:function(g){var e=this,f=Ext.get(g),h;if(e.target){h=Ext.get(e.target);e.mun(h,{mouseover:e.onTargetOver,tap:e.onTargetOver,mouseout:e.onTargetOut,mousemove:e.onMouseMove,scope:e})}e.target=f;if(f){e.mon(f,{mouseover:e.onTargetOver,tap:e.onTargetOver,mouseout:e.onTargetOut,mousemove:e.onMouseMove,scope:e})}if(e.anchor){e.anchorTarget=e.target}}}});Ext.define("Sch.patches.OperationDestroy",{extend:"Sch.util.Patch",requires:["Ext.data.operation.Destroy"],target:"Ext.data.operation.Destroy",minVersion:"5.1.1",maxVersion:"5.1.2",overrides:{doProcess:function(){var f=Ext.Array.slice(this.getRecords()),e=f.length,d;for(d=0;d<e;++d){f[d].setErased()}}}});Ext.define("Sch.patches.Chrome",{extend:"Sch.util.Patch",requires:["Ext.util.CSS"],minVersion:"5.1.0",applyFn:function(){if(Ext.isChrome&&Ext.browser.version.isGreaterThanOrEqual("43")){Ext.util.CSS.createStyleSheet(".sch-timelinepanel ."+Ext.baseCSSPrefix+"form-text { display: inherit; }")}}});Ext.define("Sch.mixin.Localizable",{requires:["Sch.locale.En"],legacyMode:false,activeLocaleId:"",l10n:null,isLocaleApplied:function(){var c=(this.singleton&&this.activeLocaleId)||this.self.activeLocaleId;if(!c){return false}for(var d in Sch.locale.Active){if(c===Sch.locale.Active[d].self.getName()){return true}}return false},applyLocale:function(){for(var b in Sch.locale.Active){Sch.locale.Active[b].apply(this.singleton?this:this.self.getName())}},L:function(){return this.localize.apply(this,arguments)},localize:function(q,o,l){if(!this.isLocaleApplied()&&!l){this.applyLocale()}if(this.hasOwnProperty("l10n")&&this.l10n.hasOwnProperty(q)&&"function"!=typeof this.l10n[q]){return this.l10n[q]}var p=this.self&&this.self.prototype;if(this.legacyMode){var r=o||this.legacyHolderProp;var k=r?this[r]:this;if(k&&k.hasOwnProperty(q)&&"function"!=typeof k[q]){return k[q]}if(p){var n=r?p[r]:p;if(n&&n.hasOwnProperty(q)&&"function"!=typeof n[q]){return n[q]}}}var j=p.l10n&&p.l10n[q];if(j===null||j===undefined){var m=p&&p.superclass;if(m&&m.localize){j=m.localize(q,o,l)}if(j===null||j===undefined){throw"Cannot find locale: "+q+" ["+this.self.getName()+"]"}}return j}});Ext.define("Sch.tooltip.ClockTemplate",{extend:"Ext.XTemplate",minuteHeight:8,minuteTop:2,hourHeight:8,hourTop:2,handLeft:10,getRotateStyle:function(b){return"transform:rotate(Ddeg);-ms-transform:rotate(Ddeg);-moz-transform: rotate(Ddeg);-webkit-transform: rotate(Ddeg);-o-transform:rotate(Ddeg);".replace(/D/g,b)},getRotateStyleIE:(function(){var f=Math.PI/180,d=Math.cos,e=Math.sin;return function(x,r,b){var u=this,t=x*f,v=d(t),p=e(t),s=b*e((90-x)*f),q=b*d((90-x)*f),c=Math.min(b,b-s),w=x>180?q:0,a="progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11 = "+v+", M12 = "+(-p)+", M21 = "+p+", M22 = "+v+")";return Ext.String.format("filter:{0};-ms-filter:{0};top:{1}px;left:{2}px;",a,c+r,w+u.handLeft)}})(),constructor:function(){var b=Ext.isIE&&Ext.isIE8m;this.callParent(['<div class="sch-clockwrap '+(b?"":"sch-supports-border-radius")+' {cls}"><div class="sch-clock"><div class="sch-hourIndicator" style="{[this.getHourStyle((values.date.getHours() % 12) * 30,'+this.hourTop+", + "+this.hourHeight+')]}">{[Ext.Date.monthNames[values.date.getMonth()].substr(0,3)]}</div><div class="sch-minuteIndicator" style="{[this.getMinuteStyle(values.date.getMinutes() * 6,'+this.minuteTop+", + "+this.minuteHeight+')]}">{[values.date.getDate()]}</div>'+(b?"":'<div class="sch-clock-dot"></div>')+'</div><span class="sch-clock-text">{text}</span></div>',{disableFormats:true,getMinuteStyle:b?this.getRotateStyleIE:this.getRotateStyle,getHourStyle:b?this.getRotateStyleIE:this.getRotateStyle}])}});Ext.define("Sch.tooltip.Tooltip",{extend:"Ext.tip.ToolTip",requires:["Sch.tooltip.ClockTemplate"],autoHide:false,anchor:"b",padding:"0 3 0 0",showDelay:0,hideDelay:0,quickShowInterval:0,dismissDelay:0,trackMouse:false,anchorOffset:5,shadow:false,frame:false,schedulerView:null,message:null,valid:true,offsetAdjust:[18,5],constructor:function(c){var d=new Sch.tooltip.ClockTemplate();this.startDate=this.endDate=new Date();if(!this.template){this.template=Ext.create("Ext.XTemplate",'<div class="sch-tip-{[values.valid ? "ok" : "notok"]}">{[this.renderClock(values.startDate, values.startText, "sch-tooltip-startdate")]}{[this.renderClock(values.endDate, values.endText, "sch-tooltip-enddate")]}<div class="sch-tip-message">{message}</div></div>',{disableFormats:true,renderClock:function(b,a,f){return d.apply({date:b,text:a,cls:f})}})}this.callParent(arguments)},update:function(i,j,k,l){if(this.startDate-i!==0||this.endDate-j!==0||this.valid!==k||this.message!==l){var m=(this.message&&!l)||(!this.message&&l);this.startDate=i;this.endDate=j;this.valid=k;this.message=l;var n=this.schedulerView.getFormattedDate(i),h=this.schedulerView.getFormattedEndDate(j,i);if(this.mode==="calendar"&&j.getHours()===0&&j.getMinutes()===0&&!(j.getYear()===i.getYear()&&j.getMonth()===i.getMonth()&&j.getDate()===i.getDate())){j=Sch.util.Date.add(j,Sch.util.Date.DAY,-1)}this.callParent([this.template.apply({valid:k,startDate:i,endDate:j,startText:n,endText:h,message:l})]);if(m){this.realign()}}},show:function(c,d){if(!c||Ext.isArray(c)){return}if(Sch.util.Date.compareUnits(this.schedulerView.getTimeResolution().unit,Sch.util.Date.DAY)>=0){this.mode="calendar";this.addCls("sch-day-resolution");this.removeCls("sch-hour-resolution")}else{this.mode="clock";this.removeCls("sch-day-resolution");this.addCls("sch-hour-resolution")}d=arguments.length>1?d:this.offsetAdjust[0];this.mouseOffsets=[d-this.offsetAdjust[0],-this.offsetAdjust[1]];this.setTarget(c);this.callParent();this.realign()},realign:function(){this.el.alignTo(this.target,"bl-tl",this.mouseOffsets)},afterRender:function(){this.callParent(arguments);this.el.on("mouseenter",this.realign,this)}});Ext.define("Sch.tooltip.HoverTip",{extend:"Ext.tip.ToolTip",alias:"widget.scheduler_hovertip",requires:["Sch.tooltip.ClockTemplate"],trackMouse:true,bodyCls:"sch-hovertip",messageTpl:'<div class="sch-hovertip-msg">{message}</div>',autoHide:false,dismissDelay:1000,showDelay:300,schedulerView:null,initComponent:function(){var c=this;var d=c.schedulerView;c.clockTpl=new Sch.tooltip.ClockTemplate();c.messageTpl=new Ext.XTemplate(c.messageTpl);c.lastTime=null;c.lastResource=null;c.callParent(arguments);c.on("beforeshow",c.tipOnBeforeShow,c);d.mon(d.el,{mouseleave:function(){c.hide()},mousemove:c.handleMouseMove,scope:c})},handleMouseMove:function(h){var j=this;var g=j.schedulerView;if(j.disabled){return}if(h.getTarget("."+g.timeCellCls,5)&&!h.getTarget(g.eventSelector)){var i=g.getDateFromDomEvent(h,"floor");if(i){var e=g.resolveResource(h.getTarget());if(i-j.lastTime!==0||e!==j.lastResource){j.lastResource=e;j.updateHoverTip(i,h);if(j.hidden){if(Sch.util.Date.compareUnits(this.schedulerView.getTimeResolution().unit,Sch.util.Date.DAY)>=0){j.addCls("sch-day-resolution");j.removeCls("sch-hour-resolution")}else{j.removeCls("sch-day-resolution");j.addCls("sch-hour-resolution")}j.show()}}}else{j.hide();j.lastTime=null;j.lastResource=null}}else{j.hide();j.lastTime=null;j.lastResource=null}},getText:function(){},updateHoverTip:function(h,g){if(h){var e=this.clockTpl.apply({date:h,text:this.schedulerView.getFormattedDate(h)});var f=this.messageTpl.apply({message:this.getText(h,g)});this.update(e+f);this.lastTime=h}},tipOnBeforeShow:function(b){return !this.disabled&&this.lastTime!==null}});Ext.define("Sch.crud.AbstractManager",{require:["Ext.data.StoreManager"],mixins:{observable:"Ext.util.Observable"},revision:null,stores:null,storeIdProperty:"storeId",storesIndex:null,activeRequests:null,delayedSyncs:null,transport:null,trackResponseType:false,phantomIdField:"$PhantomId",autoLoad:false,autoSyncTimeout:100,autoSync:false,resetIdsBeforeSync:true,syncApplySequence:null,writeAllFields:false,ignoreUpdates:0,createMissingRecords:false,autoSyncTimerId:null,constructor:function(d){d=d||{};this.mixins.observable.constructor.call(this,d);this.activeRequests={};this.delayedSyncs=[];this.transport=d.transport||this.transport||{};var e=d.stores||this.stores;this.stores=[];this.addStore(e);var f=d.syncApplySequence||this.syncApplySequence;if(f){this.syncApplySequence=null;this.addStoreToApplySequence(f)}if(this.autoLoad){this.load()}},updateStoreIndex:function(){var e={};for(var g=0,f=this.stores.length;g<f;g++){var h=this.stores[g];if(h.storeId){e[h.storeId]=this.stores[g]}}this.storesIndex=e},getStoreDescriptor:function(d){if(!d){return}if(d instanceof Ext.data.AbstractStore){for(var f=0,e=this.stores.length;f<e;f++){if(this.stores[f].store===d){return this.stores[f]}}}else{if(typeof d=="object"){return this.storesIndex[d.storeId]}else{return this.storesIndex[d]||this.getStoreDescriptor(Ext.data.StoreManager.get(d))}}},getStore:function(d){var c=this.getStoreDescriptor(d);return c&&c.store},forEachStore:function(h,i){if(!h){return}var f=this.stores;for(var j=0,g=f.length;j<g;j++){if(h.call(i||this,f[j].store,f[j].storeId,f[j])===false){break}}},addStore:function(i,q,x){if(!i){return}if(!Ext.isArray(i)){i=[i]}var s=[];for(var r=0,v=i.length;r<v;r++){var j=i[r];if(j instanceof Ext.data.AbstractStore){j={store:j}}else{if(typeof j=="object"){if(j.stores){if(!Ext.isArray(j.stores)){j.stores=[j.stores]}for(var u=0,w=j.stores.length;u<w;u++){var n=j.stores[u],t=n;if("string"===typeof n){t={storeId:n}}t.masterStoreInfo=j;j.stores[u]=t}}}else{j={store:Ext.data.StoreManager.get(j)}}}s.push(this.fillStoreDescriptor(j));j.store.crudManager=this;this.mon(j.store,{add:this.onStoreChange,append:this.onStoreChange,insert:this.onStoreChange,update:this.onStoreUpdate,remove:this.onStoreChange,clear:this.onStoreChange,scope:this})}if(typeof q==="undefined"){this.stores.push.apply(this.stores,s)}else{var l=q;if(x){if(x instanceof Ext.data.AbstractStore||typeof x!=="object"){x=this.getStoreDescriptor(x)}l+=Ext.Array.indexOf(this.stores,x)}this.stores.splice.apply(this.stores,[].concat([l,0],s))}this.updateStoreIndex()},fillStoreDescriptor:function(g){var f=g.store,h=f.storeIdProperty||this.storeIdProperty,e=f.getModel&&f.getModel()||f.model;e=e&&e.prototype;Ext.applyIf(g,{storeId:f[h],phantomIdField:e&&e.phantomIdField,idProperty:e&&e.idProperty,writeAllFields:f.writeAllFields});return g},removeStore:function(e){for(var h=0,f=this.stores.length;h<f;h++){var g=this.stores[h];if(g===e||g.store===e||g.storeId===e){this.mun(g.store,{add:this.onStoreChange,append:this.onStoreChange,insert:this.onStoreChange,update:this.onStoreUpdate,remove:this.onStoreChange,clear:this.onStoreChange,scope:this});delete this.storesIndex[g.storeId];this.stores.splice(h,1);if(this.syncApplySequence){this.removeStoreFromApplySequence(e)}break}}},addStoreToApplySequence:function(p,j,n){if(!p){return}if(!Ext.isArray(p)){p=[p]}var l=[];for(var o=0,i=p.length;o<i;o++){var m=this.getStoreDescriptor(p[o]);if(m){l.push(m)}}if(!this.syncApplySequence){this.syncApplySequence=[]}if(typeof j==="undefined"){this.syncApplySequence.push.apply(this.syncApplySequence,l)}else{var k=j;if(n){if(n instanceof Ext.data.AbstractStore||typeof n!=="object"){n=this.getStoreDescriptor(n)}k+=Ext.Array.indexOf(this.syncApplySequence,n)}this.syncApplySequence.splice.apply(this.syncApplySequence,[].concat([k,0],l))}},removeStoreFromApplySequence:function(e){for(var h=0,f=this.syncApplySequence.length;h<f;h++){var g=this.syncApplySequence[h];if(g===e||g.store===e||g.storeId===e){this.syncApplySequence.splice(h,1);break}}},onStoreUpdate:function(c,d){if(!c.isTreeStore||d!==c.getRoot()){this.onStoreChange()}},onStoreChange:function(){if(this.ignoreUpdates){return}var b=this;this.fireEvent(this.hasChanges()?"haschanges":"nochanges",this);if(this.autoSync){if(!this.autoSyncTimerId){this.autoSyncTimerId=setTimeout(function(){b.autoSyncTimerId=null;b.sync()},this.autoSyncTimeout)}}},hasChanges:function(e){var h;if(e){h=this.getStore(e);if(!h){return}return Boolean(h.getModifiedRecords().length||h.getRemovedRecords().length)}for(var g=0,f=this.stores.length;g<f;g++){h=this.stores[g].store;if(h.getModifiedRecords().length||h.getRemovedRecords().length){return true}}return false},getLoadPackage:function(i){var n={type:"load",requestId:this.getRequestId(),stores:[]};var l=this.stores,s=n.stores;for(var p=0,r=l.length;p<r;p++){var m=l[p],t=i&&i[m.storeId],o=m.pageSize||m.store.pageSize;if(t||o){var q=Ext.apply({storeId:m.storeId,page:1,pageSize:o},t);l[p].currentPage=q.page;s.push(q)}else{s.push(m.storeId)}}return n},prepareAdded:function(r,l,p){var f=[];for(var v=0,x=r.length;v<x;v++){var u=r[v],w={},t=u.getFields();if(!w.hasOwnProperty(l)){w[l]=u.getId()}for(var s=0,i=t.length;s<i;s++){var q=t[s];if(q){if(q.persist&&(u.data.hasOwnProperty(q.name)||q.critical)){if(q.serialize){w[q.name]=q.serialize(u.data[q.name],u)}else{w[q.name]=u.data[q.name]}}}}if(this.resetIdsBeforeSync){delete w[u.idProperty]}if(p){this.processSubStores(u,w,p)}f.push(w)}return f},prepareUpdated:function(r,i,j){var f=[],y=j.writeAllFields||(j.writeAllFields!==false&&this.writeAllFields),v,l;for(var u=0,x=r.length;u<x;u++){var t=r[u],s;if(y){v=t.getData();v[t.idProperty]=t.getId();for(s in v){l=t.getField(s);if(!l||!l.persist&&!l.critical){delete v[s]}else{if(l.serialize){v[s]=l.serialize(v[s],t)}else{v[s]=t.get(s)}}}}else{v=t.getChanges();v[t.idProperty]=t.getId();for(s in v){l=t.getField(s);if(!l||!l.persist){delete v[s]}else{if(l.serialize){v[s]=l.serialize(v[s],t)}else{v[s]=t.get(s)}}}var z=t.getCriticalFields();for(var w=0;w<z.length;w++){l=z[w];if(l.serialize){v[l.getName()]=l.serialize(t.get(l.getName()),t)}else{v[l.getName()]=t.get(l.getName())}}}if(i){this.processSubStores(t,v,i)}f.push(v)}return f},prepareRemoved:function(h){var g=[],i;for(var j=0,f=h.length;j<f;j++){i={};i[h[j].idProperty]=h[j].getId();g.push(i)}return g},processSubStores:function(i,m,j){for(var o=0,k=j.length;o<k;o++){var l=j[o].storeId,p=i.get(l);if(p){var n=this.getStoreChanges(Ext.apply({store:p},j[o]));if(n){m[l]=Ext.apply(n,{$store:true})}else{delete m[l]}}else{delete m[l]}}},getStoreChanges:function(o,l){l=l||o.phantomIdField||this.phantomIdField;var m=o.store,n=m.getNewRecords(),p=m.getUpdatedRecords(),k=m.getRemovedRecords(),i=o.stores;var j;if(n.length){n=this.prepareAdded(n,l,i)}if(p.length){p=this.prepareUpdated(p,i,o)}if(k.length){k=this.prepareRemoved(k)}if(n.length||p.length||k.length){j={};if(n.length){j.added=n}if(p.length){j.updated=p}if(k.length){j.removed=k}}return j},getChangeSetPackage:function(){var o={type:"sync",requestId:this.getRequestId(),revision:this.revision};var m=this.stores,i=0;for(var q=0,r=m.length;q<r;q++){var n=m[q],l=n.phantomIdField||this.phantomIdField,k=n.storeId;var p=this.getStoreChanges(n,l);if(p){i++;o[k]=p}}return i?o:null},getSubStoresData:function(k,m,l,n){if(!k){return}var i=[];var r=function(e,d){for(var a=0,c=d.length;a<c;a++){var b=d[a].storeId;if(e[b]){i.push({id:e[l],storeDesc:d[a],data:e[b]});delete e[b]}}};var o=0,p=k.length;if(n){for(;o<p;o++){r(k[o],m);var q=this.getSubStoresData(k[o].children,m,l,true);if(q){i=i.concat(q)}}}else{for(;o<p;o++){r(k[o],m)}}return i},loadDataToStore:function(v,s){var o=v.store,n=v.stores,l=v.idProperty||"id",q=o instanceof Ext.data.TreeStore,p;var i=s&&s.rows;o.metaData=s&&s.metaData;if(i){if(n){p=this.getSubStoresData(i,n,l,q)}o.__loading=true;if(q){o.proxy.data=i;o.load()}else{o.totalCount=s.total;o.currentPage=v.currentPage;o.loadData(i);o.fireEvent("load",o,o.getRange(),true)}if(p){for(var t=0,u=p.length;t<u;t++){var r=p[t];this.loadDataToStore(Ext.apply({store:o[q?"getNodeById":"getById"](r.id).get(r.storeDesc.storeId)},r.storeDesc),r.data)}}o.__loading=false}},loadData:function(f){for(var j=0,g=this.stores.length;j<g;j++){var h=this.stores[j],i=f[h.storeId];if(i){this.loadDataToStore(h,i)}}},applyChangesToRecord:function(r,p,j){var q=r.fields,s=r.data,t={},v=false,x;if(j){for(var u=0,w=j.length;u<w;u++){x=j[u].storeId;if(p.hasOwnProperty(x)){t[x]=true;var n=r.get(x);if(n){this.applyChangesToStore(Ext.apply({store:n},j[u]),p[x])}else{Ext.log("Can't find store for the response sub-package")}}}}for(x in p){if(p.hasOwnProperty(x)&&!t[x]){var o=p[x];if(!r.isEqual(s[x],o)){if(!v){v=true;r.beginEdit()}if(x===r.idProperty){r.setId(o)}else{r.set(x,o)}}}}this.ignoreUpdates++;if(v){r.endEdit()}this.ignoreUpdates--;r.commit()},applyRemovals:function(r,t,A){var k=A.idProperty,s=r.getRemovedRecords(),j=A.findByIdFn,D=A.removeRecordFn,w=0;for(var x=0,z=t.length;x<z;x++){var y=false;var B=t[x][k];for(var u=0,C=s.length;u<C;u++){if(s[u].getId()==B){s.splice(u,1);y=true;w++;break}}if(!y){var v=j(B);if(v){this.ignoreUpdates++;D(v);Ext.Array.remove(s,v);w++;this.ignoreUpdates--}else{Ext.log("Can't find record to remove from the response package")}}}return w},applyChangesToStore:function(K,k){var B,C,E;var Q=K.phantomIdField||this.phantomIdField,J=K.idProperty,F=K.store;if(!J){var N=F.getModel&&F.getModel()||F.model;N=N&&N.prototype;J=N&&N.idProperty||"id"}var D=function(a){return F.data.getByKey(a)},s=function(a){return F.getById(a)},L=function(a){return F.getNodeById(a)},R,z;var G,H;if(F instanceof Ext.data.TreeStore){G=H=L;R=function(a){var b=(a.parentId&&F.getNodeById(a.parentId))||F.getRootNode();return b.appendChild(a)};z=function(a){return a.parentNode.removeChild(a)}}else{G=D;H=s;R=function(a){return F.add(a)[0]};z=function(a){return F.remove(a)}}var I=k.rows,A=k.removed,P;if(I){var j,O,M=K.stores;for(B=0,C=I.length;B<C;B++){j=I[B];O=j[Q];E=j[J];P=null;if(O!=null){P=G(O)}else{if(J){P=H(E)}}if(P){this.applyChangesToRecord(P,j,M)}else{this.ignoreUpdates++;P=R(j);this.ignoreUpdates--;P.commit()}}}if(A&&this.applyRemovals(F,A,{idProperty:J,findByIdFn:H,removeRecordFn:z})){F.fireEvent("datachanged",F)}},applySyncResponse:function(j){var f=this.syncApplySequence||this.stores;for(var i=0,g=f.length;i<g;i++){var h=j[f[i].storeId];if(h){this.applyChangesToStore(f[i],h)}}},applyLoadResponse:function(b){this.loadData(b)},applyResponse:function(d,c){if(this.trackResponseType){d=c.type||d}switch(d){case"load":this.applyLoadResponse(c);break;case"sync":this.applySyncResponse(c);break}},getRequestId:function(){return Ext.Date.now()},onResponse:function(f,h,g){this.activeRequests[f]=null;var e=this.decode(h);if(!e||!e.success){this.fireEvent("requestfail",this,f,e,g);this.fireEvent(f+"fail",this,e,g);this.warn("CrudManager: "+f+" failed, please inspect the server response",h);return e}if((this.fireEvent("beforeresponseapply",this,f,e)!==false)&&(this.fireEvent("before"+f+"apply",this,e)!==false)){this.revision=e.revision;this.applyResponse(f,e);this.fireEvent("requestdone",this,f,e,g);this.fireEvent(f,this,e,g);if(!this.hasChanges()){this.fireEvent("nochanges",this)}}return e},onLoad:function(d,c){return this.onResponse("load",d,c)},onSync:function(d,c){return this.onResponse("sync",d,c)},load:function(h,g,i){var f;if(typeof h==="object"){f=h;h=g;g=i;i=arguments[3]}var j=this.getLoadPackage(f);if(this.fireEvent("beforeload",this,j)!==false){i=i||this;if(this.activeRequests.load){this.cancelRequest(this.activeRequests.load.desc);this.fireEvent("loadcanceled",this,j)}this.activeRequests.load={id:j.requestId};this.activeRequests.load.desc=this.sendRequest({data:this.encode(j),type:"load",success:function(b,a){var c=this.onLoad(b,a);if(g&&(!c||!c.success)){g.call(i,c,b)}else{if(h){h.call(i,c,b)}}},failure:function(b,a){this.onLoad(b,a);if(g){g.apply(i,arguments)}},scope:this})}else{this.fireEvent("loadcanceled",this,j)}},sync:function(g,f,h){if(this.activeRequests.sync){this.delayedSyncs.push(arguments);this.fireEvent("syncdelayed",this,arguments);return}var e=this.getChangeSetPackage();h=h||this;if(!e){if(g){g.call(h,null,null)}return}if(this.fireEvent("beforesync",this,e)===false){this.fireEvent("synccanceled",this,e);return}this.activeRequests.sync={id:e.requestId};this.activeRequests.sync.desc=this.sendRequest({data:this.encode(e),type:"sync",success:function(a,c){var b=this.activeRequests.sync;var d=this.onSync(a,c);if(f&&(!d||!d.success)){f.call(h,d,a,b)}else{if(g){g.call(h,d,a,b)}}this.runDelayedSync()},failure:function(a,b){this.onSync(a,b);if(f){f.apply(h,arguments)}this.runDelayedSync()},scope:this})},runDelayedSync:function(){var b=this.delayedSyncs.shift();if(!b){return}this.sync.apply(this,b)},commit:function(){for(var c=0,d=this.stores.length;c<d;c++){this.stores[c].store.commitChanges()}},reject:function(){for(var c=0,d=this.stores.length;c<d;c++){this.stores[c].store.rejectChanges()}},warn:function(){if("console" in window){var b=console;b.log&&b.log.apply&&b.log.apply(b,arguments)}},isLoading:function(){return !!this.activeRequests.load}});Ext.define("Sch.crud.transport.Ajax",{defaultMethod:{load:"GET",sync:"POST"},cancelRequest:function(b){Ext.Ajax.abort(b)},sendRequest:function(h){var n=h.data,m=this.transport[h.type],l=m.paramName,k=Ext.apply({},m&&m.params),j=m.method||this.defaultMethod[h.type];var i=Ext.apply({url:m.url,method:j,params:k,failure:h.failure,success:function(b,a){if(h.success){h.success.call(h.scope||this,b.responseXml||b.responseText)}},scope:h.scope},m.requestConfig);if(!l){if(this.format==="xml"){Ext.apply(i,{xmlData:n})}else{Ext.apply(i,{jsonData:n})}}else{i.params=i.params||{};i.params[l]=n}this.fireEvent("beforesend",this,k,h.type,i);return Ext.Ajax.request(i)}});Ext.define("Sch.crud.encoder.Json",{format:"json",encode:function(b){return Ext.JSON.encode(b)},decode:function(b){if(typeof b=="object"){return b}return Ext.JSON.decode(b,true)}});Ext.define("Sch.crud.encoder.Xml",{requires:["Ext.XTemplate"],format:"xml",stringReplaces:[[/&/g,"&amp;"],[/</g,"&lt;"],[/>/g,"&gt;"],[/"/g,"&quot;"]],encodeString:function(h){if(!h){return h}var g=h.toString(),j=this.stringReplaces;for(var i=0,f=j.length;i<f;i++){g=g.replace(j[i][0],j[i][1])}return g},encodeRecords:function(h){var f="";for(var g=0,e=h.length;g<e;g++){f+=this.encodeRecord(h[g])}return f},encodeRecord:function(e){var f="<record>";for(var h in e){var g=e[h];f+='<field id="'+this.encodeString(h)+'">'+(g&&g.$store?this.encodeStoreChanges({storeId:h},g):this.encodeString(g))+"</field>"}f+="</record>";return f},encodeStoreChanges:function(d,f){var e='<store id="'+this.encodeString(d.storeId)+'">';if(f.added){e+="<added>"+this.encodeRecords(f.added)+"</added>"}if(f.updated){e+="<updated>"+this.encodeRecords(f.updated)+"</updated>"}if(f.removed){e+="<removed>"+this.encodeRecords(f.removed)+"</removed>"}e+="</store>";return e},encode:function(h){var g,i,f,j;switch(h.type){case"load":g='<load requestId="'+this.encodeString(h.requestId)+'">';for(i=0,f=h.stores.length;i<f;i++){j=h.stores[i];if(typeof j==="string"){g+='<store id="'+this.encodeString(j)+'"/>'}else{g+='<store id="'+this.encodeString(j.storeId)+'" page="'+this.encodeString(j.page)+'" pageSize="'+this.encodeString(j.pageSize)+'"/>'}}g+="</load>";return g;case"sync":g='<sync requestId="'+this.encodeString(h.requestId)+'" revision="'+this.encodeString(h.revision)+'">';for(i in h){if(h.hasOwnProperty(i)){j=this.getStore(i);if(j){g+=this.encodeStoreChanges(j,h[i])}}}g+="</sync>";break}return g},stringToXML:function(c){if(!c){return}var d;if(window.DOMParser){d=(new DOMParser()).parseFromString(c,"text/xml")}else{if(window.ActiveXObject){d=new ActiveXObject("Microsoft.XMLDOM");d.async=false;d.loadXML(c)}}return d},decodeRecords:function(g){var e=[];for(var h=0,f=g.length;h<f;h++){e.push(this.decodeRecord(g[h]))}return e},decodeRecord:function(m){var i=m.childNodes,j={},l;for(var n=0,p=i.length;n<p;n++){var k=i[n];if(k.nodeName=="field"){l="";if(k.firstChild){var o=this.getElementByTagName(k,"store");l=o?this.decodeStore(o):k.firstChild.nodeValue}j[k.getAttribute("id")]=l}}return j},getElementsByTagName:function(i,l){var j=i.childNodes,g=[];for(var k=0,h=j.length;k<h;k++){if(j[k].nodeName==l){g.push(j[k])}}return g},getElementByTagName:function(h,f){var i=h.childNodes;for(var j=0,g=i.length;j<g;j++){if(i[j].nodeName==f){return i[j]}}},decodeStore:function(g){var i={},j=this.getElementsByTagName(g,"rows");if(j.length){i.rows=this.decodeRecords(this.getElementsByTagName(j[0],"record"));var f=parseInt(j[0].getAttribute("total"),10);if(isNaN(f)||f<i.rows.length){f=i.rows.length}i.total=f}var h=this.getElementByTagName(g,"removed");if(h){i.removed=this.decodeRecords(this.getElementsByTagName(h,"record"))}return i},decode:function(t){var q=typeof t=="string"?this.stringToXML(t):t;if(!q){return}var i={},p=q.documentElement,n=p.getElementsByTagName("store"),o,m;i.requestId=p.getAttribute("requestId");i.revision=p.getAttribute("revision");i.success=p.getAttribute("success")||"false";i.success=i.success.toLowerCase()=="true";if(!i.success){i.code=p.getAttribute("code");var l=p.getElementsByTagName("message")[0];i.message=l&&l.firstChild&&l.firstChild.nodeValue}for(var r=0,s=n.length;r<s;r++){o=n[r];m=o.getAttribute("id");if(this.getStore(m)){i[m]=this.decodeStore(o)}}return i}});Ext.define("Sch.data.CrudManager",{extend:"Sch.crud.AbstractManager",mixins:["Sch.crud.encoder.Json","Sch.crud.transport.Ajax"],resourceStore:null,eventStore:null,assignmentStore:null,addRelatedStores:true,constructor:function(p){p=p||{};var m=p.resourceStore||this.resourceStore,o=p.eventStore||this.eventStore,k=p.assignmentStore||this.assignmentStore,i=[];if(o&&p.addRelatedStores!==false){var j=this.getEventStoreInfo(o,p);k=k||j.assignmentStore;m=m||j.resourceStore}o&&i.push(o);m&&i.push(m);k&&i.push(k);if(i.length){var l=[];m&&l.push(m);o&&l.push(o);k&&l.push(k);if(l.length){p.syncApplySequence=(p.syncApplySequence||p.stores||[]).concat(l)}var n=p.stores||this.stores;if(n&&!Ext.isArray(n)){n=[n]}p.stores=(n||[]).concat(i)}this.callParent([p]);this.eventStore=this.getStoreDescriptor(o);this.resourceStore=this.getStoreDescriptor(m);this.assignmentStore=this.getStoreDescriptor(k)},getEventStoreInfo:function(j,f){if(!(j instanceof Ext.data.AbstractStore)){if(typeof j=="string"){j=Ext.data.StoreManager.get(j)}else{j=j.store}}var g={},h=f.assignmentStore,i=f.resourceStore;!h&&(g.assignmentStore=j.getAssignmentStore());!i&&(g.resourceStore=j.getResourceStore());return g},getResourceStore:function(){return this.resourceStore&&this.resourceStore.store},getEventStore:function(){return this.eventStore&&this.eventStore.store},getAssignmentStore:function(){return this.assignmentStore&&this.assignmentStore.store}});Ext.define("Sch.util.Date",{requires:"Ext.Date",mixins:["Sch.mixin.Localizable"],singleton:true,stripEscapeRe:/(\\.)/g,hourInfoRe:/([gGhHisucUOPZ]|MS)/,unitHash:null,unitsByName:{},constructor:function(){var e=Ext.Date;var f=this.unitHash={MILLI:e.MILLI,SECOND:e.SECOND,MINUTE:e.MINUTE,HOUR:e.HOUR,DAY:e.DAY,WEEK:"w",MONTH:e.MONTH,QUARTER:"q",YEAR:e.YEAR};Ext.apply(this,f);var d=this;this.units=[d.MILLI,d.SECOND,d.MINUTE,d.HOUR,d.DAY,d.WEEK,d.MONTH,d.QUARTER,d.YEAR]},onLocalized:function(){this.setUnitNames(this.L("unitNames"))},setUnitNames:function(i,g){var j=this.unitsByName={};this.l10n.unitNames=i;this._unitNames=Ext.apply({},i);var l=this.unitHash;for(var h in l){if(l.hasOwnProperty(h)){var k=l[h];this._unitNames[k]=this._unitNames[h];j[h]=k;j[k]=k}}},betweenLesser:function(e,g,f){var h=e.getTime();return g.getTime()<=h&&h<f.getTime()},constrain:function(d,f,e){return this.min(this.max(d,f),e)},compareUnits:function(h,e){var f=Ext.Array.indexOf(this.units,h),g=Ext.Array.indexOf(this.units,e);return f>g?1:(f<g?-1:0)},isUnitGreater:function(c,d){return this.compareUnits(c,d)>0},copyTimeValues:function(c,d){c.setHours(d.getHours());c.setMinutes(d.getMinutes());c.setSeconds(d.getSeconds());c.setMilliseconds(d.getMilliseconds())},add:function(d,j,i){var h=Ext.Date.clone(d);if(!j||i===0){return h}switch(j.toLowerCase()){case this.MILLI:h=new Date(d.getTime()+i);break;case this.SECOND:h=new Date(d.getTime()+(i*1000));break;case this.MINUTE:h=new Date(d.getTime()+(i*60000));break;case this.HOUR:h=new Date(d.getTime()+(i*3600000));break;case this.DAY:h.setDate(d.getDate()+i);if(h.getHours()===23&&d.getHours()===0){h=Ext.Date.add(h,Ext.Date.HOUR,1)}break;case this.WEEK:h.setDate(d.getDate()+i*7);break;case this.MONTH:var g=d.getDate();if(g>28){g=Math.min(g,Ext.Date.getLastDateOfMonth(this.add(Ext.Date.getFirstDateOfMonth(d),this.MONTH,i)).getDate())}h.setDate(g);h.setMonth(h.getMonth()+i);break;case this.QUARTER:h=this.add(d,this.MONTH,i*3);break;case this.YEAR:h.setFullYear(d.getFullYear()+i);break}return h},getUnitDurationInMs:function(b){return this.add(new Date(1,0,1),b,1)-new Date(1,0,1)},getMeasuringUnit:function(b){if(b===this.WEEK){return this.DAY}return b},getDurationInUnit:function(h,g,j,i){var f;switch(j){case this.YEAR:f=this.getDurationInYears(h,g);break;case this.QUARTER:f=this.getDurationInMonths(h,g)/3;break;case this.MONTH:f=this.getDurationInMonths(h,g);break;case this.WEEK:f=this.getDurationInDays(h,g)/7;break;case this.DAY:f=this.getDurationInDays(h,g);break;case this.HOUR:f=this.getDurationInHours(h,g);break;case this.MINUTE:f=this.getDurationInMinutes(h,g);break;case this.SECOND:f=this.getDurationInSeconds(h,g);break;case this.MILLI:f=this.getDurationInMilliseconds(h,g);break}return i?f:Math.round(f)},getUnitToBaseUnitRatio:function(c,d){if(c===d){return 1}switch(c){case this.YEAR:switch(d){case this.QUARTER:return 1/4;case this.MONTH:return 1/12}break;case this.QUARTER:switch(d){case this.YEAR:return 4;case this.MONTH:return 1/3}break;case this.MONTH:switch(d){case this.YEAR:return 12;case this.QUARTER:return 3}break;case this.WEEK:switch(d){case this.DAY:return 1/7;case this.HOUR:return 1/168}break;case this.DAY:switch(d){case this.WEEK:return 7;case this.HOUR:return 1/24;case this.MINUTE:return 1/1440}break;case this.HOUR:switch(d){case this.DAY:return 24;case this.MINUTE:return 1/60}break;case this.MINUTE:switch(d){case this.HOUR:return 60;case this.SECOND:return 1/60;case this.MILLI:return 1/60000}break;case this.SECOND:switch(d){case this.MILLI:return 1/1000}break;case this.MILLI:switch(d){case this.SECOND:return 1000}break}return -1},getDurationInMilliseconds:function(c,d){return(d-c)},getDurationInSeconds:function(c,d){return(d-c)/1000},getDurationInMinutes:function(c,d){return(d-c)/60000},getDurationInHours:function(c,d){return(d-c)/3600000},getDurationInDays:function(f,d){var e=f.getTimezoneOffset()-d.getTimezoneOffset();return(d-f+e*60*1000)/86400000},getDurationInMonths:function(c,d){return((d.getFullYear()-c.getFullYear())*12)+(d.getMonth()-c.getMonth())},getDurationInYears:function(c,d){return this.getDurationInMonths(c,d)/12},min:function(c,d){return c<d?c:d},max:function(c,d){return c>d?c:d},intersectSpans:function(h,g,e,f){return this.betweenLesser(h,e,f)||this.betweenLesser(e,h,g)},getNameOfUnit:function(b){b=this.getUnitByName(b);switch(b.toLowerCase()){case this.YEAR:return"YEAR";case this.QUARTER:return"QUARTER";case this.MONTH:return"MONTH";case this.WEEK:return"WEEK";case this.DAY:return"DAY";case this.HOUR:return"HOUR";case this.MINUTE:return"MINUTE";case this.SECOND:return"SECOND";case this.MILLI:return"MILLI"}throw"Incorrect UnitName"},getReadableNameOfUnit:function(c,d){if(!this.isLocaleApplied()){this.applyLocale()}return this._unitNames[c][d?"plural":"single"]},getShortNameOfUnit:function(b){if(!this.isLocaleApplied()){this.applyLocale()}return this._unitNames[b].abbrev},getUnitByName:function(b){if(!this.isLocaleApplied()){this.applyLocale()}if(!this.unitsByName[b]){Ext.Error.raise("Unknown unit name: "+b)}return this.unitsByName[b]},getNext:function(n,j,i,k){var l=Ext.Date.clone(n);k=arguments.length<4?1:k;i=i==null?1:i;switch(j){case this.MILLI:l=this.add(n,j,i);break;case this.SECOND:l=this.add(n,j,i);if(l.getMilliseconds()>0){l.setMilliseconds(0)}break;case this.MINUTE:l=this.add(n,j,i);if(l.getSeconds()>0){l.setSeconds(0)}if(l.getMilliseconds()>0){l.setMilliseconds(0)}break;case this.HOUR:l=this.add(n,j,i);if(l.getMinutes()>0){l.setMinutes(0)}if(l.getSeconds()>0){l.setSeconds(0)}if(l.getMilliseconds()>0){l.setMilliseconds(0)}break;case this.DAY:var m=n.getHours()===23&&this.add(l,this.HOUR,1).getHours()===1;if(m){l=this.add(l,this.DAY,2);this.clearTime(l);return l}this.clearTime(l);l=this.add(l,this.DAY,i);if(l.getHours()===1){this.clearTime(l)}break;case this.WEEK:this.clearTime(l);var h=l.getDay();l=this.add(l,this.DAY,k-h+7*(i-(k<=h?0:1)));if(l.getDay()!==k){l=this.add(l,this.HOUR,1)}else{this.clearTime(l)}break;case this.MONTH:l=this.add(l,this.MONTH,i);l.setDate(1);this.clearTime(l);break;case this.QUARTER:l=this.add(l,this.MONTH,((i-1)*3)+(3-(l.getMonth()%3)));this.clearTime(l);l.setDate(1);break;case this.YEAR:l=new Date(l.getFullYear()+i,0,1);break;default:throw"Invalid date unit"}return l},getNumberOfMsFromTheStartOfDay:function(b){return b-this.clearTime(b,true)||86400000},getNumberOfMsTillTheEndOfDay:function(b){return this.getStartOfNextDay(b,true)-b},getStartOfNextDay:function(g,i,j){var k=this.add(j?g:this.clearTime(g,i),this.DAY,1);if(k.getDate()==g.getDate()){var l=this.add(this.clearTime(g,i),this.DAY,2).getTimezoneOffset();var h=g.getTimezoneOffset();k=this.add(k,this.MINUTE,h-l)}return k},getEndOfPreviousDay:function(d,f){var e=f?d:this.clearTime(d,true);if(e-d){return e}else{return this.add(e,this.DAY,-1)}},timeSpanContains:function(h,e,g,f){return(g-h)>=0&&(e-f)>=0},compareWithPrecision:function(j,l,i){var k=Sch.util.Date,g=Ext.Date,h;switch(i){case k.DAY:j=Number(g.format(j,"Ymd"));l=Number(g.format(l,"Ymd"));break;case k.WEEK:j=Number(g.format(j,"YmW"));l=Number(g.format(l,"YmW"));break;case k.MONTH:j=Number(g.format(j,"Ym"));l=Number(g.format(l,"Ym"));break;case k.QUARTER:j=j.getFullYear()*4+Math.floor(j.getMonth()/3);l=l.getFullYear()*4+Math.floor(l.getMonth()/3);break;case k.YEAR:j=j.getFullYear();l=l.getFullYear();break;default:case k.MILLI:case k.SECOND:case k.MINUTE:case k.HOUR:i=i&&this.getUnitDurationInMs(i)||1;j=Math.floor(j.valueOf()/i);l=Math.floor(l.valueOf()/i);break}((j<l)&&(h=-1))||((j>l)&&(h=+1))||(h=0);return h},getValueInUnits:function(d,c){switch(c){case this.MONTH:return d.getMonth();case this.DAY:return d.getDate();case this.HOUR:return d.getHours();case this.MINUTE:return d.getMinutes();case this.SECOND:return d.getSeconds()}},setValueInUnits:function(f,j,h){var g=Ext.Date.clone(f),i;switch(j){case this.YEAR:i="setFullYear";break;case this.MONTH:i="setMonth";break;case this.DAY:i="setDate";break;case this.HOUR:i="setHours";break;case this.MINUTE:i="setMinutes";break;case this.SECOND:i="setSeconds";break;case this.MILLI:i="setMilliseconds";break}g[i](h);return g},getSubUnit:function(b){switch(b){case this.YEAR:return this.MONTH;case this.MONTH:return this.DAY;case this.DAY:return this.HOUR;case this.HOUR:return this.MINUTE;case this.MINUTE:return this.SECOND;case this.SECOND:return this.MILLI}},setValueInSubUnits:function(e,d,f){d=this.getSubUnit(d);return this.setValueInUnits(e,d,f)},mergeDates:function(h,e,f){var g=Ext.Date.clone(h);switch(f){case this.YEAR:g.setFullYear(e.getFullYear());case this.MONTH:g.setMonth(e.getMonth());case this.WEEK:case this.DAY:if(f===this.WEEK){g=this.add(g,this.DAY,e.getDay()-g.getDay())}else{g.setDate(e.getDate())}case this.HOUR:g.setHours(e.getHours());case this.MINUTE:g.setMinutes(e.getMinutes());case this.SECOND:g.setSeconds(e.getSeconds());case this.MILLI:g.setMilliseconds(e.getMilliseconds())}return g},splitToSubUnits:function(g,h,f,e){f=f||1;e=arguments.length<4?1:e;switch(h){case this.MONTH:return this.splitMonth(g,f,e);case this.WEEK:case this.DAY:return this.splitDay(g,f);default:break}},splitYear:function(h,j){var f=this.clearTime(h,true);f.setMonth(0);f.setDate(1);var g=[];for(var i=0;i<=12;i=i+j){g.push(this.add(f,this.MONTH,i))}return g},splitMonth:function(k,p,l){var i=this.clearTime(k,true);i.setDate(1);i=this.add(i,this.DAY,l-i.getDay());var o=Ext.Date.clone(i);var m=this.add(i,this.MONTH,1);var j=[];for(var n=0;o.getTime()<m.getTime();n=n+p){o=this.add(i,this.WEEK,n);j.push(o)}return j},splitWeek:function(i,l,j){var g=this.add(i,this.DAY,j-i.getDay());g=this.clearTime(g);var h=[];for(var k=0;k<=7;k=k+l){h.push(this.add(g,this.DAY,k))}return h},splitDay:function(h,f){var i=this.clearTime(h,true);var g=[];for(var j=0;j<=24;j=j+f){g.push(this.add(i,this.HOUR,j))}return g},splitHour:function(h,f){var i=new Date(h.getTime());i.setMinutes(0);i.setSeconds(0);i.setMilliseconds(0);var g=[];for(var j=0;j<=60;j=j+f){g.push(this.add(i,this.MINUTE,j))}return g},splitMinute:function(h,f){var i=Ext.Date.clone(h);i.setSeconds(0);i.setMilliseconds(0);var g=[];for(var j=0;j<=60;j=j+f){g.push(this.add(i,this.SECOND,j))}return g},clearTime:function(d,c){if(d.getHours()>0||d.getMinutes()>0||d.getSeconds()>0){return Ext.Date.clearTime(d,c)}return c?Ext.Date.clone(d):d}});Ext.define("Sch.util.Debug",{singleton:true,runDiagnostics:function(){var A;var u=this;var C=window.console;if(C&&C.log){A=function(){C.log.apply(C,arguments)}}else{if(!u.schedulerDebugWin){u.schedulerDebugWin=new Ext.Window({height:400,width:500,bodyStyle:"padding:10px",closeAction:"hide",autoScroll:true})}u.schedulerDebugWin.show();u.schedulerDebugWin.update("");A=function(a){u.schedulerDebugWin.update((u.schedulerDebugWin.body.dom.innerHTML||"")+a+"<br/>")}}var z=Ext.select(".sch-schedulerpanel");if(z.getCount()===0){A("No scheduler component found")}var i=Ext.getCmp(z.elements[0].id),r=i.getResourceStore(),B=i.getEventStore();if(!B.isEventStore){A("Your event store must be or extend Sch.data.EventStore")}A("Scheduler view start: "+i.getStart()+", end: "+i.getEnd());if(!r){A("No store configured");return}if(!B){A("No event store configured");return}var x=new Ext.util.MixedCollection(),v=new Ext.util.MixedCollection();for(var y=0;y<B.model.prototype.fields.length;y++){x.add(B.model.prototype.fields[y].name,B.model.prototype.fields[y])}for(y=0;y<r.model.prototype.fields.length;y++){v.add(r.model.prototype.fields[y].name,r.model.prototype.fields[y])}A(r.getCount()+" records in the resource store");A(B.getCount()+" records in the eventStore");var q=B.model.prototype.idProperty;var D=r.model.prototype.idProperty;var s=x.getByKey(q);var w=v.getByKey(D);if(!(new B.model() instanceof Sch.model.Event)){A("Your event model must extend Sch.model.Event")}if(!(new r.model() instanceof Sch.model.Resource)){A("Your resource model must extend Sch.model.Resource")}if(!s){A("idProperty on the event model is incorrectly setup, value: "+q)}if(!w){A("idProperty on the resource model is incorrectly setup, value: "+D)}var t=i.getSchedulingView();A(t.el.select(t.eventSelector).getCount()+" events present in the DOM");if(B.getCount()>0){if(!B.first().getStartDate()||!(B.first().getStartDate() instanceof Date)){A("The eventStore reader is misconfigured - The StartDate field is not setup correctly, please investigate");A("StartDate is configured with dateFormat: "+x.getByKey(B.model.prototype.startDateField).dateFormat);A("See Ext JS docs for information about different date formats: http://docs.sencha.com/extjs/#!/api/Ext.Date")}if(!B.first().getEndDate()||!(B.first().getEndDate() instanceof Date)){A("The eventStore reader is misconfigured - The EndDate field is not setup correctly, please investigate");A("EndDate is configured with dateFormat: "+x.getByKey(B.model.prototype.endDateField).dateFormat);A("See Ext JS docs for information about different date formats: http://docs.sencha.com/extjs/#!/api/Ext.Date")}if(B.proxy&&B.proxy.reader&&B.proxy.reader.jsonData){A("Dumping jsonData to console");console&&console.dir&&console.dir(B.proxy.reader.rawData)}A("Records in the event store:");B.each(function(a,b){A((b+1)+". "+a.startDateField+":"+a.getStartDate()+", "+a.endDateField+":"+a.getEndDate()+", "+a.resourceIdField+":"+a.getResourceId());if(!a.getStartDate()){A(a.getStartDate())}})}else{A("Event store has no data. Has it been loaded properly?")}if(r instanceof Ext.data.TreeStore){r=r.nodeStore}if(r.getCount()>0){A("Records in the resource store:");r.each(function(a,b){A((b+1)+". "+a.idProperty+":"+a.getId());return})}else{A("Resource store has no data.");return}A("Everything seems to be setup ok!")}});Ext.define("Sch.util.DragTracker",{extend:"Ext.dd.DragTracker",requires:["Ext.util.Region"],xStep:1,yStep:1,deferredActivation:0,constructor:function(){this.callParent(arguments);this.on("dragstart",function(){var c=this.el;var d={scroll:this.onMouseMove,pinchstart:this.onMouseUp,scope:this};c.on(d);this.on("dragend",function(){c.un(d)},this,{single:true})});this.moveListener={pinchstart:this.abortWait,touchend:this.abortWait,mouseup:this.abortWait,mousemove:this.onMoveWhileWaiting,scope:this,capture:true}},setXStep:function(b){this.xStep=b},startScroll:null,deferTimer:null,deferTolerance:10,moveListener:null,setYStep:function(b){this.yStep=b},onMoveWhileWaiting:function(g,f){var h=g.getXY();var e=this.startXY;if(Math.max(Math.abs(e[0]-h[0]),Math.abs(e[1]-h[1]))>this.deferTolerance){this.abortWait();this.onMouseUp(g)}},abortWait:function(){clearTimeout(this.deferTimer);this.deferTimer=null;Ext.getDoc().un(this.moveListener)},getRegion:function(){var q=this.startXY,u=this.el.getScroll(),o=this.getXY(),x=o[0],y=o[1],s=u.left-this.startScroll.left,n=u.top-this.startScroll.top,r=q[0]-s,t=q[1]-n,v=Math.min(r,x),w=Math.min(t,y),z=Math.abs(r-x),p=Math.abs(t-y);return new Ext.util.Region(w,v+z,w+p,v)},onMouseDown:function(f,d){if(f.event.touches&&f.event.touches.length>1){return}f.stopPropagation=Ext.emptyFn;this.startXY=f.getXY();if(this.deferredActivation){var e=this;Ext.getDoc().on(this.moveListener);this.deferTimer=setTimeout(function(){var a=e.deferredActivation;Ext.getDoc().un(e.moveListener);e.deferredActivation=false;e.onMouseDown(f,d);e.deferredActivation=a},this.deferredActivation);return}this.callParent([f,d]);this.lastXY=this.startXY;this.startScroll=this.el.getScroll()},onMouseMove:function(k,l){if(this.active&&k.type==="mousemove"&&Ext.isIE9m&&!k.browserEvent.button){k.preventDefault();this.onMouseUp(k);return}k.preventDefault();var m=k.type==="scroll"?this.lastXY:k.getXY(),e=this.startXY;if(!this.active){if(Math.max(Math.abs(e[0]-m[0]),Math.abs(e[1]-m[1]))>this.tolerance){this.triggerStart(k)}else{return}}var i=m[0],j=m[1];if(this.xStep>1){i-=this.startXY[0];i=Math.round(i/this.xStep)*this.xStep;i+=this.startXY[0]}if(this.yStep>1){j-=this.startXY[1];j=Math.round(j/this.yStep)*this.yStep;j+=this.startXY[1]}var n=this.xStep>1||this.yStep>1;if(!n||i!==m[0]||j!==m[1]){this.lastXY=[i,j];if(this.fireEvent("mousemove",this,k)===false){this.onMouseUp(k)}else{this.onDrag(k);this.fireEvent("drag",this,k)}}}});Ext.define("Sch.util.ScrollManager",{singleton:true,vthresh:25,hthresh:25,increment:100,frequency:500,animate:true,animDuration:200,activeCmp:null,activeEl:null,targetScroller:null,scrollElRegion:null,scrollProcess:{},pt:null,scrollWidth:null,scrollHeight:null,direction:"both",constructor:function(){this.doScroll=Ext.Function.bind(this.doScroll,this)},triggerRefresh:function(){if(this.activeEl){this.refreshElRegion();this.clearScrollInterval();this.onMouseMove()}},doScroll:function(){var m=this.scrollProcess,n=m.cmp,o=m.dir[0],i=this.increment,k=this.activeCmp.getScrollX(),l=this.activeCmp.getScrollY();if(o==="r"){i=Math.min(i,this.scrollWidth-k-this.activeEl.dom.clientWidth)}else{if(o==="d"){i=Math.min(i,this.scrollHeight-l-this.activeEl.dom.clientHeight)}}i=Math.max(i,0);var p=0,j=0;if(o==="r"){p=i}if(o==="l"){p=-i}if(o==="u"){j=-i}if(o==="d"){j=i}n.scrollBy(p,j,{duration:this.animDuration,callback:this.triggerRefresh,scope:this})},clearScrollInterval:function(){var b=this.scrollProcess;if(b.id){clearTimeout(b.id)}b.id=0;b.cmp=null;b.dir=""},isScrollAllowed:function(b){switch(this.direction){case"both":return true;case"horizontal":return b==="right"||b==="left";case"vertical":return b==="up"||b==="down";default:throw"Invalid direction: "+this.direction}},startScrollInterval:function(c,d){if(!this.isScrollAllowed(d)){return}this.clearScrollInterval();this.scrollProcess.cmp=c;this.scrollProcess.dir=d;this.scrollProcess.id=setTimeout(this.doScroll,this.frequency)},onMouseMove:function(u){var e=u?u.getPoint():this.pt,o=e.x,p=e.y,t=this.scrollProcess,w=this.activeCmp.getScrollX(),x=this.activeCmp.getScrollY(),z,q=this.activeCmp,y=this.activeEl,r=this.scrollElRegion,v=y.dom,s=this;this.pt=e;if(r&&r.contains(e)&&y.isScrollable()){if(r.bottom-p<=s.vthresh&&(this.scrollHeight-x-v.clientHeight>0)){if(t.cmp!=q){this.startScrollInterval(this.activeCmp,"down")}return}else{if(r.right-o<=s.hthresh&&(this.scrollWidth-w-v.clientWidth>0)){if(t.cmp!=q){this.startScrollInterval(this.activeCmp,"right")}return}else{if(p-r.top<=s.vthresh&&x>0){if(t.cmp!=q){this.startScrollInterval(this.activeCmp,"up")}return}else{if(o-r.left<=s.hthresh&&w>0){if(t.cmp!=q){this.startScrollInterval(this.activeCmp,"left")}return}}}}}this.clearScrollInterval()},refreshElRegion:function(){this.scrollElRegion=this.activeEl.getRegion()},activate:function(d,c){this.direction=c||"both";this.activeCmp=d;this.activeEl=d.getEl();if(d.scrollManager){this.targetScroller=d.scrollManager.scroller;this.scrollWidth=this.targetScroller.getMaxPosition().x;this.scrollHeight=this.targetScroller.getMaxPosition().y}else{this.scrollWidth=this.activeEl.dom.scrollWidth;this.scrollHeight=this.activeEl.dom.scrollHeight}this.refreshElRegion();this.activeEl.on("mousemove",this.onMouseMove,this)},deactivate:function(){this.clearScrollInterval();this.activeEl.un("mousemove",this.onMouseMove,this);this.targetScroller=this.activeEl=this.activeCmp=this.scrollElRegion=this.scrollWidth=this.scrollHeight=null;this.direction="both"}});Ext.define("Sch.util.Cache",{cache:null,constructor:function(){this.cache={}},key:function(c){var d;if(c instanceof Ext.data.Model){d=c.getId().toString()}else{if(c===undefined||c===null){d="[ undefined / null ]"}else{d=(c).toString()}}return d},get:function(e,h){var g=this,f;e=g.key(e);f=g.cache.hasOwnProperty(e)&&g.cache[e];if(!f&&h){f=h()}else{if(!f){f=[]}}g.cache[e]=f;return f},add:function(h,e){var g=this,f=g.key(h);if(!g.cache.hasOwnProperty(f)){g.cache[f]=g.get(h)}Ext.Array.include(g.cache[f],e);return g},remove:function(d,e){var f=this;d=f.key(d);if(f.cache.hasOwnProperty(d)){Ext.Array.remove(f.cache[d],e)}return f},move:function(h,g,f){var e=this;h=e.key(h);g=e.key(g);if(h!=g&&arguments.length>=3){e.remove(h,f);e.add(g,f)}else{if(h!=g&&e.cache.hasOwnProperty(h)&&e.cache.hasOwnProperty(g)){e.cache[g]=Ext.Array.union(e.cache[g],e.cache[h]);e.cache[h]=[]}else{if(h!=g&&e.cache.hasOwnProperty(h)){e.cache[g]=e.cache[h];e.cache[h]=[]}}}},clear:function(d){var c=this;if(!arguments.length){c.cache={}}else{d=c.key(d);if(c.cache.hasOwnProperty(d)){delete c.cache[d]}}return c},uncache:function(d){var f=this,e;for(e in f.cache){if(f.cache.hasOwnProperty(e)){f.cache[e]=Ext.Array.remove(f.cache[e],d)}}return f}});Ext.define("Sch.preset.ViewPreset",{name:null,rowHeight:null,timeColumnWidth:50,timeRowHeight:null,timeAxisColumnWidth:null,displayDateFormat:"G:i",shiftUnit:"HOUR",shiftIncrement:1,defaultSpan:12,timeResolution:null,headerConfig:null,columnLinesFor:"middle",headers:null,mainHeader:0,constructor:function(b){Ext.apply(this,b)},getHeaders:function(){if(this.headers){return this.headers}var b=this.headerConfig;this.mainHeader=b.top?1:0;return this.headers=[].concat(b.top||[],b.middle||[],b.bottom||[])},getMainHeader:function(){return this.getHeaders()[this.mainHeader]},getBottomHeader:function(){var b=this.getHeaders();return b[b.length-1]},clone:function(){var d={};var c=this;Ext.each(["rowHeight","timeColumnWidth","timeRowHeight","timeAxisColumnWidth","displayDateFormat","shiftUnit","shiftIncrement","defaultSpan","timeResolution","headerConfig"],function(a){d[a]=c[a]});return new this.self(Ext.clone(d))}});Ext.define("Sch.preset.Manager",{extend:"Ext.util.MixedCollection",requires:["Sch.util.Date","Sch.preset.ViewPreset"],mixins:["Sch.mixin.Localizable"],singleton:true,defaultPresets:{secondAndMinute:{timeColumnWidth:30,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"G:i:s",shiftIncrement:10,shiftUnit:"MINUTE",defaultSpan:24,timeResolution:{unit:"SECOND",increment:5},headerConfig:{middle:{unit:"SECOND",increment:10,align:"center",dateFormat:"s"},top:{unit:"MINUTE",align:"center",dateFormat:"D, d g:iA"}}},minuteAndHour:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"G:i",shiftIncrement:1,shiftUnit:"HOUR",defaultSpan:24,timeResolution:{unit:"MINUTE",increment:30},headerConfig:{middle:{unit:"MINUTE",increment:"30",align:"center",dateFormat:"i"},top:{unit:"HOUR",align:"center",dateFormat:"D, gA/d"}}},hourAndDay:{timeColumnWidth:60,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"G:i",shiftIncrement:1,shiftUnit:"DAY",defaultSpan:24,timeResolution:{unit:"MINUTE",increment:30},headerConfig:{middle:{unit:"HOUR",align:"center",dateFormat:"G:i"},top:{unit:"DAY",align:"center",dateFormat:"D d/m"}}},dayAndWeek:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d G:i",shiftUnit:"DAY",shiftIncrement:1,defaultSpan:5,timeResolution:{unit:"HOUR",increment:1},headerConfig:{middle:{unit:"DAY",align:"center",dateFormat:"D d M"},top:{unit:"WEEK",align:"center",renderer:function(f,d,e){return Sch.util.Date.getShortNameOfUnit("WEEK")+"."+Ext.Date.format(f,"W M Y")}}}},weekAndDay:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"WEEK",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"DAY",increment:1},headerConfig:{bottom:{unit:"DAY",align:"center",increment:1,dateFormat:"d/m"},middle:{unit:"WEEK",dateFormat:"D d M"}}},weekAndMonth:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"WEEK",shiftIncrement:5,defaultSpan:6,timeResolution:{unit:"DAY",increment:1},headerConfig:{middle:{unit:"WEEK",renderer:function(f,d,e){return Ext.Date.format(f,"d M")}},top:{unit:"MONTH",align:"center",dateFormat:"M Y"}}},monthAndYear:{timeColumnWidth:110,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftIncrement:3,shiftUnit:"MONTH",defaultSpan:12,timeResolution:{unit:"DAY",increment:1},headerConfig:{middle:{unit:"MONTH",align:"center",dateFormat:"M Y"},top:{unit:"YEAR",align:"center",dateFormat:"Y"}}},year:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"YEAR",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"MONTH",increment:1},headerConfig:{middle:{unit:"QUARTER",align:"center",renderer:function(f,d,e){return Ext.String.format(Sch.util.Date.getShortNameOfUnit("QUARTER").toUpperCase()+"{0}",Math.floor(f.getMonth()/3)+1)}},top:{unit:"YEAR",align:"center",dateFormat:"Y"}}},manyYears:{timeColumnWidth:50,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"YEAR",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"YEAR",increment:1},headerConfig:{middle:{unit:"YEAR",align:"center",dateFormat:"Y",increment:5},bottom:{unit:"YEAR",align:"center",dateFormat:"y",increment:1}}},weekAndDayLetter:{timeColumnWidth:20,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"WEEK",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"DAY",increment:1},headerConfig:{bottom:{unit:"DAY",align:"center",renderer:function(b){return Ext.Date.dayNames[b.getDay()].substring(0,1)}},middle:{unit:"WEEK",dateFormat:"D d M Y"}}},weekDateAndMonth:{timeColumnWidth:30,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"WEEK",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"DAY",increment:1},headerConfig:{middle:{unit:"WEEK",align:"center",dateFormat:"d"},top:{unit:"MONTH",dateFormat:"Y F"}}},day:{timeRowHeight:40,calendarColumnWidth:200,displayDateFormat:"G:i",shiftIncrement:1,shiftUnit:"DAY",defaultSpan:24,timeResolution:{unit:"MINUTE",increment:30},headerConfig:{bottom:{unit:"HOUR",align:"center",renderer:function(b){return Ext.String.format('<div class="sch-calendarcolumn-ct"><span class="sch-calendarcolumn-hours">{0}</span><span class="sch-calendarcolumn-minutes">{1}</span></div>',Ext.Date.format(b,"H"),Ext.Date.format(b,"i"))}},middle:{unit:"DAY",align:"center",dateFormat:"D d/m",splitUnit:"DAY"}}},week:{timeRowHeight:40,calendarColumnWidth:164,displayDateFormat:"G:i",shiftIncrement:1,shiftUnit:"WEEK",defaultSpan:24,timeResolution:{unit:"MINUTE",increment:30},headerConfig:{bottom:{unit:"HOUR",align:"center",dateFormat:"H:i",renderer:function(b){return Ext.String.format('<div class="sch-calendarcolumn-ct"><span class="sch-calendarcolumn-hours">{0}</span><span class="sch-calendarcolumn-minutes">{1}</span></div>',Ext.Date.format(b,"H"),Ext.Date.format(b,"i"))}},middle:{unit:"WEEK",align:"center",dateFormat:"D d",splitUnit:"DAY"}}},month:{timeColumnWidth:60,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"G:i",shiftIncrement:1,shiftUnit:"MONTH",defaultSpan:4,timeResolution:{unit:"HOUR",increment:12},headerConfig:{bottom:{unit:"DAY",align:"center",dateFormat:"D",splitUnit:"WEEK"},middle:{unit:"WEEK",align:"center",dateFormat:"D d/m"},top:{unit:"MONTH",align:"center",renderer:function(f,d,e){return Ext.Date.format(f,"d/m")+" - "+Ext.Date.format(d,"d/m, Y")},splitUnit:"WEEK"}}}},constructor:function(){this.callParent(arguments);this.registerDefaults()},onLocalized:function(){var b=this;this.eachKey(function(f,e){if(b.l10n[f]){var a=b.L(f);a.displayDateFormat&&(e.displayDateFormat=a.displayDateFormat);a.middleDateFormat&&(e.headerConfig.middle.dateFormat=a.middleDateFormat);a.topDateFormat&&(e.headerConfig.top.dateFormat=a.topDateFormat);a.bottomDateFormat&&(e.headerConfig.bottom.dateFormat=a.bottomDateFormat)}})},registerPreset:function(h,i){if(i){var n=i.headerConfig;var k=Sch.util.Date;for(var j in n){if(n.hasOwnProperty(j)){if(k[n[j].unit]){n[j].unit=k[n[j].unit.toUpperCase()]}if(k[n[j].splitUnit]){n[j].splitUnit=k[n[j].splitUnit.toUpperCase()]}}}if(!i.timeColumnWidth){i.timeColumnWidth=50}if(!i.rowHeight){i.rowHeight=24}var m=i.timeResolution;if(m&&k[m.unit]){m.unit=k[m.unit.toUpperCase()]}var l=i.shiftUnit;if(l&&k[l]){i.shiftUnit=k[l.toUpperCase()]}}if(this.isValidPreset(i)){if(this.containsKey(h)){this.removeAtKey(h)}i.name=h;this.add(h,new Sch.preset.ViewPreset(i))}else{throw"Invalid preset, please check your configuration"}},isValidPreset:function(h){var j=Sch.util.Date,l=true,k=Sch.util.Date.units,g={};for(var i in h.headerConfig){if(h.headerConfig.hasOwnProperty(i)){g[i]=true;l=l&&Ext.Array.indexOf(k,h.headerConfig[i].unit)>=0}}if(!(h.columnLinesFor in g)){h.columnLinesFor="middle"}if(h.timeResolution){l=l&&Ext.Array.indexOf(k,h.timeResolution.unit)>=0}if(h.shiftUnit){l=l&&Ext.Array.indexOf(k,h.shiftUnit)>=0}return l},getPreset:function(b){return this.get(b)},deletePreset:function(b){this.removeAtKey(b)},registerDefaults:function(){var d=this,e=this.defaultPresets;for(var f in e){d.registerPreset(f,e[f])}}});if(!Ext.ClassManager.get("Sch.feature.AbstractTimeSpan")){Ext.define("Sch.feature.AbstractTimeSpan",{extend:"Ext.AbstractPlugin",mixins:{observable:"Ext.util.Observable"},lockableScope:"top",schedulerView:null,timeAxis:null,containerEl:null,expandToFitView:false,disabled:false,cls:null,clsField:"Cls",template:null,store:null,renderElementsBuffered:false,renderDelay:15,refreshSizeOnItemUpdate:true,_resizeTimer:null,_renderTimer:null,showHeaderElements:false,headerTemplate:null,innerHeaderTpl:null,headerContainerCls:"sch-header-secondary-canvas",headerContainerEl:null,renderingDoneEvent:null,constructor:function(b){this.uniqueCls=this.uniqueCls||("sch-timespangroup-"+Ext.id());Ext.apply(this,b);this.mixins.observable.constructor.call(this);this.callParent(arguments)},setDisabled:function(b){if(b){this.removeElements()}this.disabled=b},removeElements:function(){this.removeBodyElements();if(this.showHeaderElements){this.removeHeaderElements()}},getBodyElements:function(){if(this.containerEl){return this.containerEl.select("."+this.uniqueCls)}return null},getHeaderContainerEl:function(){var f=this.headerContainerEl,d=Ext.baseCSSPrefix,e;if(!f||!f.dom){if(this.schedulerView.isHorizontal()){e=this.panel.getHorizontalTimeAxisColumn().headerView.containerEl}else{e=this.panel.el.down("."+d+"grid-inner-locked ."+d+"panel-body ."+d+"grid-view")}if(e){f=e.down("."+this.headerContainerCls);if(!f){f=e.appendChild({cls:this.headerContainerCls})}this.headerContainerEl=f}}return f},getHeaderElements:function(){var b=this.getHeaderContainerEl();if(b){return b.select("."+this.uniqueCls)}return null},removeBodyElements:function(){var b=this.getBodyElements();if(b){b.each(function(a){a.destroy()})}},removeHeaderElements:function(){var b=this.getHeaderElements();if(b){b.each(function(a){a.destroy()})}},getElementId:function(b){return this.uniqueCls+"-"+b.internalId},getHeaderElementId:function(b){return this.uniqueCls+"-header-"+b.internalId},getTemplateData:function(b){return this.prepareTemplateData?this.prepareTemplateData(b):b.data},getElementCls:function(e,f){var d=e.clsField||this.clsField;if(!f){f=this.getTemplateData(e)}return this.cls+" "+this.uniqueCls+" "+(f[d]||"")},getHeaderElementCls:function(e,f){var d=e.clsField||this.clsField;if(!f){f=this.getTemplateData(e)}return"sch-header-indicator "+this.uniqueCls+" "+(f[d]||"")},init:function(d){if(Ext.versions.touch&&!d.isReady()){d.on("viewready",function(){this.init(d)},this);return}if(Ext.isString(this.innerHeaderTpl)){this.innerHeaderTpl=new Ext.XTemplate(this.innerHeaderTpl)}var c=this.innerHeaderTpl;if(!this.headerTemplate){this.headerTemplate=new Ext.XTemplate('<tpl for=".">','<div id="{id}" class="{cls}" style="{side}:{position}px;">'+(c?"{[this.renderInner(values)]}":"")+"</div>","</tpl>",{renderInner:function(a){return c.apply(a)}})}this.schedulerView=d.getSchedulingView();this.panel=d;this.timeAxis=d.getTimeAxis();this.store=Ext.StoreManager.lookup(this.store);if(!this.store){Ext.Error.raise("Error: You must define a store for this plugin")}if(!this.schedulerView.getEl()){this.schedulerView.on({afterrender:this.onAfterRender,scope:this})}else{this.onAfterRender()}},onAfterRender:function(f){var e=this.schedulerView;this.containerEl=e.getSecondaryCanvasEl();this.storeListeners={load:this.renderElements,datachanged:this.renderElements,clear:this.renderElements,add:this.renderElements,remove:this.renderElements,update:this.refreshSingle,addrecords:this.renderElements,removerecords:this.renderElements,updaterecord:this.refreshSingle,expand:this.renderElements,collapse:this.renderElements,scope:this};this.store.on(this.storeListeners);e.on({bufferedrefresh:this.renderElements,refresh:this.renderElements,itemadd:this.refreshSizeOnItemUpdate?this.refreshSizes:this.renderElements,itemremove:this.refreshSizeOnItemUpdate?this.refreshSizes:this.renderElements,itemupdate:this.refreshSizeOnItemUpdate?this.refreshSizes:this.renderElements,groupexpand:this.renderElements,groupcollapse:this.renderElements,columnwidthchange:this.renderElements,resize:this.renderElements,scope:this});if(e.headerCt){e.headerCt.on({add:this.renderElements,remove:this.renderElements,scope:this})}this.panel.on({viewchange:this.renderElements,show:this.refreshSizes,modechange:this.forceNewRenderingTimeout,scope:this});var d=e.getRowContainerEl();if(d&&d.down(".sch-timetd")){this.renderElements()}},forceNewRenderingTimeout:function(){this.renderElementsBuffered=false;clearTimeout(this._renderTimer);clearTimeout(this._resizeTimer);this.renderElements()},refreshSizesInternal:function(){if(!this.schedulerView.isDestroyed&&this.schedulerView.isHorizontal()){var b=this.schedulerView.getTimeSpanRegion(new Date(),null,this.expandToFitView);this.getBodyElements().setHeight(b.bottom-b.top)}},refreshSizes:function(){clearTimeout(this._resizeTimer);this._resizeTimer=Ext.Function.defer(this.refreshSizesInternal,this.renderDelay,this)},renderElements:function(){if(this.renderElementsBuffered||this.disabled){return}this.renderElementsBuffered=true;clearTimeout(this._renderTimer);this._renderTimer=Ext.Function.defer(this.renderElementsInternal,this.renderDelay,this)},setElementX:function(c,d){if(this.panel.rtl){c.setRight(d)}else{c.setLeft(d)}},getHeaderElementPosition:function(c){var d=this.schedulerView.getTimeAxisViewModel();return Math.round(d.getPositionFromDate(c))},renderBodyElementsInternal:function(b){Ext.DomHelper.append(this.containerEl,this.generateMarkup(false,b))},getHeaderElementData:function(d,c){throw"Abstract method call"},renderHeaderElementsInternal:function(d){var c=this.getHeaderContainerEl();if(c){Ext.DomHelper.append(c,this.generateHeaderMarkup(false,d))}},renderElementsInternal:function(){this.renderElementsBuffered=false;if(this.disabled||this.schedulerView.isDestroyed){return}if(Ext.versions.extjs&&!this.schedulerView.el.down("."+Ext.baseCSSPrefix+"grid-item-container")){return}this.removeElements();this.renderBodyElementsInternal();if(this.showHeaderElements){this.headerContainerEl=null;this.renderHeaderElementsInternal()}if(this.renderingDoneEvent){this.fireEvent(this.renderingDoneEvent,this)}},generateMarkup:function(j,f){var h=this.timeAxis.getStart(),g=this.timeAxis.getEnd(),i=this.getElementData(h,g,f,j);return this.template.apply(i)},generateHeaderMarkup:function(d,e){var f=this.getHeaderElementData(e,d);return this.headerTemplate.apply(f)},getElementData:function(g,h,f,e){throw"Abstract method call"},updateBodyElement:function(f){var j=Ext.get(this.getElementId(f));if(j){var h=this.timeAxis.getStart(),g=this.timeAxis.getEnd(),i=this.getElementData(h,g,[f])[0];if(i){j.dom.className=i.$cls;j.setTop(i.top);this.setElementX(j,i.left);j.setSize(i.width,i.height)}else{Ext.destroy(j)}}else{this.renderBodyElementsInternal([f])}},updateHeaderElement:function(e){var d=Ext.get(this.getHeaderElementId(e));if(d){var f=this.getHeaderElementData([e])[0];if(f){d.dom.className=f.cls;if(this.schedulerView.isHorizontal()){this.setElementX(d,f.position);d.setWidth(f.size)}else{d.setTop(f.position);d.setHeight(f.size)}}else{Ext.destroy(d)}}else{this.renderHeaderElementsInternal([e])}},destroy:function(){clearTimeout(this._renderTimer);clearTimeout(this._resizeTimer);if(this.store.autoDestroy){this.store.destroy()}this.store.un(this.storeListeners)},refreshSingle:function(c,d){d=d instanceof Array?d:[d];Ext.Array.forEach(d,function(a){this.updateBodyElement(a);if(this.showHeaderElements){this.updateHeaderElement(a)}},this)}})}Ext.define("Sch.feature.DragCreator",{requires:["Ext.XTemplate","Ext.ToolTip","Sch.util.Date","Sch.util.ScrollManager","Sch.util.DragTracker","Sch.tooltip.Tooltip","Sch.tooltip.HoverTip"],disabled:false,showHoverTip:true,showDragTip:true,dragTip:null,dragTolerance:2,hoverTip:null,validatorFn:Ext.emptyFn,validatorFnScope:null,trackerConfig:null,schedulerView:null,template:'<div class="sch-dragcreator-proxy"><div class="sch-event-inner">&#160;</div></div>',constructor:function(b){Ext.apply(this,b||{});this.lastTime=new Date();if(!(this.template instanceof Ext.Template)){this.template=new Ext.Template(this.template)}this.schedulerView.on("destroy",this.onSchedulerDestroy,this);if(Ext.supports.Touch){this.schedulerView.on("boxready",this.initDragTracker,this)}else{this.schedulerView.el.on("mousemove",this.initDragTracker,this,{single:true})}this.callParent([b])},setDisabled:function(b){this.disabled=b;if(this.hoverTip){this.hoverTip.setDisabled(b)}if(this.dragTip){this.dragTip.setDisabled(b)}},getProxy:function(){if(!this.proxy){this.proxy=this.template.append(this.schedulerView.getSecondaryCanvasEl(),{},true);this.proxy.hide=function(){this.setStyle({left:"-10000px",top:"-10000px"})}}return this.proxy},onBeforeDragStart:function(k,i){var e=this.schedulerView,h=i.getTarget("."+e.timeCellCls,5);if(h&&this.isCreateAllowed(i)&&(!i.event.touches||i.event.touches.length===1)){var l=e.resolveResource(h);var j=e.getDateFromDomEvent(i);if(!this.disabled&&h&&e.fireEvent("beforedragcreate",e,l,j,i)!==false){this.resourceRecord=l;this.originalStart=j;this.resourceRegion=e.getScheduleRegion(this.resourceRecord,this.originalStart);this.dateConstraints=e.getDateConstraints(this.resourceRecord,this.originalStart);return true}}return false},isCreateAllowed:function(b){return !b.getTarget(this.schedulerView.eventSelector)},onDragStart:function(){var g=this,e=g.schedulerView,f=g.tracker.getRegion(),h=g.getProxy();this.dragging=true;if(this.hoverTip){this.hoverTip.disable()}g.start=g.originalStart;g.end=g.start;g.originalScroll=e.getScroll();if(e.getMode()==="horizontal"){g.rowBoundaries={top:g.resourceRegion.top,bottom:g.resourceRegion.bottom}}else{g.rowBoundaries={left:g.resourceRegion.left,right:g.resourceRegion.right}}Ext.apply(f,g.rowBoundaries);h.setBox(f);h.show();e.fireEvent("dragcreatestart",e,h);if(g.showDragTip){g.dragTip.enable();g.dragTip.update(g.start,g.end,true);g.dragTip.show(h);g.dragTip.setStyle("visibility","visible")}Sch.util.ScrollManager.activate(e,e.getMode()==="horizontal"?"horizontal":"vertical")},onDrag:function(n,s){var q=this,p=q.schedulerView,m=q.tracker.getRegion(),t=p.getStartEndDatesFromRegion(m,"round"),e="";if(!t){return}q.start=t.start||q.start;q.end=t.end||q.end;var l=q.dateConstraints;if(l){q.end=Sch.util.Date.constrain(q.end,l.start,l.end);q.start=Sch.util.Date.constrain(q.start,l.start,l.end)}q.valid=this.validatorFn.call(q.validatorFnScope||q,q.resourceRecord,q.start,q.end);if(q.valid&&typeof q.valid!=="boolean"){e=q.valid.message;q.valid=q.valid.valid}q.valid=(q.valid!==false);if(q.showDragTip){q.dragTip.update(q.start,q.end,q.valid,e)}Ext.apply(m,q.rowBoundaries);var o=p.getScroll();var r=this.getProxy();r.setBox(m);if(p.isHorizontal()){r.setY(q.resourceRegion.top+q.originalScroll.top-o.top)}},eventSwallower:function(b){b.stopPropagation();b.preventDefault()},onDragEnd:function(k,j){var l=this,n=l.schedulerView,m=true,i=j.getTarget(),e=Ext.get(i);e.on("click",this.eventSwallower);setTimeout(function(){e.un("click",l.eventSwallower)},100);l.dragging=false;if(l.showDragTip){l.dragTip.disable()}if(!l.start||!l.end||(l.end-l.start<=0)){l.valid=false}l.createContext={start:l.start,end:l.end,resourceRecord:l.resourceRecord,e:j,finalize:function(){l.finalize.apply(l,arguments)}};if(l.valid){m=n.fireEvent("beforedragcreatefinalize",l,l.createContext,j,this.getProxy())!==false}if(m){l.finalize(l.valid)}Sch.util.ScrollManager.deactivate()},finalize:function(f){var e=this.createContext;var g=this.schedulerView;if(f){var h=Ext.create(g.eventStore.model);if(Ext.data.TreeStore&&g.eventStore instanceof Ext.data.TreeStore){h.set("leaf",true);g.eventStore.append(h)}else{if(!!g.eventStore.getAssignmentStore()){g.eventStore.append(h)}}h.assign(e.resourceRecord);h.setStartEndDate(e.start,e.end);g.fireEvent("dragcreateend",g,h,e.resourceRecord,e.e,this.getProxy())}else{this.proxy.hide()}this.schedulerView.fireEvent("afterdragcreate",g,this.getProxy());if(this.hoverTip){this.hoverTip.enable()}},dragging:false,initDragTracker:function(){var g=this,e=Ext.supports.Touch,f=g.schedulerView;var h=Ext.apply({el:f.el,deferredActivation:e?1000:false,tolerance:g.dragTolerance,listeners:{mousedown:g.verifyLeftButtonPressed,beforedragstart:g.onBeforeDragStart,dragstart:g.onDragStart,drag:g.onDrag,dragend:g.onDragEnd,scope:g}},this.trackerConfig);if(e){this.showDragTip=false;this.showHoverTip=false;this.dragTip=null;this.hoverTip=null}else{this.setupTooltips()}g.tracker=new Sch.util.DragTracker(h)},setupTooltips:function(){var h=this,f=h.schedulerView;if(this.showDragTip){var e=this.dragTip;if(e instanceof Ext.tip.ToolTip){Ext.applyIf(e,{schedulerView:f});e.on("beforeshow",function(){return h.dragging})}else{this.dragTip=new Sch.tooltip.Tooltip(Ext.apply({cls:"sch-dragcreate-tip",schedulerView:f,listeners:{beforeshow:function(){return h.dragging}}},e))}}if(h.showHoverTip){var g=h.hoverTip;if(g instanceof Ext.tip.ToolTip){Ext.applyIf(g,{schedulerView:f})}else{h.hoverTip=Ext.ComponentManager.create(Ext.applyIf({renderTo:Ext.getBody(),target:f.el,schedulerView:f},g),"scheduler_hovertip")}}},verifyLeftButtonPressed:function(d,c){return c.button===0},onSchedulerDestroy:function(){if(this.hoverTip){this.hoverTip.destroy()}if(this.dragTip){this.dragTip.destroy()}if(this.tracker){this.tracker.destroy()}if(this.proxy){Ext.destroy(this.proxy);this.proxy=null}}});Ext.define("Sch.feature.SchedulerDragZone",{extend:"Ext.dd.DragZone",requires:["Sch.tooltip.Tooltip","Ext.dd.StatusProxy"],repairHighlight:false,repairHighlightColor:"transparent",containerScroll:false,showTooltip:true,tip:null,tipIsProcessed:false,schedulerView:null,lastXY:null,showExactDropPosition:false,enableCopy:false,enableCopyKey:"SHIFT",validatorFn:function(e,g,j,h,i){return true},validatorFnScope:null,copyKeyPressed:false,constructor:function(h,f){if(Ext.isIE8m&&window.top!==window){Ext.dd.DragDropManager.notifyOccluded=true}var e=this.proxy=this.proxy||new Ext.dd.StatusProxy({shadow:false,dropAllowed:this.dropAllowed,dropNotAllowed:this.dropNotAllowed,ensureAttachedToBody:Ext.emptyFn});this.callParent(arguments);this.isTarget=true;this.scroll=false;this.ignoreSelf=false;var g=this.schedulerView;if(g.touchScroll){this.showTooltip=false}g.el.appendChild(e.el);if(g.rtl){e.addCls("sch-rtl")}e.addCls("sch-dragproxy");g.on({eventdragstart:function(){Sch.util.ScrollManager.activate(g,g.constrainDragToResource&&g.getMode())},aftereventdrop:function(){Sch.util.ScrollManager.deactivate()},scope:this})},destroy:function(){this.callParent(arguments);Ext.destroyMembers(this,"tip")},autoOffset:function(d,c){this.setDelta(0,0)},setupConstraints:function(l,s,p,r,n,q,t){this.clearTicks();var v=n&&!this.showExactDropPosition&&q>1?q:0;var o=!n&&!this.showExactDropPosition&&q>1?q:0;this.resetConstraints();this.initPageX=l.left+p;this.initPageY=l.top+r;var u=s.right-s.left;var m=s.bottom-s.top;if(n){if(t){this.setXConstraint(l.left+p,l.right-u+p,v)}else{this.setXConstraint(l.left,l.right,v)}this.setYConstraint(l.top+r,l.bottom-m+r,o)}else{this.setXConstraint(l.left+p,l.right-u+p,v);if(t){this.setYConstraint(l.top+r,l.bottom-m+r,o)}else{this.setYConstraint(l.top,l.bottom,o)}}},setXConstraint:function(f,d,e){this.leftConstraint=f;this.rightConstraint=d;this.minX=f;this.maxX=d;if(e){this.setXTicks(this.initPageX,e)}this.constrainX=true},setYConstraint:function(e,f,d){this.topConstraint=e;this.bottomConstraint=f;this.minY=e;this.maxY=f;if(d){this.setYTicks(this.initPageY,d)}this.constrainY=true},onDragEnter:Ext.emptyFn,onDragOut:Ext.emptyFn,setVisibilityForSourceEvents:function(b){Ext.each(this.dragData.getEventBarElements(),function(a){a[b?"show":"hide"]()})},onDragOver:function(q){if(q.event.touches&&q.event.touches.length>1){Ext.dd.DragDropManager.handleMouseUp(q);return}var e=q.type==="scroll"?this.lastXY:q.getXY();this.checkShiftChange();var m=this.dragData;if(!m.originalHidden){this.setVisibilityForSourceEvents(false);m.originalHidden=true}var u=m.startDate;var s=m.newResource;var p=this.schedulerView;this.updateDragContext(q);if(this.showExactDropPosition){var o=p.isHorizontal();var v=p.getDateFromCoordinate(o?e[0]:e[1])-m.sourceDate;var n=new Date(m.origStart-0+v);var r=p.timeAxisViewModel.getDistanceBetweenDates(n,m.startDate);if(m.startDate>p.timeAxis.getStart()){var t=this.proxy.el;if(r){if(p.isHorizontal()){t.setX(e[0]+(this.schedulerView.rtl?-r:r))}else{t.setY(e[1]+r)}}}}if(m.startDate-u!==0||s!==m.newResource){this.schedulerView.fireEvent("eventdrag",this.schedulerView,m.draggedRecords,m.startDate,m.newResource,m)}if(this.showTooltip){this.tip.realign();this.tip.update(m.startDate,m.endDate,m.valid,m.message)}if(q.type!=="scroll"){this.lastXY=q.getXY()}},getCoordinate:function(b){switch(this.schedulerView.getMode()){case"horizontal":return b[0];case"vertical":return b[1];case"calendar":return b}},getDragData:function(w){var x=this.schedulerView,y=w.getTarget(x.eventSelector);if(!y||w.event.touches&&w.event.touches.length>1){return}var D=x.resolveEventRecord(y),A=x.resolveResource(y),H=x.resolveAssignmentRecord(y);if(!D||D.isDraggable()===false||x.fireEvent("beforeeventdrag",x,D,w)===false){return null}var F=w.getXY(),L=Ext.get(y),s=L.getXY(),E=[F[0]-s[0],F[1]-s[1]],B=L.getRegion();var C=x.getMode()=="horizontal";x.constrainDragToResource&&!A&&Ext.Error.raise("Resource could not be resolved for event: "+D.getId());var t=x.getDateConstraints(x.constrainDragToResource?A:null,D);this.setupConstraints(x.getScheduleRegion(x.constrainDragToResource?A:null,D),B,E[0],E[1],C,x.getSnapPixelAmount(),Boolean(t));var K=D.getStartDate(),z=D.getEndDate(),J=x.timeAxis,G=this.getRelatedRecords(H||D)||[],e=x.getElementsFromEventRecord(D,A);Ext.Array.forEach(G,function(a){if(a instanceof Sch.model.Assignment){e=e.concat(x.getElementsFromEventRecord(a.getEvent(),a.getResource()))}else{e=e.concat(x.getElementsFromEventRecord(a))}});e=Ext.Array.unique(e);var I={offsets:E,repairXY:s,prevScroll:x.getScroll(),dateConstraints:t,eventBarEls:e,getEventBarElements:function(){return I.eventBarEls=Ext.Array.map(I.eventBarEls,function(a){return a.dom&&a||Ext.get(a.id)})},draggedRecords:[H||D].concat(G),resourceRecord:A,sourceDate:x.getDateFromCoordinate(this.getCoordinate(F)),origStart:K,origEnd:z,startDate:K,endDate:z,timeDiff:0,startsOutsideView:K<J.getStart(),endsOutsideView:z>J.getEnd(),duration:z-K,bodyScroll:Ext.getBody().getScroll(),eventObj:w};I.ddel=this.getDragElement(L,I);return I},onStartDrag:function(e,g){var h=this.schedulerView,f=this.dragData;Ext.Array.forEach(f.getEventBarElements(),function(a){a.removeCls("sch-event-hover")});h.fireEvent("eventdragstart",h,f.draggedRecords);h.el.on("scroll",this.onViewElScroll,this)},alignElWithMouse:function(f,h,i){this.callParent(arguments);var j=this.getTargetCoord(h,i),g=f.dom?f:Ext.fly(f,"_dd");this.setLocalXY(g,j.x+this.deltaSetXY[0],j.y+this.deltaSetXY[1])},onViewElScroll:function(r,o){var n=this.proxy,j=this.schedulerView,l=this.dragData;this.setVisibilityForSourceEvents(false);var k=n.getXY();var m=j.getScroll();var p=[k[0]+m.left-l.prevScroll.left,k[1]+m.top-l.prevScroll.top];var q=this.deltaSetXY;this.deltaSetXY=[q[0]+m.left-l.prevScroll.left,q[1]+m.top-l.prevScroll.top];l.prevScroll=m;n.setXY(p);this.onDragOver(r)},getCopyKeyPressed:function(){return Boolean(this.enableCopy&&this.dragData.eventObj[this.enableCopyKey.toLowerCase()+"Key"])},checkShiftChange:function(){var c=this.getCopyKeyPressed(),d=this.dragData;if(c!==this.copyKeyPressed){this.copyKeyPressed=c;if(c){d.refElements.addCls("sch-event-copy");this.setVisibilityForSourceEvents(true)}else{d.refElements.removeCls("sch-event-copy");this.setVisibilityForSourceEvents(false)}}},onKey:function(b){if(b.getKey()===b[this.enableCopyKey]){this.checkShiftChange()}},startDrag:function(){if(this.enableCopy){Ext.getDoc().on({keydown:this.onKey,keyup:this.onKey,scope:this})}var h=this.callParent(arguments);var i=this.dragData;i.refElement=this.proxy.el.down(".sch-dd-ref");i.refElements=this.proxy.el.select(".sch-event");i.refElement.removeCls("sch-event-hover");if(this.showTooltip){var g=this.schedulerView,j=g.up("[lockable=true]").el;if(!this.tipIsProcessed){this.tipIsProcessed=true;var f=this.tip;if(f instanceof Ext.tip.ToolTip){Ext.applyIf(f,{schedulerView:g})}else{this.tip=new Sch.tooltip.Tooltip(Ext.apply({schedulerView:g,cls:"sch-dragdrop-tip",constrainTo:j},f))}}this.tip.update(i.origStart,i.origEnd,true);this.tip.setStyle("visibility");this.tip.show(i.refElement,i.offsets[0])}this.copyKeyPressed=this.getCopyKeyPressed();if(this.copyKeyPressed){i.refElements.addCls("sch-event-copy");i.originalHidden=true}return h},endDrag:function(){this.schedulerView.el.un("scroll",this.onViewElScroll,this);if(this.enableCopy){Ext.getDoc().un({keydown:this.onKey,keyup:this.onKey,scope:this})}this.callParent(arguments)},onMouseUp:function(){if(!this.dragging){this.afterDragFinalized()}},afterDragFinalized:function(){this.proxy.el.setStyle({left:0,top:0})},updateRecords:function(z){var r=this,q=r.schedulerView,w=q.eventStore,o=q.resourceStore,t=w.getAssignmentStore(),v=z.newResource,u=z.draggedRecords[0],A=z.draggedRecords.slice(1),s=z.resourceRecord,p=r.getCopyKeyPressed(),y=z.startDate,B=z.timeDiff,x=q.getMode();if(t&&w instanceof Sch.data.EventStore){r.updateRecordsMultipleAssignmentMode(y,B,u,A,s,v,w,o,t,p,x)}else{if(t){r.updateRecordsSingleAssignmentMode(y,B,u.getEvent(),Ext.Array.map(A,function(a){return a.getEvent()}),s,v,w,o,p,x)}else{r.updateRecordsSingleAssignmentMode(y,B,u,A,s,v,w,o,p,x)}}q.fireEvent("eventdrop",q,z.draggedRecords,p)},updateRecordsSingleAssignmentMode:function(x,y,o,r,v,q,u,p,z,w){var s=this,n=[];if(z){o=o.fullCopy(null);n.push(o)}o.beginEdit();if(!z&&q!==v&&v instanceof Sch.model.Resource&&q instanceof Sch.model.Resource){o.reassign(v,q)}else{if(q!==v&&v instanceof Sch.model.Resource&&q instanceof Sch.model.Resource){o.assign(q)}}o.setStartDate(x,true,u.skipWeekendsDuringDragDrop);o.endEdit();if(w!=="calendar"){var t=p.indexOf(v)-p.indexOf(q);Ext.Array.forEach(r,function(a){var b=a.getResources();if(z){a=a.fullCopy(null);n.push(a)}a.beginEdit();a.setStartDate(s.adjustStartDate(a.getStartDate(),y),true,u.skipWeekendsDuringDragDrop);t!==0&&b.length&&Ext.Array.forEach(b,function(c){var d=p.indexOf(c)-t,e;if(d<0){d=0}else{if(d>=p.getCount()){d=p.getCount()-1}}e=p.getAt(d);a.reassign(c,e)});a.endEdit()})}if(n.length){u.append(n)}},updateRecordsMultipleAssignmentMode:function(v,w,q,m,t,o,s,n,r,x,u){var p=this;Ext.Array.forEach([].concat(q,m),function(b){var a=b.getEvent();a.setStartDate(p.adjustStartDate(a.getStartDate(),w),true,s.skipWeekendsDuringDragDrop);if(u!="calendar"&&t!==o){if(x){a.assign(o)}else{if(!a.isAssignedTo(o)){a.reassign(b.getResource(),o)}else{a.unassign(b.getResource())}}}})},isValidDrop:function(e,d,f){if(e!==d){if(f instanceof Sch.model.Assignment){return !f.getEvent().isAssignedTo(d)}else{return !f.isAssignedTo(d)}}return true},resolveResource:function(k,l){var n=this.proxy.el.dom;var j=this.dragData.bodyScroll;n.style.display="none";var m=document.elementFromPoint(k[0]-j.left,k[1]-j.top);if(Ext.isIE8&&l&&l.browserEvent.synthetic){m=document.elementFromPoint(k[0]-j.left,k[1]-j.top)}n.style.display="block";if(!m){return null}var i=this.schedulerView;if(m.className.match(Ext.baseCSSPrefix+"grid-item")){return this.resolveResource([k[0],k[1]+3],l)}if(!m.className.match(i.timeCellCls)){var e=Ext.fly(m).up("."+i.timeCellCls);if(e){m=e.dom}else{return null}}return i.resolveResource(m)},adjustStartDate:function(e,f){var d=this.schedulerView;return d.timeAxis.roundDate(new Date(e-0+f),d.snapRelativeToEventStartDate?e:false)},updateDragContext:function(l){var e=this.dragData,m=l.type==="scroll"?this.lastXY:l.getXY();if(!e.refElement){return}var n=this.schedulerView,k=e.refElement.getRegion();if(n.timeAxis.isContinuous()){if((n.isHorizontal()&&this.minX<m[0]&&m[0]<this.maxX)||(n.isVertical()&&this.minY<m[1]&&m[1]<this.maxY)){var p=n.getDateFromCoordinate(this.getCoordinate(m));e.timeDiff=p-e.sourceDate;e.startDate=this.adjustStartDate(e.origStart,e.timeDiff);e.endDate=new Date(e.startDate-0+e.duration)}}else{var o=this.resolveStartEndDates(k);e.startDate=o.startDate;e.endDate=o.endDate;e.timeDiff=e.startDate-e.origStart}e.newResource=n.constrainDragToResource?e.resourceRecord:this.resolveResource([k.left+e.offsets[0],k.top+e.offsets[1]],l);if(e.newResource){var j=this.validatorFn.call(this.validatorFnScope||this,e.draggedRecords,e.newResource,e.startDate,e.duration,l);if(!j||typeof j==="boolean"){e.valid=j!==false;e.message=""}else{e.valid=j.valid!==false;e.message=j.message}}else{e.valid=false}},getRelatedRecords:function(h){var e=this.schedulerView,g=e.getEventSelectionModel(),f=g.getDraggableSelections();return Ext.Array.filter(f,function(a){return h!==a})},getDragElement:function(i,n){var k=n.getEventBarElements();var l;var o;var j=n.offsets[0];var m=n.offsets[1];if(k.length>1){var p=Ext.core.DomHelper.createDom({tag:"div",cls:"sch-dd-wrap",style:{overflow:"visible"}});Ext.Array.forEach(k,function(a){l=a.dom.cloneNode(true);l.id=Ext.id();if(a.dom===i.dom){l.className+=" sch-dd-ref";if(Ext.isIE8){Ext.fly(l).addCls("sch-dd-ref")}}p.appendChild(l);var b=a.getOffsetsTo(i);Ext.fly(l).setStyle({left:b[0]-j+"px",top:b[1]-m+"px"})});o=p}else{l=i.dom.cloneNode(true);l.id=Ext.id();l.style.left=-j+"px";l.style.top=-m+"px";l.className+=" sch-dd-ref";if(Ext.isIE8){Ext.fly(l).addCls("sch-dd-ref")}o=l}if(!i.dom.style.height){Ext.fly(o).setHeight(i.getHeight())}return o},onDragDrop:function(l,k){this.updateDragContext(l);var o=this,e=o.schedulerView,m=o.cachedTarget||Ext.dd.DragDropMgr.getDDById(k),n=o.dragData,j=false,p=true;n.ddCallbackArgs=[m,l,k];if(n.valid&&n.startDate&&n.endDate){n.finalize=function(){o.finalize.apply(o,arguments)};p=e.fireEvent("beforeeventdropfinalize",o,n,l)!==false;if(p&&o.isValidDrop(n.resourceRecord,n.newResource,n.draggedRecords[0])){j=(n.startDate-n.origStart)!==0||n.newResource!==n.resourceRecord}}if(p){o.finalize(n.valid&&j)}else{o.proxy.el.addCls("sch-before-drag-finalized")}},finalize:function(n){var k=this,h=k.schedulerView,m=h.eventStore,j=k.dragData;k.proxy.el.removeCls("sch-before-drag-finalized");if(k.tip){k.tip.hide()}if(n){var i,l=function(){i=true};m.on("update",l,null,{single:true});k.updateRecords(j);m.un("update",l,null,{single:true});if(!i){k.onInvalidDrop.apply(k,j.ddCallbackArgs)}else{if(Ext.isIE9){k.proxy.el.setStyle("visibility","hidden");Ext.Function.defer(k.onValidDrop,10,k,j.ddCallbackArgs)}else{k.onValidDrop.apply(k,j.ddCallbackArgs)}h.fireEvent("aftereventdrop",h,j.draggedRecords)}k.afterDragFinalized()}else{k.onInvalidDrop.apply(k,j.ddCallbackArgs)}},onInvalidDrop:function(i,j,h){if(Ext.isIE&&!j){j=i;i=i.getTarget()||document.body}if(this.tip){this.tip.hide()}this.setVisibilityForSourceEvents(true);var g=this.schedulerView,e=this.callParent([i,j,h]);g.fireEvent("aftereventdrop",g,this.dragData.draggedRecords);this.afterDragFinalized();return e},resolveStartEndDates:function(i){var h=this.dragData,l,j=h.origStart,g=h.origEnd;var k=Sch.util.Date;if(!h.startsOutsideView){l=this.schedulerView.getStartEndDatesFromRegion(i,"round");if(l){j=l.start||h.startDate;g=k.add(j,k.MILLI,h.duration)}}else{if(!h.endsOutsideView){l=this.schedulerView.getStartEndDatesFromRegion(i,"round");if(l){g=l.end||h.endDate;j=k.add(g,k.MILLI,-h.duration)}}}return{startDate:j,endDate:g}}});Ext.define("Sch.feature.DragDrop",{requires:["Ext.XTemplate","Sch.feature.SchedulerDragZone"],validatorFn:function(e,g,j,h,i){return true},validatorFnScope:null,dragConfig:null,constructor:function(c,d){Ext.apply(this,d);this.schedulerView=c;c.eventDragZone=new Sch.feature.SchedulerDragZone(c.ownerCt.el,Ext.apply({ddGroup:c.id,schedulerView:c,validatorFn:this.validatorFn,validatorFnScope:this.validatorFnScope},this.dragConfig));this.schedulerView.on("destroy",this.cleanUp,this);this.callParent([d])},cleanUp:function(){var b=this.schedulerView;if(b.eventDragZone){b.eventDragZone.destroy()}}});Ext.define("Sch.feature.ResizeZone",{extend:"Ext.util.Observable",requires:["Ext.resizer.Resizer","Sch.tooltip.Tooltip","Sch.util.ScrollManager"],showTooltip:true,showExactResizePosition:false,validatorFn:Ext.emptyFn,validatorFnScope:null,schedulerView:null,origEl:null,handlePos:null,eventRec:null,tip:null,tipInstance:null,startScroll:null,constructor:function(d){Ext.apply(this,d);var c=this.schedulerView;c.on({destroy:this.cleanUp,scope:this});c.mon(c.el,{mousedown:this.onMouseDown,mouseup:this.onMouseUp,scope:this,delegate:".sch-resizable-handle"});this.callParent(arguments)},onMouseDown:function(h,g){var e=this.schedulerView;var i=this.eventRec=e.resolveEventRecord(g);var j=i.isResizable();if(h.button!==0||(j===false||typeof j==="string"&&!g.className.match(j))){return}this.eventRec=i;this.handlePos=this.getHandlePosition(g);this.origEl=Ext.get(h.getTarget(".sch-event"));e.el.on({mousemove:this.onMouseMove,scope:this,single:true})},onMouseUp:function(f,e){var d=this.schedulerView;d.el.un({mousemove:this.onMouseMove,scope:this,single:true})},getTipInstance:function(){if(this.tipInstance){return this.tipInstance}var e=this.schedulerView;var f=this.tip;var d=e.up("[lockable=true]").el;if(f instanceof Ext.tip.ToolTip){Ext.applyIf(f,{schedulerView:e})}else{f=new Sch.tooltip.Tooltip(Ext.apply({rtl:this.rtl,schedulerView:e,constrainTo:d,cls:"sch-resize-tip",onMyMouseMove:function(a){this.el.alignTo(this.target,"bl-tl",[a.getX()-this.target.getX(),-5])}},f))}return this.tipInstance=f},onMouseMove:function(j,i){var e=this.schedulerView,k=this.eventRec,m=this.handlePos;if(!k||e.fireEvent("beforeeventresize",e,k,j)===false){return}delete this.eventRec;j.stopEvent();this.origEl.addCls("sch-event-resizing");this.resizer=this.createResizer(this.origEl,k,m);var n=this.resizer.resizeTracker;if(this.showTooltip){var l=this.getTipInstance();l.setTarget(this.origEl);l.update(k.getStartDate(),k.getEndDate(),true);l.show(this.origEl)}n.onMouseDown(j,this.resizer[m].dom);n.onMouseMove(j,this.resizer[m].dom);e.fireEvent("eventresizestart",e,k);e.el.on("scroll",this.onViewElScroll,this)},getHandlePosition:function(c){var d=c.className.match("start");if(this.schedulerView.getMode()==="horizontal"){if(this.schedulerView.rtl){return d?"east":"west"}return d?"west":"east"}else{return d?"north":"south"}},createResizer:function(I,F,v){var y=this.schedulerView,s=this,E=y.resolveResource(I),t=y.getSnapPixelAmount(),w=y.getScheduleRegion(E,F),u=y.getDateConstraints(E,F),x=I.getHeight(),D=(y.rtl&&v[0]==="e")||(!y.rtl&&v[0]==="w")||v[0]==="n",C=y.getMode()!=="horizontal",G={otherEdgeX:D?I.getRight():I.getLeft(),otherEdgeY:D?I.getBottom():I.getTop(),target:I,isStart:D,startYOffset:I.getY()-I.parent().getY(),startXOffset:I.getX()-I.parent().getX(),dateConstraints:u,resourceRecord:E,eventRecord:F,handles:v[0],minHeight:x,constrainTo:w,listeners:{resizedrag:this.partialResize,resize:this.afterResize,scope:this}};var H=I.id;var A="_"+H;I.id=I.dom.id=A;Ext.cache[A]=Ext.cache[H];if(C){if(t>0){var B=I.getWidth();Ext.apply(G,{minHeight:t,minWidth:B,maxWidth:B,heightIncrement:t})}}else{if(t>0){Ext.apply(G,{minWidth:t,maxHeight:x,widthIncrement:t})}}var z=new Ext.resizer.Resizer(G);z.prevId=H;if(z.resizeTracker){z.resizeTracker.tolerance=-1;var J=z.resizeTracker.updateDimensions;z.resizeTracker.updateDimensions=function(a){if(!Ext.isWebKit||a.getTarget(".sch-timelineview")){var b;if(C){b=y.el.getScroll().top-s.startScroll.top;z.resizeTracker.minHeight=G.minHeight-Math.abs(b)}else{b=y.el.getScroll().left-s.startScroll.left;z.resizeTracker.minWidth=G.minWidth-Math.abs(b)}J.apply(this,arguments)}};z.resizeTracker.resize=function(b){var a;if(C){a=y.el.getScroll().top-s.startScroll.top;if(v[0]==="s"){b.y-=a}b.height+=Math.abs(a)}else{a=y.el.getScroll().left-s.startScroll.left;if(v[0]==="e"){b.x-=a}b.width+=Math.abs(a)}Ext.resizer.ResizeTracker.prototype.resize.apply(this,arguments)}}I.setStyle("z-index",parseInt(I.getStyle("z-index"),10)+1);Sch.util.ScrollManager.activate(y,y.getMode()==="horizontal"?"horizontal":"vertical");this.startScroll=y.el.getScroll();return z},getStartEndDates:function(){var l=this.resizer,n=l.el,m=this.schedulerView,h=l.isStart,j,i,k;if(h){if(m.getMode()==="horizontal"){k=[m.rtl?n.getRight():n.getLeft()+1,n.getTop()]}else{k=[(n.getRight()+n.getLeft())/2,n.getTop()]}i=l.eventRecord.getEndDate();if(m.snapRelativeToEventStartDate){j=m.getDateFromXY(k);j=m.timeAxis.roundDate(j,l.eventRecord.getStartDate())}else{j=m.getDateFromXY(k,"round")}}else{if(m.getMode()==="horizontal"){k=[m.rtl?n.getLeft():n.getRight(),n.getBottom()]}else{k=[(n.getRight()+n.getLeft())/2,n.getBottom()]}j=l.eventRecord.getStartDate();if(m.snapRelativeToEventStartDate){i=m.getDateFromXY(k);i=m.timeAxis.roundDate(i,l.eventRecord.getEndDate())}else{i=m.getDateFromXY(k,"round")}}j=j||l.start;i=i||l.end;if(l.dateConstraints){j=Sch.util.Date.constrain(j,l.dateConstraints.start,l.dateConstraints.end);i=Sch.util.Date.constrain(i,l.dateConstraints.start,l.dateConstraints.end)}return{start:j,end:i}},partialResize:function(y,s,x,r){var A=this.schedulerView,G=r.type==="scroll"?this.resizer.resizeTracker.lastXY:r.getXY(),z=this.getStartEndDates(G),I=z.start,J=z.end,K=y.eventRecord,B=A.getMode(),E=A.isHorizontal();if(E){y.target.el.setY(y.target.parent().getY()+y.startYOffset)}else{y.target.el.setX(y.target.parent().getX()+y.startXOffset)}if(this.showTooltip){var w=this.validatorFn.call(this.validatorFnScope||this,y.resourceRecord,K,I,J);var C="";if(w&&typeof w!=="boolean"){C=w.message;w=w.valid}this.getTipInstance().update(I,J,w!==false,C)}if(this.showExactResizePosition){var e=y.target.el,F,D,H;if(y.isStart){if(A.getMode()==="calendar"){var L=A.calendar.getEventColumns(K)[0];F=A.timeAxisViewModel.getDistanceBetweenDates(I,L.end)}else{F=A.timeAxisViewModel.getDistanceBetweenDates(I,K.getEndDate())}if(E){D=A.getDateFromCoordinate(y.otherEdgeX-Math.min(s,y.maxWidth))||I;H=A.timeAxisViewModel.getDistanceBetweenDates(D,I);e.setWidth(F);e.setX(e.getX()+H)}else{D=A.getDateFromCoordinate(y.otherEdgeY-Math.min(s,y.maxHeight))||I;H=A.timeAxisViewModel.getDistanceBetweenDates(D,I);e.setHeight(F);e.setY(e.getY()+H)}}else{F=A.timeAxisViewModel.getDistanceBetweenDates(K.getStartDate(),J);if(E){e.setWidth(F)}else{e.setHeight(F)}}}else{if(!I||!J||((y.start-I===0)&&(y.end-J===0))){return}}y.end=J;y.start=I;A.fireEvent("eventpartialresize",A,K,I,J,y.el)},onViewElScroll:function(c,d){this.resizer.resizeTracker.onDrag.apply(this.resizer.resizeTracker,arguments);this.partialResize(this.resizer,0,0,c)},afterResize:function(C,s,y,x){var v=this,w=C.resourceRecord,u=C.eventRecord,z=u.getStartDate(),e=u.getEndDate(),B=C.start||z,A=C.end||e,h=v.schedulerView,r=false,t=true,D=v.validatorFn.call(v.validatorFnScope||v,w,u,B,A,x);Sch.util.ScrollManager.deactivate();h.el.un("scroll",this.onViewElScroll,this);if(this.showTooltip){this.getTipInstance().hide()}h.el.select("[id^=calendar-resizer-placeholder]").remove();delete Ext.cache[C.el.id];C.el.id=C.el.dom.id=C.el.id.substr(1);v.resizeContext={resourceRecord:C.resourceRecord,eventRecord:u,start:B,end:A,finalize:function(){v.finalize.apply(v,arguments)}};if(D&&typeof D!=="boolean"){D=D.valid}if(B&&A&&(A-B>0)&&((B-z!==0)||(A-e!==0))&&D!==false){t=h.fireEvent("beforeeventresizefinalize",v,v.resizeContext,x)!==false;r=true}else{h.repaintEventsForResource(w)}if(t){v.finalize(r)}},finalize:function(g){var f=this.schedulerView;var h=this.resizeContext;var i=false;var j=function(){i=true};f.eventStore.on("update",j);this.resizer.target.destroy();if(g){if(this.resizer.isStart){h.eventRecord.setStartDate(h.start,false,f.eventStore.skipWeekendsDuringDragDrop)}else{h.eventRecord.setEndDate(h.end,false,f.eventStore.skipWeekendsDuringDragDrop)}if(!i){f.repaintEventsForResource(h.resourceRecord)}}else{f.repaintEventsForResource(h.resourceRecord)}this.resizer.destroy();f.eventStore.un("update",j);f.fireEvent("eventresizeend",f,h.eventRecord);this.resizeContext=null},cleanUp:function(){if(this.tipInstance){this.tipInstance.destroy()}}});Ext.define("Sch.feature.Grouping",{extend:"Ext.grid.feature.Grouping",alias:"feature.scheduler_grouping",headerRenderer:Ext.emptyFn,timeAxisViewModel:null,headerCellTpl:'<tpl for="."><div class="sch-grid-group-hd-cell {cellCls}" style="{cellStyle}; width: {width}px;"><span>{value}</span></div></tpl>',renderCells:function(k){var i=[];var h=this.timeAxisViewModel;var m=h.columnConfig[this.timeAxisViewModel.columnLinesFor];for(var n=0;n<m.length;n++){var j={};var l=this.headerRenderer(m[n].start,m[n].end,k.children,j);j.value=l;j.width=h.getPositionFromDate(m[n].end)-h.getPositionFromDate(m[n].start);i.push(j)}return this.headerCellTpl.apply(i)},init:function(){var d=this.view;var c=this;this.callParent(arguments);if(typeof this.headerCellTpl==="string"){this.headerCellTpl=new Ext.XTemplate(this.headerCellTpl)}if(d.eventStore){this.timeAxisViewModel=d.timeAxisViewModel;d.mon(this.view.eventStore,{add:this.onEventAddOrRemove,remove:this.onEventAddOrRemove,update:this.onEventUpdate,scope:this});this.groupHeaderTpl=new Ext.XTemplate(this.schedulerGroupHeaderTpl,{renderCells:Ext.Function.bind(c.renderCells,c)})}if(d.resourceStore){d.mon(this.view.resourceStore,{add:function(a,b){c.refreshGroupHeader(b.length?b[0]:b)}})}Ext.apply(d,{getRowNode:function(a){return this.retrieveNode(this.getRowId(a),true)}})},getGroupHeaderNodeIndex:function(g,j){var f=g.resourceStore;var i=f.getGrouper().getGroupString(j);var h=this.getGroup(i);return g.store.indexOf(h.items[0])},onEventUpdate:function(i,k){var l=i.getResourceStore().getGroupField();var h=k.previous&&k.resourceIdField in k.previous;var j=k.getResource();if(h){var g=i.getResourceStore().getById(k.previous[k.resourceIdField]);if(g&&g.get(l)!==j.get(l)){this.refreshGroupHeader(g)}}if(j){this.refreshGroupHeader(j)}},onEventAddOrRemove:function(h,e){var g=this;var f=g.view;Ext.Array.forEach(e,function(b){var a=b.getResource(null,f.eventStore);if(a){g.refreshGroupHeader(a)}})},refreshGroupHeader:function(f){var d=this,e=d.view;e.refreshNode(d.getGroupHeaderNodeIndex(e,f))},schedulerGroupHeaderTpl:"{[this.renderCells(values)]}"});Ext.define("Sch.eventlayout.Horizontal",{nbrOfBandsByResource:null,bandIndexToPxConvertFn:null,bandIndexToPxConvertScope:null,constructor:function(b){Ext.apply(this,b);this.nbrOfBandsByResource={}},clearCache:function(b){if(b){delete this.nbrOfBandsByResource[b.internalId]}else{this.nbrOfBandsByResource={}}},getNumberOfBands:function(j,f){var g=this.nbrOfBandsByResource;if(g.hasOwnProperty(j.internalId)){return g[j.internalId]}var h=Ext.isFunction(f)?f():f;var i=Ext.Array.map(h,function(a){return{start:a.getStartDate(),end:a.getEndDate(),event:a}});return this.applyLayout(i,j)},applyLayout:function(f,h){var g=f.slice();var e=this;g.sort(function(a,b){return e.sortEvents(a.event,b.event)});return this.nbrOfBandsByResource[h.internalId]=this.layoutEventsInBands(g)},sortEvents:function(b,i){var a=b.getStartDate();var h=i.getStartDate();var j=(a-h===0);if(j){return b.getEndDate()>i.getEndDate()?-1:1}else{return(a<h)?-1:1}},layoutEventsInBands:function(d){var e=0;do{var f=d[0];while(f){f.top=this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertScope||this,e,f.event);Ext.Array.remove(d,f);f=this.findClosestSuccessor(f,d)}e++}while(d.length>0);return e},findClosestSuccessor:function(r,i){var m=Infinity,q,l=r.end,k,p=r.end-r.start===0;for(var n=0,o=i.length;n<o;n++){k=i[n].start-l;if(k>=0&&k<m&&(k>0||i[n].end-i[n].start>0||!p)){q=i[n];m=k}}return q}});Ext.define("Sch.eventlayout.Vertical",{requires:["Sch.util.Date"],view:null,constructor:function(b){Ext.apply(this,b)},applyLayout:function(L,G){if(L.length===0){return}var i=this;L.sort(function(a,b){return i.sortEvents(a.event,b.event)});var I,J,D=this.view,C=Sch.util.Date,A=1,w,K,E=G-(2*D.barMargin),H,x;for(var l=0,y=L.length;l<y;l++){H=L[l];I=H.start;J=H.end;K=this.findStartSlot(L,H);var j=this.getCluster(L,l);if(j.length>1){H.left=K.start;H.width=K.end-K.start;x=1;while(x<(j.length-1)&&j[x+1].start-H.start===0){x++}var z=this.findStartSlot(L,j[x]);if(z&&z.start<0.8){j=j.slice(0,x)}}var F=j.length,B=(K.end-K.start)/F;for(x=0;x<F;x++){j[x].width=B;j[x].left=K.start+(x*B)}l+=F-1}for(l=0,y=L.length;l<y;l++){L[l].width=L[l].width*E;L[l].left=D.barMargin+(L[l].left*E)}},findStartSlot:function(h,g){var f=this.getPriorOverlappingEvents(h,g),e;if(f.length===0){return{start:0,end:1}}for(e=0;e<f.length;e++){if(e===0&&f[0].left>0){return{start:0,end:f[0].left}}else{if(f[e].left+f[e].width<(e<f.length-1?f[e+1].left:1)){return{start:f[e].left+f[e].width,end:e<f.length-1?f[e+1].left:1}}}}return false},getPriorOverlappingEvents:function(n,m){var l=Sch.util.Date,k=m.start,i=m.end,p=[];for(var o=0,j=Ext.Array.indexOf(n,m);o<j;o++){if(l.intersectSpans(k,i,n[o].start,n[o].end)){p.push(n[o])}}p.sort(this.sortOverlappers);return p},sortOverlappers:function(c,d){return c.left<d.left?-1:1},getCluster:function(n,l){if(l>=n.length-1){return[n[l]]}var p=[n[l]],k=n[l].start,i=n[l].end,j=n.length,m=Sch.util.Date,o=l+1;while(o<j&&m.intersectSpans(k,i,n[o].start,n[o].end)){p.push(n[o]);k=m.max(k,n[o].start);i=m.min(n[o].end,i);o++}return p},sortEvents:function(k,m){var j=k.getStartDate(),a=k.getEndDate();var l=m.getStartDate(),b=m.getEndDate();var n=(j-l===0);if(n){return a>b?-1:1}else{return(j<l)?-1:1}}});Ext.define("Sch.eventlayout.Table",{extend:"Sch.eventlayout.Horizontal",timeAxisViewModel:null,layoutEventsInBands:function(p){var k=this.timeAxisViewModel;var m=k.timeAxis;var j=0;do{var n=p[0];while(n){n.top=this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertScope||this,j,n.event);var i=Math.floor(m.getTickFromDate(n.start));var l=this.timeAxisViewModel.getPositionFromDate(m.getAt(i).getStartDate());var o=this.timeAxisViewModel.getTickWidth();n.left=l;n.width=o;Ext.Array.remove(p,n);n=this.findClosestSuccessor(n,p)}j++}while(p.length>0);return j},findClosestSuccessor:function(u,i){var q=Infinity,t,n=u.end,l;var o=this.timeAxisViewModel.timeAxis;var v=Math.floor(o.getTickFromDate(u.start));var p=o.getAt(v);for(var r=0,s=i.length;r<s;r++){l=i[r].start-n;if(l>=0&&l<q&&i[r].start>=p.getEndDate()){t=i[r];q=l}}return t}});Ext.define("Sch.column.Summary",{extend:"Ext.grid.column.Column",alias:["widget.summarycolumn","plugin.scheduler_summarycolumn"],mixins:["Ext.AbstractPlugin"],alternateClassName:"Sch.plugin.SummaryColumn",init:Ext.emptyFn,lockableScope:"top",showPercent:false,nbrDecimals:1,sortable:false,fixed:true,menuDisabled:true,width:80,dataIndex:"_sch_not_used",timeAxis:null,eventStore:null,constructor:function(b){this.scope=this;this.callParent(arguments);this.on("beforerender",this.onMyBeforeRender,this)},onMyBeforeRender:function(){var b=this.up("tablepanel[lockable=true]");this.timeAxis=b.getTimeAxis();this.eventStore=b.getEventStore()},renderer:function(k,t,n){var m=this.timeAxis,p=this.eventStore,o=m.getStart(),l=m.getEnd(),r=0,s=this.calculate(p.getEventsForResource(n),o,l);if(s<=0){return""}if(this.showPercent){var q=Sch.util.Date.getDurationInMinutes(o,l);return(Math.round((s*100)/q))+" %"}else{if(s>1440){return(s/1440).toFixed(this.nbrDecimals)+" "+Sch.util.Date.getShortNameOfUnit("DAY")}if(s>=30){return(s/60).toFixed(this.nbrDecimals)+" "+Sch.util.Date.getShortNameOfUnit("HOUR")}return s+" "+Sch.util.Date.getShortNameOfUnit("MINUTE")}},calculate:function(n,j,m){var l=0,h,i,k=Sch.util.Date;Ext.each(n,function(a){h=a.getStartDate();i=a.getEndDate();if(k.intersectSpans(j,m,h,i)){l+=k.getDurationInMinutes(k.max(h,j),k.min(i,m))}});return l}});Ext.define("Sch.column.Resource",{extend:"Ext.grid.Column",alias:"widget.resourcecolumn",align:"center",menuDisabled:true,hideable:false,sortable:false,locked:false,lockable:false,draggable:false,enableLocking:false,model:null,initComponent:function(){this.tdCls=(this.tdCls||"")+" sch-timetd";this.cls=(this.cls||"")+" sch-resourcecolumn-header";this.callParent(arguments)}});Ext.define("Sch.column.Day",{extend:"Ext.grid.column.Column",alias:"widget.weekview-day",align:"center",start:null,end:null,draggable:false,groupable:false,hideable:false,sortable:false,menuDisabled:true,enableLocking:false,flex:1,resizable:false,tdCls:"sch-timetd",initComponent:function(){var b=new Date();this.addCls("sch-daycolumn-header");if(this.isWeekend()){this.addCls("sch-daycolumn-header-weekend");this.tdCls=(this.tdCls||"")+" sch-daycolumn-weekend"}if(this.start.getDate()===b.getDate()&&this.start.getMonth()===b.getMonth()&&this.start.getYear()===b.getYear()){this.addCls("sch-daycolumn-header-today");this.tdCls=(this.tdCls||"")+" sch-daycolumn-today"}this.callParent(arguments)},isWeekend:function(){var b=this.start.getDay();return b===6||b===0}});if(!Ext.ClassManager.get("Sch.view.model.TimeAxis")){Ext.define("Sch.view.model.TimeAxis",{extend:"Ext.util.Observable",requires:["Ext.Date","Sch.util.Date","Sch.preset.Manager"],timeAxis:null,availableWidth:0,tickWidth:100,snapToIncrement:false,forceFit:false,headerConfig:null,headers:null,mainHeader:0,timeAxisColumnWidth:null,resourceColumnWidth:null,calendarColumnWidth:null,timeColumnWidth:null,rowHeightHorizontal:null,rowHeightVertical:null,mode:"horizontal",suppressFit:false,refCount:0,columnConfig:{},viewPreset:null,columnLinesFor:"middle",eventStore:null,originalTickWidth:null,constructor:function(e){var f=this;Ext.apply(this,e);if(this.viewPreset){if(this.viewPreset instanceof Sch.preset.ViewPreset){this.consumeViewPreset(this.viewPreset)}else{var d=Sch.preset.Manager.getPreset(this.viewPreset);d&&this.consumeViewPreset(d)}}f.timeAxis.on("reconfigure",f.onTimeAxisReconfigure,f);this.callParent(arguments)},destroy:function(){this.timeAxis.un("reconfigure",this.onTimeAxisReconfigure,this)},onTimeAxisReconfigure:function(d,c){if(!c){this.update()}},reconfigure:function(b){this.headers=null;Ext.apply(this,b);switch(this.mode){case"horizontal":this.setTickWidth(this.timeColumnWidth);break;case"vertical":this.setTickWidth(this.rowHeightVertical);break;case"calendar":this.setTickWidth(this.rowHeightVertical);break}this.fireEvent("reconfigure",this)},getColumnConfig:function(){return this.columnConfig},update:function(k,g){var j=this.timeAxis,l=this.headerConfig;this.availableWidth=Math.max(k||this.availableWidth,0);if(!Ext.isNumber(this.availableWidth)){throw"Invalid available width provided to Sch.view.model.TimeAxis"}if(this.forceFit&&this.availableWidth<=0){return}this.columnConfig={};for(var i in l){if(l[i].cellGenerator){this.columnConfig[i]=l[i].cellGenerator.call(this,j.getStart(),j.getEnd())}else{this.columnConfig[i]=this.createHeaderRow(i,l[i])}}var h=this.calculateTickWidth(this.originalTickWidth);if(!Ext.isNumber(h)||h<=0){throw"Invalid column width calculated in Sch.view.model.TimeAxis"}this.updateTickWidth(h);if(!g){this.fireEvent("update",this)}},createHeaderRow:function(h,k){var l=[],j=this,i=k.align,g=Ext.Date.clearTime(new Date());j.forEachInterval(h,function(a,d,c){var b={align:i,start:a,end:d,headerCls:""};if(k.renderer){b.header=k.renderer.call(k.scope||j,a,d,b,c,j.eventStore)}else{b.header=Ext.Date.format(a,k.dateFormat)}if(k.unit===Sch.util.Date.DAY&&(!k.increment||k.increment===1)){b.headerCls+=" sch-dayheadercell-"+a.getDay();if(Ext.Date.clearTime(a,true)-g===0){b.headerCls+=" sch-dayheadercell-today"}}l.push(b)});return l},getDistanceBetweenDates:function(c,d){return Math.round(this.getPositionFromDate(d,true)-this.getPositionFromDate(c))},getPositionFromDate:function(r,s){if(this.mode==="calendar"){var v=this.rowHeightCalendar||this.rowHeightVertical;var t=this.getHeaders();var u=this.timeAxis.getStart();var p=Sch.util.Date;var n=p.mergeDates(u,r,t[1].unit);var m=p.getDurationInUnit(u,n,t[1].unit,true)*v;var l=Math.round(m);if(l===0&&s){return this.calendarRowsAmount*v}return l}else{var o=-1,q=this.timeAxis.getTickFromDate(r);if(q>=0){o=Math.round(this.tickWidth*(q-this.timeAxis.visibleTickStart))}return o}},getDateFromPosition:function(p,m){if(this.mode==="calendar"){var w=this.rowHeightCalendar||this.rowHeightVertical;var q=Sch.util.Date;var v=this.timeAxis.getStart();var u=this.getHeaders();var o=q.add(v,u[0].splitUnit,Math.floor(p[0]/this.calendarColumnWidth));var r=this.timeAxis.first();var t=(r.get("end")-r.get("start"))/w;var n=q.add(o,q.MILLI,Math.round(p[1]*t));if(m){n=this.timeAxis[m+"Date"](n)}return n}else{var s=p/this.getTickWidth()+this.timeAxis.visibleTickStart,x=this.timeAxis.getCount();if(s<0||s>x){return null}return this.timeAxis.getDateFromTick(s,m)}},getSingleUnitInPixels:function(b){return Sch.util.Date.getUnitToBaseUnitRatio(this.timeAxis.getUnit(),b)*this.tickWidth/this.timeAxis.increment},getSnapPixelAmount:function(){if(this.snapToIncrement){var b=this.timeAxis.getResolution();return(b.increment||1)*this.getSingleUnitInPixels(b.unit)}else{return 1}},getTickWidth:function(){return this.tickWidth},setTickWidth:function(c,d){this.originalTickWidth=c;this.updateTickWidth(c);this.update(null,d)},updateTickWidth:function(b){this.tickWidth=b;switch(this.mode){case"horizontal":this.timeColumnWidth=b;break;case"vertical":this.rowHeightVertical=b;break;case"calendar":this.rowHeightVertical=b;break}},getTotalWidth:function(){return Math.round(this.tickWidth*this.timeAxis.getVisibleTickTimeSpan())},calculateTickWidth:function(r){var l=this.forceFit;var o=this.timeAxis;var t=0,p=o.getUnit(),m=Number.MAX_VALUE,s=Sch.util.Date;if(this.snapToIncrement){var q=o.getResolution();m=s.getUnitToBaseUnitRatio(p,q.unit)*q.increment}else{var n=s.getMeasuringUnit(p);m=Math.min(m,s.getUnitToBaseUnitRatio(p,n))}if(!this.suppressFit){var u=Math[l?"floor":"round"](this.getAvailableWidth()/o.getVisibleTickTimeSpan());t=(l||r<u)?u:r;if(m>0&&(!l||m<1)){var v=Ext.versions.touch&&l?"ceil":(l?"floor":"round");t=Math.round(Math.max(1,Math[v](m*t))/m)}}else{t=r}return t},getAvailableWidth:function(){return this.availableWidth},setAvailableWidth:function(d){this.availableWidth=Math.max(0,d);var c=this.calculateTickWidth(this.originalTickWidth);if(c!==this.tickWidth){this.update()}},fitToAvailableWidth:function(d){var c=Math.floor(this.availableWidth/this.timeAxis.getVisibleTickTimeSpan());this.setTickWidth(c,d)},setForceFit:function(b){if(b!==this.forceFit){this.forceFit=b;this.update()}},setSnapToIncrement:function(b){if(b!==this.snapToIncrement){this.snapToIncrement=b;this.update()}},getViewRowHeight:function(){var b=this.mode=="horizontal"?this.rowHeightHorizontal:this.rowHeightVertical;if(!b){throw"rowHeight info not available"}return b},setViewRowHeight:function(h,f){var g=this.mode==="horizontal";var e="rowHeight"+Ext.String.capitalize(this.mode);if(this[e]!=h){this[e]=h;if(g){if(!f){this.fireEvent("update",this)}}else{this.setTickWidth(h,f)}}},setViewColumnWidth:function(c,d){switch(this.mode){case"horizontal":this.setTickWidth(c,d);break;case"vertical":this.resourceColumnWidth=c;break;case"calendar":this.calendarColumnWidth=c;break}if(!d){this.fireEvent("columnwidthchange",this,c)}},getHeaders:function(){if(this.headers){return this.headers}var b=this.headerConfig;this.mainHeader=b.top?1:0;return this.headers=[].concat(b.top||[],b.middle||[],b.bottom||[])},getMainHeader:function(){return this.getHeaders()[this.mainHeader]},getBottomHeader:function(){var b=this.getHeaders();return b[b.length-1]},forEachInterval:function(f,g,i){i=i||this;var j=this.headerConfig;if(!j){return}if(f==="top"||(f==="middle"&&j.bottom)){var h=j[f];this.timeAxis.forEachAuxInterval(h.unit,h.increment,g,i)}else{this.timeAxis.each(function(a,b){return g.call(i,a.data.start,a.data.end,b)})}},forEachMainInterval:function(d,c){this.forEachInterval("middle",d,c)},consumeViewPreset:function(d){this.headers=null;var c=this.mode=="horizontal";Ext.apply(this,{headerConfig:d.headerConfig,columnLinesFor:d.columnLinesFor||"middle",rowHeightHorizontal:d.rowHeight,tickWidth:c?d.timeColumnWidth:d.timeRowHeight||d.timeColumnWidth||60,timeColumnWidth:d.timeColumnWidth,rowHeightVertical:d.timeRowHeight||d.timeColumnWidth||60,timeAxisColumnWidth:d.timeAxisColumnWidth,resourceColumnWidth:d.resourceColumnWidth||100});this.originalTickWidth=this.tickWidth}})}Ext.define("Sch.view.HorizontalTimeAxis",{extend:"Ext.util.Observable",requires:["Ext.XTemplate"],trackHeaderOver:true,compactCellWidthThreshold:15,baseCls:"sch-column-header",tableCls:"sch-header-row",headerHtmlRowTpl:'<table border="0" cellspacing="0" cellpadding="0" style="width: {totalWidth}px; {tstyle}" class="{{tableCls}} sch-header-row-{position} {cls}"><thead><tr><tpl for="cells"><td class="{{baseCls}} {headerCls}" style="position : static; text-align: {align}; width: {width}px; {style}" tabIndex="0"headerPosition="{parent.position}" headerIndex="{[xindex-1]}"><div class="sch-simple-timeheader">{header}</div></td></tpl></tr></thead></table>',model:null,hoverCls:"",containerEl:null,height:null,constructor:function(i){var h=this;var f=!!Ext.versions.touch;var g=f?"tap":"click";Ext.apply(this,i);h.callParent(arguments);h.model.on("update",h.onModelUpdate,this,{priority:5});h.containerEl=Ext.get(h.containerEl);if(!(h.headerHtmlRowTpl instanceof Ext.Template)){h.headerHtmlRowTpl=h.headerHtmlRowTpl.replace("{{baseCls}}",this.baseCls).replace("{{tableCls}}",this.tableCls);h.headerHtmlRowTpl=new Ext.XTemplate(h.headerHtmlRowTpl)}if(h.trackHeaderOver&&h.hoverCls){h.containerEl.on({mousemove:h.highlightCell,delegate:".sch-column-header",scope:h});h.containerEl.on({mouseleave:h.clearHighlight,scope:h})}var j={scope:this,delegate:".sch-column-header"};if(f){j.tap=this.onElClick("tap");j.doubletap=this.onElClick("doubletap")}else{j.click=this.onElClick("click");j.dblclick=this.onElClick("dblclick");j.contextmenu=this.onElClick("contextmenu")}h._listenerCfg=j;if(h.containerEl){h.containerEl.on(j)}},destroy:function(){var b=this;if(b.containerEl){b.containerEl.un(b._listenerCfg);b.containerEl.un({mousemove:b.highlightCell,delegate:".sch-simple-timeheader",scope:b});b.containerEl.un({mouseleave:b.clearHighlight,scope:b})}b.model.un({update:b.onModelUpdate,scope:b})},onModelUpdate:function(){this.render()},getHTML:function(n,k,o){var j=this.model.getColumnConfig();var l=this.model.getTotalWidth();var p=Ext.Object.getKeys(j).length;var q=this.height?this.height/p:0;var m="";var r;if(j.top){this.embedCellWidths(j.top);m+=this.headerHtmlRowTpl.apply({totalWidth:l,cells:j.top,position:"top",tstyle:"border-top : 0;"+(q?"height:"+q+"px":"")})}if(j.middle){this.embedCellWidths(j.middle);m+=this.headerHtmlRowTpl.apply({totalWidth:l,cells:j.middle,position:"middle",tstyle:(j.top?"":"border-top : 0;")+(q?"height:"+q+"px":""),cls:!j.bottom&&this.model.getTickWidth()<=this.compactCellWidthThreshold?"sch-header-row-compact":""})}if(j.bottom){this.embedCellWidths(j.bottom);m+=this.headerHtmlRowTpl.apply({totalWidth:l,cells:j.bottom,position:"bottom",tstyle:(q?"height:"+q+"px":""),cls:this.model.getTickWidth()<=this.compactCellWidthThreshold?"sch-header-row-compact":""})}return m+'<div class="sch-header-secondary-canvas"></div>'},render:function(){if(!this.containerEl){return}var j=this.containerEl,i=j.dom,k=i.style.display,h=this.model.getColumnConfig(),g=i.parentNode;i.style.display="none";g.removeChild(i);var l=this.getHTML();i.innerHTML=l;if(!h.top&&!h.middle){this.containerEl.addCls("sch-header-single-row")}else{this.containerEl.removeCls("sch-header-single-row")}g&&g.appendChild(i);i.style.display=k;this.fireEvent("refresh",this)},embedCellWidths:function(f){var h=(Ext.isIE7||(Ext.isSafari&&!Ext.supports.Touch))?1:0;for(var j=0;j<f.length;j++){var g=f[j];var i=this.model.getDistanceBetweenDates(g.start,g.end);if(i){g.width=i-(j?h:0)}else{g.width=0;g.style="display: none"}}},onElClick:function(b){return function(h,g){g=h.delegatedTarget||g;var a=Ext.fly(g).getAttribute("headerPosition"),j=Ext.fly(g).getAttribute("headerIndex"),i=this.model.getColumnConfig()[a][j];this.fireEvent("timeheader"+b,this,i.start,i.end,h)}},highlightCell:function(f,e){var d=this;if(e!==d.highlightedCell){d.clearHighlight();d.highlightedCell=e;Ext.fly(e).addCls(d.hoverCls)}},clearHighlight:function(){var c=this,d=c.highlightedCell;if(d){Ext.fly(d).removeCls(c.hoverCls);delete c.highlightedCell}}});Ext.define("Sch.column.timeAxis.Horizontal",{extend:"Ext.grid.column.Column",alias:"widget.timeaxiscolumn",draggable:false,groupable:false,hideable:false,sortable:false,fixed:true,menuDisabled:true,cls:"sch-simple-timeaxis",tdCls:"sch-timetd",enableLocking:false,requires:["Sch.view.HorizontalTimeAxis"],timeAxisViewModel:null,headerView:null,hoverCls:"",ownHoverCls:"sch-column-header-over",trackHeaderOver:true,compactCellWidthThreshold:20,afterRender:function(){var c=this;var d=c.titleEl.createChild({cls:"sch-horizontaltimeaxis-ct"});c.headerView=new Sch.view.HorizontalTimeAxis({model:c.timeAxisViewModel,containerEl:d,hoverCls:c.ownHoverCls,trackHeaderOver:c.trackHeaderOver,compactCellWidthThreshold:c.compactCellWidthThreshold});c.headerView.on("refresh",c.onTimeAxisViewRefresh,c);c.ownerCt.on("afterlayout",function(){if(!c.ownerCt){return}c.mon(c.ownerCt,"resize",c.onHeaderContainerResize,c);if(this.getWidth()>0){if(c.getAvailableWidthForSchedule()===c.timeAxisViewModel.getAvailableWidth()){c.headerView.render()}else{c.timeAxisViewModel.update(c.getAvailableWidthForSchedule())}c.setWidth(c.timeAxisViewModel.getTotalWidth())}},null,{single:true});this.enableBubble("timeheaderclick","timeheaderdblclick","timeheadercontextmenu");c.relayEvents(c.headerView,["timeheaderclick","timeheaderdblclick","timeheadercontextmenu"]);c.callParent(arguments);c.focusable=false},initRenderData:function(){var b=this;b.renderData.headerCls=b.renderData.headerCls||b.headerCls;return b.callParent(arguments)},destroy:function(){if(this.headerView){this.headerView.destroy()}this.callParent(arguments)},onTimeAxisViewRefresh:function(){this.headerView.un("refresh",this.onTimeAxisViewRefresh,this);this.setWidth(this.timeAxisViewModel.getTotalWidth());this.headerView.on("refresh",this.onTimeAxisViewRefresh,this)},getAvailableWidthForSchedule:function(){var g=this.ownerCt.isVisible(true)?this.ownerCt.getWidth():(this.ownerCt.lastBox&&this.ownerCt.lastBox.width||0),f=this.ownerCt.items,h;for(var e=1;e<f.length;e++){h=f.get(e);if(!h.hidden){g-=h.isVisible(true)?h.getWidth():(h.lastBox&&h.lastBox.width||0)}}return g-Ext.getScrollbarSize().width-1},onResize:function(){this.callParent(arguments);this.timeAxisViewModel.setAvailableWidth(this.getAvailableWidthForSchedule())},onHeaderContainerResize:function(){this.timeAxisViewModel.setAvailableWidth(this.getAvailableWidthForSchedule());this.headerView.render()},refresh:function(){this.timeAxisViewModel.update(null,true);this.headerView.render()}});Ext.define("Sch.column.timeAxis.Vertical",{extend:"Ext.grid.column.Column",alias:"widget.verticaltimeaxis",align:"right",draggable:false,groupable:false,hideable:false,sortable:false,menuDisabled:true,timeAxis:null,timeAxisViewModel:null,cellTopBorderWidth:null,cellBottomBorderWidth:null,totalBorderWidth:null,enableLocking:false,locked:true,initComponent:function(){this.callParent(arguments);this.tdCls=(this.tdCls||"")+" sch-verticaltimeaxis-cell";this.scope=this;this.totalBorderWidth=this.cellTopBorderWidth+this.cellBottomBorderWidth},afterRender:function(){this.callParent(arguments);var b=this.up("panel");b.getView().on("resize",this.onContainerResize,this)},onContainerResize:function(f,d,e){this.timeAxisViewModel.update(e-21)},renderer:function(i,f,g,h){var j=this.timeAxisViewModel.getBottomHeader();f.style="height:"+(this.timeAxisViewModel.getTickWidth()-this.totalBorderWidth)+"px";if(j.renderer){return j.renderer.call(j.scope||this,g.data.start,g.data.end,f,h)}else{return Ext.Date.format(g.data.start,j.dateFormat)}}});if(!Ext.ClassManager.get("Sch.model.Customizable")){Ext.define("Sch.model.Customizable",{extend:"Ext.data.Model",customizableFields:null,previous:null,__editing:null,__editCounter:0,constructor:function(){var b=this.callParent(arguments);return b},onClassExtended:function(e,g,f){var h=f.onBeforeCreated;f.onBeforeCreated=function(a,p){h.apply(this,arguments);var o=a.prototype;if(!o.customizableFields){return}o.customizableFields=(a.superclass.customizableFields||[]).concat(o.customizableFields);var r=o.customizableFields;var q={};var c=this;var s=Ext.Array.findBy(a.fields,function(i){return i.name===o.idProperty});c.idField=o.idField=s;if(!a.fieldsMap[o.idProperty]){a.fieldsMap[o.idProperty]=s}Ext.Array.forEach(r,function(i){if(typeof i=="string"){i={name:i}}q[i.name]=i});var d=o.fields;var b=[];var t=[];Ext.Array.forEach(d,function(i){if(i.isCustomizableField){t.push(i.getName())}});if(o.idProperty!=="id"&&o.getField("id")){if(!o.getField("id").hasOwnProperty("name")){t.push("id")}}if(o.idProperty!=="Id"&&o.getField("Id")){if(!o.getField("Id").hasOwnProperty("name")){t.push("Id")}}a.removeFields(t);Ext.Object.each(q,function(l,i){i.isCustomizableField=true;var B=i.name||i.getName();var m=B==="Id"?"idProperty":B.charAt(0).toLowerCase()+B.substr(1)+"Field";var A=o[m];var n=A||B;var y;if(o.getField(n)){y=Ext.applyIf({name:B,isCustomizableField:true},o.getField(n));o.getField(n).isCustomizableField=true;y=Ext.create("data.field."+(y.type||"auto"),y);r.push(y)}else{y=Ext.applyIf({name:n,isCustomizableField:true},i);y=Ext.create("data.field."+(y.type||"auto"),y);b.push(y)}var j=Ext.String.capitalize(B);if(j!="Id"){var z="get"+j;var k="set"+j;if(!o[z]||o[z].__getterFor__&&o[z].__getterFor__!=n){o[z]=function(){return this.get(n)};o[z].__getterFor__=n}if(!o[k]||o[k].__setterFor__&&o[k].__setterFor__!=n){o[k]=function(u){return this.set(n,u)};o[k].__setterFor__=n}}});a.addFields(b)}},set:function(i,g){var h;var k;this.previous=this.previous||{};if(typeof i==="string"){h=this.get(i);if(h instanceof Date&&!(g instanceof Date)){g=this.getField(i).convert(g,this)}if((h instanceof Date&&(h-g))||!(h instanceof Date)&&h!==g){this.previous[i]=h}else{return[]}}else{for(var j in i){h=this.get(j);var l=i[j];if(h instanceof Date&&!(l instanceof Date)){l=this.getField(j).convert(l,this)}if((h instanceof Date&&(h-l))||!(h instanceof Date)&&h!==l){this.previous[j]=h}}}k=this.callParent(arguments);if(!this.__editing){delete this.previous}return k},reject:function(){var d=this,e=d.modified||{},f;d.__editing=true;d.previous=d.previous||{};for(f in e){if(e.hasOwnProperty(f)){if(typeof e[f]!="function"){d.previous[f]=d.get(f)}}}d.callParent(arguments);delete d.previous;d.__editing=false},beginEdit:function(){this.__editCounter++;this.__editing=true;this.callParent(arguments)},cancelEdit:function(){this.__editCounter=0;this.__editing=false;this.callParent(arguments);delete this.previous},endEdit:function(d,f){if(--this.__editCounter===0){if(!d&&this.getModifiedFieldNames){var e=this.editMemento;if(!f){f=this.getModifiedFieldNames(e.data)}if(f&&f.length===0){d=true}}this.callParent([d].concat(Array.prototype.slice.call(arguments,1)));this.__editing=false;delete this.previous}}})}if(!Ext.ClassManager.get("Sch.model.Range")){Ext.define("Sch.model.Range",{extend:"Sch.model.Customizable",requires:["Sch.util.Date"],idProperty:"Id",config:Ext.versions.touch?{idProperty:"Id"}:null,startDateField:"StartDate",endDateField:"EndDate",nameField:"Name",clsField:"Cls",customizableFields:[{name:"StartDate",type:"date",dateFormat:"c"},{name:"EndDate",type:"date",dateFormat:"c"},{name:"Cls",type:"string"},{name:"Name",type:"string"}],setStartDate:function(f,g){var h=this.getEndDate();var e=this.getStartDate();this.set(this.startDateField,f);if(g===true&&h&&e){this.setEndDate(Sch.util.Date.add(f,Sch.util.Date.MILLI,h-e))}},setEndDate:function(e,g){var f=this.getStartDate();var h=this.getEndDate();this.set(this.endDateField,e);if(g===true&&f&&h){this.setStartDate(Sch.util.Date.add(e,Sch.util.Date.MILLI,-(h-f)))}},setStartEndDate:function(c,d){this.beginEdit();this.set(this.startDateField,c);this.set(this.endDateField,d);this.endEdit()},getDates:function(){var f=[],d=this.getEndDate();for(var e=Ext.Date.clearTime(this.getStartDate(),true);e<d;e=Sch.util.Date.add(e,Sch.util.Date.DAY,1)){f.push(e)}return f},forEachDate:function(c,d){return Ext.each(this.getDates(),c,d)},isValid:function(){var d=this.callParent(arguments);if(d){var f=this.getStartDate(),e=this.getEndDate();d=!f||!e||(e-f>=0)}return d},shift:function(c,d){this.setStartEndDate(Sch.util.Date.add(this.getStartDate(),c,d),Sch.util.Date.add(this.getEndDate(),c,d))},fullCopy:function(){return this.copy.apply(this,arguments)}})}if(!Ext.ClassManager.get("Sch.model.TimeAxisTick")){Ext.define("Sch.model.TimeAxisTick",{extend:"Sch.model.Range",startDateField:"start",endDateField:"end"})}!Ext.ClassManager.get("Sch.model.Event")&&Ext.define("Sch.model.Event",{extend:"Sch.model.Range",idProperty:"Id",customizableFields:[{name:"ResourceId"},{name:"Draggable",type:"boolean",persist:false,defaultValue:true},{name:"Resizable",persist:false,defaultValue:true}],resourceIdField:"ResourceId",draggableField:"Draggable",resizableField:"Resizable",getInternalId:function(){return this.internalId},getEventStore:function(){var c=this,d=c.joined&&c.joined[0];if(d&&!d.isEventStore){Ext.Array.sort(c.joined,function(a,b){return(a.isEventStore||false)>(b.isEventStore||false)&&-1||1});d=c.joined[0]}return d},getResourceStore:function(){var b=this.getEventStore();return b&&b.getResourceStore()},getAssignmentStore:function(){var b=this.getEventStore();return b&&b.getAssignmentStore()},getResources:function(){var c=this,d=c.getEventStore();return d&&d.getResourcesForEvent(c)||[]},forEachResource:function(g,h){var f=this.getResources();for(var e=0;e<f.length;e++){if(g.call(h||this,f[e])===false){return}}},getResource:function(h,f){var i=this,g=null,j;f=f||i.getEventStore();j=f&&f.getResourceStore();h=h==null?i.getResourceId():h;if(f&&(h===null||h===undefined)){g=f.getResourcesForEvent(i);if(g.length==1){g=g[0]}else{if(g.length>1){Ext.Error.raise("Event::getResource() is not applicable for events with multiple assignments, please use Event::getResources() instead.")}else{g=null}}}else{if(j){g=j.getModelById(h)}}return g},setResource:function(f){var d=this,e=d.getEventStore();e&&e.removeAssignmentsForEvent(d);d.assign(f)},assign:function(f){var d=this,e=d.getEventStore();f=f instanceof Sch.model.Resource?f.getId():f;if(e){e.assignEventToResource(d,f)}else{d.setResourceId(f)}},unassign:function(f){var d=this,e=d.getEventStore();f=f instanceof Sch.model.Resource?f.getId():f;if(e){e.unassignEventFromResource(d,f)}else{if(d.getResourceId()==f){d.setResourceId(null)}}},reassign:function(f,e){var g=this,h=g.getEventStore();f=f instanceof Sch.model.Resource?f.getId():f;e=e instanceof Sch.model.Resource?e.getId():e;if(h){h.reassignEventFromResourceToResource(g,f,e)}else{g.setResourceId(e)}},isAssignedTo:function(g){var h=this,e=h.getEventStore(),f=false;g=g instanceof Sch.model.Resource&&g.getId()||g;if(e){f=e.isEventAssignedToResource(h,g)}else{f=h.getResourceId()==g}return f},getAssignments:function(){var c=this,d=c.getEventStore();return d&&d.getAssignmentsForEvent(c)},isDraggable:function(){return this.getDraggable()},isResizable:function(){return this.getResizable()},isPersistable:function(){var c=this,d=c.getEventStore();return d&&d.isEventPersistable(c)}});if(!Ext.ClassManager.get("Sch.model.Resource")){Ext.define("Sch.model.Resource",{extend:"Sch.model.Customizable",idProperty:"Id",config:Ext.versions.touch?{idProperty:"Id"}:null,nameField:"Name",customizableFields:[{name:"Name",type:"string"}],getInternalId:function(){return this.internalId},getResourceStore:function(){return this.joined&&this.joined[0]},getEventStore:function(){var b=this.getResourceStore();return b&&b.getEventStore()||this.parentNode&&this.parentNode.getEventStore()},getAssignmentStore:function(){var b=this.getEventStore();return b&&b.getAssignmentStore()},getEvents:function(d){var c=this;d=d||c.getEventStore();return d&&d.getEventsForResource(c)||[]},getAssignments:function(){var c=this,d=c.getEventStore();return d&&d.getAssignmentsForResource(c)},isPersistable:function(){var b=this.parentNode;return !b||!b.phantom||(b.isRoot&&b.isRoot())}})}if(!Ext.ClassManager.get("Sch.model.Assignment")){Ext.define("Sch.model.Assignment",{extend:"Sch.model.Customizable",idProperty:"Id",customizableFields:[{name:"ResourceId"},{name:"EventId"}],resourceIdField:"ResourceId",eventIdField:"EventId",getInternalId:function(){return this.internalId},getAssignmentStore:function(){return this.joined&&this.joined[0]},getEventStore:function(){var b=this.getAssignmentStore();return b&&b.getEventStore()},getResourceStore:function(){var b=this.getEventStore();return b&&b.getResourceStore()},getEvent:function(d){var c=this;d=d||c.getEventStore();return d&&d.getModelById(c.getEventId())},getResource:function(c){var d=this;c=c||d.getResourceStore();return c&&c.getModelById(d.getResourceId())},getEventName:function(d){var c=this.getEvent(d);return c&&c.getName()||""},getResourceName:function(d){var c=this.getResource(d);return c&&c.getName()||""},isPersistable:function(){var d=this,e=d.getEvent(),f=d.getResource();return e&&!e.phantom&&f&&!f.phantom},fullCopy:function(){return this.copy.apply(this,arguments)}})}Ext.define("Sch.data.util.ResourceEventsCache",{extend:"Sch.util.Cache",requires:["Ext.data.Model"],eventStore:null,eventStoreDetacher:null,resourceStoreDetacher:null,constructor:function(v){var p=this,o=v.getResourceStore();p.callParent();function m(b,a){Ext.Array.forEach(a,function(c){p.add(c.getResourceId(),c)})}function t(b,a){Ext.Array.forEach(a,function(c){p.remove(c.getResourceId(),c)})}function u(f,c,g,d){var b=c.resourceIdField,e=c.previous&&b in c.previous,a=e&&c.previous[b];if(g!=Ext.data.Model.COMMIT&&e){p.move(a,c.getResourceId(),c)}}function r(){p.clear()}function n(c,a,b){p.clear();x(a)}function q(d,c,b,a){p.move(b,a)}function s(a,b){Ext.Array.forEach(b,function(c){p.clear(c)})}function w(){p.clear()}function x(a){Ext.destroy(p.resourceStoreDetacher);p.resourceStoreDetacher=a&&a.on({idchanged:q,remove:s,clear:w,cacheresethint:w,rootchange:w,priority:100,destroyable:true})}p.eventStoreDetacher=v.on({add:m,remove:t,update:u,clear:r,cacheresethint:r,rootchange:r,resourcestorechange:n,priority:100,destroyable:true});x(o);p.eventStore=v},destroy:function(){var b=this;Ext.destroyMembers(b,"eventStoreDetacher","resourceStoreDetacher");b.eventStore=null},get:function(e,d){var f=this;e=f.key(e);d=d||function(){return Ext.Array.filter(f.eventStore.getRange(),function(a){return a.getResourceId()==e})};return f.callParent([e,d])}});Ext.define("Sch.data.util.EventAssignmentsCache",{extend:"Sch.util.Cache",requires:["Ext.data.Model"],assignmentStore:null,assignmentStoreDetacher:null,eventStoreDetacher:null,constructor:function(r){var q=this,u=r.getEventStore();q.callParent();function o(b,a){Ext.Array.forEach(a,function(c){q.add(c.getEventId(),c)})}function w(b,a){Ext.Array.forEach(a,function(c){q.remove(c.getEventId(),c)})}function m(e,b,f){var d=b.eventIdField,a=b.previous&&d in b.previous,c=a&&b.previous[d];if(f!=Ext.data.Model.COMMIT&&a){q.move(c,b.getEventId(),b)}}function n(a){q.clear()}function v(a,b){q.clear();x(b)}function p(d,c,b,a){q.move(b,a)}function t(b,a){Ext.Array.forEach(a,function(c){q.clear(c)})}function s(){q.clear()}function x(a){Ext.destroy(q.eventStoreDetacher);q.eventStoreDetacher=a&&a.on({idchanged:p,remove:t,cacheresethint:s,clear:s,rootchange:s,priority:100,destroyable:true})}q.assignmentStoreDetacher=r.on({add:o,remove:w,update:m,cacheresethint:n,clear:n,eventstorechange:v,priority:100,destroyable:true});x(u);q.assignmentStore=r},destroy:function(){var b=this;Ext.destroyMembers(b,"assignmentStoreDetacher","eventStoreDetacher");b.assignmentStore=null},get:function(e,d){var f=this;e=f.key(e);d=d||function(){return Ext.Array.filter(f.assignmentStore.getRange(),function(a){return a.getEventId()==e})};return f.callParent([e,d])}});Ext.define("Sch.data.util.ResourceAssignmentsCache",{extend:"Sch.util.Cache",requires:["Ext.data.Model"],assignmentStore:null,assignmentStoreDetacher:null,eventStoreDetacher:null,resourceStoreDetacher:null,constructor:function(w){var u=this,y=w.getEventStore(),r=y&&y.getResourceStore();u.callParent();function t(a,b){Ext.Array.forEach(b,function(c){u.add(c.getResourceId(),c)})}function C(a,b){Ext.Array.forEach(b,function(c){u.remove(c.getResourceId(),c)})}function p(d,a,e){var b=a.resourceIdField,c=a.previous&&b in a.previous,f=c&&a.previous[b];if(e!=Ext.data.Model.COMMIT&&c){u.move(f,a.getResourceId(),a)}}function s(a){u.clear()}function B(b,a){D(a);A(a&&a.getResourceStore())}function q(b,a){u.clear();A(a)}function v(c,b,a,d){u.move(a,d)}function x(b,a){Ext.Array.forEach(a,function(c){u.clear(c)})}function z(){u.clear()}function D(a){Ext.destroy(u.eventStoreDetacher);u.eventStoreDetacher=a&&a.on({resourcestorechange:q,priority:100,destroyable:true})}function A(a){Ext.destroy(u.resourceStoreDetacher);u.resourceStoreDetacher=a&&a.on({idchanged:v,remove:x,clear:z,cacheresethint:z,rootchange:z,priority:100,destroyable:true})}u.assignmentStoreDetacher=w.on({add:t,remove:C,update:p,clear:s,cacheresethint:s,eventstorechange:B,priority:100,destroyable:true});D(y);A(r);u.assignmentStore=w},destroy:function(){var b=this;Ext.destroyMembers(b,"assignmentStoreDetacher","eventStoreDetacher","resourceStoreDetacher");b.assignmentStore=null},get:function(e,d){var f=this;e=f.key(e);d=d||function(){return Ext.Array.filter(f.assignmentStore.getRange(),function(a){return a.getResourceId()==e})};return f.callParent([e,d])}});if(!Ext.ClassManager.get("Sch.data.util.AssignmentStoreEventResourcesCache")){Ext.define("Sch.data.util.AssignmentStoreEventResourcesCache",{extend:"Sch.util.Cache",requires:["Ext.data.Model"],assignmentStore:null,assignmentStoreDetacher:null,eventStoreDetacher:null,resourceStoreDetacher:null,constructor:function(y){var x=this,C=y.getEventStore(),t=C&&C.getResourceStore();x.callParent();function v(c,d){var b=x.assignmentStore.getEventStore(),a=b&&b.getResourceStore();Ext.Array.forEach(d,function(e){var f=a&&a.getModelById(e.getResourceId());if(f){x.add(e.getEventId(),f)}else{x.clear(e.getEventId())}})}function G(c,d){var b=x.assignmentStore.getEventStore(),a=b&&b.getResourceStore();Ext.Array.forEach(d,function(e){var f=a.getModelById(e.getResourceId());if(f){x.remove(e.getEventId(),f)}else{x.clear(e.getEventId())}})}function r(c,l,g){var f=l.resourceIdField,b=l.previous&&f in l.previous,j=b&&l.previous[f],e=l.eventIdField,a=l.previous&&e in l.previous,k=a&&l.previous[e],h=x.assignmentStore.getEventStore(),d=h&&h.getResourceStore(),i;if(g!=Ext.data.Model.COMMIT&&(b||a)){j=b?j:l.getResourceId();k=a?k:l.getEventId();i=d.getModelById(j);if(i){x.remove(k,i)}else{x.clear(k)}i=d.getModelById(l.getResourceId());if(i){x.add(l.getEventId(),i)}else{x.clear(l.getEventId())}}}function u(a){x.clear()}function F(b,a){x.clear();H(a);E(a&&a.getResourceStore())}function w(c,b,a,d){x.move(a,d)}function B(a,b){Ext.Array.forEach(b,function(c){x.clear(c)})}function z(){x.clear()}function s(b,a){x.clear();E(a)}function A(b,a){Ext.Array.forEach(a,function(c){x.uncache(c)})}function D(){x.clear()}function H(a){Ext.destroy(x.eventStoreDetacher);x.eventStoreDetacher=a&&a.on({idchanged:w,remove:B,clear:z,cacheresethint:z,rootchange:z,resourcestorechange:s,priority:100,destroyable:true})}function E(a){Ext.destory(x.resourceStoreDetacher);x.resourceStoreDetacher=a&&a.on({remove:A,clear:D,cacheresethint:D,rootchange:D,priority:100,destroyable:true})}x.assignmentStoreDetacher=y.on({add:v,remove:G,update:r,clear:u,cacheresethint:u,priority:100,destroyable:true});x.assignmentStore=y},destroy:function(){var b=this;Ext.destroyMembers(b,"assignmentStoreDetacher","eventStoreDetacher","resourceStoreDetacher");b.assignmentStore=null},get:function(e,d){var f=this;d=d||function(){return f.assignmentStore.mapAssignmentsForEvent(e,function a(c){return c.getResource()},function b(c){return !!c})};return f.callParent([e,d])}})}if(!Ext.ClassManager.get("Sch.data.util.AssignmentStoreResourceEventsCache")){Ext.define("Sch.data.util.AssignmentStoreResourceEventsCache",{extend:"Sch.util.Cache",requires:["Ext.data.Model"],assignmentStore:null,assignmentStoreDetacher:null,eventStoreDetacher:null,resourceStoreDetacher:null,constructor:function(y){var w=this,C=y.getEventStore(),t=C&&C.getResourceStore();w.callParent();function v(b,c){var a=w.assignmentStore.getEventStore();Ext.Array.forEach(c,function(d){var e=a&&a.getModelById(d.getEventId());if(e){w.add(d.getResourceId(),e)}else{w.clear(d.getResourceId())}})}function G(b,c){var a=w.assignmentStore.getEventStore();Ext.Array.forEach(c,function(d){var e=a&&a.getModelById(d.getEventId());if(e){w.remove(d.getResourceId(),e)}else{w.clear(d.getResourceId())}})}function r(c,j,f){var e=j.resourceIdField,b=j.previous&&e in j.previous,h=b&&j.previous[e],d=j.eventIdField,a=j.previous&&d in j.previous,i=a&&j.previous[d],g=w.assignmentStore.getEventStore(),k;if(f!=Ext.data.Model.COMMIT&&(b||a)){h=b?h:j.getResourceId();i=a?i:j.getEventId();k=g&&g.getModelById(i);if(k){w.remove(h,k)}else{w.clear(h)}k=g&&g.getModelById(j.getEventId());if(k){w.add(j.getResourceId(),k)}else{w.clear(j.getResourceId())}}}function u(a){w.clear()}function F(b,a){w.clear();H(a);E(a&&a.getResourceStore())}function B(a,b){Ext.Array.forEach(b,function(c){w.uncache(c)})}function z(){w.clear()}function s(b,a){w.clear();E(a)}function x(c,b,a,d){w.move(a,d)}function A(b,a){Ext.Array.forEach(a,function(c){w.clear(c)})}function D(){w.clear()}function H(a){Ext.destroy(w.eventStoreDetacher);w.eventStoreDetacher=a&&a.on({remove:B,cacheresethint:z,clear:z,rootchange:z,resourcestorechange:s,priority:100,destroyable:true})}function E(a){Ext.destroy(w.resourceStoreDetacher);w.resourceStoreDetacher=a&&a.on({idchanged:x,remove:A,cacheresethint:D,clear:D,rootchange:D,priority:100,destroyable:true})}w.assignmentStoreDetacher=y.on({add:v,remove:G,update:r,cacheresethint:u,clear:u,eventstorechange:F,priority:100,destroyable:true});H(C);E(t);w.assignmentStore=y},destroy:function(){var b=this;Ext.destroyMembers(b,"assignmentStoreDetacher","eventStoreDetacher","resourceStoreDetacher");b.assignmentStore=null},get:function(e,d){var f=this;d=d||function(){return f.assignmentStore.mapAssignmentsForResource(e,function a(c){return c.getEvent()},function b(c){return !!c})};return f.callParent([e,d])}})}if(!Ext.ClassManager.get("Sch.data.util.ModelPersistencyManager")){Ext.define("Sch.data.util.ModelPersistencyManager",{config:{eventStore:null,resourceStore:null,assignmentStore:null},eventStoreDetacher:null,resourceStoreDetacher:null,assignmentStoreDetacher:null,constructor:function(b){this.initConfig(b)},updateEventStore:function(e,f){var d=this;Ext.destroyMembers(d,"eventStoreDetacher");if(e&&e.autoSync){d.eventStoreDetacher=e.on({beforesync:d.onEventStoreBeforeSync,scope:d,destroyable:true,priority:100})}},updateResourceStore:function(e,d){var f=this;Ext.destroyMembers(f,"resourceStoreDetacher");if(e&&e.autoSync){f.resourceStoreDetacher=e.on({beforesync:f.onResourceStoreBeforeSync,scope:f,destroyable:true,priority:100})}},updateAssignmentStore:function(e,d){var f=this;Ext.destroyMembers(f,"assignmentStoreDetacher");if(e&&e.autoSync){f.assignmentStoreDetacher=e.on({beforesync:f.onAssignmentStoreBeforeSync,scope:f,destroyable:true,priority:100})}},onEventStoreBeforeSync:function(d){var c=this;c.removeNonPersistableRecordsToCreate(d);return c.shallContinueSync(d)},onResourceStoreBeforeSync:function(d){var c=this;c.removeNonPersistableRecordsToCreate(d);return c.shallContinueSync(d)},onAssignmentStoreBeforeSync:function(d){var c=this;c.removeNonPersistableRecordsToCreate(d);return c.shallContinueSync(d)},removeNonPersistableRecordsToCreate:function(e){var f=e.create||[],g,h;for(h=f.length-1;h>=0;--h){g=f[h];if(!g.isPersistable()){Ext.Array.remove(f,g)}}if(f.length===0){delete e.create}},shallContinueSync:function(b){return Boolean((b.create&&b.create.length>0)||(b.update&&b.update.length>0)||(b.destroy&&b.destroy.length>0))}})}if(!Ext.ClassManager.get("Sch.data.util.IdConsistencyManager")){Ext.define("Sch.data.util.IdConsistencyManager",{config:{eventStore:null,resourceStore:null,assignmentStore:null},eventStoreDetacher:null,resourceStoreDetacher:null,constructor:function(b){this.initConfig(b)},updateEventStore:function(e,f){var d=this;Ext.destroyMembers(d,"eventStoreDetacher");if(e){d.eventStoreDetacher=e.on({idchanged:d.onEventIdChanged,scope:d,destroyable:true,priority:200})}},updateResourceStore:function(e,d){var f=this;Ext.destroyMembers(f,"resourceStoreDetacher");if(e){f.resourceStoreDetacher=e.on({idchanged:f.onResourceIdChanged,scope:f,destroyable:true,priority:200})}},onEventIdChanged:function(n,l,j,i){var m=this,k=m.getAssignmentStore(),h;if(k){h=m.getUpdateAssignmentEventIdFieldFn(k,j,i);n.on("update",h,null,{single:true,priority:200})}},onResourceIdChanged:function(j,n,q,o){var k=this,m=k.getEventStore(),l=k.getAssignmentStore(),p,r;if(m&&!l){p=k.getUpdateEventResourceIdFieldFn(m,q,o)}if(l){r=k.getUpdateAssignmentResourceIdFieldFn(l,q,o)}if(p||l){j.on("update",function(){p&&p();r&&r()},null,{single:true,priority:200})}},getUpdateEventResourceIdFieldFn:function(h,g,f){var e=h.getRange();return function(){Ext.Array.forEach(e,function(a){a.getResourceId()==g&&a.setResourceId(f)})}},getUpdateAssignmentEventIdFieldFn:function(h,g,e){var f=h.getAssignmentsForEvent(g);return function(){Ext.Array.forEach(f,function(a){a.getEventId()==g&&a.setEventId(e)})}},getUpdateAssignmentResourceIdFieldFn:function(h,g,e){var f=h.getAssignmentsForResource(g);return function(){Ext.Array.forEach(f,function(a){a.getResourceId()==g&&a.setResourceId(e)})}}})}if(!Ext.ClassManager.get("Sch.data.mixin.UniversalModelGetter")){Ext.define("Sch.data.mixin.UniversalModelGetter",{getModelById:function(c){var d=this;return d.getNodeById?d.getNodeById(c):d.getById(c)},getModelByInternalId:function(c){var d=this;return d.byInternalIdMap?d.byInternalIdMap[c]:d.getByInternalId(c)}})}if(!Ext.ClassManager.get("Sch.data.mixin.CacheHintHelper")){Ext.define("Sch.data.mixin.CacheHintHelper",{extend:"Ext.Mixin",mixinConfig:{before:{loadRecords:"loadRecords"}},loadRecords:function(){var b=this;b.fireEvent("cacheresethint",b)}})}if(!Ext.ClassManager.get("Sch.data.mixin.EventStore")){Ext.define("Sch.data.mixin.EventStore",{extend:"Ext.Mixin",requires:["Sch.util.Date","Sch.data.util.IdConsistencyManager","Sch.data.util.ModelPersistencyManager","Sch.data.util.ResourceEventsCache"],isEventStore:true,resourceStore:null,resourceStoreDetacher:null,assignmentStore:null,resourceEventsCache:null,idConsistencyManager:null,modelPersistencyManager:null,mixinConfig:{after:{constructor:"constructor",destroy:"destroy"}},constructor:function(){var b=this;b.resourceEventsCache=b.createResourceEventsCache();b.idConsistencyManager=b.createIdConsistencyManager();b.modelPersistencyManager=b.createModelPersistencyManager()},destroy:function(){var b=this;Ext.destroyMembers(b,"resourceEventsCache","idConsistencyManager","modelPersistencyManager")},createResourceEventsCache:function(){return new Sch.data.util.ResourceEventsCache(this)},createIdConsistencyManager:function(){var b=this;return new Sch.data.util.IdConsistencyManager({eventStore:b,resourceStore:b.getResourceStore(),assignmentStore:b.getAssignmentStore()})},createModelPersistencyManager:function(){var b=this;return new Sch.data.util.ModelPersistencyManager({eventStore:b,resourceStore:b.getResourceStore(),assignmentStore:b.getAssignmentStore()})},getResourceStore:function(){return this.resourceStore},setResourceStore:function(d){var e=this,f=e.resourceStore;if(e.resourceStore){e.resourceStore.setEventStore(null);e.idConsistencyManager&&e.idConsistencyManager.setResourceStore(null);e.modelPersistencyManager&&e.modelPersistencyManager.setResourceStore(null)}e.resourceStore=d&&Ext.StoreMgr.lookup(d)||null;if(e.resourceStore){e.modelPersistencyManager&&e.modelPersistencyManager.setResourceStore(e.resourceStore);e.idConsistencyManager&&e.idConsistencyManager.setResourceStore(e.resourceStore);d.setEventStore(e)}if((f||d)&&f!==d){e.fireEvent("resourcestorechange",e,d,f)}},getAssignmentStore:function(){return this.assignmentStore},setAssignmentStore:function(d){var e=this,f=e.assignmentStore;if(e.assignmentStore){e.assignmentStore.setEventStore(null);e.idConsistencyManager&&e.idConsistencyManager.setAssignmentStore(null);e.modelPersistencyManager&&e.modelPersistencyManager.setAssignmentStore(null)}e.assignmentStore=d&&Ext.StoreMgr.lookup(d)||null;if(e.assignmentStore){e.modelPersistencyManager&&e.modelPersistencyManager.setAssignmentStore(e.assignmentStore);e.idConsistencyManager&&e.idConsistencyManager.setAssignmentStore(e.assignmentStore);e.assignmentStore.setEventStore(e);Ext.destroy(e.resourceEventsCache)}else{e.resourceEventsCache=e.createResourceEventsCache()}if((f||d)&&f!==d){e.fireEvent("assignmentstorechange",e,d,f)}},isDateRangeAvailable:function(j,i,n,l){var k=Sch.util.Date,h=this.getEventsForResource(l),m=true;Ext.each(h,function(a){m=(n===a||!k.intersectSpans(j,i,a.getStartDate(),a.getEndDate()));return m});return m},getEventsInTimeSpan:function(i,g,h){var k=new Ext.util.MixedCollection();var l=[];if(h!==false){var j=Sch.util.Date;this.forEachScheduledEvent(function(a,b,c){if(j.intersectSpans(b,c,i,g)){l.push(a)}})}else{this.forEachScheduledEvent(function(a,b,c){if(b-i>=0&&g-c>=0){l.push(a)}})}k.addAll(l);return k},forEachScheduledEvent:function(c,d){this.each(function(a){var b=a.getStartDate(),f=a.getEndDate();if(b&&f){return c.call(d||this,a,b,f)}},this)},getTotalTimeSpan:function(){var e=new Date(9999,0,1),d=new Date(0),f=Sch.util.Date;this.each(function(a){if(a.getStartDate()){e=f.min(a.getStartDate(),e)}if(a.getEndDate()){d=f.max(a.getEndDate(),d)}});e=e<new Date(9999,0,1)?e:null;d=d>new Date(0)?d:null;return{start:e||null,end:d||e||null}},filterEventsForResource:function(g,h,e){var f=g.getEvents(this);return Ext.Array.filter(f,h,e||this)},append:function(b){throw"Must be implemented by consuming class"},getResourcesForEvent:function(i){var j=this,h=j.getAssignmentStore(),f=j.getResourceStore(),g;if(h){g=h.getResourcesForEvent(i)}else{if(f){i=i instanceof Sch.model.Event&&i||j.getModelById(i);g=i&&f.getModelById(i.getResourceId());g=g&&[g]||[]}else{g=[]}}return g},getEventsForResource:function(i){var j=this,h=j.getAssignmentStore(),f,g;if(h){g=h.getEventsForResource(i)}else{if(j.resourceEventsCache){g=j.resourceEventsCache.get(i)}else{g=[]}}return g},getAssignmentsForEvent:function(d){var e=this,f=e.getAssignmentStore();return f&&f.getAssignmentsForEvent(d)||[]},getAssignmentsForResource:function(d){var e=this,f=e.getAssignmentStore();return f&&f.getAssignmentsForResource(d)||[]},assignEventToResource:function(e,h){var f=this,g=f.getAssignmentStore();if(g){g.assignEventToResource(e,h)}else{e=e instanceof Sch.model.Event&&e||f.getModelById(e);h=h instanceof Sch.model.Resource?h.getId():h;e&&e.setResourceId(h)}},unassignEventFromResource:function(e,h){var f=this,g=f.getAssignmentStore();if(g){g.unassignEventFromResource(e,h)}else{e=e instanceof Sch.model.Event&&e||f.getModelById(e);h=h instanceof Sch.model.Resource?h.getId():h;if(e&&e.getResourceId()==h){e.setResourceId(null)}}},reassignEventFromResourceToResource:function(i,g,f){var j=this,h=j.getAssignmentStore();if(h){h.unassignEventFromResource(i,g);h.assignEventToResource(i,f)}else{i=i instanceof Sch.model.Event&&i||j.getModelById(i);g=g instanceof Sch.model.Resource?g.getId():g;f=f instanceof Sch.model.Resource?f.getId():f;if(i.getResourceId()==g){i.setResourceId(f)}}},isEventAssignedToResource:function(j,i){var f=this,h=f.getAssignmentStore(),g;if(h){g=h.isEventAssignedToResource(j,i)}else{j=j instanceof Sch.model.Event&&j||f.getModelById(j);i=i instanceof Sch.model.Resource?i.getId():i;g=j&&(j.getResourceId()==i)||false}return g},removeAssignmentsForEvent:function(d){var e=this,f=e.getAssignmentStore();if(f){f.removeAssignmentsForEvent(d)}else{d=d instanceof Sch.model.Event&&d||e.getModelById(d);d&&d.setResourceId(null)}},removeAssignmentsForResource:function(h){var e=this,g=e.getAssignmentStore(),f=e.getResourceStore();if(g){g.removeAssignmentsForResource(h)}else{if(f){h=h instanceof Sch.model.Resource&&h||f.getModelById(h);h&&Ext.Array.forEach(e.resourceEventsCache.get(h),function(a){a.setResourceId(null)})}else{h=h instanceof Sch.model.Resource?h.getId():h;Ext.Array.forEach(e.getRange(),function(a){a.getResourceId()==h&&a.setResourceId(null)})}}},isEventPersistable:function(l){var m=this,j=m.getAssignmentStore(),k,n,h,i=true;if(!j){k=l.getResources();for(n=0,h=k.length;i&&n<h;++n){i=k[n].phantom!==true}}return i}})}if(!Ext.ClassManager.get("Sch.data.EventStore")){Ext.define("Sch.data.EventStore",{extend:"Ext.data.Store",alias:"store.eventstore",mixins:["Sch.data.mixin.UniversalModelGetter","Sch.data.mixin.CacheHintHelper","Sch.data.mixin.EventStore"],storeId:"events",model:"Sch.model.Event",config:{model:"Sch.model.Event"},proxy:"memory",constructor:function(d){var c=this;c.callParent([d]);c.resourceStore&&c.setResourceStore(c.resourceStore);c.assignmentStore&&c.setAssignmentStore(c.assignmentStore);if(c.getModel()!==Sch.model.Event&&!(c.getModel().prototype instanceof Sch.model.Event)){throw"The model for the EventStore must subclass Sch.model.Event"}},append:function(b){this.add(b)}})}if(!Ext.ClassManager.get("Sch.data.mixin.ResourceStore")){Ext.define("Sch.data.mixin.ResourceStore",{eventStore:null,getEventStore:function(){return this.eventStore},setEventStore:function(e){var d=this,f;if(d.eventStore!==e){f=d.eventStore;d.eventStore=e&&Ext.StoreMgr.lookup(e)||null;d.fireEvent("eventstorechange",d,e,f)}}})}Ext.define("Sch.data.mixin.FilterableTreeStore",{isFilteredFlag:false,isHiddenFlag:false,lastTreeFilter:null,lastTreeHiding:null,allowExpandCollapseWhileFiltered:true,reApplyFilterOnDataChange:true,suspendIncrementalFilterRefresh:0,filterGeneration:0,currentFilterGeneration:null,dataChangeListeners:null,monitoringDataChange:false,filterUpdateSuspended:false,onClassMixedIn:function(b){b.override(Sch.data.mixin.FilterableTreeStore.prototype.inheritables()||{})},initTreeFiltering:function(){this.treeFilter=new Ext.util.Filter({filterFn:this.isNodeFilteredIn,scope:this});this.dataChangeListeners={nodeappend:this.onNeedToUpdateFilter,nodeinsert:this.onNeedToUpdateFilter,scope:this};if(Ext.getVersion().isGreaterThan("5.1.0.107")){Ext.apply(this.dataChangeListeners,{beforeload:this.onStoreBeforeLoad,load:this.onStoreLoad})}},onStoreBeforeLoad:function(){this.filterUpdateSuspended=true},onStoreLoad:function(){this.filterUpdateSuspended=false;this.onNeedToUpdateFilter()},startDataChangeMonitoring:function(){if(this.monitoringDataChange){return}this.monitoringDataChange=true;this.on(this.dataChangeListeners)},stopDataChangeMonitoring:function(){if(!this.monitoringDataChange){return}this.monitoringDataChange=false;this.un(this.dataChangeListeners)},onNeedToUpdateFilter:function(){if(this.reApplyFilterOnDataChange&&!this.filterUpdateSuspended&&!this.suspendIncrementalFilterRefresh){this.reApplyFilter()}},clearTreeFilter:function(){if(!this.isTreeFiltered()){return}this.currentFilterGeneration=null;this.isFilteredFlag=false;this.lastTreeFilter=null;if(!this.isTreeFiltered(true)){this.stopDataChangeMonitoring()}this.refreshNodeStoreContent();this.fireEvent("filter-clear",this)},reApplyFilter:function(){if(this.isHiddenFlag){this.hideNodesBy.apply(this,this.lastTreeHiding.concat(this.isFilteredFlag))}if(this.isFilteredFlag){this.filterTreeBy(this.lastTreeFilter)}},refreshNodeStoreContent:function(){var c=this,d=c.getFilters();if(d.indexOf(c.treeFilter)<0){c.addFilter(c.treeFilter)}else{this.getFilters().fireEvent("endupdate",this.getFilters())}},getIndexInTotalDataset:function(m){var n=this.getRootNode(),k=-1;var j=this.rootVisible;if(!j&&m==n){return -1}var h=this.isTreeFiltered();var i=this.currentFilterGeneration;var l=function(b){if(h&&b.__filterGen!=i||b.hidden){if(b==m){return false}}if(j||b!=n){k++}if(b==m){return false}if(!b.data.leaf&&b.isExpanded()){var a=b.childNodes,c=a.length;for(var d=0;d<c;d++){if(l(a[d])===false){return false}}}};l(n);return k},isTreeFiltered:function(b){return this.isFilteredFlag||b&&this.isHiddenFlag},markFilteredNodes:function(v,C){var w=this;var A=this.currentFilterGeneration;var B={};var u=this.getRootNode(),s=this.rootVisible;var p=function(a){var b=a.parentNode;while(b&&!B[b.internalId]){B[b.internalId]=true;b=b.parentNode}};var D=C.filter;var q=C.scope||this;var t=C.shallow;var r=C.checkParents||t;var y=C.fullMatchingParents;var z=C.onlyParents||y;if(z&&r){throw new Error("Can't combine `onlyParents` and `checkParents` options")}if(s){B[u.internalId]=true}var x=function(b){if(b.hidden){return}var d,a,c,e;if(b.data.leaf){if(D.call(q,b,B)){B[b.internalId]=true;p(b)}}else{if(z){d=D.call(q,b);a=b.childNodes;c=a.length;if(d){B[b.internalId]=true;p(b);if(y){b.cascadeBy(function(f){B[f.internalId]=true});return}}for(e=0;e<c;e++){if(d&&a[e].data.leaf){B[a[e].internalId]=true}else{if(!a[e].data.leaf){x(a[e])}}}}else{if(r){d=D.call(q,b,B);if(d){B[b.internalId]=true;p(b)}}if(!r||!t||t&&(d||b==u&&!s)){a=b.childNodes;c=a.length;for(e=0;e<c;e++){x(a[e])}}}}};x(v);u.cascadeBy(function(a){if(B[a.internalId]){a.__filterGen=A;if(w.allowExpandCollapseWhileFiltered&&!a.data.leaf){a.expand()}}})},filterTreeBy:function(f,d){this.currentFilterGeneration=this.filterGeneration++;var e;if(arguments.length==1&&Ext.isObject(arguments[0])){d=f.scope;e=f.filter}else{e=f;f={filter:e,scope:d}}this.fireEvent("nodestore-datachange-start",this);f=f||{};this.markFilteredNodes(this.getRootNode(),f);this.startDataChangeMonitoring();this.isFilteredFlag=true;this.lastTreeFilter=f;this.fireEvent("nodestore-datachange-end",this);this.fireEvent("filter-set",this);this.refreshNodeStoreContent()},isNodeFilteredIn:function(f){var d=this.isTreeFiltered();var e=this.currentFilterGeneration;return this.loading||!Boolean(d&&f.__filterGen!=e||f.hidden)},hasNativeFilters:function(){var f=this,d=f.getFilters(),e=d.getCount();return(e&&e>1)||d.indexOf(f.treeFilter)<0},hideNodesBy:function(e,f,g){var h=this;if(h.isFiltered()&&h.hasNativeFilters()){throw new Error("Can't hide nodes of the filtered tree store")}f=f||h;h.getRootNode().cascadeBy(function(a){a.hidden=Boolean(e.call(f,a,h))});h.startDataChangeMonitoring();h.isHiddenFlag=true;h.lastTreeHiding=[e,f];if(!g){h.refreshNodeStoreContent()}},showAllNodes:function(b){this.getRootNode().cascadeBy(function(a){a.hidden=false});this.isHiddenFlag=false;this.lastTreeHiding=null;if(!this.isTreeFiltered(true)){this.stopDataChangeMonitoring()}if(!b){this.refreshNodeStoreContent()}},inheritables:function(){return{onNodeExpand:function(f,d,e){if(this.isTreeFiltered(true)&&f==this.getRoot()){this.callParent(arguments);this.reApplyFilter()}else{return this.callParent(arguments)}},onNodeCollapse:function(o,t,m,n,l){var p=this;var r=p.data;var k=r.contains;var s=p.isTreeFiltered();var q=p.currentFilterGeneration;r.contains=function(){var f,a,d;var b=p.indexOf(o)+1;var e=false;for(var c=0;c<t.length;c++){if(!(t[c].hidden||s&&t[c].__filterGen!=q)&&k.call(this,t[c])){f=o;while(f.parentNode){a=f;do{a=a.nextSibling}while(a&&(a.hidden||s&&a.__filterGen!=q));if(a){e=true;d=p.indexOf(a);break}else{f=f.parentNode}}if(!e){d=p.getCount()}p.removeAt(b,d-b);break}}return false};this.callParent(arguments);r.contains=k},handleNodeExpand:function(k,r,i){var n=this;var m=[];var q=n.isTreeFiltered();var l=n.currentFilterGeneration;for(var p=0;p<r.length;p++){var o=r[p];if(!(q&&o.__filterGen!=l||o.hidden)){m[m.length]=o}}return this.callParent([k,m,i])},onNodeInsert:function(p,B,v){var t=this,u,o,s,A,r,w,z=B.raw||B.data,q,x,y;if(t.filterFn){x=t.filterFn(B);B.set("visible",x);if(x){p.set("visible",t.filterFn(p))}}t.registerNode(B,true);t.beginUpdate();if(t.isVisible(B)){if(v===0||!B.previousSibling){u=p}else{for(o=B.previousSibling;o&&!o.get("visible");o=o.previousSibling){}if(!o){u=p}else{while(o.isExpanded()&&o.lastChild){o=o.lastChild}u=o}}t.insert(t.indexOf(u)+1,B);if(!B.isLeaf()&&B.isExpanded()){if(B.isLoaded()){t.onNodeExpand(B,B.childNodes)}else{if(!t.fillCount){B.set("expanded",false);B.expand()}}}}else{t.needsSync=t.needsSync||B.phantom||B.dirty}if(!B.isLeaf()&&!B.isLoaded()&&!t.lazyFill){s=t.getProxy().getReader();A=B.getProxy();r=A?A.getReader():null;w=r&&r.initialConfig.rootProperty?r:s;q=w.getRoot(z);if(q){y=B.childType;t.fillNode(B,w.extractData(q,y?{model:y}:undefined))}}t.endUpdate()},isFiltered:function(){return this.callParent(arguments)||this.isTreeFiltered()}}}});if(!Ext.ClassManager.get("Sch.data.ResourceStore")){Ext.define("Sch.data.ResourceStore",{extend:"Ext.data.Store",model:"Sch.model.Resource",config:{model:"Sch.model.Resource"},alias:"store.resourcestore",requires:["Sch.patches.OperationDestroy"],mixins:["Sch.data.mixin.UniversalModelGetter","Sch.data.mixin.CacheHintHelper","Sch.data.mixin.ResourceStore"],storeId:"resources",proxy:"memory",constructor:function(){this.callParent(arguments);if(this.getModel()!==Sch.model.Resource&&!(this.getModel().prototype instanceof Sch.model.Resource)){throw"The model for the ResourceStore must subclass Sch.model.Resource"}}})}if(!Ext.ClassManager.get("Sch.data.ResourceTreeStore")){Ext.define("Sch.data.ResourceTreeStore",{extend:"Ext.data.TreeStore",requires:["Sch.patches.TreeStore","Sch.patches.TreeStoreInternalIdMap"],mixins:["Sch.patches.NodeStore","Sch.data.mixin.UniversalModelGetter","Sch.data.mixin.CacheHintHelper","Sch.data.mixin.ResourceStore","Sch.data.mixin.FilterableTreeStore"],alias:"store.resourcetreestore",model:"Sch.model.Resource",storeId:"resources",proxy:"memory",constructor:function(){this.callParent(arguments);this.initTreeFiltering();if(this.getModel()!==Sch.model.Resource&&!(this.getModel().prototype instanceof Sch.model.Resource)){throw"The model for the ResourceTreeStore must subclass Sch.model.Resource"}},setRootNode:function(){this.isSettingRoot=true;var b=this.callParent(arguments);this.isSettingRoot=false;return b}})}if(!Ext.ClassManager.get("Sch.data.AssignmentStore")){Ext.define("Sch.data.AssignmentStore",{extend:"Ext.data.Store",mixins:["Sch.data.mixin.UniversalModelGetter","Sch.data.mixin.CacheHintHelper"],requires:["Sch.model.Assignment","Sch.model.Range","Sch.model.Resource","Sch.data.util.EventAssignmentsCache","Sch.data.util.ResourceAssignmentsCache","Sch.data.util.AssignmentStoreEventResourcesCache","Sch.data.util.AssignmentStoreResourceEventsCache"],model:"Sch.model.Assignment",alias:"store.assignmentstore",storeId:"assignments",proxy:"memory",eventResourceCache:null,resourceEventsCache:null,eventStoreDetacher:null,resourceStoreDetacher:null,eventStore:null,constructor:function(d){var c=this;c.callParent([d]);c.eventAssignmentsCache=c.eventAssignmentsCache||new Sch.data.util.EventAssignmentsCache(c);c.resourceAssignmentsCache=c.resourceAssignmentsCache||new Sch.data.util.ResourceAssignmentsCache(c)},destroy:function(){var b=this;Ext.destroyMembers(b,"eventResourceCache","resourceEventsCache","eventAssignmentsCache","resourceEventsCache","eventStoreDetacher","resourceStoreDetacher");b.callParent()},getEventStore:function(){return this.eventStore},setEventStore:function(e){var d=this,f=d.eventStore;if(d.eventStore){}d.eventStore=e&&Ext.StoreMgr.lookup(e)||null;if(d.eventStore){}d.attachToEventStore(d.eventStore);if((f||e)&&f!==e){d.fireEvent("eventstorechange",d,e,f)}},attachToEventStore:function(d){var c=this;Ext.destroy(c.eventStoreDetacher);if(d&&d instanceof Ext.data.TreeStore){c.eventStoreDetacher=d.on({noderemove:c.onEventNodeRemove,resourcestorechange:c.onEventStoreResourceStoreChange,scope:c,destroyable:true,priority:200})}else{if(d){c.eventStoreDetacher=d.on({remove:c.onEventRemove,resourcestorechange:c.onEventStoreResourceStoreChange,scope:c,destroyable:true,priority:200})}}c.attachToResourceStore(d&&d.getResourceStore())},attachToResourceStore:function(c){var d=this;Ext.destroy(d.resourceStoreDetacher);if(c&&c instanceof Ext.data.TreeStore){d.resourceStoreDetacher=c.on({noderemove:d.onResourceNodeRemove,scope:d,destroyable:true,priority:200})}else{if(c){d.resourceStoreDetacher=c.on({remove:d.onResourceRemove,scope:d,destroyable:true,priority:200})}}},onEventStoreResourceStoreChange:function(d,e,f){this.attachToResourceStore(e)},onEventRemove:function(j,k,l,g){var i=this,h;if(!g){h=[];Ext.Array.forEach(k,function(a){h=h.concat(i.getAssignmentsForEvent(a))});h.length&&i.remove(h)}},onEventNodeRemove:function(j,h,f){var i=this,g;if(!f){g=[];h.cascadeBy(function(a){g=g.concat(i.getAssignmentsForEvent(a))});g.length&&i.remove(g)}},onResourceRemove:function(j,i,l,g){var k=this,h;if(!g){h=[];Ext.Array.forEach(i,function(a){h=h.concat(k.getAssignmentsForResource(a))});h.length&&k.remove(h)}},onResourceNodeRemove:function(i,h,f){var j=this,g;if(!f){g=[];h.cascadeBy(function(a){g=g.concat(j.getAssignmentsForResource(a))});g.length&&j.remove(g)}},mapAssignmentsForEvent:function(i,f,h){var j=this,g=[];f=f||Ext.identityFn;h=h||Ext.returnTrue;if(f!==Ext.identityFn||h!==Ext.returnTrue){Ext.Array.forEach(j.eventAssignmentsCache.get(i),function(a){var b=f(a);h(b)&&g.push(b)})}else{g=[].concat(j.eventAssignmentsCache.get(i))}return g},mapAssignmentsForResource:function(i,f,h){var j=this,g=[];f=f||Ext.identityFn;h=h||Ext.returnTrue;if(f!==Ext.identityFn||h!==Ext.returnTrue){Ext.Array.forEach(j.resourceAssignmentsCache.get(i),function(a){var b=f(a);h(b)&&g.push(b)})}else{g=[].concat(j.resourceAssignmentsCache.get(i))}return g},getAssignmentsForEvent:function(b){return this.mapAssignmentsForEvent(b)},removeAssignmentsForEvent:function(c){var d=this;d.remove(d.getAssignmentsForEvent(c))},getAssignmentsForResource:function(b){return this.mapAssignmentsForResource(b)},removeAssignmentsForResource:function(c){var d=this;d.remove(d.getAssignmentsForResource(c))},getResourcesForEvent:function(i){var j=this,g;if(j.eventResourceCache){g=j.eventResourceCache.get(i)}else{g=j.mapAssignmentsForEvent(i,function h(a){return a.getResource()},function f(a){return !!a})}return g},getEventsForResource:function(i){var j=this,g;if(j.resourceEventsCache){g=j.resourceEventsCache.get(i)}else{g=j.mapAssignmentsForResource(i,function h(a){return a.getEvent()},function f(a){return !!a})}return g},assignEventToResource:function(l,j,k){var g=this,h=[];k=k||Ext.identityFn;var i=Ext.isArray(j)?j:[j];Ext.Array.forEach(i,function(b){if(!g.isEventAssignedToResource(l,b)){var a=new g.model();a.setEventId(l instanceof Ext.data.Model&&l.getId()||l);a.setResourceId(b instanceof Ext.data.Model&&b.getId()||b);a=k(a);h.push(a)}});g.add(h);return h},unassignEventFromResource:function(e,h){var f=this,g;if(!h){this.removeAssignmentsForEvent(e)}else{if(f.isEventAssignedToResource(e,h)){g=f.getAssignmentForEventAndResource(e,h);f.remove(g)}}return g},isEventAssignedToResource:function(k,j){var l=this,n=l.getResourcesForEvent(k),h=false,m,i;j=j instanceof Ext.data.Model&&j.getId()||j;for(m=0,i=n.length;!h&&m<i;m++){h=n[m];h=h.getId()==j}return h},getAssignmentForEventAndResource:function(k,j){var l=this,n=l.getAssignmentsForEvent(k),h=null,m,i;j=j instanceof Ext.data.Model&&j.getId()||j;for(m=0,i=n.length;!h&&m<i;m++){h=n[m];h=h.getResourceId()==j&&h||null}return h}})}Ext.define("Sch.data.TimeAxis",{extend:"Ext.data.JsonStore",requires:["Sch.util.Date","Sch.model.TimeAxisTick"],model:"Sch.model.TimeAxisTick",continuous:true,originalContinuous:null,autoAdjust:true,unit:null,increment:null,resolutionUnit:null,resolutionIncrement:null,weekStartDay:null,mainUnit:null,shiftUnit:null,shiftIncrement:1,defaultSpan:1,isConfigured:false,adjustedStart:null,adjustedEnd:null,visibleTickStart:null,visibleTickEnd:null,presetName:null,mode:"plain",startTime:0,endTime:24,constructor:function(e){var f=this;e=e||{};if(f.setModel){f.setModel(f.model)}f.setMode(e.mode||f.mode);f.originalContinuous=f.continuous;f.callParent(arguments);f.on(Ext.versions.touch?"refresh":"datachanged",function(a){f.fireEvent("reconfigure",f,false)});f.on("endreconfigure",function(b,a){b.fireEvent("reconfigure",b,a)});if(e.viewPreset){var d=Sch.preset.Manager.getPreset(e.viewPreset);d&&f.consumeViewPreset(d)}if(e.start||f.start){f.reconfigure(e)}},reconfigure:function(s,v){this.isConfigured=true;Ext.apply(this,s);var l=this.getAdjustedDates(s.start,s.end,true);var m=this.getAdjustedDates(s.start,s.end);var u=m.start;var r=m.end;if(this.fireEvent("beforereconfigure",this,u,r)!==false){this.fireEvent("beginreconfigure",this);var o=this.unit;var n=this.increment||1;var p=this.generateTicks(u,r,o,n,this.mainUnit);this.removeAll(true);this.suspendEvents();this.add(p);if(this.getCount()===0){Ext.Error.raise("Invalid time axis configuration or filter, please check your input data.")}this.resumeEvents();var t=Sch.util.Date;var q=p.length;if(this.isContinuous()){this.adjustedStart=l.start;this.adjustedEnd=this.getNext(q>1?p[q-1].start:l.start,o,n)}else{this.adjustedStart=this.getStart();this.adjustedEnd=this.getEnd()}do{this.visibleTickStart=(this.getStart()-this.adjustedStart)/(t.getUnitDurationInMs(o)*n);if(this.visibleTickStart>=1){this.adjustedStart=t.getNext(this.adjustedStart,o,n)}}while(this.visibleTickStart>=1);do{this.visibleTickEnd=q-(this.adjustedEnd-this.getEnd())/(t.getUnitDurationInMs(o)*n);if(q-this.visibleTickEnd>=1){this.adjustedEnd=t.getNext(this.adjustedEnd,o,-1)}}while(q-this.visibleTickEnd>=1);this.fireEvent("endreconfigure",this,v)}},setMode:function(b){this.mode=b;if(b==="calendar"){this.generateTicksValidatorFn=function(a){if(this.startTime>0||this.endTime<24){return(a.getHours()>=this.startTime&&a.getHours()<this.endTime)}else{return true}}}else{this.generateTicksValidatorFn=function(){return true}}},setTimeSpan:function(f,e){var d=this.getAdjustedDates(f,e);f=d.start;e=d.end;if(this.getStart()-f!==0||this.getEnd()-e!==0){this.reconfigure({start:f,end:e})}},filterBy:function(c,d){this.continuous=false;d=d||this;this.clearFilter(true);this.suspendEvents(true);this.filter([{filterFn:function(a,b){return c.call(d,a.data,b)}}]);if(this.getCount()===0){this.clearFilter();this.resumeEvents();Ext.Error.raise("Invalid time axis filter - no ticks passed through the filter. Please check your filter method.")}this.resumeEvents()},isContinuous:function(){return this.continuous&&!this.isFiltered()},clearFilter:function(){this.continuous=this.originalContinuous;this.callParent(arguments)},generateTicks:function(t,q,n,l){var m=[],o,s=Sch.util.Date,p=0;n=n||this.unit;l=l||this.increment;var k=this.getAdjustedDates(t,q);t=k.start;q=k.end;while(t<q){o=this.getNext(t,n,l);if(!this.autoAdjust&&o>q){o=q}if(n===s.HOUR&&l>1&&m.length>0&&p===0){var r=m[m.length-1];p=((r.start.getHours()+l)%24)-r.end.getHours();if(p!==0){o=s.add(o,s.HOUR,p)}}this.generateTicksValidatorFn(t)&&m.push({start:t,end:o});t=o}return m},getVisibleTickTimeSpan:function(){return this.isContinuous()?this.visibleTickEnd-this.visibleTickStart:this.getCount()},getAdjustedDates:function(q,n,o){var p=Sch.util.Date;q=q||this.getStart();n=n||p.add(q,this.mainUnit,this.defaultSpan);if(this.mode==="calendar"){if(this.shiftUnit===p.MONTH){var l=p.add(q,p.WEEK,1);var m=p.add(n,p.WEEK,-1);if(!n){n=this.getNext(q,this.shiftUnit,1);n=this.ceilDate(n,false,this.shiftUnit,1);n=this.ceilDate(n,false,this.mainUnit,1)}if(l.getMonth()!==q.getMonth()&&m.getMonth()!==n.getMonth()){return{start:q,end:n}}}var j=this.floorDate(q,false,this.shiftUnit,1);j=this.floorDate(j,false,this.mainUnit,1);var k=this.getNext(q,this.shiftUnit,1);var r=this.ceilDate(k,false,this.shiftUnit,1);r=this.ceilDate(r,false,this.mainUnit,1);return{start:j,end:r}}else{return this.autoAdjust||o?{start:this.floorDate(q,false,this.autoAdjust?this.mainUnit:this.unit,1),end:this.ceilDate(n,false,this.autoAdjust?this.mainUnit:this.unit,1)}:{start:q,end:n}}},getTickFromDate:function(q){var l=this.data.items;var m=l.length-1;if(q<l[0].data.start||q>l[m].data.end){return -1}var o,n,s;if(this.isContinuous()){if(q-l[0].data.start===0){return this.visibleTickStart}if(q-l[m].data.end===0){return this.visibleTickEnd}var i=this.adjustedStart;var t=this.adjustedEnd;var r=Math.floor(l.length*(q-i)/(t-i));if(r>m){r=m}n=r===0?i:l[r].data.start;s=r==m?t:l[r].data.end;o=r+(q-n)/(s-n);if(o<this.visibleTickStart||o>this.visibleTickEnd){return -1}return o}else{for(var p=0;p<=m;p++){s=l[p].data.end;if(q<=s){n=l[p].data.start;o=p+(q>n?(q-n)/(s-n):0);return o}}}return -1},getDateFromTick:function(n,j){if(n===this.visibleTickEnd){return this.getEnd()}var q=Math.floor(n),l=n-q,k=this.getAt(q);if(!k){return null}var m=k.data;var r=q===0?this.adjustedStart:m.start;var o=(q==this.getCount()-1)&&this.isContinuous()?this.adjustedEnd:m.end;var p=Sch.util.Date.add(r,Sch.util.Date.MILLI,l*(o-r));if(j){p=this[j+"Date"](p)}return p},getTicks:function(){var b=[];this.each(function(a){b.push(a.data)});return b},getStart:function(){var b=this.first();if(b){return new Date(b.data.start)}return null},getEnd:function(){var b=this.last();if(b){return new Date(b.data.end)}return null},floorDate:function(t,r,q,x){r=r!==false;var v=Ext.Date.clone(t),u=r?this.getStart():null,m=x||this.resolutionIncrement,n;if(q){n=q}else{n=r?this.resolutionUnit:this.mainUnit}var w=Sch.util.Date;var s=function(b,a){return Math.floor(b/a)*a};switch(n){case w.MILLI:if(r){v=w.add(u,w.MILLI,s(w.getDurationInMilliseconds(u,v),m))}break;case w.SECOND:if(r){v=w.add(u,w.MILLI,s(w.getDurationInSeconds(u,v),m)*1000)}else{v.setMilliseconds(0);v.setSeconds(s(v.getSeconds(),m))}break;case w.MINUTE:if(r){v=w.add(u,w.SECOND,s(w.getDurationInMinutes(u,v),m)*60)}else{v.setMinutes(s(v.getMinutes(),m));v.setSeconds(0);v.setMilliseconds(0)}break;case w.HOUR:if(r){v=w.add(u,w.MINUTE,s(w.getDurationInHours(this.getStart(),v),m)*60)}else{v.setMinutes(0);v.setSeconds(0);v.setMilliseconds(0);v.setHours(s(v.getHours(),m))}break;case w.DAY:if(r){v=w.add(u,w.DAY,s(w.getDurationInDays(u,v),m))}else{Sch.util.Date.clearTime(v);v.setDate(s(v.getDate()-1,m)+1)}break;case w.WEEK:var o=v.getDay()||7;var p=this.weekStartDay||7;Sch.util.Date.clearTime(v);v=w.add(v,w.DAY,o>=p?p-o:-(7-p+o));if(v.getDay()!==p&&v.getHours()===23){v=w.add(v,w.HOUR,1)}break;case w.MONTH:if(r){v=w.add(u,w.MONTH,s(w.getDurationInMonths(u,v),m))}else{Sch.util.Date.clearTime(v);v.setDate(1);v.setMonth(s(v.getMonth(),m))}break;case w.QUARTER:Sch.util.Date.clearTime(v);v.setDate(1);v=w.add(v,w.MONTH,-(v.getMonth()%3));break;case w.YEAR:if(r){v=w.add(u,w.YEAR,s(w.getDurationInYears(u,v),m))}else{v=new Date(s(t.getFullYear()-1,m)+1,0,1)}break}return v},roundDate:function(w,M){var C=Ext.Date.clone(w),v=this.resolutionIncrement;M=M||this.getStart();switch(this.resolutionUnit){case Sch.util.Date.MILLI:var J=Sch.util.Date.getDurationInMilliseconds(M,C),K=Math.round(J/v)*v;C=Sch.util.Date.add(M,Sch.util.Date.MILLI,K);break;case Sch.util.Date.SECOND:var F=Sch.util.Date.getDurationInSeconds(M,C),x=Math.round(F/v)*v;C=Sch.util.Date.add(M,Sch.util.Date.MILLI,x*1000);break;case Sch.util.Date.MINUTE:var A=Sch.util.Date.getDurationInMinutes(M,C),N=Math.round(A/v)*v;C=Sch.util.Date.add(M,Sch.util.Date.SECOND,N*60);break;case Sch.util.Date.HOUR:var B=Sch.util.Date.getDurationInHours(M,C),E=Math.round(B/v)*v;C=Sch.util.Date.add(M,Sch.util.Date.MINUTE,E*60);break;case Sch.util.Date.DAY:var L=Sch.util.Date.getDurationInDays(M,C),I=Math.round(L/v)*v;C=Sch.util.Date.add(M,Sch.util.Date.DAY,I);break;case Sch.util.Date.WEEK:Sch.util.Date.clearTime(C);var z=C.getDay()-this.weekStartDay,u;if(z<0){z=7+z}if(Math.round(z/7)===1){u=7-z}else{u=-z}C=Sch.util.Date.add(C,Sch.util.Date.DAY,u);break;case Sch.util.Date.MONTH:var y=Sch.util.Date.getDurationInMonths(M,C)+(C.getDate()/Ext.Date.getDaysInMonth(C)),G=Math.round(y/v)*v;C=Sch.util.Date.add(M,Sch.util.Date.MONTH,G);break;case Sch.util.Date.QUARTER:Sch.util.Date.clearTime(C);C.setDate(1);C=Sch.util.Date.add(C,Sch.util.Date.MONTH,3-(C.getMonth()%3));break;case Sch.util.Date.YEAR:var D=Sch.util.Date.getDurationInYears(M,C),H=Math.round(D/v)*v;C=Sch.util.Date.add(M,Sch.util.Date.YEAR,H);break}return C},ceilDate:function(n,h,k){var l=Ext.Date.clone(n);h=h!==false;var i=h?this.resolutionIncrement:1,j=false,m;if(k){m=k}else{m=h?this.resolutionUnit:this.mainUnit}switch(m){case Sch.util.Date.HOUR:if(l.getMinutes()>0||l.getSeconds()>0||l.getMilliseconds()>0){j=true}break;case Sch.util.Date.DAY:if(l.getHours()>0||l.getMinutes()>0||l.getSeconds()>0||l.getMilliseconds()>0){j=true}break;case Sch.util.Date.WEEK:Sch.util.Date.clearTime(l);if(l.getDay()!==this.weekStartDay||n.getTime()-l.getTime()>0){j=true}break;case Sch.util.Date.MONTH:Sch.util.Date.clearTime(l);if(l.getDate()!==1||n.getTime()-l.getTime()>0){j=true}break;case Sch.util.Date.QUARTER:Sch.util.Date.clearTime(l);if(l.getMonth()%3!==0||l.getDate()!==1||n.getTime()-l.getTime()>0){j=true}break;case Sch.util.Date.YEAR:Sch.util.Date.clearTime(l);if(l.getMonth()!==0||l.getDate()!==1||n.getTime()-l.getTime()>0){j=true}break;default:break}if(j){return this.getNext(l,m,i)}else{return l}},getNext:function(d,f,e){return Sch.util.Date.getNext(d,f,e,this.weekStartDay)},getResolution:function(){return{unit:this.resolutionUnit,increment:this.resolutionIncrement}},setResolution:function(c,d){this.resolutionUnit=c;this.resolutionIncrement=d||1},shift:function(d,c){this.setTimeSpan(Sch.util.Date.add(this.getStart(),c,d),Sch.util.Date.add(this.getEnd(),c,d))},shiftNext:function(d){d=d||this.getShiftIncrement();var c=this.getShiftUnit();this.setTimeSpan(Sch.util.Date.add(this.getStart(),c,d),Sch.util.Date.add(this.getEnd(),c,d))},shiftPrevious:function(d){d=-(d||this.getShiftIncrement());var c=this.getShiftUnit();this.setTimeSpan(Sch.util.Date.add(this.getStart(),c,d),Sch.util.Date.add(this.getEnd(),c,d))},getShiftUnit:function(){return this.shiftUnit||this.mainUnit},getShiftIncrement:function(){return this.shiftIncrement||1},getUnit:function(){return this.unit},getIncrement:function(){return this.increment},getRowTicks:function(){if(this.mode==="plain"){return}else{var f=this.getStart();var e=Sch.util.Date.add(f,this.headerConfig.middle.splitUnit,1);var d=this.findBy(function(a){return a.getStartDate().getTime()>=e.getTime()});if(d===-1){return this.getRange()}return this.getRange(0,d-1)}},dateInAxis:function(b){return Sch.util.Date.betweenLesser(b,this.getStart(),this.getEnd())},timeSpanInAxis:function(c,d){if(this.isContinuous()){return Sch.util.Date.intersectSpans(c,d,this.getStart(),this.getEnd())}else{return(c<this.getStart()&&d>this.getEnd())||this.getTickFromDate(c)!==this.getTickFromDate(d)}},isRangeInAxis:function(d){var f=d.getStartDate(),e=d.getEndDate();if(!f||!e){return false}return this.timeSpanInAxis(f,e)},forEachAuxInterval:function(k,i,j,m){m=m||this;var p=this.getEnd(),l=this.getStart(),n=0,o;if(l>p){throw"Invalid time axis configuration"}while(l<p){o=Sch.util.Date.min(this.getNext(l,k,i||1),p);j.call(m,l,o,n);l=o;n++}},consumeViewPreset:function(b){Ext.apply(this,{unit:b.getBottomHeader().unit,increment:b.getBottomHeader().increment||1,resolutionUnit:b.timeResolution.unit,resolutionIncrement:b.timeResolution.increment,mainUnit:b.getMainHeader().unit,shiftUnit:b.shiftUnit,shiftIncrement:b.shiftIncrement||1,defaultSpan:b.defaultSpan||1,presetName:b.name,headerConfig:b.headerConfig})}});Ext.define("Sch.view.Horizontal",{requires:["Ext.util.Region","Ext.Element","Sch.util.Date"],view:null,constructor:function(b){Ext.apply(this,b)},translateToScheduleCoordinate:function(d){var c=this.view;if(c.rtl){return c.getHorizontalTimeAxisColumn().getEl().getRight()-d}return d-c.getEl().getX()+c.getScroll().left},translateToPageCoordinate:function(d){var c=this.view;return d+c.getEl().getX()-c.getScroll().left},getDateFromXY:function(h,e,f){var g=h[0];if(!f){g=this.translateToScheduleCoordinate(g)}return this.view.timeAxisViewModel.getDateFromPosition(g,e)},getEventRenderData:function(t){var o=t.getStartDate(),p=t.getEndDate()||o,m=this.view,r=m.timeAxis.getStart(),l=m.timeAxis.getEnd(),n=Math,q=m.getXFromDate(Sch.util.Date.max(o,r)),k=m.getXFromDate(Sch.util.Date.min(p,l)),s={};if(this.view.rtl){s.right=n.min(q,k)}else{s.left=n.min(q,k)}s.width=n.max(1,n.abs(k-q))-m.eventBorderWidth;if(m.managedEventSizing){s.top=n.max(0,(m.barMargin-((Ext.isIE&&!Ext.isStrict)?0:m.eventBorderWidth-m.cellTopBorderWidth)));s.height=m.timeAxisViewModel.rowHeightHorizontal-(2*m.barMargin)-m.eventBorderWidth}s.start=o;s.end=p;s.startsOutsideView=o<r;s.endsOutsideView=p>l;return s},getScheduleRegion:function(t,r){var v=Ext.Element.prototype.getRegion?"getRegion":"getPageBox",o=this.view,p=t?Ext.fly(o.getRowNode(t))[v]():o.getTableRegion(),s=o.timeAxis.getStart(),m=o.timeAxis.getEnd(),w=o.getDateConstraints(t,r)||{start:s,end:m},u=this.translateToPageCoordinate(o.getXFromDate(Sch.util.Date.max(s,w.start))),n=this.translateToPageCoordinate(o.getXFromDate(Sch.util.Date.min(m,w.end))),q=p.top+o.barMargin,x=p.bottom-o.barMargin-o.eventBorderWidth;return new Ext.util.Region(q,Math.max(u,n),x,Math.min(u,n))},getResourceRegion:function(u,z,v){var r=this.view,A=r.getRowNode(u),y=Ext.fly(A).getOffsetsTo(r.getEl()),t=r.timeAxis.getStart(),p=r.timeAxis.getEnd(),B=z?Sch.util.Date.max(t,z):t,x=v?Sch.util.Date.min(p,v):p,w=r.getXFromDate(B),q=r.getXFromDate(x),s=y[1]+r.cellTopBorderWidth,D=y[1]+Ext.fly(A).getHeight()-r.cellBottomBorderWidth;if(!Ext.versions.touch){var C=r.getScroll();s+=C.top;D+=C.top}return new Ext.util.Region(s,Math.max(w,q),D,Math.min(w,q))},columnRenderer:function(t,l,q,p,m){var n=this.view;var u=n.eventStore.filterEventsForResource(q,function(a){return n.timeAxis.isRangeInAxis(a)});if(u.length===0){return}var o=Ext.Array.map(u,function(a){return n.generateTplData(a,q,p)});if(n.dynamicRowHeight){var r=n.eventLayout.horizontal;var s=r.applyLayout(o,q,this.layoutEventVertically,this);var v=(s*n.timeAxisViewModel.rowHeightHorizontal)-((s-1)*n.barMargin);n.cellTopBorderWidth-n.cellBottomBorderWidth;l.rowHeight=v}return n.eventTpl.apply(o)},layoutEventVertically:function(g,e){var f=this.view;var h=g===0?f.barMargin:(g*f.timeAxisViewModel.rowHeightHorizontal-(g-1)*f.barMargin);if(h>=f.cellBottomBorderWidth){h-=f.cellBottomBorderWidth}return h},resolveResource:function(h){var i=this,f=i.view,j,g;j=Ext.fly(h).is(f.eventSelector)&&h||Ext.fly(h).up(f.eventSelector,null,true);if(j){g=f.getResourceRecordFromDomId(j.id)}else{h=f.findRowByChild(h);g=h&&f.getRecordForRowNode(h)||null}return g},getTimeSpanRegion:function(i,k,l){var o=this.view,p=o.getXFromDate(i),n=k?o.getXFromDate(k):p,j,m;m=o.getTableRegion();if(l){j=Math.max(m?m.bottom-m.top:0,o.getEl().dom.clientHeight)}else{j=m?m.bottom-m.top:0}return new Ext.util.Region(0,Math.max(p,n),j,Math.min(p,n))},getStartEndDatesFromRegion:function(j,m,n){var h=this.view;var k=h.rtl;var i=h.getDateFromCoordinate(k?j.right:j.left,m),l=h.getDateFromCoordinate(k?j.left:j.right,m);if(i&&l||n&&(i||l)){return{start:i,end:l}}return null},onEventAdd:function(i,j){var k=this.view,s={},z,y,l,x,v,r,w,t,u;for(r=0,w=j.length;r<w;r++){z=j[r];y=z.getStartDate();l=z.getEndDate();if(y&&l&&k.timeAxis.timeSpanInAxis(y,l)){x=j[r].getResources(k.eventStore);for(t=0,u=x.length;t<u;t++){v=x[t];s[v.getId()]=v}}}Ext.Object.each(s,function(a,b){k.repaintEventsForResource(b)})},onEventRemove:function(j,o){var m=this,l=m.view,k=m.resourceStore,p=l.eventStore,q,r;q=Ext.Array.unique(Ext.Array.flatten(Ext.Array.map(o,function(a){return p.getResourcesForEvent(a)})));function n(a){l.store.indexOf(a)>=0&&l.repaintEventsForResource(a)}if(q.length>1){Ext.Array.forEach(q,n)}else{if(q.length==1){r=Ext.Array.flatten(Ext.Array.map(o,function(a){return l.getElementsFromEventRecord(a,null,null,true)}));r=new Ext.CompositeElementLite(r);r.fadeOut({callback:function(){n(q[0])}})}}},onEventUpdate:function(s,r){var o=r.previous||{};var m=this.view;var p=m.timeAxis;var v=r.getStartDate();var n=r.getEndDate();var u=o.StartDate||v;var q=o.EndDate||n;var l=u&&q&&p.timeSpanInAxis(u,q);var t;if(r.resourceIdField in o&&l){t=s.getResourceStore().getById(o[r.resourceIdField]);t&&m.repaintEventsForResource(t,true)}if((v&&n&&p.timeSpanInAxis(v,n))||l){Ext.Array.forEach(r.getResources(),function(a){m.repaintEventsForResource(a,true)})}},setColumnWidth:function(f,d){var e=this.view;e.getTimeAxisViewModel().setViewColumnWidth(f,d)},getVisibleDateRange:function(){var k=this.view;if(!k.getEl()){return null}var l=k.getTableRegion(),g=k.timeAxis.getStart(),i=k.timeAxis.getEnd(),j=k.getWidth();if((l.right-l.left)<j){return{startDate:g,endDate:i}}var h=k.getScroll();return{startDate:k.getDateFromCoordinate(h.left,null,true),endDate:k.getDateFromCoordinate(h.left+j,null,true)}}});Ext.define("Sch.view.Vertical",{view:null,constructor:function(b){Ext.apply(this,b)},translateToScheduleCoordinate:function(c){var d=this.view;return c-d.getEl().getY()+d.getScroll().top},translateToPageCoordinate:function(g){var e=this.view;var h=e.getEl(),f=h.getScroll();return g+h.getY()-f.top},getDateFromXY:function(h,e,f){var g=h[1];if(!f){g=this.translateToScheduleCoordinate(g)}return this.view.timeAxisViewModel.getDateFromPosition(g,e)},getEventRenderData:function(z,y,s){var r=z.getStartDate(),t=z.getEndDate(),p=this.view,u=p.timeAxis.getStart(),o=p.timeAxis.getEnd(),q=Math,v=q.floor(p.getCoordinateFromDate(Sch.util.Date.max(r,u))),n=q.floor(p.getCoordinateFromDate(Sch.util.Date.min(t,o))),w=this.getResourceColumnWidth(y),x;x={top:q.max(0,q.min(v,n)-p.eventBorderWidth),height:q.max(1,q.abs(v-n))};if(p.managedEventSizing){x.left=p.barMargin;x.width=w-(2*p.barMargin)-p.eventBorderWidth}x.start=r;x.end=t;x.startsOutsideView=r<u;x.endsOutsideView=t>o;return x},getScheduleRegion:function(s,q){var o=this.view,p=s?Ext.fly(o.getScheduleCell(0,o.resourceStore.indexOf(s))).getRegion():o.getTableRegion(),r=o.timeAxis.getStart(),l=o.timeAxis.getEnd(),v=o.getDateConstraints(s,q)||{start:r,end:l},t=this.translateToPageCoordinate(o.getCoordinateFromDate(Sch.util.Date.max(r,v.start))),m=this.translateToPageCoordinate(o.getCoordinateFromDate(Sch.util.Date.min(l,v.end))),u=p.left+o.barMargin,n=(s?(p.left+this.getResourceColumnWidth(s)):p.right)-o.barMargin;return new Ext.util.Region(Math.min(t,m),n,Math.max(t,m),u)},getResourceColumnWidth:function(b){return this.view.timeAxisViewModel.resourceColumnWidth},getResourceRegion:function(s,y,t){var q=this.view,v=q.resourceStore.indexOf(s)*this.getResourceColumnWidth(s),r=q.timeAxis.getStart(),n=q.timeAxis.getEnd(),z=y?Sch.util.Date.max(r,y):r,w=t?Sch.util.Date.min(n,t):n,u=Math.max(0,q.getCoordinateFromDate(z)-q.cellTopBorderWidth),o=q.getCoordinateFromDate(w)-q.cellTopBorderWidth,x=v+q.cellBorderWidth,p=v+this.getResourceColumnWidth(s)-q.cellBorderWidth;return new Ext.util.Region(Math.min(u,o),p,Math.max(u,o),x)},columnRenderer:function(A,i,v,t,l){var s=this.view;var B="";if(t===0){var F=Sch.util.Date,w=s.timeAxis,u,D,x,z;u=[];D=s.eventStore.getEventsForResource(v);for(x=0,z=D.length;x<z;x++){var E=D[x],C=E.getStartDate(),y=E.getEndDate();if(C&&y&&w.timeSpanInAxis(C,y)){u.push(s.generateTplData(E,v,l))}}s.eventLayout.vertical.applyLayout(u,this.getResourceColumnWidth(v));B="&#160;"+s.eventTpl.apply(u)}if(l%2===1){i.tdCls=(i.tdCls||"")+" "+s.altColCls;i.cellCls=(i.cellCls||"")+" "+s.altColCls}return B},resolveResource:function(i){var j=this,g=j.view,k,l,h;k=Ext.fly(i).is(g.eventSelector)&&i||Ext.fly(i).up(g.eventSelector,null,true);if(k){h=g.getResourceRecordFromDomId(k.id)}else{i=Ext.fly(i).is(g.timeCellSelector)?i:Ext.fly(i).up(g.timeCellSelector,null,true);l=-1;if(i&&Ext.isIE8m){i=i.previousSibling;while(i){if(i.nodeType===1){l++}i=i.previousSibling}}else{if(i){l=Ext.Array.indexOf(Array.prototype.slice.call(i.parentNode.children),i)}}h=l>=0&&g.resourceStore.getAt(l)||null}return h},onEventUpdate:function(m,x){var p=this;var r=x.previous||{};var o=p.view;var s=o.timeAxis;var w=x.getStartDate();var q=x.getEndDate();var v=r.StartDate||w;var t=r.EndDate||q;var n=v&&t&&s.timeSpanInAxis(v,t);var u;if(x.resourceIdField in r&&n){u=m.getResourceStore().getById(r[x.resourceIdField]);u&&p.relayoutRenderedEvents(u)}if((w&&q&&s.timeSpanInAxis(w,q))||n){p.renderSingle(x);Ext.Array.forEach(x.getResources(),function(a){p.relayoutRenderedEvents(a);o.getEventSelectionModel().isSelected(x)&&o.onEventBarSelect(x,true)})}},onEventAdd:function(n,k){var l=this,h=l.view,m,i,j;if(k.length===1){m=k[0];i=m.getStartDate();j=m.getEndDate();if(i&&j&&h.timeAxis.timeSpanInAxis(i,j)){l.renderSingle(m);Ext.Array.forEach(n.getResourcesForEvent(m),function(a){l.relayoutRenderedEvents(a)})}}else{h.repaintAllEvents()}},onEventRemove:function(i,l){var n=this,m=n.view,t,r,p,q,o,s;for(s=false,q=0,o=l.length;!s&&q<o;q++){t=l[q];r=t.getStartDate();p=t.getEndDate();s=r&&p&&m.timeAxis.timeSpanInAxis(r,p);s&&m.repaintAllEvents()}},relayoutRenderedEvents:function(g){var h=[],f=this.view,e=f.eventStore.getEventsForResource(g);Ext.Array.forEach(f.eventStore.getEventsForResource(g),function(a){var b=f.getElementsFromEventRecord(a,g);b.length&&h.push({start:a.getStartDate(),end:a.getEndDate(),event:a,node:b[0]})});f.eventLayout.vertical.applyLayout(h,this.getResourceColumnWidth(g));Ext.Array.forEach(h,function(a){a.node.setStyle({left:a.left+"px",width:a.width+"px"});f.fireEvent("eventrepaint",f,a.event,a.node)})},renderSingle:function(k){var l=this,g=l.view,h=k.getStartDate(),i=k.getEndDate(),j;Ext.Array.forEach(g.getElementsFromEventRecord(k),function(a){a.destroy()});if(h&&i&&g.timeAxis.timeSpanInAxis(h,i)){Ext.Array.forEach(k.getResources(),function(a){var b=g.resourceStore.indexOf(a),d=Ext.fly(g.getScheduleCell(0,b)),c;if(d){c=g.generateTplData(k,a,b);g.eventTpl.append(d.first(),[c])}})}},getTimeSpanRegion:function(h,j){var m=this.view,i=m.getCoordinateFromDate(h),k=j?m.getCoordinateFromDate(j):i,n=m.getTableRegion(),l=n?n.right-n.left:m.getEl().dom.clientWidth;return new Ext.util.Region(Math.min(i,k),l,Math.max(i,k),0)},getStartEndDatesFromRegion:function(i,j,f){var g=this.view.getDateFromCoordinate(i.top,j),h=this.view.getDateFromCoordinate(i.bottom,j);if(g&&h){return{start:Sch.util.Date.min(g,h),end:Sch.util.Date.max(g,h)}}else{return null}},setColumnWidth:function(f,d){var e=this.view;e.resourceColumnWidth=f;e.getTimeAxisViewModel().setViewColumnWidth(f,d)},getVisibleDateRange:function(){var j=this.view;if(!j.rendered){return null}var l=j.getScroll(),g=j.getHeight(),k=j.getTableRegion(),i=j.timeAxis.getEnd();if(k.bottom-k.top<g){var h=j.timeAxis.getStart();return{startDate:h,endDate:i}}return{startDate:j.getDateFromCoordinate(l.top,null,true),endDate:j.getDateFromCoordinate(l.top+g,null,true)||i}}});Ext.define("Sch.view.Calendar",{requires:["Ext.util.Region"],view:null,constructor:function(b){Ext.apply(this,b)},getColumnBy:function(f,h){var i=this.view.panel.headerCt.getGridColumns();var g=[];for(var j=0;j<i.length;j++){if(f.call(this,i[j])){if(h!==true){g.push(i[j])}else{g.push({column:i[j],index:j})}}}return g},getEventColumns:function(d,c){return this.getColumnBy(function(a){return !(d.getEndDate()<=a.start||d.getStartDate()>=a.end)},c)},getColumnEvents:function(c){var d=[];this.view.eventStore.each(function(a){if(!(a.getEndDate()<=c.start||a.getStartDate()>=c.end)){d.push(a)}});return d},getColumnByResource:function(c,d){return this.getColumnBy(function(a){return a.start==c.start},d)[0]},translateToScheduleCoordinate:function(c){var d=this.view;if(Ext.isArray(c)){return[c[0]-d.getEl().getX()+d.getScroll().left,c[1]-d.getEl().getY()+d.getScroll().top]}else{return c-d.getEl().getY()+d.getScroll().top}},translateToPageCoordinate:function(g){var e=this.view;var h=e.getEl(),f=h.getScroll();if(Ext.isArray(g)){return[g[0]+h.getX()-f.left,g[1]+h.getY()-f.top]}else{return g+h.getY()-f.top}},getDateFromXY:function(h,e,f){var g=h;if(!f){g=this.translateToScheduleCoordinate(g)}return this.view.timeAxisViewModel.getDateFromPosition(g,e)},getEventRenderData:function(B,A,t){var s=B.getStartDate(),u=B.getEndDate(),q=this.view,z=q.panel.headerCt.getGridColumns(),v=z[t].start,p=z[t].end,r=Math;var w=Math.floor(q.getCoordinateFromDate(Sch.util.Date.max(s,v)));var o=Math.floor(q.timeAxisViewModel.getPositionFromDate(Sch.util.Date.min(u,p),true));var x=this.getCalendarColumnWidth();var y;if(o===0){o=q.getStore().getCount()*q.getRowHeight()}y={top:r.max(0,r.min(w,o)-q.eventBorderWidth),height:r.max(1,r.abs(w-o))};if(q.managedEventSizing){y.left=q.barMargin;y.width=x-(2*q.barMargin)-q.eventBorderWidth}y.start=s;y.end=u;y.startsOutsideView=s<v;y.endsOutsideView=u>p;return y},getScheduleRegion:function(m,p){var i=this.view,k=m?this.getColumnByResource(m).getRegion():i.getTableRegion(),j=this.translateToPageCoordinate(0),n=this.translateToPageCoordinate(i.getStore().getCount()*i.getRowHeight()),l=k.left+i.barMargin,o=k.right-i.barMargin;return new Ext.util.Region(Math.min(j,n),o,Math.max(j,n),l)},getCalendarColumnWidth:function(b){return this.view.timeAxisViewModel.calendarColumnWidth},getResourceRegion:function(s,y,t){var q=this.view,v=q.resourceStore.indexOf(s)*this.getCalendarColumnWidth(),r=q.timeAxis.getStart(),n=q.timeAxis.getEnd(),z=y?Sch.util.Date.max(r,y):r,w=t?Sch.util.Date.min(n,t):n,u=Math.max(0,q.getCoordinateFromDate(z)-q.cellTopBorderWidth),o=q.getCoordinateFromDate(w)-q.cellTopBorderWidth,x=v+q.cellBorderWidth,p=v+this.getCalendarColumnWidth()-q.cellBorderWidth;return new Ext.util.Region(Math.min(u,o),p,Math.max(u,o),x)},columnRenderer:function(u,i,r,q,l){var p=this.view;var v="";if(q===0){var o,w,s,t;o=[];w=this.getColumnEvents(i.column);for(s=0,t=w.length;s<t;s++){var x=w[s];o.push(p.generateTplData(x,r,l))}p.eventLayout.vertical.applyLayout(o,this.getCalendarColumnWidth());v="&#160;"+p.eventTpl.apply(o)}if(l%2===1){i.tdCls=(i.tdCls||"")+" "+p.altColCls;i.cellCls=(i.cellCls||"")+" "+p.altColCls}return v},resolveResource:function(i){var g=this.view;i=Ext.fly(i).is(g.timeCellSelector)?i:Ext.fly(i).up(g.timeCellSelector);if(i){var h=i.dom?i.dom:i;var f=0;if(Ext.isIE8m){h=h.previousSibling;while(h){if(h.nodeType===1){f++}h=h.previousSibling}}else{f=Ext.Array.indexOf(Array.prototype.slice.call(h.parentNode.children),h)}if(f>=0){var j=g.panel.headerCt.getGridColumns()[f];return{start:j.start,end:j.end}}}},onEventUpdate:function(l,k){this.renderSingle.call(this,k);var j=k.previous||{};var g=new Sch.model.Event({StartDate:j.StartDate||k.getStartDate(),EndDate:j.EndDate||k.getEndDate()});this.relayoutRenderedEvents(g);this.relayoutRenderedEvents(k);var h=this.view;var i=h.getEventSelectionModel();i.forEachEventRelatedSelection(k,function(a){h.onEventBarSelect(a)})},onEventAdd:function(d,f){var e=this.view;if(f.length===1){this.renderSingle(f[0]);this.relayoutRenderedEvents(f[0])}else{e.repaintAllEvents()}},onEventRemove:function(d,f){var e=this.view;if(f.length===1){this.relayoutRenderedEvents(f[0])}else{e.repaintAllEvents()}},relayoutRenderedEvents:function(d){var f=this,e=f.getEventColumns(d,true);Ext.each(e,function(a){f.repaintEventsForColumn(a.column,a.index)})},renderSingle:function(h){var f=this.view;var g=this.view.resourceStore.first();var e=this.getEventColumns(h,true);Ext.each(f.getElementsFromEventRecord(h),function(a){Ext.fly(a).destroy()});Ext.each(e,function(b){var c=Ext.fly(f.getScheduleCell(0,b.index));if(!c){return}var a=f.generateTplData(h,g,b.index);if(!Ext.versions.touch){c=c.first()}f.eventTpl.append(c,[a])})},repaintEventsForColumn:function(A,t){var s=this;var i=s.getColumnEvents(A);var r=s.view;var w=[],v,z,D,B,C,x;if(i.length>0){for(v=0,z=i.length;v<z;v++){D=i[v];B=r.getElementsFromEventRecord(D)[0];if(!B){return}var u=B.id.split("-");u.pop();C=D.getStartDate();x=D.getEndDate();w.push({start:C<A.start?A.start:C,end:x>A.end?A.end:x,event:D,id:u.join("-")})}}r.eventLayout.vertical.applyLayout(w,A.getWidth());var l=Ext.get(Ext.DomQuery.selectNode("tr:nth-child(1)",r.el.dom));for(v=0;v<w.length;v++){D=w[v];var y=Ext.get(Ext.DomQuery.selectNode("td:nth-child("+(t+1)+") [id^="+D.id+"-]",l.dom));y&&y.setStyle({left:D.left+"px",width:Math.max(D.width,0)+"px"})}},getTimeSpanRegion:function(r,o){var m=this.view,p=m.getCoordinateFromDate(r),l=o?m.getCoordinateFromDate(o,true,true):p;var q=this.getColumnBy(function(a){return a.start<=r&&a.end>r})[0];var n=this.getColumnBy(function(a){return a.start<o&&a.end>=o})[0];var j=this.translateToScheduleCoordinate([q.getX(),0]);var k=this.translateToScheduleCoordinate([n?n.getRegion().right:q.getWidth()+j[0],0]);return new Ext.util.Region(Math.min(p,l),k[0],Math.max(p,l),j[0])},getStartEndDatesFromRegion:function(i,j,f){var g=this.view.getDateFromCoordinate([i.left,i.top],j),h=this.view.getDateFromCoordinate([i.left,i.bottom],j);if(g&&h){return{start:Sch.util.Date.min(g,h),end:Sch.util.Date.max(g,h)}}else{return null}},setColumnWidth:function(f,d){var e=this.view;e.calendarColumnWidth=f;e.getTimeAxisViewModel().setViewColumnWidth(f,d)},getVisibleDateRange:function(){var j=this.view;if(!j.rendered){return null}var l=j.getScroll(),g=j.getHeight(),k=j.getTableRegion(),i=j.timeAxis.getEnd();if(k.bottom-k.top<g){var h=j.timeAxis.getStart();return{startDate:h,endDate:i}}return{startDate:j.getDateFromCoordinate(l.top,null,true),endDate:j.getDateFromCoordinate(l.top+g,null,true)||i}}});Ext.define("Sch.selection.EventModel",{extend:"Ext.selection.Model",alias:"selection.eventmodel",requires:["Ext.util.KeyNav"],deselectOnContainerClick:true,selectedOnMouseDown:false,bindToView:function(f){var g=this;g.view=f;var e=f.eventStore;var h=f.resourceStore;g.bindStore(e);f.mon(h,"beforeload",g.clearSelectionOnRefresh,g);f.mon(e,"beforeload",g.clearSelectionOnRefresh,g);f.on({eventclick:g.onEventClick,eventmousedown:g.onEventMouseDown,itemmousedown:g.onItemMouseDown,refresh:function(){g.refresh()},destroy:function(){g.bindStore(null)},scope:g})},clearSelectionOnRefresh:function(){this.clearSelections()},onEventMouseDown:function(d,e,f){this.selectedOnMouseDown=null;if(!this.isSelected(e)){this.selectedOnMouseDown=e;this.selectWithEvent(e,f)}},onEventClick:function(d,e,f){if(!this.selectedOnMouseDown){this.selectWithEvent(e,f)}},onItemMouseDown:function(d,j,a,b,c){if(this.deselectOnContainerClick&&!c.getTarget(this.view.eventSelector)){this.deselectAll()}},onSelectChange:function(o,q,i,r){var m=this,l=m.view,k=m.store,n=q?"select":"deselect",p=0;if((i||m.fireEvent("before"+n,m,o))!==false&&r()!==false){if(q){l.onEventBarSelect(o,i)}else{l.onEventBarDeselect(o,i)}if(!i){m.fireEvent(n,m,o)}}},selectRange:Ext.emptyFn,selectNode:function(h,g,f){var e=this.view.resolveEventRecord(h);if(e){this.select(e,g,f)}},deselectNode:function(h,g,f){var e=this.view.resolveEventRecord(h);if(e){this.deselect(e,f)}},getFirstSelectedEventForResource:function(i){var l=this.getSelection(),j=null,g,h,k;for(g=0,h=l.length;!j&&g<h;++g){k=l[g];if(k.isAssignedTo(i)){j=k}}return j},getDraggableSelections:function(){return Ext.Array.filter(this.getSelection(),function(b){return b.isDraggable()})},forEachEventRelatedSelection:function(d,c){this.isSelected(d)&&c(d)}});Ext.define("Sch.selection.AssignmentModel",{extend:"Sch.selection.EventModel",alias:"selection.assignmentmodel",assignmentStoreDetacher:null,destroy:function(){var b=this;Ext.destroyMembers(b,"assignmentStoreDetacher");b.callParent()},bindToView:function(f){var h=this,e,g;h.callParent([f]);e=h.view.eventStore;g=e.getAssignmentStore();if(g){h.assignmentStoreDetacher=g.on({remove:h.onAssignmentStoreRemove,clear:h.onAssignmentStoreClear,refresh:h.onAssignmentStoreRefresh,scope:h,destroyable:true})}},selectWithEvent:function(e,j){var l=this,i=l.view,m=i.resolveResource(j.getTarget()),k,n;if(m){k=i.eventStore.getAssignmentStore();n=k.getAssignmentForEventAndResource(e,m);if(n){l.callParent([n,j])}}},getFirstSelectedEventForResource:function(i){var l=this.getSelection(),j=null,g,h,k;for(g=0,h=l.length;!j&&g<h;++g){k=l[g];if(k.getEvent().isAssignedTo(i)){j=k}}return j},getDraggableSelections:function(){return Ext.Array.filter(this.getSelection(),function(b){return b.getEvent().isDraggable()})},forEachEventRelatedSelection:function(d,c){Ext.Array.forEach(this.getSelection(),function(a){a.getEvent()===d&&c(a)})},onAssignmentStoreRemove:function(c,d){this.deselect(d,true)},onAssignmentStoreClear:function(b){this.clearSelections()},onAssignmentStoreRefresh:function(b){this.clearSelections()}});Ext.define("Sch.plugin.Printable",{extend:"Ext.AbstractPlugin",alias:"plugin.scheduler_printable",requires:["Ext.XTemplate"],lockableScope:"top",docType:"<!DOCTYPE HTML>",beforePrint:Ext.emptyFn,afterPrint:Ext.emptyFn,autoPrintAndClose:true,fakeBackgroundColor:true,scheduler:null,mainTpl:null,constructor:function(b){Ext.apply(this,b);if(!this.mainTpl){this.mainTpl=new Ext.XTemplate('{docType}<html class="'+Ext.baseCSSPrefix+'border-box {htmlClasses}"><head><meta content="text/html; charset=UTF-8" http-equiv="Content-Type" /><title>{title}</title>{styles}</head><body class="sch-print-body {bodyClasses}"><div class="sch-print-ct {componentClasses}" style="width:{totalWidth}px"><div class="sch-print-headerbg" style="border-left-width:{totalWidth}px;height:{headerHeight}px;"></div><div class="sch-print-header-wrap">{[this.printLockedHeader(values)]}{[this.printNormalHeader(values)]}</div>{[this.printLockedGrid(values)]}{[this.printNormalGrid(values)]}</div><script type="text/javascript">{setupScript}<\/script></body></html>',{printLockedHeader:function(a){var d="";if(a.lockedGrid){d+='<div style="left:-'+a.lockedScroll+"px;margin-right:-"+a.lockedScroll+"px;width:"+(a.lockedWidth+a.lockedScroll)+'px"';d+='class="sch-print-lockedheader '+a.lockedGrid.headerCt.el.dom.className+'">';d+=a.lockedHeader;d+="</div>"}return d},printNormalHeader:function(a){var d="";if(a.normalGrid){d+='<div style="left:'+(a.lockedGrid?a.lockedWidth:"0")+"px;width:"+a.normalWidth+'px;" class="sch-print-normalheader '+a.normalGrid.headerCt.el.dom.className+'">';d+='<div style="margin-left:-'+a.normalScroll+'px">'+a.normalHeader+"</div>";d+="</div>"}return d},printLockedGrid:function(a){var d="";if(a.lockedGrid){d+='<div id="lockedRowsCt" style="left:-'+a.lockedScroll+"px;margin-right:-"+a.lockedScroll+"px;width:"+(a.lockedWidth+a.lockedScroll)+"px;top:"+a.headerHeight+'px;" class="sch-print-locked-rows-ct '+a.innerLockedClasses+" "+Ext.baseCSSPrefix+'grid-inner-locked">';d+=a.lockedRows;d+="</div>"}return d},printNormalGrid:function(a){var d="";if(a.normalGrid){d+='<div id="normalRowsCt" style="left:'+(a.lockedGrid?a.lockedWidth:"0")+"px;top:"+a.headerHeight+"px;width:"+a.normalWidth+'px" class="sch-print-normal-rows-ct '+a.innerNormalClasses+'">';d+='<div style="position:relative;overflow:visible;margin-left:-'+a.normalScroll+'px">'+a.normalRows+"</div>";d+="</div>"}return d}})}},init:function(b){this.scheduler=b;b.print=Ext.Function.bind(this.print,this)},getGridContent:function(q){var r=q.normalGrid,z=q.lockedGrid,p=z.getView(),x=r.getView(),u,A,s,v,t,C,w;this.beforePrint(q);if(z.collapsed&&!r.collapsed){C=z.getWidth()+r.getWidth()}else{C=r.getWidth();w=z.getWidth()}var B=p.store.getRange();A=p.tpl.apply(p.collectData(B,0));s=x.tpl.apply(x.collectData(B,0));v=p.el.getScroll().left;t=x.el.getScroll().left;var D=document.createElement("div");D.innerHTML=A;D.firstChild.style.width=p.el.dom.style.width;A=D.innerHTML;if(Sch.feature&&Sch.feature.AbstractTimeSpan){var y=(q.plugins||[]).concat(q.normalGrid.plugins||[]).concat(q.columnLinesFeature||[]);Ext.each(y,function(a){if(a instanceof Sch.feature.AbstractTimeSpan&&a.generateMarkup){s=a.generateMarkup(true)+s}})}this.afterPrint(q);return{normalHeader:r.headerCt.el.dom.innerHTML,lockedHeader:z.headerCt.el.dom.innerHTML,lockedGrid:z.collapsed?false:z,normalGrid:r.collapsed?false:r,lockedRows:A,normalRows:s,lockedScroll:v,normalScroll:t,lockedWidth:w-(Ext.isWebKit?1:0),normalWidth:C,headerHeight:r.headerCt.getHeight(),innerLockedClasses:z.view.el.dom.className,innerNormalClasses:r.view.el.dom.className+(this.fakeBackgroundColor?" sch-print-fake-background":""),width:q.getWidth()}},getStylesheets:function(){return Ext.getDoc().select('link[rel="stylesheet"]')},print:function(){var l=this.scheduler;if(!(this.mainTpl instanceof Ext.Template)){var r=22;this.mainTpl=new Ext.XTemplate(this.mainTpl,{compiled:true,disableFormats:true})}var k=l.getView(),j=this.getStylesheets(),n=Ext.get(Ext.core.DomHelper.createDom({tag:"div"})),q;j.each(function(a){n.appendChild(a.dom.cloneNode(true))});q=n.dom.innerHTML+"";var m=this.getGridContent(l),p=this.mainTpl.apply(Ext.apply({waitText:this.waitText,docType:this.docType,htmlClasses:Ext.getBody().parent().dom.className,bodyClasses:Ext.getBody().dom.className,componentClasses:l.el.dom.className,title:(l.title||""),styles:q,totalWidth:l.getWidth(),setupScript:("window.onload = function(){ ("+this.setupScript.toString()+")("+l.syncRowHeight+", "+this.autoPrintAndClose+", "+Ext.isChrome+", "+Ext.isIE+"); };")},m));var o=window.open("","printgrid");if(!o||!o.document){return false}this.printWindow=o;o.document.write(p);o.document.close()},setupScript:function(h,g,i,f){var j=function(){if(h){var s=document.getElementById("lockedRowsCt"),a=document.getElementById("normalRowsCt"),r=s&&s.getElementsByTagName("tr"),c=a&&a.getElementsByTagName("tr"),e=c&&r?c.length:0;for(var p=0;p<e;p++){var q=c[p].clientHeight;var d=r[p].clientHeight;var b=Math.max(q,d)+"px";r[p].style.height=c[p].style.height=b}}document._loaded=true;if(g){window.print();if(!i){window.close()}}};if(f){setTimeout(j,0)}else{j()}}});Ext.define("Sch.plugin.exporter.AbstractExporter",{extend:"Ext.util.Observable",requires:["Ext.dom.Element","Ext.core.DomHelper"],mixins:["Sch.mixin.Localizable"],pageHeaderHeight:41,pageFooterHeight:0,bufferedHeightMargin:25,paperWidth:0,paperHeight:0,printHeight:0,lockedRowsHeight:0,normalRowsHeight:0,iterateTimeout:10,tableSelector:undefined,currentPage:undefined,headerTplDataFn:null,footerTplDataFn:null,headerTplDataFnScope:null,footerTplDataFnScope:null,config:{exporterId:"abstractexporter",name:"",translateURLsToAbsolute:true,expandAllBeforeExport:false,headerTpl:'<div class="sch-export-header" style="height:{height}px; width:{width}px"><h2>{pageNo}/{totalPages}</h2></div>',tpl:'<!DOCTYPE html><html class="'+Ext.baseCSSPrefix+'border-box {htmlClasses}"><head><meta content="text/html; charset=UTF-8" http-equiv="Content-Type" /><title>{title}</title>{styles}</head><body class="'+Ext.baseCSSPrefix+'webkit sch-export {bodyClasses}">{header}<div class="{componentClasses}" style="height:{bodyHeight}px; width:{totalWidth}px; position: relative !important">{HTML}</div>{footer}</body></html>',footerTpl:""},callbacks:undefined,error:undefined,extractedPages:undefined,numberOfPages:0,constructor:function(d){var c=this;d=d||{};c.callParent(arguments);delete d.getUserHeaderTplData;delete d.getUserFooterTplData;c.initConfig(d);if(!d.tableSelector){c.tableSelector="."+Ext.baseCSSPrefix+"grid-item-container"}if(!d.name){c.setName(c.L("name"))}},setHeaderTpl:function(b){this.headerTpl=this.getTplInstance(b)},getHeaderTpl:function(){return this.headerTpl},setTpl:function(b){this.tpl=this.getTplInstance(b)},getTpl:function(){return this.tpl},setFooterTpl:function(b){this.footerTpl=this.getTplInstance(b)},getFooterTpl:function(){return this.footerTpl},getTplInstance:function(b){return(b&&!b.isTemplate)?new Ext.XTemplate(b,{disableFormats:true}):b},getBodyClasses:function(){var c=new RegExp(Ext.baseCSSPrefix+"ie\\d?|"+Ext.baseCSSPrefix+"gecko","g"),d=Ext.getBody().dom.className.replace(c,"");if(Ext.isIE){d+=" sch-ie-export"}return d},getComponentClasses:function(){return this.getComponent().el.dom.className},setComponent:function(d){var c=this;c.component=d;c.view=d.getSchedulingView();c.normalGrid=d.normalGrid;c.lockedGrid=d.lockedGrid;c.normalView=d.normalGrid.view;c.lockedView=d.lockedGrid.view;c.lockedBodySelector="#"+c.lockedView.getId();c.normalBodySelector="#"+c.normalView.getId();c.lockedHeader=c.lockedGrid.headerCt;c.normalHeader=c.normalGrid.headerCt;c.headerHeight=c.normalHeader.getHeight();c.printHeight=Math.floor(c.paperHeight)-c.headerHeight-(c.exportConfig.showHeader?c.pageHeaderHeight:0)-(c.exportConfig.showFooter?c.pageFooterHeight:0);c.saveComponentState(d)},getComponent:function(){return this.component},setPaperSize:function(e,d){var f=this;if(d==="landscape"){f.paperWidth=e.height;f.paperHeight=e.width}else{f.paperWidth=e.width;f.paperHeight=e.height}},getPaperFormat:function(){return this.exportConfig.format},isBuffered:function(){return !!this.getBufferedRenderer()},getBufferedRenderer:function(){return this.view.bufferedRenderer},setComponentRange:function(o){var m=this,p=m.getComponent(),i=m.view,j,n;if(o.range!=="complete"){switch(o.range){case"date":j=new Date(o.dateFrom);n=new Date(o.dateTo);if(Sch.util.Date.getDurationInDays(j,n)<1){n=Sch.util.Date.add(n,Sch.util.Date.DAY,1)}j=Sch.util.Date.constrain(j,p.getStart(),p.getEnd());n=Sch.util.Date.constrain(n,p.getStart(),p.getEnd());break;case"current":var l=i.getVisibleDateRange();j=l.startDate;n=l.endDate||i.timeAxis.getEnd();if(o.cellSize){var k=o.cellSize;m.timeColumnWidth=k[0];if(m.timeColumnWidth){p.setTimeColumnWidth(m.timeColumnWidth)}if(k.length>1){m.view.setRowHeight(k[1])}}break}p.setTimeSpan(j,n)}m.ticks=p.timeAxis.getTicks()},getStylesheets:function(){var g=this.translateURLsToAbsolute,h=Ext.getDoc().select('link[rel="stylesheet"]'),f=Ext.get(Ext.core.DomHelper.createDom({tag:"div"})),e;h.each(function(b){var a=b.dom.cloneNode(true);g&&a.setAttribute("href",b.dom.href);f.appendChild(a)});e=f.dom.innerHTML+"";return e},forEachTimeSpanPlugin:function(p,m,n){if(Sch.feature&&Sch.feature.AbstractTimeSpan){var k=this;var i=(p.plugins||[]).concat(p.normalGrid.plugins||[]).concat(p.columnLinesFeature||[]);for(var o=0,j=i.length;o<j;o++){var l=i[o];if(l instanceof Sch.feature.AbstractTimeSpan){m.call(n||k,l)}}}},prepareComponent:function(d,e){var f=this;d=d||f.getComponent();f.suspendInfiniteScroll(d);f.forEachTimeSpanPlugin(d,function(a){a._renderDelay=a.renderDelay;a.renderDelay=0});d.getSchedulingView().timeAxisViewModel.suppressFit=true;d.timeAxis.autoAdjust=false;d.normalGrid.expand();d.lockedGrid.expand();f.setComponentRange(e);if(f.expandAllBeforeExport&&d.expandAll){d.expandAll()}f.fitComponentIntoPage();if(f.isBuffered()&&Ext.isIE8){f.normalView.bufferedRenderer.variableRowHeight=false;f.lockedView.bufferedRenderer.variableRowHeight=false}},restoreComponent:function(d){var c=this;d=d||c.getComponent();c.forEachTimeSpanPlugin(d,function(a){a.renderDelay=a._renderDelay;delete a._renderDelay});c.restoreComponentState(d);c.restoreInfiniteScroll(d);c.exportConfig.afterExport&&c.exportConfig.afterExport(d)},saveComponentState:function(f){f=f||this.getComponent();var j=this,g=f.getSchedulingView(),i=f.normalGrid,h=f.lockedGrid;j.restoreSettings={width:f.getWidth(),height:f.getHeight(),rowHeight:g.timeAxisViewModel.getViewRowHeight(),columnWidth:g.timeAxisViewModel.getTickWidth(),startDate:f.getStart(),endDate:f.getEnd(),normalWidth:i.getWidth(),normalLeft:i.getEl().getStyle("left"),lockedWidth:h.getWidth(),lockedCollapse:h.collapsed,normalCollapse:i.collapsed,autoAdjust:f.timeAxis.autoAdjust,suppressFit:g.timeAxisViewModel.suppressFit,restoreColumnWidth:false,startIndex:g.all?g.all.startIndex:0}},restoreComponentState:function(h){var g=this;h=h||g.getComponent();var e=g.restoreSettings,f=h.getSchedulingView();h.timeAxis.autoAdjust=e.autoAdjust;h.normalGrid.show();h.setWidth(e.width);h.setHeight(e.height);h.setTimeSpan(e.startDate,e.endDate);h.setTimeColumnWidth(e.columnWidth,true);f.setRowHeight(e.rowHeight);h.lockedGrid.show();h.normalGrid.setWidth(e.normalWidth);h.normalGrid.getEl().setStyle("left",e.normalLeft);h.lockedGrid.setWidth(e.lockedWidth);f.timeAxisViewModel.suppressFit=e.suppressFit;f.timeAxisViewModel.setTickWidth(e.columnWidth);if(e.lockedCollapse){h.lockedGrid.collapse()}if(e.normalCollapse){h.normalGrid.collapse()}if(g.getBufferedRenderer()){g.scrollTo(e.startIndex);if(Ext.isIE8){g.normalView.bufferedRenderer.variableRowHeight=true;g.lockedView.bufferedRenderer.variableRowHeight=true}}},extractPages:function(f,g,h,j){var i=this;i.exportConfig=g;i.normalRows=[];i.lockedRows=[];i.extractedPages=[];i.numberOfPages=0;i.lockedRowsHeight=0;i.normalRowsHeight=0;i.setPaperSize(g.pageSize,g.orientation);i.setComponent(f,g);i.prepareComponent(f,g);g.beforeExport&&g.beforeExport(f,i.ticks);i.callbacks={success:h||Ext.emptyFn,scope:j||i};setTimeout(function(){i.collectRows(i.onRowsCollected,i)},1)},onPagesExtracted:function(d){var c=this;c.restoreComponent();c.submitPages(d)},submitPages:function(e){var f=this,d=f.callbacks;d.success.call(d.scope,f.renderPages(e))},getCurrentPage:function(){return this.currentPage},setCurrentPage:function(b){this.currentPage=b},getExpectedNumberOfPages:Ext.emptyFn,commitPage:function(f){var e=this;e.numberOfPages++;var g=e.preparePageToCommit(f);var h=Ext.apply({html:g.dom.innerHTML,number:e.numberOfPages},f);e.extractedPages.push(h);e.fireEvent("commitpage",e,h,e.numberOfPages,e.getExpectedNumberOfPages())},collectLockedRow:function(g,h){var e=Ext.fly(g).getHeight();this.lockedRowsHeight+=e;var f={height:e,row:g.cloneNode(true),record:this.lockedView.getRecord(h)};this.lockedRows.push(f);return f},collectNormalRow:function(g,h){var e=Ext.fly(g).getHeight();this.normalRowsHeight+=e;var f={height:Ext.fly(g).getHeight(),row:g.cloneNode(true),record:this.normalView.getRecord(h)};this.normalRows.push(f);return f},onRowsCollected:function(){throw"Sch.plugin.exporter.AbstractExporter: [onRowsCollected] Abstract method called."},iterateAsync:function(h,e){var g=this;e=e||g;var f=function(){var a=arguments;var b=setInterval(function(){clearInterval(b);h.apply(e,[].concat.apply([f],a))},g.iterateTimeout)};f.apply(g,Ext.Array.slice(arguments,2))},callAsync:function(f,d){d=d||this;var e=setInterval(function(){clearInterval(e);f.apply(d,Ext.Array.slice(arguments,2))},this.iterateTimeout)},collectRows:function(f,e){var d=this;if(d.isBuffered()){setTimeout(function(){d.scrollTo(0,function(){d.iterateAsync(d.collectRowsStep,d,0,f,e)})},1)}else{setTimeout(function(){d.collectRowsStep(null,0,f,e)},1)}},collectRowsStep:function(q,m,l,i){var n=this,r=n.normalView.all.endIndex,p=n.component.store.getCount(),o=n.normalView.all.slice(m),t=n.lockedView.all.slice(m);for(var s=0;s<t.length;s++){n.collectLockedRow(t[s],m+s)}for(s=0;s<o.length;s++){n.collectNormalRow(o[s],m+s)}n.fireEvent("collectrows",n,m,r,p);if(n.isBuffered()){if(r+1<p){n.callAsync(function(){n.scrollTo(r+1,function(){q(r+1,l,i)})})}else{n.callAsync(function(){n.scrollTo(0,function(){l.call(i||n,n.lockedRows,n.normalRows)})})}}else{l.call(i||n,n.lockedRows,n.normalRows)}},renderPages:function(g){var i=this;g=g||i.extractedPages;for(var j=0,f=g.length;j<f;j++){var h=g[j];h.html=i.applyPageTpl(h)}return g},applyPageTpl:function(d){var c=this;return c.getTpl().apply(c.getPageTplData(d))},applyHeaderTpl:function(f){var j=this,h=j.getHeaderTpl();if(j.exportConfig.showHeader&&h){var g=j.headerTplDataFn;var i=g&&g.call(j.headerTplDataFnScope||j,f);return h.apply(Ext.apply(j.getHeaderTplData(f),i))}return""},applyFooterTpl:function(f){var j=this,h=j.getFooterTpl();if(j.exportConfig.showFooter&&h){var g=j.footerTplDataFn;var i=g&&g.call(j.footerTplDataFnScope||j,f);return h.apply(Ext.apply(j.getFooterTplData(f),i))}return""},getHeaderTplData:function(d){var c=this;return{width:c.paperWidth,height:c.pageHeaderHeight,totalPages:c.numberOfPages,pageNo:d.number}},getFooterTplData:function(d){var c=this;return{width:c.paperWidth,height:c.pageFooterHeight,totalPages:c.numberOfPages,pageNo:d.number}},getPageTplData:function(d){var c=this;return{bodyClasses:c.getBodyClasses(),bodyHeight:c.printHeight+c.headerHeight,componentClasses:c.getComponentClasses(),styles:c.getStylesheets(),showHeader:c.exportConfig.showHeader,showFooter:c.exportConfig.showFooter,header:c.applyHeaderTpl(d),HTML:d.html,footer:c.applyFooterTpl(d),totalWidth:c.paperWidth,title:d.number+" of "+c.numberOfPages}},fitComponentIntoPage:Ext.emptyFn,getLockedGridBody:function(b){b=b||this.getCurrentPage();return b.select(this.lockedBodySelector+" > "+this.tableSelector).first()},getNormalGridBody:function(b){b=b||this.getCurrentPage();return b.select(this.normalBodySelector+" > "+this.tableSelector).first()},emptyLockedGrid:function(b){this.getLockedGridBody(b).select(this.lockedView.getItemSelector()).remove()},fillGrids:function(j,f,h,g){var i=this;i.fillLockedGrid(j,h,g);i.fillNormalGrid(f,h,g)},fillLockedGrid:function(h,g,f){var e=this;if(!f){e.emptyLockedGrid()}e.appendRows(e.getLockedGridBody(),h||e.lockedRows,g)},fillNormalGrid:function(h,g,f){var e=this;if(!f){e.emptyNormalGrid()}e.appendRows(e.getNormalGridBody(),h||e.normalRows,g)},appendRows:function(k,l,i){var j=k.dom;for(var g=0,h=l.length;g<h;g++){j.appendChild(i?l[g].row.cloneNode(true):l[g].row)}},emptyNormalGrid:function(b){this.getNormalGridBody(b).select(this.normalView.getItemSelector()).remove()},getRowHeight:function(){return this.view.timeAxisViewModel.getViewRowHeight()},getTotalSize:function(){return{width:this.getTotalWidth(),height:this.getTotalHeight()}},getTotalHeight:function(){var c=this,d;if(c.isBuffered()){d=c.bufferedHeightMargin+c.normalRowsHeight}else{d=c.lockedView.getEl().down(c.tableSelector).getHeight()}return c.headerHeight+d},getTotalWidth:function(){return this.getLockedGridWidth()+this.normalGrid.body.down(this.tableSelector).getWidth()},getLockedGridWidth:function(){return this.lockedHeader.getEl().first().getWidth()},getNormalGridWidth:function(){return this.normalHeader.getEl().first().getWidth()},preparePageToCommit:function(){var l=this.getCurrentPage(),n=this.component,r=n.lockedGrid,o=n.normalGrid;l.el.select(".sch-remove").remove();var s=function(a){var b=l.select("#"+a).first();return b&&b.dom},k=function(a){if(a){a.style.width="100%"}},p=function(a){if(a){a.style.height="100%"}};var t=l.select(this.normalBodySelector).first();t.dom.style.top="0px";var m=l.select(this.lockedBodySelector).first();m.dom.style.top="0px";var q=[s(n.id+"-targetEl"),s(n.id+"-innerCt"),s(r.id),s(r.body.id),s(r.view.el.id)];Ext.Array.forEach(q,p);k(q[0]);k(q[1]);k(s(o.headerCt.id));Ext.Array.forEach([s(o.id),s(o.body.id),s(o.getView().id)],function(a){if(a){a.style.height=a.style.width="100%"}});return l},cloneElement:function(b){return new Ext.dom.Element(Ext.core.DomHelper.createDom({tag:"div",html:b.dom.innerHTML}))},startPage:function(d){var e=this;var f=e.cloneElement(d||e.getComponent().body);e.setCurrentPage(f)},scrollTo:function(f,g){var h=this;if(h.component.ensureVisible){var e=h.component.store.getAt(f);h.component.ensureVisible(e,{callback:function(){if(g&&this.isLocked===false){g.apply(h)}},select:false,focus:false,animate:false})}else{h.lockedView.bufferedRenderer.scrollTo(f,false,function(){h.normalView.bufferedRenderer.scrollTo(f,false,g)})}},removeNode:function(d){if(d&&d.parentNode){d.parentNode.removeChild(d)}else{if(d.elements){for(var e=0;e<d.elements.length;e++){var f=d.elements[e];f.parentNode.removeChild(f)}}}},restoreInfiniteScroll:function(c){var d=c.getSchedulingView();if(c.infiniteScroll&&d.rendered){c.timeAxis.setTimeSpan(this._oldStart,this._oldEnd);d.setScrollX(this._oldScrollX);d.bindInfiniteScrollListeners()}},suspendInfiniteScroll:function(d){var e=d.getSchedulingView();if(d.infiniteScroll&&e.rendered){e.unbindInfiniteScrollListeners();this._oldStart=d.timeAxis.getStart();this._oldEnd=d.timeAxis.getEnd();this._oldScrollX=e.getScrollX();var f=d.getEventStore().getTotalTimeSpan();d.setTimeSpan(f.start,f.end)}}});Ext.define("Sch.plugin.exporter.SinglePage",{extend:"Sch.plugin.exporter.AbstractExporter",config:{exporterId:"singlepage",headerTpl:'<div class="sch-export-header" style="height:{height}px; width:{width}px"></div>'},getExpectedNumberOfPages:function(){return 1},getPaperFormat:function(){var h=this,j=h.getTotalSize(),f=h.exportConfig.DPI,i=Ext.Number.toFixed(j.width/f,1),g=Ext.Number.toFixed(j.height/f,1);return i+"in*"+g+"in"},onRowsCollected:function(){var b=this;b.startPage();b.fillGrids();b.commitPage();b.onPagesExtracted()},getPageTplData:function(){var c=this,d=c.getTotalSize();return Ext.apply(c.callParent(arguments),{bodyHeight:d.height,showHeader:false,totalWidth:d.width})},getHeaderTplData:function(d){var c=this;return{width:c.getTotalWidth(),height:c.pageHeaderHeight}},fitComponentIntoPage:function(){var d=this,c=d.lockedGrid;c.setWidth(c.headerCt.getEl().first().getWidth())},preparePageToCommit:function(){var j=this,i=j.callParent(arguments),k=i.select(".sch-secondary-canvas").first(),l=k.select(".sch-zone"),g=k.select(".sch-column-line");var h=j.getTotalHeight();k.setTop(0);l.setHeight(h);g.setHeight(h);return i}});Ext.define("Sch.plugin.exporter.MultiPage",{extend:"Sch.plugin.exporter.AbstractExporter",config:{exporterId:"multipage"},rowPageIndex:0,columnPageIndex:0,pagesPerColumn:0,extractPages:function(){this.enableGarbageCollector=Ext.enableGarbageCollector;Ext.enableGarbageCollector=false;Ext.dom.GarbageCollector.pause();return this.callParent(arguments)},onRowsCollected:function(d,e){var f=this;f.rowPageIndex=0;f.columnPageIndex=0;f.pagesPerColumn=0;f.buildPageFrames(function(){f.buildPages(function(){f.onPagesExtracted.apply(f,arguments);Ext.enableGarbageCollector=f.enableGarbageCollector;Ext.dom.GarbageCollector.resume()},f,d,e)})},buildPages:function(i,l,g,h){var k=this,j=k.pageFrames[0];k.startPage(j,true);this.iterateAsync(k.rowIteratorStep,k,{rowIndex:0,pageFrame:j,rowsHeight:0,leftHeight:this.printHeight,lockeds:[],normals:[],lockedRows:g,normalRows:h,callback:i,scope:l||k})},rowIteratorStep:function(r,x){var o=this,n=x.rowIndex,w=x.lockedRows,q=x.normalRows,p=x.leftHeight,u=x.lockeds,m=x.normals,v=true;if(n<w.length){var s=w[n],t=q[n];if(s.height<=p){u.push(s);m.push(t);x.leftHeight-=s.height;x.rowsHeight+=s.height;v=false}else{o.fillGrids(u,m,x.pageFrame);o.commitPage({rowsHeight:x.rowsHeight});o.startPage(x.pageFrame);x.lockeds=[s];x.normals=[t];x.leftHeight=o.printHeight-s.height;x.rowsHeight=s.height}x.rowIndex++}else{if(o.columnPageIndex<o.pageFrames.length){o.fillGrids(u,m,x.pageFrame);o.commitPage({rowsHeight:x.rowsHeight});x.pageFrame=o.pageFrames[o.columnPageIndex];o.startPage(x.pageFrame,true);x.leftHeight=o.printHeight;x.rowsHeight=0;x.lockeds=[];x.normals=[];x.rowIndex=0}else{o.fillGrids(u,m,x.pageFrame);o.commitPage({rowsHeight:x.rowsHeight});x.callback.call(x.scope);return}}if(v){r(x)}else{o.rowIteratorStep(r,x)}},fillGrids:function(j,k,i){var l=this,g=l.lockedColumnPages[l.columnPageIndex-1],h=!g||(g&&g.leftWidth);if(g){l.fillLockedGrid(j,true);l.removeHiddenLockedColumns(g)}if(h){l.fillNormalGrid(k,true);l.removeInvisibleEvents(-i.normalGridOffset,-i.normalGridOffset+i.normalGridWidth)}},buildPageFrame:function(m,s){var o=this,k=o.lockedColumnPages[m];if(k){o.lockedGrid.setWidth(o.showLockedColumns(k.start,k.end)+(k.startOffset||0));if(k.leftWidth){o.normalGrid.show()}else{o.normalGrid.hide()}}else{o.lockedGrid.setWidth(0);o.lockedGrid.hide();o.normalGrid.show()}var t=o.cloneElement(o.getComponent().body);t.normalGridOffset=s;t.lockedGridOffset=k&&k.startOffset||0;t.normalGridWidth=o.normalGrid.getWidth();t.lockedGridWidth=o.lockedGrid.getWidth();t.select(o.lockedBodySelector).first().dom.style.position="";t.select("#"+o.lockedView.id).first().dom.style.overflow="visible";if(!o.normalGrid.hidden){var l=t.select(o.normalBodySelector).first();l.dom.style.position="";l.dom.style.top="0px";var q=o.getNormalGridBody(t);var r=t.select("#"+o.normalView.headerCt.id).first();var p=t.select(".sch-secondary-canvas").first();var n=t.select("#"+o.normalView.id).first();q.dom.style.left=s+"px";r.dom.style.left=s+"px";r.dom.style.overflow="visible";p.dom.style.left=s+"px";n.dom.style.overflow="visible"}return t},buildPageFrames:function(h,j){var i=this;j=j||i;i.lockedColumnPages=i.calculateLockedColumnPages();var g=Math.ceil(i.getTotalWidth()/i.paperWidth),f=i.pageFrames=[];i.iterateAsync(function(b,c,a){if(c>=g){h.call(j,f);return}f.push(i.buildPageFrame(c,a));var d=i.lockedColumnPages[c];if(d){a-=d.leftWidth||0}else{a-=i.paperWidth}b(c+1,a)},i,0,0)},startPage:function(f,e){var d=this;if(e){if(d.columnPageIndex==1){d.pagesPerColumn=d.extractedPages.length}d.rowPageIndex=0;d.columnPageIndex++}d.rowPageIndex++;d.callParent(arguments);d.emptyNormalGrid();d.emptyLockedGrid()},commitPage:function(d){var c=this;c.callParent([Ext.apply({row:c.rowPageIndex,column:c.columnPageIndex},d)])},getExpectedPagesPerColumn:function(){return this.pagesPerColumn||Math.ceil((this.lockedRowsHeight||this.component.store.count()*this.component.getRowHeight())/this.printHeight)},getExpectedColumnsNumber:function(){return this.pageFrames?this.pageFrames.length:Math.ceil((this.lockedGrid.getWidth()+this.ticks.length*this.view.timeAxisViewModel.getTickWidth())/this.paperWidth)},getExpectedNumberOfPages:function(){return this.getExpectedColumnsNumber()*this.getExpectedPagesPerColumn()},calculateLockedColumnPages:function(){var k=this,i=[],p=k.lockedColumns,n=k.paperWidth,l;for(var m=0,o=p.length;m<o;m++){var q=p[m],r=q.width;l=l||{start:m,end:m};n-=r;if(n<0){i.push(l);if(n){l={start:m,end:m}}n=k.paperWidth-r+n}else{l.end=m}}if(l){l.leftWidth=n;i.push(l)}return i},getPageTplData:function(b){return Ext.apply(this.callParent(arguments),{title:b.number+" of "+this.numberOfPages+" (column: "+b.column+", row: "+b.row+")"})},showLockedColumns:function(l,j){var k=this,h=k.lockedColumns,m=0;l=l||0;j=j||h.length-1;for(var i=0;i<h.length;i++){var n=h[i];if(i>=l&&i<=j){n.column.show();m+=n.width}else{n.column.hide()}}return m},removeInvisibleEvents:function(q,k){var i=this,o=i.getNormalGridBody(),n=i.normalView.eventCls;var r=o.select("."+n).elements;for(var l=0;l<r.length;l++){var p=parseInt(r[l].style.left,10),m=p+parseInt(r[l].style.width,10);if(m<q||p>k){i.removeNode(r[l])}}},removeHiddenLockedColumns:function(s){var l=this,m=l.getCurrentPage(),t=l.getLockedGridBody();for(var o=0;o<l.lockedColumns.length;o++){var r=l.lockedColumns[o].column;if(o<s.start||o>s.end){var q="#"+r.getId();var n=m.select(q);l.removeNode(n);var p=r.getCellSelector();var i=t.select(p);l.removeNode(i)}}},fitComponentIntoPage:function(){var b=this;b.getComponent().setWidth(b.paperWidth)},restoreComponentState:function(){this.callParent(arguments);this.showLockedColumns()},setComponent:function(){var c=this,d=c.lockedColumns=[];c.callParent(arguments);c.lockedGrid.headerCt.items.each(function(a){if(!a.hidden){d.push({column:a,width:a.getWidth()})}})}});Ext.define("Sch.plugin.exporter.MultiPageVertical",{extend:"Sch.plugin.exporter.AbstractExporter",config:{exporterId:"multipagevertical"},minRowHeight:20,visibleColumns:null,visibleColumnsWidth:0,onRowsCollected:function(d,e){var f=this;f.iterateAsync(function(o,c){if(c===d.length){f.onPagesExtracted();return}var n=c,p=f.printHeight,a=0,q=[],b=[],m,r=false;f.startPage();while(!r&&n<d.length){m=e[n];p-=m.height;if(p>0){a+=m.height;q.push(d[n]);b.push(m);n++}else{r=true}}f.fillGrids(q,b);f.commitPage({rowIndex:n,rowsHeight:a});o(n)},f,0)},startPage:function(){var c=this;c.callParent(arguments);var d=c.getCurrentPage().select("#"+c.lockedView.id).first();d.dom.style.overflow="visible"},getExpectedNumberOfPages:function(){return Math.ceil(this.lockedRowsHeight/this.printHeight)},setComponent:function(){var c=this,d=c.visibleColumns=[];c.callParent(arguments);c.visibleColumnsWidth=0;c.lockedGrid.headerCt.items.each(function(a){if(!a.hidden){d.push({column:a,width:a.getWidth()});c.visibleColumnsWidth+=a.getWidth()}})},fitComponentIntoPage:function(){var n=this,m=n.getComponent(),o=m.normalGrid,t=m.lockedGrid,q=n.getTotalWidth(),l=n.ticks,r=n.timeColumnWidth||n.restoreSettings.columnWidth;var s=Math.floor((n.visibleColumnsWidth/q)*n.paperWidth);var u=Math.floor((l.length*r/q)*n.paperWidth);var p=Math.floor(u/l.length);var v=(p/r)*n.getRowHeight();n.view.setRowHeight(v<n.minRowHeight?n.minRowHeight:v);m.setWidth(n.paperWidth);o.setWidth(u);t.setWidth(s);n.fitLockedColumnWidth(s);m.setTimeColumnWidth(p)},fitLockedColumnWidth:function(f){var e=this.visibleColumns;if(e.length){var g=f/e.length;for(var h=0;h<e.length;h++){e[h].column.setWidth(g)}this._restoreColumnWidth=true}},restoreComponentState:function(){this.callParent(arguments);if(this._restoreColumnWidth){var d=this.visibleColumns;for(var f=0;f<d.length;f++){var e=d[f];e.column.setWidth(e.width);e.column.show()}}}});Ext.define("Sch.plugin.Export",{extend:"Ext.util.Observable",alternateClassName:"Sch.plugin.PdfExport",alias:"plugin.scheduler_export",mixins:["Ext.AbstractPlugin","Sch.mixin.Localizable"],requires:["Ext.XTemplate","Sch.plugin.exporter.SinglePage","Sch.plugin.exporter.MultiPage","Sch.plugin.exporter.MultiPageVertical"],lockableScope:"top",pageSizes:{A5:{width:5.8,height:8.3},A4:{width:8.3,height:11.7},A3:{width:11.7,height:16.5},Letter:{width:8.5,height:11},Legal:{width:8.5,height:14}},DPI:72,printServer:undefined,timeout:60000,headerTpl:null,headerTplDataFn:null,headerTplDataFnScope:null,tpl:null,footerTpl:null,footerTplDataFn:null,footerTplDataFnScope:null,exportDialogClassName:"Sch.widget.ExportDialog",exportDialogConfig:{},exporterConfig:null,exportConfig:{format:"A4",orientation:"portrait",range:"complete",showHeader:true,showFooter:false},expandAllBeforeExport:false,translateURLsToAbsolute:true,openAfterExport:true,beforeExport:Ext.emptyFn,afterExport:Ext.emptyFn,fileFormat:"pdf",defaultExporter:"multipage",exporters:undefined,callbacks:undefined,constructor:function(d){var c=this;d=d||{};c.exportersIndex={};if(d.exportDialogConfig){Ext.Object.each(this.exportConfig,function(g,h,a){var b=d.exportDialogConfig[g];if(b){a[g]=b}})}c.callParent([d]);c.setFileFormat(c.fileFormat);if(!c.exporters){c.exporters=c.buildExporters()}c.initExporters();c.bindExporters()},init:function(d){var c=this;d.showExportDialog=Ext.Function.bind(c.showExportDialog,c);d.doExport=Ext.Function.bind(c.doExport,c);c.scheduler=d},initExporters:function(){var f=this,d=f.exporters;for(var e=0;e<d.length;e++){if(!(d[e] instanceof Sch.plugin.exporter.AbstractExporter)){d[e]=f.createExporter(d[e])}}},bindExporters:function(){var c=this.exporters;for(var d=0;d<c.length;d++){this.bindExporter(c[d])}},bindExporter:function(c){var d=this;d.mon(c,{commitpage:d.onPageCommit,collectrows:d.onRowCollected,scope:d})},unbindExporter:function(c){var d=this;d.mun(c,{commitpage:d.onPageCommit,collectrows:d.onRowCollected,scope:d})},buildExporters:function(){return["Sch.plugin.exporter.SinglePage","Sch.plugin.exporter.MultiPage","Sch.plugin.exporter.MultiPageVertical"]},getExporterConfig:function(h,e){var g=this;var f=Ext.apply({translateURLsToAbsolute:g.translateURLsToAbsolute,expandAllBeforeExport:g.expandAllBeforeExport,DPI:g.DPI},g.exporterConfig);if(g.headerTpl){f.headerTpl=g.headerTpl}if(g.headerTplDataFn){f.headerTplDataFn=g.headerTplDataFn;f.headerTplDataFnScope=g.headerTplDataFnScope}if(g.tpl){f.tpl=g.tpl}if(g.footerTpl){f.footerTpl=g.footerTpl}if(g.footerTplDataFn){f.footerTplDataFn=g.footerTplDataFn;f.footerTplDataFnScope=g.footerTplDataFnScope}return f},createExporter:function(e,f){var h=this,g=h.getExporterConfig(e,f);if(Ext.isObject(e)){return Ext.create(Ext.apply(g,e))}else{return Ext.create(e,Ext.apply(g,f))}},registerExporter:function(c,d){if(!(c instanceof Sch.plugin.exporter.AbstractExporter)){c=this.createExporter.apply(this,arguments)}this.exporters.push(c);this.bindExporter(c)},getExporter:function(c){if(!c){return}var d=this.exportersIndex[c];if(d){return d}d=this.exportersIndex[c]=Ext.Array.findBy(this.exporters,function(a){return a.getExporterId()==c});return d},getExporters:function(){return this.exporters},setFileFormat:function(b){if(typeof b!=="string"){this.fileFormat="pdf"}else{b=b.toLowerCase();if(b==="png"){this.fileFormat=b}else{this.fileFormat="pdf"}}},showExportDialog:function(){var c=this,d=c.scheduler.getSchedulingView();if(c.win){c.win.destroy();c.win=null}c.win=Ext.create(c.exportDialogClassName,{plugin:c,exportDialogConfig:Ext.apply({startDate:c.scheduler.getStart(),endDate:c.scheduler.getEnd(),rowHeight:d.timeAxisViewModel.getViewRowHeight(),columnWidth:d.timeAxisViewModel.getTickWidth(),defaultExporter:c.defaultExporter,exporters:c.exporters,exportConfig:c.exportConfig},c.exportDialogConfig)});c.win.show()},getExportConfig:function(d){var f=this;var e=Ext.apply({fileFormat:f.fileFormat,exporterId:f.defaultExporter,beforeExport:Ext.Function.bind(f.beforeExport,f),afterExport:Ext.Function.bind(f.afterExport,f)},d,f.exportConfig);e.DPI=e.DPI||f.DPI;e.pageSize=Ext.apply({},f.pageSizes[e.format]);e.pageSize.width*=e.DPI;e.pageSize.height*=e.DPI;return e},doExport:function(o,k,j,n){var m=this,p=m.scheduler,i=m.getExportConfig(o);m.callbacks={success:k||Ext.emptyFn,failure:j||Ext.emptyFn,scope:n||m};var l=m.exporter=m.getExporter(i.exporterId);if(l&&m.fireEvent("beforeexport",p,l,i)!==false){m.mask();m.exporter.extractPages(p,i,function(a){m.fireEvent("updateprogressbar",0.8,this.L("requestingPrintServer"));m.doRequest(a,i)},m)}},onRowCollected:function(h,g,e,f){this.fireEvent("updateprogressbar",0.2*(e+1)/f,Ext.String.format(this.L("fetchingRows"),e+1,f))},onPageCommit:function(g,h,e,f){f=Math.max(e,f);this.fireEvent("updateprogressbar",0.2+0.6*e/f,Ext.String.format(this.L("builtPage"),e,f))},onExportSuccess:function(h){var j=this,i=j.getWin(),k=j.callbacks,l=k&&k.success,g=k&&k.scope||j;j.fireEvent("updateprogressbar",1);j.unmask();l&&l.apply(g,arguments);setTimeout(function(){j.fireEvent("hidedialogwindow",h);if(j.openAfterExport){window.open(h.url,"ExportedPanel")}},i?i.hideTime:3000)},onExportFailure:function(k,i){var l=this,j=this.getWin(),m=l.callbacks,n=m&&m.failure,h=m&&m.scope||l;n&&n.call(h,k);l.fireEvent("showdialogerror",j,k,i);l.unmask()},doRequest:function(r,q){var m=this,l=m.scheduler;if(!m.test&&!m.debug){if(m.printServer){var i={type:"POST",url:m.printServer,timeout:m.timeout,params:Ext.apply({html:{array:Ext.JSON.encode(r)},startDate:l.getStartDate(),endDate:l.getEndDate(),format:m.exporter.getPaperFormat(),orientation:q.orientation,range:q.range,fileFormat:m.fileFormat},this.getParameters()),success:m.onRequestSuccess,failure:m.onRequestFailure,scope:m};Ext.apply(i,this.getAjaxConfig(i));Ext.Ajax.request(i)}else{m.onExportFailure("Print server URL is not defined, please specify printServer config")}}else{if(m.debug){var p=r||[];for(var n=0,o=p.length;n<o;n++){var k=window.open();k.document.write(p[n].html);k.document.close()}}m.onExportSuccess(m.testResponse||{success:true,url:"foo",htmlArray:r})}},onRequestSuccess:function(e){var h=this,f;try{f=Ext.JSON.decode(e.responseText)}catch(g){h.onExportFailure("Wrong server response received");return}if(f.success){h.onExportSuccess(f)}else{h.onExportFailure(f.msg,f)}},onRequestFailure:function(e){var d=this,f=e.status===200?e.responseText:e.statusText;d.onExportFailure(f,e)},getParameters:function(){return{}},getAjaxConfig:function(b){return{}},getWin:function(){return this.win||null},mask:function(){var b=Ext.getBody().mask();b.addCls("sch-export-mask")},unmask:function(){Ext.getBody().unmask()},destroy:function(){this.callParent(arguments);if(this.win){this.win.destroy()}}});Ext.define("Sch.plugin.Lines",{extend:"Sch.feature.AbstractTimeSpan",alias:"plugin.scheduler_lines",cls:"sch-timeline",showTip:true,innerTpl:null,prepareTemplateData:null,side:null,init:function(d){if(Ext.isString(this.innerTpl)){this.innerTpl=new Ext.XTemplate(this.innerTpl)}this.side=d.rtl?"right":"left";var c=this.innerTpl;if(!this.template){this.template=new Ext.XTemplate('<tpl for=".">','<div id="{id}" '+(this.showTip?'title="{[this.getTipText(values)]}" ':"")+'class="{$cls}" style="'+this.side+':{left}px;top:{top}px;height:{height}px;width:{width}px">'+(c?"{[this.renderInner(values)]}":"")+"</div>","</tpl>",{getTipText:function(a){return d.getSchedulingView().getFormattedDate(a.Date)+" "+(a.Text||"")},renderInner:function(a){return c.apply(a)}})}this.callParent(arguments)},generateMarkup:function(c,d){return this.schedulerView.getMode()==="calendar"?"":this.callParent(arguments)},generateHeaderMarkup:function(c,d){return this.schedulerView.getMode()==="calendar"?"":this.callParent(arguments)},getElementData:function(w,l,E){var H=this.store,y=this.schedulerView,s=y.isHorizontal(),B=E||H.getRange(),z=[],i,G,u=y.getTimeSpanRegion(w,null,this.expandToFitView),x,F,C;if(Ext.versions.touch){i="100%"}else{i=s?u.bottom-u.top:1}G=s?1:u.right-u.left;for(var A=0,D=B.length;A<D;A++){x=B[A];F=x.get("Date");if(F&&Sch.util.Date.betweenLesser(F,w,l)){var v=y.getCoordinateFromDate(F);C=Ext.apply({},this.getTemplateData(x));C.id=this.getElementId(x);C.$cls=this.getElementCls(x,C);C.width=G;C.height=i;if(s){C.left=v}else{C.top=v}z.push(C)}}return z},getHeaderElementData:function(t){var v=this.timeAxis.getStart(),l=this.timeAxis.getEnd(),i=this.schedulerView.isHorizontal(),p=[],o,u,n,r;t=t||this.store.getRange();for(var q=0,s=t.length;q<s;q++){o=t[q];u=o.get("Date");if(u&&Sch.util.Date.betweenLesser(u,v,l)){n=this.getHeaderElementPosition(u);r=this.getTemplateData(o);r=Ext.apply({side:i?this.side:"top",cls:this.getHeaderElementCls(o,r),position:n},r);r.id=this.getHeaderElementId(o);p.push(r)}}return p}});Ext.define("Sch.plugin.CurrentTimeLine",{extend:"Sch.plugin.Lines",alias:"plugin.scheduler_currenttimeline",mixins:["Sch.mixin.Localizable"],requires:["Ext.data.JsonStore"],updateInterval:60000,showHeaderElements:true,autoUpdate:true,expandToFitView:true,timer:null,init:function(f){if(Ext.getVersion("touch")){this.showHeaderElements=false}var d=new Ext.data.JsonStore({fields:["Date","Cls","Text"],data:[{Date:new Date(),Cls:"sch-todayLine",Text:this.L("tooltipText")}]});var e=d.first();if(this.autoUpdate){this.timer=setInterval(function(){e.set("Date",new Date())},this.updateInterval)}this.store=d;this.callParent(arguments)},destroy:function(){if(this.timer){clearInterval(this.timer);this.timer=null}if(this.store.autoDestroy){this.store.destroy()}this.callParent(arguments)}});Ext.define("Sch.plugin.DragSelector",{extend:"Sch.util.DragTracker",alias:"plugin.scheduler_dragselector",mixins:["Ext.AbstractPlugin"],requires:["Sch.util.ScrollManager"],lockableScope:"top",schedulerView:null,eventData:null,sm:null,proxy:null,bodyRegion:null,constructor:function(b){b=b||{};Ext.applyIf(b,{onBeforeStart:this.onBeforeStart,onStart:this.onStart,onDrag:this.onDrag,onEnd:this.onEnd});this.callParent(arguments)},init:function(c){var d=this.schedulerView=c.getSchedulingView();d.on({afterrender:this.onSchedulingViewRender,scope:this})},onBeforeStart:function(b){return !b.getTarget(".sch-event")&&b.ctrlKey},onStart:function(d){var f=this.schedulerView;this.proxy.show();this.bodyRegion=f.getScheduleRegion();var e=[];f.getEventNodes().each(function(a){e[e.length]={region:a.getRegion(),node:a.dom}});this.eventData=e;this.sm.deselectAll();Sch.util.ScrollManager.activate(f)},onDrag:function(l){var k=this.sm,n=this.eventData,e=this.getRegion().constrainTo(this.bodyRegion),p,o,i,m;this.proxy.setBox(e);for(p=0,i=n.length;p<i;p++){o=n[p];m=e.intersect(o.region);if(m&&!o.selected){o.selected=true;k.selectNode(o.node,true)}else{if(!m&&o.selected){o.selected=false;k.deselectNode(o.node)}}}},onEnd:function(b){if(this.proxy){this.proxy.setDisplayed(false)}Sch.util.ScrollManager.deactivate()},onSchedulingViewRender:function(b){this.sm=b.getEventSelectionModel();this.initEl(this.schedulerView.el);this.proxy=b.el.createChild({cls:"sch-drag-selector"})},destroy:function(){if(this.proxy){Ext.destroy(this.proxy)}this.callParent(arguments)}});Ext.define("Sch.plugin.EventEditor",{extend:"Ext.form.Panel",mixins:["Ext.AbstractPlugin","Sch.mixin.Localizable"],alias:["widget.eventeditor","plugin.scheduler_eventeditor"],lockableScope:"normal",requires:["Sch.util.Date","Ext.util.Region","Ext.form.Label","Ext.form.field.Date","Ext.form.field.Time"],hideOnBlur:true,startDateField:null,startTimeField:null,durationField:null,timeConfig:null,dateConfig:null,durationConfig:null,durationUnit:null,durationText:null,triggerEvent:"eventdblclick",fieldsPanelConfig:null,dateFormat:"Y-m-d",timeFormat:"H:i",cls:"sch-eventeditor",border:false,shadow:false,dynamicForm:true,eventRecord:null,hidden:true,collapsed:true,currentForm:null,schedulerView:null,resourceRecord:null,preventHeader:true,floating:true,hideMode:"offsets",ignoreCls:"sch-event-editor-ignore-click",readOnly:false,layout:{type:"vbox",align:"stretch"},dragProxyEl:null,constrain:false,constructor:function(b){b=b||{};Ext.apply(this,b);this.durationUnit=this.durationUnit||Sch.util.Date.HOUR;this.callParent(arguments)},initComponent:function(){if(!this.fieldsPanelConfig){throw"Must define a fieldsPanelConfig property"}Ext.apply(this,{fbar:this.buttons||this.buildButtons(),items:[{xtype:"container",layout:"hbox",height:35,border:false,cls:"sch-eventeditor-timefields",items:this.buildDurationFields()},Ext.applyIf(this.fieldsPanelConfig,{flex:1,activeItem:0})]});this.callParent(arguments)},init:function(b){this.ownerCt=b;this.schedulerView=b.getView();this.eventStore=this.schedulerView.getEventStore();this.schedulerView.on({afterrender:this.onSchedulerRender,dragcreateend:this.onDragCreateEnd,scope:this});this.schedulerView.on("eventrepaint",this.onEventRepaint,this);if(this.triggerEvent){this.schedulerView.on(this.triggerEvent,this.onActivateEditor,this)}this.schedulerView.registerEventEditor(this)},onSchedulerRender:function(){this.render(Ext.getBody());if(this.hideOnBlur){this.mon(Ext.getDoc(),"mousedown",this.onMouseDown,this)}},show:function(l,j){var k=this.schedulerView.isReadOnly();if(k!==this.readOnly){Ext.Array.forEach(this.query("field"),function(a){a.setReadOnly(k)});this.saveButton.setVisible(!k);this.deleteButton.setVisible(!k);this.readOnly=k}if(this.deleteButton){this.deleteButton.setVisible(!k&&this.eventStore.indexOf(l)>=0)}this.eventRecord=l;this.durationField.setValue(Sch.util.Date.getDurationInUnit(l.getStartDate(),l.getEndDate(),this.durationUnit,true));var n=l.getStartDate();this.startDateField.setValue(n);this.startTimeField.setValue(n);var m=this.schedulerView.up("[floating=true]");if(m){this.getEl().setZIndex(m.getEl().getZIndex()+1);m.addCls(this.ignoreCls)}this.callParent();j=j||this.schedulerView.getElementsFromEventRecord(l)[0];this.alignTo(j,this.schedulerView.getMode()=="horizontal"?"bl":"tl-tr",this.getConstrainOffsets(j));this.expand(!this.constrain);if(this.constrain){this.doConstrain(Ext.util.Region.getRegion(Ext.getBody()))}var p,o=l.get("EventType");if(o&&this.dynamicForm){var q=this.items.getAt(1),r=q.query("> component[EventType="+o+"]");if(!r.length){throw"Can't find form for EventType="+o}if(!q.getLayout().setActiveItem){throw"Can't switch active component in the 'fieldsPanel'"}p=r[0];if(!(p instanceof Ext.form.Panel)){throw"Each child component of 'fieldsPanel' should be a 'form'"}q.getLayout().setActiveItem(p)}else{p=this}this.currentForm=p;p.getForm().loadRecord(l)},getConstrainOffsets:function(b){return[0,0]},onSaveClick:function(){var j=this,l=j.eventRecord,r=j.currentForm.getForm();if(r.isValid()&&j.fireEvent("beforeeventsave",j,l)!==false){var p=j.startDateField.getValue(),k,q=j.startTimeField.getValue(),n=j.durationField.getValue();if(p&&n>=0){if(q){Sch.util.Date.copyTimeValues(p,q)}k=Sch.util.Date.add(p,j.durationUnit,n)}else{return}if(!j.schedulerView.allowOverlap){var o=l.getResources(j.eventStore);var m=false;o=o.length>0?o:[j.resourceRecord];Ext.each(o,function(a){return m=!j.schedulerView.isDateRangeAvailable(p,k,l,a)});if(m){return}}j.schedulerView.un("eventrepaint",j.onEventRepaint,j);j.onBeforeSave(l);l.beginEdit();r.updateRecord(l);l.setStartEndDate(p,k);l.endEdit();if(j.eventStore.indexOf(j.eventRecord)<0){if(j.schedulerView.fireEvent("beforeeventadd",j.schedulerView,l)!==false){j.eventStore.append(l)}}j.onAfterSave(l);j.collapse(null,true);j.schedulerView.on("eventrepaint",j.onEventRepaint,j)}},onBeforeSave:function(b){},onAfterSave:function(b){},onDeleteClick:function(){if(this.fireEvent("beforeeventdelete",this,this.eventRecord)!==false){this.eventStore.remove(this.eventRecord)}this.collapse(null,true)},onCancelClick:function(){this.collapse(null,true)},buildButtons:function(){this.saveButton=new Ext.Button({text:this.L("saveText"),scope:this,handler:this.onSaveClick});this.deleteButton=new Ext.Button({text:this.L("deleteText"),scope:this,handler:this.onDeleteClick});this.cancelButton=new Ext.Button({text:this.L("cancelText"),scope:this,handler:this.onCancelClick});return[this.saveButton,this.deleteButton,this.cancelButton]},buildDurationFields:function(){this.startDateField=new Ext.form.field.Date(Ext.apply({width:90,allowBlank:false,format:this.dateFormat},this.dateConfig||{}));this.startDateField.getPicker().addCls(this.ignoreCls);this.startTimeField=new Ext.form.field.Time(Ext.apply({width:70,allowBlank:false,format:this.timeFormat},this.timeConfig||{}));this.startTimeField.getPicker().addCls(this.ignoreCls);this.durationField=new Ext.form.field.Number(Ext.apply({width:45,value:0,minValue:0,allowNegative:false},this.durationConfig||{}));this.durationLabel=new Ext.form.Label({text:this.getDurationText()});return[this.startDateField,this.startTimeField,this.durationField,this.durationLabel]},onActivateEditor:function(c,d){this.show(d)},onMouseDown:function(b){if(this.collapsed||b.within(this.getEl())||b.getTarget("."+this.ignoreCls,9)||b.getTarget(this.schedulerView.eventSelector)){return}this.collapse()},onDragCreateEnd:function(j,e,i,h,g){this.dragProxyEl=g;this.resourceRecord=i;this.schedulerView.onEventCreated(e);this.show(e,this.dragProxyEl)},hide:function(){this.callParent(arguments);var b=this.dragProxyEl;if(b){b.hide()}},afterCollapse:function(){this.hide();this.callParent(arguments)},getDurationText:function(){if(this.durationText){return this.durationText}return Sch.util.Date.getShortNameOfUnit(Sch.util.Date.getNameOfUnit(this.durationUnit))},onEventRepaint:function(c,d){if(!this.getCollapsed()&&d===this.eventRecord){this.show(d)}}});Ext.define("Sch.plugin.EventTools",{extend:"Ext.Container",mixins:["Ext.AbstractPlugin"],lockableScope:"top",alias:"plugin.scheduler_eventtools",hideDelay:500,align:"right",defaults:{xtype:"tool",baseCls:"sch-tool",overCls:"sch-tool-over",width:20,height:20,visibleFn:Ext.emptyFn},hideTimer:null,lastPosition:null,cachedSize:null,offset:{x:0,y:1},autoRender:true,floating:true,hideMode:"offsets",hidden:true,getRecord:function(){return this.record},init:function(b){if(!this.items){throw"Must define an items property for this plugin to function correctly"}this.addCls("sch-event-tools");this.scheduler=b;b.on({eventresizestart:this.onOperationStart,eventresizeend:this.onOperationEnd,eventdragstart:this.onOperationStart,eventdrop:this.onOperationEnd,eventmouseenter:this.onEventMouseEnter,eventmouseleave:this.onContainerMouseLeave,scope:this})},onRender:function(){this.callParent(arguments);this.scheduler.mon(this.el,{mouseenter:this.onContainerMouseEnter,mouseleave:this.onContainerMouseLeave,scope:this})},onEventMouseEnter:function(l,j,m){var p=false;var k;this.record=j;this.items.each(function(a){k=a.visibleFn(j)!==false;a.setVisible(k);if(k){p=true}},this);if(!p){return}if(!this.rendered){this.doAutoRender()}var n=m.getTarget(l.eventSelector);var o=Ext.fly(n).getBox();this.doLayout();var i=this.getSize();this.lastPosition=[m.getXY()[0]-(i.width/2),o.y-i.height-this.offset.y];this.onContainerMouseEnter()},onContainerMouseEnter:function(){window.clearTimeout(this.hideTimer);this.setPosition.apply(this,this.lastPosition);this.show()},onContainerMouseLeave:function(){window.clearTimeout(this.hideTimer);this.hideTimer=Ext.defer(this.hide,this.hideDelay,this)},onOperationStart:function(){this.scheduler.un("eventmouseenter",this.onEventMouseEnter,this);window.clearTimeout(this.hideTimer);this.hide()},onOperationEnd:function(){this.scheduler.on("eventmouseenter",this.onEventMouseEnter,this)}});Ext.define("Sch.plugin.Pan",{extend:"Ext.AbstractPlugin",alias:"plugin.scheduler_pan",lockableScope:"top",enableVerticalPan:true,statics:{KEY_SHIFT:1,KEY_CTRL:2,KEY_ALT:4,KEY_ALL:7},disableOnKey:0,constructor:function(b){Ext.apply(this,b)},init:function(b){if(Ext.supports.Touch){return}this.view=b.getSchedulingView();this.view.on("afterrender",this.onRender,this)},onRender:function(b){this.view.el.on("mousedown",this.onMouseDown,this)},onMouseDown:function(g,h){var e=this.self,f=this.disableOnKey;if((g.shiftKey&&(f&e.KEY_SHIFT))||(g.ctrlKey&&(f&e.KEY_CTRL))||(g.altKey&&(f&e.KEY_ALT))){return}if(g.getTarget("."+this.view.timeCellCls,10)&&!g.getTarget(this.view.eventSelector)){this.mouseX=g.getX();this.mouseY=g.getY();Ext.getBody().on("mousemove",this.onMouseMove,this);Ext.getDoc().on("mouseup",this.onMouseUp,this);if(Ext.isIE||Ext.isGecko){Ext.getBody().on("mouseenter",this.onMouseUp,this)}g.stopEvent()}},onMouseMove:function(i){i.stopEvent();var g=i.getX();var h=i.getY();var e=0,j=this.mouseX-g;if(this.enableVerticalPan){e=this.mouseY-h}this.mouseX=g;this.mouseY=h;this.view.scrollBy(j,e,false)},onMouseUp:function(b){Ext.getBody().un("mousemove",this.onMouseMove,this);Ext.getDoc().un("mouseup",this.onMouseUp,this);if(Ext.isIE||Ext.isGecko){Ext.getBody().un("mouseenter",this.onMouseUp,this)}}});Ext.define("Sch.plugin.SimpleEditor",{extend:"Ext.Editor",alias:"plugin.scheduler_simpleeditor",requires:["Ext.form.TextField"],mixins:["Ext.AbstractPlugin","Sch.mixin.Localizable"],lockableScope:"top",cls:"sch-simpleeditor",allowBlur:false,delegate:".sch-event-inner",dataIndex:null,completeOnEnter:true,cancelOnEsc:true,ignoreNoChange:true,height:19,dragProxyEl:null,newEventText:null,autoSize:{width:"boundEl"},initComponent:function(){this.field=this.field||{xtype:"textfield",selectOnFocus:true};this.callParent(arguments)},init:function(b){this.scheduler=b.getSchedulingView();b.on("afterrender",this.onSchedulerRender,this);this.scheduler.registerEventEditor(this);this.dataIndex=this.dataIndex||this.scheduler.getEventStore().model.prototype.nameField},edit:function(d,c){c=c||this.scheduler.getElementsFromEventRecord(d)[0];this.startEdit(c.child(this.delegate));this.realign();this.record=d;this.setValue(this.record.get(this.dataIndex))},onSchedulerRender:function(b){this.on({startedit:this.onStartEdit,complete:function(h,g,i){var a=this.record;var j=this.scheduler.eventStore;a.set(this.dataIndex,g);if(j.indexOf(a)<0){if(this.scheduler.fireEvent("beforeeventadd",this.scheduler,a)!==false){j.append(a)}}this.onAfterEdit()},canceledit:this.onAfterEdit,hide:function(){if(this.dragProxyEl){this.dragProxyEl.hide()}},scope:this});b.on({eventdblclick:function(a,f,e){if(!b.isReadOnly()){this.edit(f)}},dragcreateend:this.onDragCreateEnd,scope:this})},onStartEdit:function(){if(!this.allowBlur){Ext.getBody().on("mousedown",this.onMouseDown,this);this.scheduler.on("eventmousedown",function(){this.cancelEdit()},this)}},onAfterEdit:function(){if(!this.allowBlur){Ext.getBody().un("mousedown",this.onMouseDown,this);this.scheduler.un("eventmousedown",function(){this.cancelEdit()},this)}},onMouseDown:function(c,d){if(this.editing&&this.el&&!c.within(this.el)){this.cancelEdit()}},onDragCreateEnd:function(j,e,i,h,g){this.dragProxyEl=g;this.scheduler.onEventCreated(e);if(e.get(this.dataIndex)===""){e.set(this.dataIndex,this.newEventText||this.L("newEventText"))}this.edit(e,this.dragProxyEl)}});Ext.define("Sch.plugin.Zones",{extend:"Sch.feature.AbstractTimeSpan",alias:"plugin.scheduler_zones",requires:["Sch.model.Range"],innerTpl:null,cls:"sch-zone",side:null,init:function(d){if(Ext.isString(this.innerTpl)){this.innerTpl=new Ext.XTemplate(this.innerTpl)}this.side=d.rtl?"right":"left";var c=this.innerTpl;if(!this.template){this.template=new Ext.XTemplate('<tpl for="."><div id="{id}" class="{$cls}" style="'+this.side+':{left}px;top:{top}px;height:{height}px;width:{width}px;{style}">'+(c?"{[this.renderInner(values)]}":"")+"</div></tpl>",{renderInner:function(a){return c.apply(a)}})}if(Ext.isString(this.innerHeaderTpl)){this.innerHeaderTpl=new Ext.XTemplate(this.innerHeaderTpl)}this.callParent(arguments)},getElementData:function(E,I,w,G){var F=this.schedulerView,l=[];var J=F.getTimeSpanRegion(E,I,this.expandToFitView);var K,C,L,D,A,H;w=w||this.store.getRange();for(var x=0,y=w.length;x<y;x++){K=w[x];C=K.getStartDate();L=K.getEndDate();H=this.getTemplateData(K);if(C&&L&&Sch.util.Date.intersectSpans(C,L,E,I)){D=Ext.apply({},H);D.id=this.getElementId(K);D.$cls=this.getElementCls(K,H);var B=F.getMode();if(B==="calendar"){var v=F.getTimeSpanRegion(C,L);D.left=v.left;D.top=v.top;D.height=v.bottom-v.top;D.width=v.right-v.left}else{var i=F.getCoordinateFromDate(Sch.util.Date.max(C,E));var z=F.getCoordinateFromDate(Sch.util.Date.min(L,I));if(B==="horizontal"){D.left=i;D.top=J.top;D.width=G?0:z-i;D.height=J.bottom-J.top;D.style=G?("border-left-width:"+(z-i)+"px"):""}else{D.left=J.left;D.top=i;D.height=G?0:z-i;D.width=J.right-J.left;D.style=G?("border-top-width:"+(z-i)+"px"):""}}l.push(D)}}return l},getHeaderElementId:function(c,d){return this.callParent([c])+(d?"-start":"-end")},getHeaderElementCls:function(e,g,f){var h=e.clsField||this.clsField;if(!g){g=this.getTemplateData(e)}return"sch-header-indicator sch-header-indicator-"+(f?"start ":"end ")+this.uniqueCls+" "+(g[h]||"")},getZoneHeaderElementData:function(q,k,m,r){var p=r?m.getStartDate():m.getEndDate(),n=null,l,j,o;if(p&&Sch.util.Date.betweenLesser(p,q,k)){l=this.getHeaderElementPosition(p);j=this.schedulerView.isHorizontal();o=this.getTemplateData(m);n=Ext.apply({id:this.getHeaderElementId(m,r),cls:this.getHeaderElementCls(m,o,r),isStart:r,side:j?this.side:"top",position:l},o)}return n},getHeaderElementData:function(q){var r=this.timeAxis.getStart(),k=this.timeAxis.getEnd(),n=[],l,o,i;q=q||this.store.getRange();for(var m=0,p=q.length;m<p;m++){l=q[m];o=this.getZoneHeaderElementData(r,k,l,true);if(o){n.push(o)}i=this.getZoneHeaderElementData(r,k,l,false);if(i){n.push(i)}}return n},updateZoneHeaderElement:function(d,c){d.dom.className=c.cls;if(this.schedulerView.isHorizontal()){this.setElementX(d,c.position)}else{d.setTop(c.position)}},updateHeaderElement:function(n){var i=this.timeAxis.getStart(),j=this.timeAxis.getEnd(),k=Ext.get(this.getHeaderElementId(n,true)),l=Ext.get(this.getHeaderElementId(n,false)),m=this.getZoneHeaderElementData(i,j,n,true),h=this.getZoneHeaderElementData(i,j,n,false);if(!(k&&h)||!(l&&h)){Ext.destroy(k,l);this.renderHeaderElementsInternal([n])}else{if(k){if(!m){Ext.destroy(k)}else{this.updateZoneHeaderElement(k,m)}}if(l){if(!h){Ext.destroy(l)}else{this.updateZoneHeaderElement(l,h)}}}}});Ext.define("Sch.plugin.TimeGap",{extend:"Sch.plugin.Zones",alias:"plugin.scheduler_timegap",requires:["Ext.data.JsonStore"],getZoneCls:Ext.emptyFn,init:function(b){this.store=new Ext.data.JsonStore({model:"Sch.model.Range"});this.scheduler=b;b.mon(b.eventStore,{load:this.populateStore,update:this.populateStore,remove:this.populateStore,add:this.populateStore,datachanged:this.populateStore,scope:this});b.on("viewchange",this.populateStore,this);this.schedulerView=b.getSchedulingView();this.callParent(arguments)},populateStore:function(r){var s=this.schedulerView.getEventsInView(),o=[],p=this.scheduler.getStart(),l=this.scheduler.getEnd(),q=s.getCount(),k=p,m,n=0,t;s.sortBy(function(a,b){return a.getStartDate()-b.getStartDate()});t=s.getAt(0);while(k<l&&n<q){m=t.getStartDate();if(!Sch.util.Date.betweenLesser(k,m,t.getEndDate())&&k<m){o.push(new this.store.model({StartDate:k,EndDate:m,Cls:this.getZoneCls(k,m)||""}))}k=Sch.util.Date.max(t.getEndDate(),k);n++;t=s.getAt(n)}if(k<l){o.push(new this.store.model({StartDate:k,EndDate:l,Cls:this.getZoneCls(k,l)||""}))}this.store.removeAll(o.length>0);this.store.add(o)}});Ext.define("Sch.plugin.TreeCellEditing",{extend:"Ext.grid.plugin.CellEditing",alias:"plugin.scheduler_treecellediting",lockableScope:"locked",editorsStarted:0,init:function(b){this._grid=b;this.on("beforeedit",this.onMyBeforeEdit,this);this.callParent(arguments)},showEditor:function(e){var d=this,f=e.field;if(!e._cancelEdit){e._cancelEdit=e.cancelEdit;e.cancelEdit=d.myCancelEdit}if(f.setSuppressTaskUpdate){f.setSuppressTaskUpdate(true)}this.callParent(arguments);if(f.setSuppressTaskUpdate){f.setSuppressTaskUpdate(false)}},checkReadOnly:function(){var b=this._grid;if(!(b instanceof Sch.panel.TimelineTreePanel)){b=b.up("tablepanel")}return !b.isReadOnly()},onEditComplete:function(e,g,f){var h=this;if(e.field.applyChanges){e.field.applyChanges(e.field.task||h.context.record);return h.callParent([e,g,g])}else{return h.callParent([e,g,f])}},myCancelEdit:function(){var e=this,g=e.field;if(g&&g.applyChanges){var h=g.instantUpdate;g.instantUpdate=true;var f=e._cancelEdit.apply(this,arguments);g.instantUpdate=h;return f}else{return e._cancelEdit.apply(this,arguments)}},onMyBeforeEdit:function(d,e){var f=e.column.getEditor();if(this.editing){this.completeEdit()}if(f){if(f.setTask){f.setTask(e.record);e.value=e.originalValue=f.getValue()}}return this.checkReadOnly()}});Ext.define("Sch.plugin.ResourceZones",{extend:"Sch.plugin.Zones",alias:"plugin.scheduler_resourcezones",innerTpl:null,store:null,cls:"sch-resourcezone",init:function(d){this.uniqueCls=this.uniqueCls||("sch-timespangroup-"+Ext.id());this.scheduler=d;d.registerRenderer(this.renderer,this);if(Ext.isString(this.innerTpl)){this.innerTpl=new Ext.XTemplate(this.innerTpl)}var c=this.innerTpl;if(!this.template){this.template=new Ext.XTemplate('<tpl for="."><div id="'+this.uniqueCls+'-{id}" class="'+this.cls+" "+this.uniqueCls+' {Cls}" style="'+(d.rtl?"right":"left")+':{start}px;width:{width}px;top:{start}px;height:{width}px;{style}">'+(c?"{[this.renderInner(values)]}":"")+"</div></tpl>",{renderInner:function(a){return c.apply(a)}})}this.storeListeners={load:this.fullRefresh,datachanged:this.fullRefresh,clear:this.fullRefresh,add:this.fullRefresh,remove:this.fullRefresh,update:this.refreshSingle,addrecords:this.fullRefresh,removerecords:this.fullRefresh,updaterecord:this.refreshSingle,scope:this};this.store.on(this.storeListeners)},destroy:function(){this.store.un(this.storeListeners);this.callParent(arguments)},fullRefresh:function(){this.scheduler.getSchedulingView().refresh()},renderer:function(h,e,f,g){if(this.scheduler.getOrientation()==="horizontal"||g===0){return this.renderZones(f)}return""},renderZones:function(z){var B=this.store,w=this.scheduler,u=w.timeAxis.getStart(),q=w.timeAxis.getEnd(),x=[],s=z.getEvents(B),i,A;for(var y=0,t=s.length;y<t;y++){var v=s[y];i=v.getStartDate();A=v.getEndDate();if(i&&A&&Sch.util.Date.intersectSpans(i,A,u,q)){var r=w.getSchedulingView()[w.getOrientation()].getEventRenderData(v);var C,D;if(w.getMode()==="horizontal"){C=w.rtl?r.right:r.left;D=r.width}else{C=r.top;D=r.height}x[x.length]=Ext.apply({id:v.internalId,start:C,width:D,Cls:v.getCls()},v.data)}}return this.template.apply(x)},refreshSingle:function(n,p){var t=Ext.get(this.uniqueCls+"-"+p.internalId);if(t){var r=this.scheduler,q=r.timeAxis.getStart(),m=r.timeAxis.getEnd();var u=Sch.util.Date.max(q,p.getStartDate()),s=Sch.util.Date.min(m,p.getEndDate()),l=p.getCls();var o=r.getSchedulingView().getCoordinateFromDate(u);var v=r.getSchedulingView().getCoordinateFromDate(s)-o;t.dom.className=this.cls+" "+this.uniqueCls+" "+(l||"");t.setStyle({left:o+"px",top:o+"px",height:v+"px",width:v+"px"})}}});Ext.define("Sch.plugin.HeaderZoom",{extend:"Sch.util.DragTracker",mixins:["Ext.AbstractPlugin"],alias:"plugin.scheduler_headerzoom",lockableScope:"top",scheduler:null,proxy:null,headerRegion:null,init:function(b){this.scheduler=b;this.onModeChange();b.on("modechange",this.onModeChange,this)},onOrientationChange:function(){return this.onModeChange.apply(this,arguments)},onModeChange:function(){var b=this.scheduler.down("timeaxiscolumn");if(b){if(b.rendered){this.onTimeAxisColumnRender(b)}else{b.on({afterrender:this.onTimeAxisColumnRender,scope:this})}}},onTimeAxisColumnRender:function(b){this.proxy=b.el.createChild({cls:"sch-drag-selector"});this.initEl(b.el)},onStart:function(b){this.proxy.show();this.headerRegion=this.scheduler.normalGrid.headerCt.getRegion()},onDrag:function(d){var f=this.headerRegion;var e=this.getRegion().constrainTo(f);e.top=f.top;e.bottom=f.bottom;this.proxy.setBox(e)},onEnd:function(i){if(this.proxy){this.proxy.setDisplayed(false);var e=this.scheduler;var k=e.timeAxis;var j=this.getRegion();var l=e.getSchedulingView().timeAxisViewModel.getBottomHeader().unit;var h=e.getSchedulingView().getStartEndDatesFromRegion(j);e.zoomToSpan({start:k.floorDate(h.start,false,l,1),end:k.ceilDate(h.end,false,l,1)})}},destroy:function(){if(this.proxy){Ext.destroy(this.proxy);this.proxy=null}this.callParent(arguments)}});Ext.define("Sch.plugin.CellPlugin",{extend:"Ext.AbstractPlugin",alias:"plugin.scheduler_cellplugin",requires:["Ext.form.field.Base"],mixins:{observable:"Ext.util.Observable"},frameCls:"sch-cellplugin-highlighter",frameTemplate:new Ext.Template(['<div class="{cls} active" style="width: {width}px; height: {height}px;">','<div class="sch-cellplugin-border sch-cellplugin-border-horizontal sch-cellplugin-border-top"></div>','<div class="sch-cellplugin-border sch-cellplugin-border-horizontal sch-cellplugin-border-bottom"></div>','<div class="sch-cellplugin-border sch-cellplugin-border-vertical sch-cellplugin-border-left"></div>','<div class="sch-cellplugin-border sch-cellplugin-border-vertical sch-cellplugin-border-right"></div>',"</div>"]),editor:"Sch.field.CellEditor",singleClickEditing:true,dblClickTimeout:100,clickTimer:[],editing:false,context:{},selContext:[],constructor:function(b){Ext.apply(this,b||{},{context:{},editing:false,tickIndex:null,resource:null,startDate:null,eventIndexInCell:-1,eventRecord:null});this.mixins.observable.constructor.call(this);this.callParent(arguments)},init:function(d){var c=this;c.view=d.getSchedulingView();c.lockedView=d.lockedGrid.getView();d.getNavigationModel().setPosition=Ext.emptyFn;c.timeAxisViewModel=d.timeAxisViewModel;c.tickCount=d.timeAxis.getCount();c.rowsCount=d.resourceStore.getCount();c.keyNav=new Ext.util.KeyNav({target:d.lockedGrid.view,eventName:"itemkeydown",processEvent:function(i,j,a,h,b){return b},ignoreInputFields:true,up:this.onKeyUp,down:this.onKeyDown,right:this.onKeyRight,left:this.onKeyLeft,tab:this.onKeyTab,enter:this.onKeyEnter,esc:this.onKeyEsc,scope:this});if(c.view.bufferedRenderer){c.view.on("afterrender",function(){c.view.el.on("scroll",c.onViewScroll,c)},c,{single:true});c.mon(c.view,"itemadd",c.onItemAdd,c)}c.mon(d,{headerclick:c.onContainerClick,zoomchange:c.destroyHighlighter,scope:c});c.mon(c.view,{containerclick:c.onContainerClick,scheduleclick:c.onCellClick,scheduledblclick:c.onCellDblClick,eventclick:c.onEventClick,eventdblclick:c.onEventDblClick,containerkeydown:c.onEditorKeyDown,groupcollapse:c.onGroupCollapse,groupexpand:c.onGroupExpand,scope:c});c.mon(c.timeAxisViewModel,{update:c.onViewModelUpdate,scope:c});c.mon(c.view.timeAxis,{beforereconfigure:c.onBeforeReconfigure,scope:c});c.mon(c.view.resourceStore,{load:c.onResourceLoad,add:c.onResourceAdd,remove:c.onResourceRemove,clear:c.destroyHighlighter,scope:c});c.mon(c.view.eventStore,{load:c.destroyHighlighter,scope:c});c.mon(c.lockedView,{cellclick:c.onLockedCellClick,beforeitemkeydown:c.onBeforeItemKeyDown,scope:c})},onEditorKeyDown:function(e,f,d){switch(f.getKey()){case f.TAB:f.preventDefault();if(f.shiftKey){this.moveLeft(f)}else{this.moveRight(f)}break;case f.ENTER:this.onEditorKeyEnter();break;case f.ESC:this.cancelEdit(f);break;default:break}},onEditorKeyEnter:function(){if(this.completeEdit()){this.beginEditBelow()}else{this.showEditorInCell(this.getEventOrCell(this.context,true))}},destroy:function(){this.keyNav.destroy()},destroyHighlighter:function(){var b=this;b.clearSelection();b.containerEl&&b.containerEl.destroy();delete b.containerEl;delete b.startDate;delete b.resource;delete b.resourceIndex;delete b.eventRecord;delete b.tickIndex},onGroupCollapse:function(){var b=this;b.rowsCount=b.view.getNodes().length;if(b.getResourceIndex()===-1){b.destroyHighlighter()}else{b.refreshCell()}},onGroupExpand:function(){var b=this;b.rowsCount=b.view.getNodes().length;b.refreshCell()},onViewScroll:function(){var c=this;if(c.containerEl){var d=Ext.get(c.view.getNodeByRecord(c.resource));if(d){c.containerEl.setY(d.getY()-1)}}},onItemAdd:function(){var c=this;if(!c.resource){return}var d=c.view.getNodeByRecord(c.resource);if(d){c.containerEl.show()}else{c.containerEl.hide()}},getResourceIndex:function(c){var d=this;c=c||d.resource;return d.view.dataSource.data.indexOf(c)},getResource:function(b){return this.view.dataSource.getAt(b)},onResourceLoad:function(d,e,f){if(f){this.rowsCount=e.length}},onResourceAdd:function(c,d){this.rowsCount+=d.length;this.refreshCell()},onResourceRemove:function(j,f,i,g){var h=this;h.rowsCount=j.getCount();if(h.rowsCount===0){h.destroyHighlighter()}if(Ext.Array.indexOf(f,h.resource)!==-1){h.destroyHighlighter()}h.refreshCell()},onBeforeReconfigure:function(b){if(!this.startDate&&Ext.isNumber(this.tickIndex)){this.startDate=b.getAt(this.tickIndex).getStartDate()}},onLockedCellClick:function(n,j,e,i,m,k,l){this.showEditorInCell({tickIndex:this.tickIndex||0,resourceIndex:k,eventIndexInCell:0},l)},onBeforeItemKeyDown:function(j,h,k,e,i,l){if(!i.isSpecialKey()){this.beginEdit()}},onViewModelUpdate:function(g){var e=this,h=g.timeAxis;e.tickCount=h.getCount();if(e.startDate){var f=h.getTickFromDate(e.startDate);if(f>=0){delete e.startDate;e.tickIndex=f;if(!e.containerEl){e.renderElement()}e.refreshCell()}else{e.containerEl.destroy();delete e.containerEl;e.clearSelection()}}else{e.refreshCell()}},refreshCell:function(){var c=this;var d=c.timeAxisViewModel.getTickWidth();if(c.containerEl){c.containerEl.setWidth(d);c.containerEl.setLeft(d);c.showEditorInCell({tickIndex:c.tickIndex,resourceIndex:c.getResourceIndex()})}if(c.editor instanceof Ext.form.field.Base){c.editor.setMaxWidth(d)}},clearSelection:function(){var b=this;b.view.getSecondaryCanvasEl().select("."+b.frameCls+".clone").remove();b.selContext=[]},addSelection:function(){var d=this;var c=d.frameTemplate.apply({cls:d.frameCls,width:d.containerEl.getWidth(),height:d.containerEl.getHeight()});c=Ext.get(Ext.DomHelper.append(d.containerEl.parent(),c));c.setStyle("top",d.containerEl.getStyle("top"));c.setStyle("left",d.containerEl.getStyle("left"));c.removeCls("active");c.addCls("clone");d.selContext.push(Ext.apply({},d.context))},renderElement:function(){var h=this;h.containerEl=h.view.getSecondaryCanvasEl();var i=h.timeAxisViewModel.getTickWidth();var g=h.timeAxisViewModel.getViewRowHeight();var j=h.frameTemplate.apply({cls:h.frameCls,width:i,height:g});h.containerEl=Ext.get(Ext.DomHelper.append(h.containerEl,j));var f={height:g,maxHeight:g,width:i,maxWidth:i,renderTo:h.containerEl};if(Ext.isObject(h.editor)&&!(h.editor instanceof Ext.Base)){h.editor=Ext.create(Ext.apply(f,h.editor,{xclass:"Sch.field.CellEditor"}))}else{if(Ext.isString(h.editor)){h.editor=Ext.create(h.editor,f)}else{h.containerEl.appendChild(h.editor.el)}}},onContainerClick:function(){var b=this;if(b.lockedView.getSelectionModel().getSelection().length>0){if(b.editor.isVisible&&b.editor.isVisible()){b.lockedView.getFocusEl().focus()}}},onCellClick:function(h,e,i,k,j){var l=this;l.clickTimer.push(setTimeout(function(){l.handleCellClick(h,e,i,k,j)},l.dblClickTimeout))},handleCellClick:function(i,n,j,l,k){var m=this;var e=Math.floor(m.view.timeAxis.getTickFromDate(n));if(m.fireEvent("cellclick",m,e,j)!==false){m.showEditorInCell({tickIndex:e,resourceIndex:j},k);if(m.singleClickEditing){m.beginEdit()}}},onCellDblClick:function(g,e,h,j,i){Ext.each(this.clickTimer,function(a){clearTimeout(a)});this.handleCellDblClick(g,e,h,j,i)},handleCellDblClick:function(i,n,j,l,k){var m=this;var e=Math.floor(m.view.timeAxis.getTickFromDate(n));if(m.fireEvent("celldblclick",m,e,j)!==false){m.showEditorInCell({tickIndex:e,resourceIndex:j},k);m.beginEdit()}},onEventClick:function(e,i,k){var l=this;var m=l.view.getDateFromDomEvent(k);var n=Math.floor(l.view.timeAxis.getTickFromDate(m));var j=l.view.dataSource.data.indexOf(i.getResource());l.showEditorInCell({tickIndex:n,resourceIndex:j,eventRecord:i},k)},onEventDblClick:function(e,i,k){var l=this;var m=l.view.getDateFromDomEvent(k);var n=Math.floor(l.view.timeAxis.getTickFromDate(m));var j=l.view.dataSource.data.indexOf(i.getResource());l.showEditorInCell({tickIndex:n,resourceIndex:j,eventRecord:i},k);l.beginEdit()},showEditorInCell:function(o,l){var k=this;var q="tickIndex" in o?o.tickIndex:k.tickIndex;var e="resourceIndex" in o?o.resourceIndex:k.resourceIndex;if(q===-1||e===-1){return}var n=k.view.timeAxis.getAt(q);var r=n.getStartDate();var m=n.getEndDate();var p=k.view.dataSource.getAt(e);if(l&&l.type==="click"&&!o.eventRecord){o.eventRecord=k.getCellEvents({startDate:r,endDate:m,resource:p}).getAt(0)}if(k.fireEvent("beforeselect",k,p,r,m,o.eventRecord)===false){return}k.onBeforeSelect(l);if(!k.containerEl){k.renderElement()}else{if(l&&l.ctrlKey){k.addSelection()}else{k.clearSelection()}}Ext.apply(k.context,{startDate:r,endDate:m,resource:p});if(o.eventRecord){k.context.eventRecord=o.eventRecord}else{delete k.context.eventRecord}k.tickIndex=q;k.resource=p;k.resourceIndex=e;k.eventIndexInCell=o.eventIndexInCell;if(o.eventRecord){k.alignEditorWithRecord(o.eventRecord,o.resource)}else{k.alignEditorWithCell()}k.onAfterSelect(l);k.fireEvent("select",k,p,r,m);k.fireEvent("selectionchange",k,k.getSelection())},alignEditorWithRecord:function(g,h){var i=this;var f=i.view.getElementsFromEventRecord(g,h),j=f[0].getBox();j.y--;j.x--;i.alignEditor(j)},alignEditorWithCell:function(){var c=this;var d=Ext.get(c.view.getRowByRecord(c.resource));d&&c.alignEditor({left:c.timeAxisViewModel.getTickWidth()*c.tickIndex,y:d.getTop()-1,height:d.getHeight(),width:c.timeAxisViewModel.getTickWidth()})},alignEditor:function(c){var d=this;d.containerEl.setY(c.y);if("x" in c){d.containerEl.setX(c.x)}else{d.containerEl.setLeft(c.left)}d.containerEl.setWidth(c.width);d.containerEl.setHeight(c.height);if(Ext.isIE8m){d.containerEl.setHeight(c.height+1);d.containerEl.setStyle("padding-top",1);d.containerEl.select(".sch-cellplugin-border-top").setStyle("top",1);d.containerEl.select(".sch-cellplugin-border-vertical").setHeight(c.height);d.containerEl.select(".sch-cellplugin-border-horizontal").setWidth(c.width)}else{if(Ext.isChrome){d.containerEl.select(".sch-cellplugin-border-vertical").setHeight(c.height)}}d.containerEl.show()},getSelection:function(){return this.selContext.concat(this.context)},getEventRecord:function(b){return b.eventRecord},getResourceRecord:function(b){return b.resource},onKeyUp:function(b){this.moveUp(b)},onKeyDown:function(b){this.moveDown(b)},onKeyLeft:function(b){this.moveLeft(b)},onKeyRight:function(b){this.moveRight(b)},onKeyTab:function(b){if(b.shiftKey){this.moveLeft(b)}else{this.moveRight(b)}},onKeyEnter:function(){this.beginEdit()},onKeyEsc:function(){this.destroyHighlighter()},findPreviousIndex:function(g){var h=this;var e=h.getResourceIndex();var f=h.view.walkRecs(h.resource,-1);if(f!==h.resource){return h.getResourceIndex(f)}else{return -1}},findNextIndex:function(g){var h=this;var e=h.getResourceIndex();var f=h.view.walkRecs(h.resource,1);if(f!==h.resource){return h.getResourceIndex(f)}else{return -1}},getCellEvents:function(d){var f=this;d=d||f.context;if(d.resourceIndex===-1||d.tickIndex===-1){return new Ext.util.MixedCollection()}var e=f.view.eventStore.queryBy(function(a){return a.getResourceId()===d.resource.getId()&&a.getStartDate()>=d.startDate&&a.getStartDate()<d.endDate});e.sortBy(function(b,c){var a=f.view.getElementsFromEventRecord(b,d.resource)[0],h=f.view.getElementsFromEventRecord(c,d.resource)[0];return a.getY()<h.getY()?-1:1});return e},getAbove:function(h){var g=this,f;h=h||g.context;if(h.eventRecord&&g.eventIndexInCell==null){g.eventIndexInCell=g.getCellEvents(h).indexOf(h.eventRecord)}if(g.eventIndexInCell>0){f=g.eventIndexInCell-1;return{eventIndexInCell:f,eventRecord:g.getCellEvents(h).getAt(f)}}var e=g.findPreviousIndex();if(e===-1){return{resourceIndex:-1}}return g.getEventOrCell(Ext.applyIf({resourceIndex:e},h),true)},getBelow:function(i){var h=this;i=i||h.context;if(i.eventRecord&&h.eventIndexInCell==null){h.eventIndexInCell=h.getCellEvents(i).indexOf(i.eventRecord)}if(h.eventIndexInCell>=0){var j=h.getCellEvents(i);var g=h.eventIndexInCell+1;if(j.getCount()>g){return{eventIndexInCell:g,eventRecord:j.getAt(g)}}}var f=h.findNextIndex();if(f===-1){return{resourceIndex:-1}}return h.getEventOrCell(Ext.applyIf({resourceIndex:f},i))},getEventOrCell:function(p,r){var l=this,m=-1,k=null,q=l.tickIndex,n=l.resourceIndex;if("tickIndex" in p){q=p.tickIndex;var o=l.view.timeAxis.getAt(q);p.startDate=o.getStartDate();p.endDate=o.getEndDate()}if("resourceIndex" in p){n=p.resourceIndex;p.resource=l.view.dataSource.getAt(n)}var j=l.getCellEvents(p);if(j.getCount()){if(r===true){m=j.getCount()-1;k=j.getAt(m)}else{m=0;k=j.getAt(0)}}return{tickIndex:q,resourceIndex:n,eventIndexInCell:m,eventRecord:k}},getPrevious:function(e){var d=this;e=e||d.context;var f=d.getResourceIndex();if(d.tickIndex>0){return d.getEventOrCell(Ext.applyIf({tickIndex:d.tickIndex-1},e))}else{return d.getEventOrCell(Ext.applyIf({tickIndex:d.tickCount-1,resourceIndex:d.findPreviousIndex()},e))}},getNext:function(d){var c=this;d=d||c.context;if(c.tickIndex<c.tickCount-1){return c.getEventOrCell(Ext.applyIf({tickIndex:++c.tickIndex,resourceIndex:c.getResourceIndex()},d))}else{return c.getEventOrCell(Ext.applyIf({tickIndex:0,resourceIndex:c.findNextIndex()},d))}},moveUp:function(c){var d=this;if(!d.containerEl){return}d.showEditorInCell(d.getAbove(),c)},moveDown:function(c){var d=this;if(!d.containerEl){return}d.showEditorInCell(d.getBelow(),c)},moveLeft:function(c){var d=this;if(!d.containerEl){return}d.showEditorInCell(d.getPrevious(),c)},moveRight:function(c){var d=this;if(!d.containerEl){return}d.showEditorInCell(d.getNext(),c)},expandResourceRow:function(h){var j=this;var i=Ext.get(j.view.getNodeByRecord(j.context.resource));var k=i.getBox();var g=j.getCellEvents().last();if(g){var l=j.view.getElementsFromEventRecord(g,j.context.resource)[0].getBox();if(Math.abs(l.bottom-k.bottom)<=h){i.setHeight(k.height+h);Ext.get(j.lockedView.getNodeByRecord(j.context.resource)).setHeight(k.height+h);j.__oldHeight=k.height;return k.bottom}else{return l.bottom}}},collapseResourceRow:function(){var b=this;if(b.__oldHeight){Ext.get(b.view.getNodeByRecord(b.context.resource)).setHeight(b.__oldHeight);Ext.get(b.lockedView.getNodeByRecord(b.context.resource)).setHeight(b.__oldHeight);delete b.__oldHeight}},beginEditBelow:function(){var f=this;if(!f.containerEl){return}delete f.context.eventRecord;f.beginEdit();var e=f.timeAxisViewModel.getViewRowHeight();var d=f.expandResourceRow(e);f.alignEditor({left:f.timeAxisViewModel.getTickWidth()*f.tickIndex,y:d,width:f.timeAxisViewModel.getTickWidth(),height:e})},beginEdit:function(){var m=this;if(!m.containerEl){return}if(m.fireEvent("beforecelledit",m,m.getSelection())===false){return}m.editing=true;m.editor.startDate=m.context.startDate;m.editor.bottomUnit=Sch.util.Date.getSubUnit(m.timeAxisViewModel.getBottomHeader().unit);m.containerEl.select(".sch-cellplugin-border").hide();m.containerEl.setStyle("z-index",1);var n=m.getEventRecord(m.context),l=m.getResourceRecord(m.context);if(n){var h=Ext.Date;var j=Ext.isArray(m.editor.dateFormat)?m.editor.dateFormat[0]:m.editor.dateFormat;var i=h.format(n.getStartDate(),j);var k=h.format(n.getEndDate(),j);m.editor.record=n;m.editor.setValue([i,k].join(m.editor.divider));m.editor.recordNode=m.view.getElementsFromEventRecord(n,l)[0];Ext.fly(m.editor.recordNode).hide()}m.editor.show();m.editor.setWidth(m.editor.getMaxWidth());m.editor.focus();m.fireEvent("begincelledit",m,m.getSelection())},cancelEdit:function(){var d=this;var f=d.editor.getValue();var e=d.getSelection();if(d.fireEvent("beforecancelcelledit",d,f,e)===false){return}d.stopEditing();d.fireEvent("cancelcelledit",d,f,e)},completeEdit:function(){var o=this,t=false;if(!o.editing||!o.containerEl){return}var n=o.editor.getValue();var l=o.getSelection();if(o.fireEvent("beforecompletecelledit",o,n,l)===false){return}if(n&&o.editor.isValid()){var r=o.editor.record;var s=Sch.util.Date;var m=s.getSubUnit(o.timeAxisViewModel.getBottomHeader().unit);var v=o.editor.getDates(n);var u=v[0];var q=v[1];if(r){r.setStartEndDate(u,q);delete o.editor.record}else{var p=new o.view.eventStore.model({StartDate:u,EndDate:q,ResourceId:o.context.resource.getId()});o.view.onEventCreated(p);o.view.eventStore.add(p)}t=true}o.stopEditing();o.fireEvent("completecelledit",o,n,l);return t},stopEditing:function(){var c=this;if(c.editor.recordNode){Ext.fly(c.editor.recordNode).show();delete c.editor.recordNode}c.collapseResourceRow();c.editor.setValue("");c.editing=false;c.clearSelection();c.containerEl.select(".sch-cellplugin-border").show();c.containerEl.setStyle("z-index","auto");c.editor.hide();var d=c.lockedView.getRowByRecord(c.resource);d&&Ext.fly(d).down("td").focus()},onBeforeSelect:function(c){var d=this;c&&c.isNavKeyPress&&c.isNavKeyPress()&&d.clearSelection();d.restoreEditing=d.editing;d.editing&&d.completeEdit()},onAfterSelect:function(c){var d=this;d.lockedView.getSelectionModel().select(d.resource);d.lockedView.getNodeByRecord(d.resource).focus();d.editor.setValue("");if(d.restoreEditing&&(c===true||c&&c.isNavKeyPress())){d.beginEdit()}d.restoreEditing=false;d.containerEl.scrollIntoView(d.view.getEl())}});Ext.define("Sch.field.CellEditor",{extend:"Ext.form.field.Text",alias:"widget.celleditorfield",hidden:true,enableKeyEvents:true,divider:"-",dateFormat:"H",getErrors:function(h){var e=this,f=e.callParent(arguments);if(h==null){return f}var g=this.getDates(h);if(!g[0]){f.push("Start date is incorrect")}if(!g[1]){f.push("End date is incorrect")}if(g[1]-g[0]<0){f.push("Start date is less then end date")}return f},getDates:function(j){var k=this;var g=j.split(k.divider);var i,h;if(Ext.isArray(k.dateFormat)){for(var l=0;l<k.dateFormat.length;l++){i=i||Ext.Date.parse(g[0],k.dateFormat[l]);h=h||Ext.Date.parse(g[1],k.dateFormat[l])}}else{i=Ext.Date.parse(g[0],k.dateFormat);h=Ext.Date.parse(g[1],k.dateFormat)}if(!i||!h){return[]}if(k.record){i=Sch.util.Date.mergeDates(k.record.getStartDate(),i,k.bottomUnit);h=Sch.util.Date.mergeDates(k.record.getEndDate(),h,k.bottomUnit)}else{i=Sch.util.Date.mergeDates(k.startDate,i,k.bottomUnit);h=Sch.util.Date.mergeDates(k.startDate,h,k.bottomUnit)}return[i,h]}});Ext.define("Sch.widget.ResizePicker",{extend:"Ext.Panel",alias:"widget.dualrangepicker",width:200,height:200,border:true,collapsible:false,bodyStyle:"position:absolute; margin:5px",verticalCfg:{height:120,value:24,increment:2,minValue:20,maxValue:80,reverse:true,disabled:true},horizontalCfg:{width:120,value:100,minValue:25,increment:5,maxValue:200,disable:true},initComponent:function(){var b=this;b.horizontalCfg.value=b.dialogConfig.columnWidth;b.verticalCfg.value=b.dialogConfig.rowHeight;b.verticalCfg.disabled=b.dialogConfig.scrollerDisabled||false;b.dockedItems=[b.vertical=new Ext.slider.Single(Ext.apply({dock:"left",style:"margin-top:10px",vertical:true,listeners:{change:b.onSliderChange,changecomplete:b.onSliderChangeComplete,scope:b}},b.verticalCfg)),b.horizontal=new Ext.slider.Single(Ext.apply({dock:"top",style:"margin-left:28px",listeners:{change:b.onSliderChange,changecomplete:b.onSliderChangeComplete,scope:b}},b.horizontalCfg))];b.callParent(arguments)},afterRender:function(){var c=this;c.addCls("sch-ux-range-picker");c.valueHandle=this.body.createChild({cls:"sch-ux-range-value",cn:{tag:"span"}});c.valueSpan=this.valueHandle.down("span");var d=new Ext.dd.DD(this.valueHandle);Ext.apply(d,{startDrag:function(){c.dragging=true;this.constrainTo(c.body)},onDrag:function(){c.onHandleDrag.apply(c,arguments)},endDrag:function(){c.onHandleEndDrag.apply(c,arguments);c.dragging=false},scope:this});this.setValues(this.getValues());this.callParent(arguments);this.body.on("click",this.onBodyClick,this)},onBodyClick:function(f,e){var d=[f.getXY()[0]-8-this.body.getX(),f.getXY()[1]-8-this.body.getY()];this.valueHandle.setLeft(Ext.Number.constrain(d[0],0,this.getAvailableWidth()));this.valueHandle.setTop(Ext.Number.constrain(d[1],0,this.getAvailableHeight()));this.setValues(this.getValuesFromXY([this.valueHandle.getLeft(true),this.valueHandle.getTop(true)]));this.onSliderChangeComplete()},getAvailableWidth:function(){return this.body.getWidth()-18},getAvailableHeight:function(){return this.body.getHeight()-18},onHandleDrag:function(){this.setValues(this.getValuesFromXY([this.valueHandle.getLeft(true),this.valueHandle.getTop(true)]))},onHandleEndDrag:function(){this.setValues(this.getValuesFromXY([this.valueHandle.getLeft(true),this.valueHandle.getTop(true)]))},getValuesFromXY:function(i){var j=i[0]/this.getAvailableWidth();var g=i[1]/this.getAvailableHeight();var h=Math.round((this.horizontalCfg.maxValue-this.horizontalCfg.minValue)*j);var f=Math.round((this.verticalCfg.maxValue-this.verticalCfg.minValue)*g)+this.verticalCfg.minValue;return[h+this.horizontalCfg.minValue,f]},getXYFromValues:function(k){var g=this.horizontalCfg.maxValue-this.horizontalCfg.minValue;var i=this.verticalCfg.maxValue-this.verticalCfg.minValue;var h=Math.round((k[0]-this.horizontalCfg.minValue)*this.getAvailableWidth()/g);var l=k[1]-this.verticalCfg.minValue;var j=Math.round(l*this.getAvailableHeight()/i);return[h,j]},updatePosition:function(){var d=this.getValues();var c=this.getXYFromValues(d);this.valueHandle.setLeft(Ext.Number.constrain(c[0],0,this.getAvailableWidth()));if(this.verticalCfg.disabled){this.valueHandle.setTop(this.dialogConfig.rowHeight)}else{this.valueHandle.setTop(Ext.Number.constrain(c[1],0,this.getAvailableHeight()))}this.positionValueText();this.setValueText(d)},positionValueText:function(){var d=this.valueHandle.getTop(true);var c=this.valueHandle.getLeft(true);this.valueSpan.setLeft(c>30?-30:10);this.valueSpan.setTop(d>10?-20:20)},setValueText:function(b){if(this.verticalCfg.disabled){b[1]=this.dialogConfig.rowHeight}this.valueSpan.update("["+b.toString()+"]")},setValues:function(b){this.horizontal.setValue(b[0]);if(this.verticalCfg.reverse){if(!this.verticalCfg.disabled){this.vertical.setValue(this.verticalCfg.maxValue+this.verticalCfg.minValue-b[1])}}else{if(!this.verticalCfg.disabled){this.vertical.setValue(b[1])}}if(!this.dragging){this.updatePosition()}this.positionValueText();this.setValueText(b)},getValues:function(){if(!this.verticalCfg.disabled){var b=this.vertical.getValue();if(this.verticalCfg.reverse){b=this.verticalCfg.maxValue-b+this.verticalCfg.minValue}return[this.horizontal.getValue(),b]}return[this.horizontal.getValue()]},onSliderChange:function(){this.fireEvent("change",this,this.getValues());if(!this.dragging){this.updatePosition()}},onSliderChangeComplete:function(){this.fireEvent("changecomplete",this,this.getValues())},afterLayout:function(){this.callParent(arguments);this.updatePosition()}});Ext.define("Sch.widget.ExportDialogForm",{extend:"Ext.form.Panel",requires:["Ext.data.Store","Ext.XTemplate","Ext.ProgressBar","Ext.form.field.ComboBox","Ext.form.field.Date","Ext.form.FieldContainer","Ext.form.field.Checkbox","Sch.widget.ResizePicker"],border:false,bodyPadding:"10 10 0 10",autoHeight:true,initComponent:function(){var b=this;b.fieldDefaults=Ext.applyIf(b.fieldDefaults||{},{labelAlign:"left",labelWidth:120,anchor:"99%"});b.items=b.createFields();b.items.push(b.progressBar||b.createProgressBar());b.callParent(arguments);b.onRangeChange(null,b.dialogConfig.exportConfig.range);b.onExporterChange(b.exportersField,b.exportersField.getValue());b.on({hideprogressbar:b.hideProgressBar,showprogressbar:b.showProgressBar,updateprogressbar:b.updateProgressBar,scope:b})},isValid:function(){var b=this;if(b.rangeField.getValue()==="date"){return b.dateFromField.isValid()&&b.dateToField.isValid()}return true},getValues:function(j,l,k,g){var h=this.callParent(arguments);h.showHeader=!!h.showHeader;h.showFooter=!!h.showFooter;var i=this.resizePicker.getValues();if(!j){h.cellSize=i}else{h+="&cellSize[0]="+i[0]+"&cellSize[1]="+i[1]}return h},createFields:function(){var l=this,i=l.dialogConfig,j='<table class="sch-fieldcontainer-label-wrap"><td width="1" class="sch-fieldcontainer-label">',k='<td><div class="sch-fieldcontainer-separator"></div></table>',h=[];l.rangeField=new Ext.form.field.ComboBox({value:i.exportConfig.range,triggerAction:"all",cls:"sch-export-dialog-range",forceSelection:true,editable:false,fieldLabel:i.rangeFieldLabel,name:"range",queryMode:"local",displayField:"name",valueField:"value",store:new Ext.data.Store({fields:["name","value"],data:[{name:i.completeViewText,value:"complete"},{name:i.dateRangeText,value:"date"},{name:i.currentViewText,value:"current"}]}),listeners:{change:l.onRangeChange,scope:l}});l.resizePicker=new Sch.widget.ResizePicker({dialogConfig:i,margin:"10 20"});l.resizerHolder=new Ext.form.FieldContainer({fieldLabel:i.scrollerDisabled?i.adjustCols:i.adjustColsAndRows,labelAlign:"top",hidden:true,labelSeparator:"",beforeLabelTextTpl:j,afterLabelTextTpl:k,layout:"vbox",defaults:{flex:1,allowBlank:false},items:[l.resizePicker]});l.dateFromField=new Ext.form.field.Date({fieldLabel:i.dateRangeFromText,baseBodyCls:"sch-exportdialogform-date",name:"dateFrom",format:i.dateRangeFormat||Ext.Date.defaultFormat,allowBlank:false,maxValue:i.endDate,minValue:i.startDate,value:i.startDate});l.dateToField=new Ext.form.field.Date({fieldLabel:i.dateRangeToText,name:"dateTo",format:i.dateRangeFormat||Ext.Date.defaultFormat,baseBodyCls:"sch-exportdialogform-date",allowBlank:false,maxValue:i.endDate,minValue:i.startDate,value:i.endDate});l.datesHolder=new Ext.form.FieldContainer({fieldLabel:i.specifyDateRange,labelAlign:"top",hidden:true,labelSeparator:"",beforeLabelTextTpl:j,afterLabelTextTpl:k,layout:"vbox",defaults:{flex:1,allowBlank:false},items:[l.dateFromField,l.dateToField]});if(i.showHeaderField){l.showHeaderField=new Ext.form.field.Checkbox({fieldLabel:l.dialogConfig.showHeaderLabel,cls:"sch-export-dialog-header",name:"showHeader",checked:!!i.exportConfig.showHeader,checkedValue:true,uncheckedValue:false})}if(i.showFooterField){l.showFooterField=new Ext.form.field.Checkbox({fieldLabel:l.dialogConfig.showFooterLabel,cls:"sch-export-dialog-footer",name:"showFooter",checked:!!i.exportConfig.showFooter,checkedValue:true,uncheckedValue:false})}l.exportersField=new Ext.form.field.ComboBox({value:i.defaultExporter,triggerAction:"all",cls:"sch-export-dialog-exporter",forceSelection:true,editable:false,fieldLabel:i.exportersFieldLabel,name:"exporterId",queryMode:"local",displayField:"name",valueField:"value",store:l.buildExporterStore(i.exporters),listeners:{change:l.onExporterChange,scope:l}});l.formatField=new Ext.form.field.ComboBox({value:i.exportConfig.format,triggerAction:"all",forceSelection:true,editable:false,fieldLabel:i.formatFieldLabel,name:"format",queryMode:"local",store:i.pageFormats||["A5","A4","A3","Letter","Legal"]});var m=i.exportConfig.orientation==="portrait"?'class="sch-none"':"",n=i.exportConfig.orientation==="landscape"?'class="sch-none"':"";l.orientationField=new Ext.form.field.ComboBox({value:i.exportConfig.orientation,triggerAction:"all",componentCls:"sch-exportdialogform-orientation",forceSelection:true,editable:false,fieldLabel:l.dialogConfig.orientationFieldLabel,afterSubTpl:new Ext.XTemplate('<span id="sch-exportdialog-imagePortrait" '+n+'></span><span id="sch-exportdialog-imageLandscape" '+m+"></span>"),name:"orientation",displayField:"name",valueField:"value",queryMode:"local",store:new Ext.data.Store({fields:["name","value"],data:[{name:i.orientationPortraitText,value:"portrait"},{name:i.orientationLandscapeText,value:"landscape"}]}),listeners:{change:function(a,b){switch(b){case"landscape":Ext.fly("sch-exportdialog-imagePortrait").toggleCls("sch-none");Ext.fly("sch-exportdialog-imageLandscape").toggleCls("sch-none");break;case"portrait":Ext.fly("sch-exportdialog-imagePortrait").toggleCls("sch-none");Ext.fly("sch-exportdialog-imageLandscape").toggleCls("sch-none");break}}}});h.push(l.rangeField);h.push(l.resizerHolder);h.push(l.datesHolder);h.push(l.exportersField);h.push(l.formatField);h.push(l.orientationField);if(i.showHeaderField){h.push(l.showHeaderField)}if(i.showFooterField){h.push(l.showFooterField)}return h},buildExporterStore:function(j){var h=[];for(var f=0,g=j.length;f<g;f++){var i=j[f];h.push({name:i.getName(),value:i.getExporterId()})}return Ext.create("Ext.data.Store",{fields:["name","value"],data:h})},createProgressBar:function(){return this.progressBar=new Ext.ProgressBar({text:this.config.progressBarText,animate:true,hidden:true,margin:"4px 0 10px 0"})},onRangeChange:function(c,d){switch(d){case"complete":this.datesHolder.hide();this.resizerHolder.hide();break;case"date":this.datesHolder.show();this.resizerHolder.hide();break;case"current":this.datesHolder.hide();this.resizerHolder.show();this.resizePicker.expand(true);break}},onExporterChange:function(c,d){switch(d){case"singlepage":this.disableFields(true);break;default:this.disableFields(false)}},disableFields:function(c){var d=this;if(d.showHeaderField){d.showHeaderField.setDisabled(c)}d.formatField.setDisabled(c);d.orientationField.setDisabled(c)},showProgressBar:function(){if(this.progressBar){this.progressBar.show()}},hideProgressBar:function(){if(this.progressBar){this.progressBar.hide()}},updateProgressBar:function(d,c){if(this.progressBar){this.progressBar.updateProgress(d);if(c){this.progressBar.updateText(c)}}}});Ext.define("Sch.widget.ExportDialog",{alternateClassName:"Sch.widget.PdfExportDialog",extend:"Ext.window.Window",requires:["Sch.widget.ExportDialogForm"],mixins:["Sch.mixin.Localizable"],alias:"widget.exportdialog",modal:false,width:350,cls:"sch-exportdialog",frame:false,layout:"fit",draggable:true,padding:0,myConfig:null,plugin:null,buttonsPanel:null,buttonsPanelScope:null,progressBar:null,dateRangeFormat:"",showHeaderField:true,showFooterField:false,constructor:function(b){Ext.apply(this,b.exportDialogConfig);this.plugin=b.plugin;this.title=this.L("title");this.myConfig=Ext.apply({progressBarText:this.L("progressBarText"),dateRangeToText:this.L("dateRangeToText"),pickerText:this.L("pickerText"),dateRangeFromText:this.L("dateRangeFromText"),dateRangeText:this.L("dateRangeText"),currentViewText:this.L("currentViewText"),formatFieldLabel:this.L("formatFieldLabel"),orientationFieldLabel:this.L("orientationFieldLabel"),rangeFieldLabel:this.L("rangeFieldLabel"),showHeaderLabel:this.L("showHeaderLabel"),showFooterLabel:this.L("showFooterLabel"),exportersFieldLabel:this.L("exportersFieldLabel"),orientationPortraitText:this.L("orientationPortraitText"),orientationLandscapeText:this.L("orientationLandscapeText"),completeViewText:this.L("completeViewText"),adjustCols:this.L("adjustCols"),adjustColsAndRows:this.L("adjustColsAndRows"),specifyDateRange:this.L("specifyDateRange"),dateRangeFormat:this.dateRangeFormat,exportConfig:this.exportConfig,showHeaderField:this.showHeaderField,showFooterField:this.showFooterField,pageFormats:this.getPageFormats()},b.exportDialogConfig);this.callParent(arguments)},getPageFormats:function(){var e=this.plugin.pageSizes,g=[];Ext.Object.each(e,function(b,a){g.push({width:a.width,height:a.height,name:b})});g.sort(function(a,b){return a.width-b.width});var f=[];for(var h=0;h<g.length;h++){f.push(g[h].name)}return f},initComponent:function(){var c=this,d={hidedialogwindow:c.destroy,showdialogerror:c.showError,updateprogressbar:function(b,a){if(arguments.length==2){c.fireEvent("updateprogressbar",b,undefined)}else{c.fireEvent("updateprogressbar",b,a)}},scope:this};c.form=c.buildForm(c.myConfig);Ext.apply(this,{items:c.form,fbar:c.buildButtons(c.buttonsPanelScope||c)});c.callParent(arguments);c.plugin.on(d)},afterRender:function(){var b=this;b.relayEvents(b.form.resizePicker,["change","changecomplete","select"]);b.form.relayEvents(b,["updateprogressbar","hideprogressbar","showprogressbar"]);b.callParent(arguments)},buildButtons:function(b){return[{xtype:"button",scale:"medium",text:this.L("exportButtonText"),handler:function(){if(this.form.isValid()){this.fireEvent("showprogressbar");var d=this.form.getValues();d.exporterId=d.exporterId;var a=this.dateRangeFormat||Ext.Date.defaultFormat;if(d.dateFrom&&!Ext.isDate(d.dateFrom)){d.dateFrom=Ext.Date.parse(d.dateFrom,a)}if(d.dateTo&&!Ext.isDate(d.dateTo)){d.dateTo=Ext.Date.parse(d.dateTo,a)}this.plugin.doExport(d)}},scope:b},{xtype:"button",scale:"medium",text:this.L("cancelButtonText"),handler:function(){this.destroy()},scope:b}]},buildForm:function(b){return new Sch.widget.ExportDialogForm({progressBar:this.progressBar,dialogConfig:b})},showError:function(e,f){var h=e,g=f||h.L("generalError");h.fireEvent("hideprogressbar");Ext.Msg.alert("",g)}});Ext.define("Sch.feature.ColumnLines",{extend:"Sch.plugin.Lines",requires:["Ext.data.JsonStore"],cls:"sch-column-line",showTip:false,timeAxisViewModel:null,renderingDoneEvent:"columnlinessynced",init:function(b){this.timeAxis=b.getTimeAxis();this.timeAxisViewModel=b.timeAxisViewModel;this.panel=b;this.store=new Ext.data.JsonStore({fields:["Date"]});this.callParent(arguments);b.on({modechange:this.populate,destroy:this.onHostDestroy,scope:this});this.timeAxisViewModel.on("update",this.populate,this);this.populate()},onHostDestroy:function(){this.timeAxisViewModel.un("update",this.populate,this)},populate:function(){this.store.setData(this.getData())},getElementData:function(){var b=this.schedulerView;if(b.isHorizontal()&&b.store.getCount()>0){return this.callParent(arguments)}return[]},getData:function(){var z=this.panel,p=[];if(z.isHorizontal()){var q=this.timeAxisViewModel;var t=q.columnLinesFor;var v=!!(q.headerConfig&&q.headerConfig[t].cellGenerator);if(v){var i=q.getColumnConfig()[t];for(var w=1,y=i.length;w<y;w++){p.push({Date:i[w].start})}}else{var x,r,l=q.getColumnConfig(),u;if(t==="bottom"){x="middle"}else{if(t==="middle"){x="top"}}r=l[x];if(r){var s=q.headerConfig;if(s[x].increment!==s[t].increment||s[x].unit!==s[t].unit){u={};Ext.Array.forEach(r,function(a){u[a.start.getTime()]=1})}}q.forEachInterval(t,function(b,a,c){if(c>0){p.push({Date:b,Cls:u&&u[b.getTime()]?"sch-column-line-solid":""})}})}}return p}});Ext.define("Sch.template.Event",{extend:"Ext.XTemplate",eventPrefix:null,resizeHandles:null,resizeTpl:'<div class="sch-resizable-handle sch-resizable-handle-{0}"></div>',constructor:function(d){Ext.apply(this,d);var e=(this.resizeHandles==="start"||this.resizeHandles==="both"?'<div class="sch-resizable-handle sch-resizable-handle-start"></div>':"");var f=(this.resizeHandles==="end"||this.resizeHandles==="both"?'<div class="sch-resizable-handle sch-resizable-handle-end"></div>':"");this.callParent(['<tpl for="."><div unselectable="on" tabindex="-1" id="'+this.eventPrefix+'{id}" style="right:{right}px;left:{left}px;top:{top}px;height:{height}px;width:{width}px;{style}" class="sch-event '+Ext.baseCSSPrefix+'unselectable {internalCls} {cls}">'+e+'<div unselectable="on" class="sch-event-inner {iconCls}">{body}</div>'+f+"</div></tpl>"])}});Ext.define("Sch.mixin.AbstractTimelineView",{requires:["Sch.data.TimeAxis","Sch.view.Horizontal"],selectedEventCls:"sch-event-selected",readOnly:false,horizontalViewClass:"Sch.view.Horizontal",timeCellCls:"sch-timetd",timeCellSelector:".sch-timetd",eventBorderWidth:1,timeAxis:null,timeAxisViewModel:null,eventPrefix:null,rowHeight:null,orientation:"horizontal",mode:"horizontal",horizontal:null,vertical:null,secondaryCanvasEl:null,panel:null,displayDateFormat:null,el:null,constructor:function(b){if(b&&b.orientation){b.mode=this.mode=b.orientation}this.callParent([b])},_initializeTimelineView:function(){if(this.horizontalViewClass){this.horizontal=Ext.create(this.horizontalViewClass,{view:this})}if(this.verticalViewClass){this.vertical=Ext.create(this.verticalViewClass,{view:this})}if(this.calendarViewClass){this.calendar=Ext.create(this.calendarViewClass,{view:this})}this.eventPrefix=(this.eventPrefix||this.getId())+"-"},getTimeAxisViewModel:function(){return this.timeAxisViewModel},getFormattedDate:function(b){return Ext.Date.format(b,this.getDisplayDateFormat())},getFormattedEndDate:function(f,e){var d=this.getDisplayDateFormat();if(f.getHours()===0&&f.getMinutes()===0&&!(f.getYear()===e.getYear()&&f.getMonth()===e.getMonth()&&f.getDate()===e.getDate())&&!Sch.util.Date.hourInfoRe.test(d.replace(Sch.util.Date.stripEscapeRe,""))){f=Sch.util.Date.add(f,Sch.util.Date.DAY,-1)}return Ext.Date.format(f,d)},getDisplayDateFormat:function(){return this.displayDateFormat},setDisplayDateFormat:function(b){this.displayDateFormat=b},fitColumns:function(c){if(this.mode==="horizontal"){this.getTimeAxisViewModel().fitToAvailableWidth(c)}else{var d=Math.floor((this.panel.getWidth()-Ext.getScrollbarSize().width-1)/this.headerCt.getColumnCount());this.setColumnWidth(d,c)}},getElementFromEventRecord:function(e,g){var h=this,f;f=h.getElementsFromEventRecord(e,g);if(f.length===0){f=null}else{if(f.length==1){f=f[0]}else{if(h.mode=="calendar"){f=f[0]}else{Ext.Error.raise("The method getElementFromEventRecord() is deprecated, it can't handle the situation when several DOM elements correspond to a single event record, please use getElementsFromEventRecord() method instead!")}}}return f},getElementsFromEventRecord:function(h,j,l,g){var k=this,i;g=g||false;if(j&&(l!==null&&l!==undefined)){i="[id^="+k.eventPrefix+h.internalId+"-"+j.internalId+"-"+l+"]"}else{if(j){i="[id^="+k.eventPrefix+h.internalId+"-"+j.internalId+"-]"}else{i="[id^="+k.eventPrefix+h.internalId+"-]"}}return k.getEl().query(i,g)},getStartEndDatesFromRegion:function(f,d,e){return this[this.mode].getStartEndDatesFromRegion(f,d,e)},getTimeResolution:function(){return this.timeAxis.getResolution()},setTimeResolution:function(c,d){this.timeAxis.setResolution(c,d);if(this.getTimeAxisViewModel().snapToIncrement){this.refreshKeepingScroll()}},getEventIdFromDomNodeId:function(b){return b.substring(this.eventPrefix.length).split("-")[0]},getResourceIdFromDomNodeId:function(b){return b.substring(this.eventPrefix.length).split("-")[1]},getDateFromDomEvent:function(c,d){return this.getDateFromXY(c.getXY(),d)},getSnapPixelAmount:function(){return this.getTimeAxisViewModel().getSnapPixelAmount()},setSnapEnabled:function(b){this.getTimeAxisViewModel().setSnapToIncrement(b)},setReadOnly:function(b){this.readOnly=b;this[b?"addCls":"removeCls"](this._cmpCls+"-readonly")},isReadOnly:function(){return this.readOnly},setOrientation:function(){this.setMode.apply(this,arguments)},setMode:function(b){this.mode=b;this.timeAxisViewModel.mode=b},getOrientation:function(){return this.getMode.apply(this,arguments)},getMode:function(){return this.mode},isHorizontal:function(){return this.getMode()==="horizontal"},isVertical:function(){return !this.isHorizontal()},getDateFromXY:function(f,d,e){return this[this.mode].getDateFromXY(f,d,e)},getDateFromCoordinate:function(f,d,e){if(!e){f=this[this.mode].translateToScheduleCoordinate(f)}return this.timeAxisViewModel.getDateFromPosition(f,d)},getDateFromX:function(d,c){return this.getDateFromCoordinate(d,c)},getDateFromY:function(c,d){return this.getDateFromCoordinate(c,d)},getCoordinateFromDate:function(e,d){var f=this.timeAxisViewModel.getPositionFromDate(e);if(d===false){f=this[this.mode].translateToPageCoordinate(f)}return Math.round(f)},getXFromDate:function(d,c){return this.getCoordinateFromDate(d,c)},getYFromDate:function(d,c){return this.getCoordinateFromDate(d,c)},getTimeSpanDistance:function(d,c){return this.timeAxisViewModel.getDistanceBetweenDates(d,c)},getTimeSpanRegion:function(d,c){return this[this.mode].getTimeSpanRegion(d,c)},getScheduleRegion:function(c,d){return this[this.mode].getScheduleRegion(c,d)},getTableRegion:function(){throw"Abstract method call"},getRowNode:function(b){throw"Abstract method call"},getRecordForRowNode:function(b){throw"Abstract method call"},getVisibleDateRange:function(){return this[this.mode].getVisibleDateRange()},setColumnWidth:function(c,d){this[this.mode].setColumnWidth(c,d)},findRowByChild:function(b){throw"Abstract method call"},setBarMargin:function(c,d){this.barMargin=c;if(!d){this.refreshKeepingScroll()}},getRowHeight:function(){return this.timeAxisViewModel.getViewRowHeight()},setRowHeight:function(d,c){this.timeAxisViewModel.setViewRowHeight(d,c)},refreshKeepingScroll:function(){throw"Abstract method call"},scrollVerticallyTo:function(c,d){throw"Abstract method call"},scrollHorizontallyTo:function(d,c){throw"Abstract method call"},getVerticalScroll:function(){throw"Abstract method call"},getHorizontalScroll:function(){throw"Abstract method call"},getEl:Ext.emptyFn,getSecondaryCanvasEl:function(){if(!this.rendered){throw"Calling this method too early"}if(!this.secondaryCanvasEl){this.secondaryCanvasEl=(this.scrollerEl||this.getEl()).createChild({cls:"sch-secondary-canvas"})}return this.secondaryCanvasEl},getScroll:function(){throw"Abstract method call"},getOuterEl:function(){return this.getEl()},getRowContainerEl:function(){return this.getEl()},getScheduleCell:function(c,d){return this.getCellByPosition({row:c,column:d})},getScrollEventSource:function(){return this.getEl()},getViewportHeight:function(){return this.getEl().getHeight()},getViewportWidth:function(){return this.getEl().getWidth()},getViewportCenterDate:function(){var d=this.getScroll(),c;if(this.getMode()==="vertical"){c=[0,d.top+this.getViewportHeight()/2]}else{c=[d.left+this.getViewportWidth()/2,0]}return this.getDateFromXY(c,null,true)},getDateConstraints:Ext.emptyFn});Ext.apply(Sch,{VERSION:"3.0.6"});Ext.define("Sch.mixin.TimelineView",{extend:"Sch.mixin.AbstractTimelineView",requires:["Ext.tip.ToolTip","Sch.patches.TouchScroll","Sch.patches.PartnerScroll","Sch.patches.View","Sch.patches.TableView","Sch.patches.Collection","Sch.patches.ToolTip"],tip:null,overScheduledEventClass:"sch-event-hover",ScheduleBarEvents:["mousedown","mouseup","click","dblclick","contextmenu"],ResourceRowEvents:["keydown","keyup"],preventOverCls:false,_initializeTimelineView:function(){this.callParent(arguments);this.on("destroy",this._onDestroy,this);this.on("afterrender",this._onAfterRender,this);this.panel.on("viewready",this._onViewReady,this);this.setMode(this.mode);this.enableBubble("columnwidthchange");this.addCls("sch-timelineview");if(this.readOnly){this.addCls(this._cmpCls+"-readonly")}this.addCls(this._cmpCls);if(this.eventAnimations){this.addCls("sch-animations-enabled")}},handleScheduleBarEvent:function(c,d){this.fireEvent(this.scheduledEventName+c.type,this,this.resolveEventRecord(d),c)},handleResourceRowEvent:function(d,c){this.fireEvent(this.scheduledEventName+d.type,this,this.resolveEventRecordFromResourceRow(c),d)},_onDestroy:function(){if(this.tip){this.tip.destroy()}},_onViewReady:function(){if(this.touchScroll){this.getSecondaryCanvasEl().insertBefore(this.getNodeContainer())}},_onAfterRender:function(){if(this.overScheduledEventClass){this.setMouseOverEnabled(true)}if(this.tooltipTpl){if(typeof this.tooltipTpl==="string"){this.tooltipTpl=new Ext.XTemplate(this.tooltipTpl)}this.el.on("mousemove",this.setupTooltip,this,{single:true})}var h=this.bufferedRenderer;if(h){this.patchBufferedRenderingPlugin(h);this.patchBufferedRenderingPlugin(this.lockingPartner.bufferedRenderer)}this.on("bufferedrefresh",this.onBufferedRefresh,this,{buffer:10});this.setupTimeCellEvents();var i=this.getSecondaryCanvasEl();if(i.getStyle("position").toLowerCase()!=="absolute"){var j=Ext.Msg||window;j.alert("ERROR: The CSS file for the Bryntum component has not been loaded.")}var f={delegate:this.eventSelector,scope:this};var g={delegate:this.rowSelector,scope:this};Ext.Array.forEach(this.ScheduleBarEvents,function(a){f[a]=this.handleScheduleBarEvent},this);Ext.Array.forEach(this.ResourceRowEvents,function(a){g[a]=this.handleResourceRowEvent},this);this.el.on(f);this.el.on(g)},patchBufferedRenderingPlugin:function(f){var d=this;var e=f.setBodyTop;f.setBodyTop=function(c,b){var a=e.apply(this,arguments);d.fireEvent("bufferedrefresh",this);return a}},onBufferedRefresh:function(){var g=this.body.dom;if(!g){return}var h=g.style;if(Ext.isIE9m){this.getSecondaryCanvasEl().dom.style.top=this.body.dom.style.top}else{var e=h.transform||h.msTransform||h.webkitTransform;var f;if(e){f=/\(-?\d+px,\s*(-?\d+px),\s*(-?\d+)px\)/.exec(e)}if(f){this.getSecondaryCanvasEl().dom.style.top=e?f[1]:g.style.top}}},setMouseOverEnabled:function(b){this[b?"mon":"mun"](this.el,{mouseover:this.onEventMouseOver,mouseout:this.onEventMouseOut,delegate:this.eventSelector,scope:this})},onEventMouseOver:function(f,e){if(e!==this.lastItem&&!this.preventOverCls){this.lastItem=e;Ext.fly(e).addCls(this.overScheduledEventClass);var d=this.resolveEventRecord(e);if(d){this.fireEvent("eventmouseenter",this,d,f)}}},onEventMouseOut:function(c,d){if(this.lastItem){if(!c.within(this.lastItem,true,true)){Ext.fly(this.lastItem).removeCls(this.overScheduledEventClass);this.fireEvent("eventmouseleave",this,this.resolveEventRecord(this.lastItem),c);delete this.lastItem}}},highlightItem:function(c){if(c){var d=this;d.clearHighlight();d.highlightedItem=c;Ext.fly(c).addCls(d.overItemCls)}},setupTooltip:function(){var c=this,d=Ext.apply({delegate:c.eventSelector,target:c.el,anchor:"b",rtl:c.rtl,show:function(){Ext.ToolTip.prototype.show.apply(this,arguments);if(this.triggerElement&&c.getMode()==="horizontal"){this.setX(this.targetXY[0]-10);var b=Ext.fly(this.triggerElement).getBox();var a=b.top-this.getHeight()-10;this.setY(a<0?b.bottom+10:a)}}},c.tipCfg);c.tip=new Ext.ToolTip(d);c.tip.on({beforeshow:function(b){if(!b.triggerElement||!b.triggerElement.id){return false}var h=this.resolveEventRecord(b.triggerElement);if(!h||this.fireEvent("beforetooltipshow",this,h)===false){return false}var a=this.getDataForTooltipTpl(h,b.triggerElement),g;if(!a){return false}g=this.tooltipTpl.apply(a);if(!g){return false}b.update(g)},scope:this});if(Ext.supports.Touch){c.el.un({touchmove:c.setupTooltip,mousemove:c.setupTooltip,scope:c})}},getHorizontalTimeAxisColumn:function(){if(!this.timeAxisColumn){this.timeAxisColumn=this.headerCt.down("timeaxiscolumn");if(this.timeAxisColumn){this.timeAxisColumn.on("destroy",function(){this.timeAxisColumn=null},this)}}return this.timeAxisColumn},getDataForTooltipTpl:function(d,c){return Ext.apply({_record:d},d.data)},refreshKeepingScroll:function(){Ext.suspendLayouts();this.saveScrollState();this.refresh();Ext.resumeLayouts(true);if(this.scrollState.left!==0||this.scrollState.top!==0||this.infiniteScroll){this.restoreScrollState()}},setupTimeCellEvents:function(){this.mon(this.el,{click:this.handleScheduleEvent,dblclick:this.handleScheduleEvent,contextmenu:this.handleScheduleEvent,pinch:this.handleScheduleEvent,pinchstart:this.handleScheduleEvent,pinchend:this.handleScheduleEvent,scope:this})},getTableRegion:function(){var b=this.el.down("."+Ext.baseCSSPrefix+"grid-item-container");return(b||this.el).getRegion()},getRowNode:function(b){return this.getNodeByRecord(b)},findRowByChild:function(b){return this.findItemByChild(b)},getRecordForRowNode:function(b){return this.getRecord(b)},refreshKeepingResourceScroll:function(){var b=this.getScroll();this.refresh();if(this.getMode()==="horizontal"){this.scrollVerticallyTo(b.top)}else{this.scrollHorizontallyTo(b.left)}},scrollHorizontallyTo:function(e,d){var f=this.getEl();if(f&&Ext.supports.Touch){this.setScrollX(e)}else{if(f){f.scrollTo("left",Math.max(0,e),d)}}},scrollVerticallyTo:function(f,e){var d=this.getEl();if(d&&Ext.supports.Touch){this.setScrollY(f)}else{if(d){d.scrollTo("top",Math.max(0,f),e)}}},getVerticalScroll:function(){var b=this.getEl();return b.getScroll().top},getHorizontalScroll:function(){var b=this.getEl();return b.getScroll().left},getScroll:function(){var b=this;return{top:b.getScrollY(),left:b.getScrollX()}},handleScheduleEvent:function(){},scrollElementIntoView:function(Q,A,M,O,T,N,R){var x=this,B=Q.dom,H=Ext.getDom(x.getEl()),K=Q.getOffsetsTo(H),S=x.getScroll(),P=K[0]+S.left,G=K[1]+S.top,J=G+B.offsetHeight,z=P+B.offsetWidth,F=H.clientHeight,L=parseInt(S.top,10),y=parseInt(S.left,10),E=L+F,I=y+H.clientWidth,C,D;T=T===null||T===undefined?20:T;if(B.offsetHeight>F||G<L){D=G-T}else{if(J>E){D=J-F+T}}if(A!==false&&B.offsetWidth>H.clientWidth||P<y){C=P-T}else{if(A!==false&&z>I){C=z-H.clientWidth+T}}M=M===true&&{}||M;O=O===true&&{}||O;R=R||x;if(M&&O){M.listeners=Ext.apply(M.listeners||{},{afteranimate:function(){O.listeners=Ext.apply(O.listeners||{},{afteranimate:function(){N&&N.call(R);N=null}});Ext.fly(B).highlight(null,O)}})}else{if(M){M.listeners=Ext.apply(M.listeners,{afteranimate:function(){N&&N.call(R);N=null}})}else{if(O){O.listeners=Ext.apply(O.listeners||{},{afteranimate:function(){N&&N.call(R);N=null}})}}}D!==undefined&&x.setScrollY(D,M);C!==undefined&&x.setScrollX(C,M);!M&&O&&Ext.fly(B).highlight(null,O);!M&&!O&&N&&N.call(R)},disableViewScroller:function(c){var d=this.getScrollable();if(d){d.setDisabled(c)}}});Ext.define("Sch.view.TimelineGridView",{extend:"Ext.grid.View",mixins:["Sch.mixin.TimelineView"],infiniteScroll:false,bufferCoef:5,bufferThreshold:0.2,cachedScrollLeftDate:null,boxIsReady:false,ignoreNextHorizontalScroll:false,constructor:function(b){this.callParent(arguments);if(this.infiniteScroll){this.on("boxready",this.setupInfiniteScroll,this)}if(this.timeAxisViewModel){this.relayEvents(this.timeAxisViewModel,["columnwidthchange"])}},setupInfiniteScroll:function(){var h=this.panel.ownerCt;this.cachedScrollLeftDate=h.startDate||this.timeAxis.getStart();if(Ext.supports.Touch&&Ext.os.is.Windows){var g=this.panel.headerCt.scrollable;var e=this.scrollable;try{Ext.GlobalEvents.un("idle",g.onIdle,g);Ext.GlobalEvents.un("idle",e.onIdle,e)}catch(i){Ext.log("Cannot unsubscribe required listener, zooming may be broken")}}var j=this;h.calculateOptimalDateRange=function(d,f,a,c){if(c){return c}var b=Sch.preset.Manager.getPreset(a.preset);return j.calculateInfiniteScrollingDateRange(d,b.getBottomHeader().unit,a.increment,a.width)};this.bindInfiniteScrollListeners()},bindInfiniteScrollListeners:function(){if(this.scrollManager){this.scrollManager.scroller.on("scroll",this.onHorizontalScroll,this)}else{this.el.on("scroll",this.onHorizontalScroll,this)}this.on("resize",this.onSelfResize,this)},unbindInfiniteScrollListeners:function(){if(this.scrollManager){this.scrollManager.scroller.un("scroll",this.onHorizontalScroll,this)}else{this.el.un("scroll",this.onHorizontalScroll,this)}this.un("resize",this.onSelfResize,this)},onHorizontalScroll:function(){if(this.ignoreNextHorizontalScroll||this.cachedScrollLeftDate){this.ignoreNextHorizontalScroll=false;return}var h=this.el.dom,j=this.getWidth(),i=this.getScroll().left,f=this.scrollManager?this.scrollManager.scroller.getMaxPosition().x:h.scrollWidth,g=j*this.bufferThreshold*this.bufferCoef;if((f-i-j<g)||i<g){this.shiftToDate(this.getDateFromCoordinate(i,null,true));this.el.stopAnimation()}},refresh:function(){this.callParent(arguments);if(this.infiniteScroll&&!this.scrollStateSaved&&this.boxIsReady){this.restoreScrollLeftDate()}},onSelfResize:function(j,i,g,f,h){this.boxIsReady=true;if(i!==f){this.shiftToDate(this.cachedScrollLeftDate||this.getVisibleDateRange().startDate,this.cachedScrollCentered)}},restoreScrollLeftDate:function(){if(this.cachedScrollLeftDate&&this.boxIsReady){this.ignoreNextHorizontalScroll=true;this.scrollToDate(this.cachedScrollLeftDate);this.cachedScrollLeftDate=null}},scrollToDate:function(d){this.cachedScrollLeftDate=d;if(this.cachedScrollCentered){this.panel.ownerCt.scrollToDateCentered(d)}else{this.panel.ownerCt.scrollToDate(d)}var c=this.getScroll().left;this.panel.scrollLeftPos=c;this.headerCt.el.dom.scrollLeft=c},saveScrollState:function(){this.scrollStateSaved=this.boxIsReady;this.callParent(arguments)},restoreScrollState:function(){this.scrollStateSaved=false;if(this.infiniteScroll&&this.cachedScrollLeftDate){this.restoreScrollLeftDate();this.el.dom.scrollTop=this.scrollState.top;return}this.callParent(arguments)},calculateInfiniteScrollingDateRange:function(n,m,i,j){var l=this.timeAxis;var o=this.getWidth();j=j||this.timeAxisViewModel.getTickWidth();i=i||l.increment||1;m=m||l.unit;var k=Sch.util.Date;var p=Math.ceil(o*this.bufferCoef/j);return{start:l.floorDate(k.add(n,m,-p*i),false,m,i),end:l.ceilDate(k.add(n,m,Math.ceil((o/j+p)*i)),false,m,i)}},shiftToDate:function(f,d){var e=this.calculateInfiniteScrollingDateRange(f);this.cachedScrollLeftDate=f;this.cachedScrollCentered=d;this.timeAxis.setTimeSpan(e.start,e.end)},destroy:function(){if(this.infiniteScroll&&this.rendered){this.unbindInfiniteScrollListeners()}this.callParent(arguments)}});Ext.define("Sch.mixin.AbstractSchedulerView",{requires:["Sch.model.Assignment","Sch.template.Event","Sch.eventlayout.Horizontal","Sch.view.Vertical","Sch.eventlayout.Vertical"],_cmpCls:"sch-schedulerview",scheduledEventName:"event",eventTemplateClass:"Sch.template.Event",eventTpl:null,barMargin:1,constrainDragToResource:false,allowOverlap:null,readOnly:null,altColCls:"sch-col-alt",dynamicRowHeight:true,managedEventSizing:true,eventAnimations:true,horizontalLayoutCls:"Sch.eventlayout.Horizontal",horizontalEventSorterFn:null,verticalLayoutCls:"Sch.eventlayout.Vertical",verticalEventSorterFn:null,eventCls:"sch-event",verticalViewClass:"Sch.view.Vertical",eventStore:null,resourceStore:null,eventLayout:null,_initializeSchedulerView:function(){var d=Ext.ClassManager.get(this.horizontalLayoutCls);var c=Ext.ClassManager.get(this.verticalLayoutCls);this.eventSelector="."+this.eventCls;this.eventLayout={};if(d){this.eventLayout.horizontal=new d(Ext.apply({timeAxisViewModel:this.timeAxisViewModel},{bandIndexToPxConvertFn:this.horizontal.layoutEventVertically,bandIndexToPxConvertScope:this.horizontal},this.horizontalEventSorterFn?{sortEvents:this.horizontalEventSorterFn}:{}))}if(c){this.eventLayout.vertical=new c(Ext.apply({},{view:this},this.verticalEventSorterFn?{sortEvents:this.verticalEventSorterFn}:{}))}this.store=this.store||this.resourceStore;this.resourceStore=this.resourceStore||this.store},generateTplData:function(n,o,p){var l=this[this.mode].getEventRenderData(n,o,p),k=n.getStartDate(),i=n.getEndDate(),j=n.getCls()||"";j+=" sch-event-resizable-"+n.getResizable();if(n.dirty){j+=" sch-dirty "}if(l.endsOutsideView){j+=" sch-event-endsoutside "}if(l.startsOutsideView){j+=" sch-event-startsoutside "}if(this.eventBarIconClsField){j+=" sch-event-withicon "}if(n.isDraggable()===false){j+=" sch-event-fixed "}if(i-k===0){j+=" sch-event-milestone "}l.id=n.internalId+"-"+o.internalId+(this.getMode()==="calendar"?("-"+p):"-x");l.internalCls=j;l.start=k;l.end=i;l.iconCls=n.data[this.eventBarIconClsField]||"";l.event=n;if(this.eventRenderer){var m=this.eventRenderer.call(this.eventRendererScope||this,n,o,l,p);if(Ext.isObject(m)&&this.eventBodyTemplate){l.body=this.eventBodyTemplate.apply(m)}else{l.body=m}}else{if(this.eventBodyTemplate){l.body=this.eventBodyTemplate.apply(n.data)}else{if(this.eventBarTextField){l.body=n.data[this.eventBarTextField]||""}}}return l},resolveResource:function(c){var d=this;return d[d.mode].resolveResource(c)},getResourceRegion:function(d,e,f){return this[this.mode].getResourceRegion(d,e,f)},resolveEventRecord:function(b){b=b.dom?b.dom:b;if(!(Ext.fly(b).is(this.eventSelector))){b=Ext.fly(b).up(this.eventSelector)}return b&&this.getEventRecordFromDomId(b.id)},resolveEventRecordFromResourceRow:function(g){var j=this,h=j.getEventSelectionModel(),i,f;g=g.dom?g.dom:g;i=j.getRecord(g);return h.getFirstSelectedEventForResource(i)},resolveAssignmentRecord:function(h){var l=this,j=l.eventStore.getAssignmentStore(),i=null,g,k;if(j){h=h.dom&&h.dom||h;g=l.getEventRecordFromDomId(h.id);k=l.getResourceRecordFromDomId(h.id);if(g&&k){i=j.getAssignmentForEventAndResource(g,k)}}return i},getEventRecordFromDomId:function(b){b=this.getEventIdFromDomNodeId(b);return this.eventStore.getModelByInternalId(b)},getResourceRecordFromDomId:function(b){b=this.getResourceIdFromDomNodeId(b);return this.eventStore.getResourceStore().getByInternalId(b)},isDateRangeAvailable:function(g,f,e,h){return this.eventStore.isDateRangeAvailable(g,f,e,h)},getEventsInView:function(){var c=this.timeAxis.getStart(),d=this.timeAxis.getEnd();return this.eventStore.getEventsInTimeSpan(c,d)},getEventNodes:function(){return this.getEl().select(this.eventSelector)},onEventCreated:function(b){},getEventStore:function(){return this.eventStore},registerEventEditor:function(b){this.eventEditor=b},getEventEditor:function(){return this.eventEditor},onEventUpdate:function(d,f,e){this[this.mode].onEventUpdate(d,f,e)},onEventAdd:function(d,c){if(!Ext.isArray(c)){c=[c]}this[this.mode].onEventAdd(d,c)},onAssignmentAdd:function(d,e){var f=this;Ext.Array.forEach(e,function(a){var b=a.getResource();b&&f.repaintEventsForResource(b)})},onAssignmentUpdate:function(m,j){var k=this,i=j.previous&&j.previous[j.resourceIdField],l=j.getResourceId(),h,n;if(i){h=k.resourceStore.getModelById(i);k.repaintEventsForResource(h)}if(l){n=k.resourceStore.getModelById(l);k.repaintEventsForResource(n)}},onAssignmentRemove:function(d,e){var f=this;Ext.Array.forEach(e,function(b){var a=b.getResourceId();var c=a&&f.resourceStore.getModelById(a);c&&f.repaintEventsForResource(c)})},onEventRemove:function(d,c){this[this.mode].onEventRemove(d,c)},bindEventStore:function(m,h){var k=this;var i={scope:k,refresh:k.onEventDataRefresh,addrecords:k.onEventAdd,updaterecord:k.onEventUpdate,removerecords:k.onEventRemove,add:k.onEventAdd,update:k.onEventUpdate,remove:k.onEventRemove,nodeinsert:k.onEventAdd,nodeappend:k.onEventAdd};var n={scope:k,refresh:k.onEventDataRefresh,load:k.onEventDataRefresh,update:k.onAssignmentUpdate,add:k.onAssignmentAdd,remove:k.onAssignmentRemove};if(!Ext.versions.touch){i.clear=k.onEventDataRefresh}if(!h&&k.eventStore){k.eventStore.setResourceStore(null);if(m!==k.eventStore&&k.eventStore.autoDestroy){k.eventStore.destroy()}else{if(k.mun){k.mun(k.eventStore,i);var l=k.eventStore.getAssignmentStore&&k.eventStore.getAssignmentStore();if(l){k.mun(l,n)}}else{k.eventStore.un(i)}}if(!m){k.eventStore=null}}if(m){m=Ext.data.StoreManager.lookup(m);if(k.mon){k.mon(m,i)}else{m.on(i)}k.eventStore=m;m.setResourceStore(k.resourceStore);var j=m.getAssignmentStore&&m.getAssignmentStore();if(j){k.mon(j,n)}}if(m&&!h){k.refresh()}},onEventDataRefresh:function(){this.refreshKeepingScroll()},onEventBarSelect:function(f){var h=this,e,g;if(f instanceof Sch.model.Assignment){e=f.getEvent();g=f.getResource()}else{e=f;g=null}Ext.Array.forEach(h.getElementsFromEventRecord(e,g),function(a){a.addCls(h.selectedEventCls)})},onEventBarDeselect:function(f){var h=this,e,g;if(f instanceof Sch.model.Assignment){e=f.getEvent();g=f.getResource()}else{e=f;g=null}e&&Ext.Array.forEach(h.getElementsFromEventRecord(e,g),function(a){a.removeCls(h.selectedEventCls)})},refresh:function(){throw"Abstract method call"},repaintEventsForResource:function(b){throw"Abstract method call"},repaintAllEvents:function(){this.refreshKeepingScroll()},scrollEventIntoView:function(k,h,i,j,n){var m=this,l=k.getResources();l.length&&m.scrollResourceEventIntoView(l[0],k,null,h,i,j,n)},scrollResourceEventIntoView:function(t,r,q,u,x,n,m){var o=this,p=r.getStartDate(),s=r.getEndDate(),v,w;if(Ext.data.TreeStore&&o.resourceStore instanceof Ext.data.TreeStore){t.bubble(function(a){a.expand()})}if(!o.timeAxis.dateInAxis(p)||!o.timeAxis.dateInAxis(s)){v=o.timeAxis.getEnd()-o.timeAxis.getStart();o.timeAxis.setTimeSpan(new Date(p.valueOf()-v/2),new Date(s.getTime()+v/2));o.up("panel").scrollTask.cancel()}o.panel.ownerCt.ensureVisible(t,{callback:function(){if(this.isLocked===false){w=o.getElementsFromEventRecord(r,t,q);w=w.length&&w[0]||null;o.scrollElementIntoView(w,true,x,u,null,n,m)}}})}});Ext.define("Sch.mixin.SchedulerView",{extend:"Sch.mixin.AbstractSchedulerView",mixins:["Sch.mixin.Localizable"],requires:["Sch.feature.DragCreator","Sch.feature.DragDrop","Sch.feature.ResizeZone","Sch.column.Resource","Sch.view.Calendar","Ext.XTemplate"],eventResizeHandles:"end",dndValidatorFn:Ext.emptyFn,resizeValidatorFn:Ext.emptyFn,createValidatorFn:Ext.emptyFn,calendarViewClass:"Sch.view.Calendar",_initializeSchedulerView:function(){this.callParent(arguments);this.on({destroy:this._destroy,afterrender:this._afterRender,itemupdate:this.onRowUpdated,scope:this});if(Ext.getVersion().isGreaterThan("5.1.1")){this.on("itemadd",function(a){var d=this.all.item(this.all.endIndex-a.length);if(d){d.dom.style.height=""}})}var b=this;if(!this.eventPrefix){throw"eventPrefix missing"}b.eventTpl=b.eventTpl||Ext.create(this.eventTemplateClass,{eventPrefix:this.eventPrefix,resizeHandles:this.eventResizeHandles})},inheritables:function(){return{loadingText:this.L("loadingText"),overItemCls:"",trackOver:false,selectedItemCls:"",setReadOnly:function(b){if(this.dragCreator){this.dragCreator.setDisabled(b)}this.callParent(arguments)},repaintEventsForResource:function(n,p){var o=this,l=o.getMode(),m=l==="horizontal",j=m?o.indexOf(n):0;if(m){o.eventLayout.horizontal.clearCache(n)}if(j>=0){Ext.suspendLayouts();if(m){o.refreshNode(n);o.lockingPartner.refreshNode(n)}else{o.refreshNode(j);o.lockingPartner.refreshNode(j)}Ext.resumeLayouts();if(p){var k=o.getEventSelectionModel();var i=o.eventStore.getEventsForResource(n);Ext.Array.forEach(i,function(a){k.forEachEventRelatedSelection(a,function(b){o.onEventBarSelect(b,true)})})}}},repaintAllEvents:function(){if(this.mode==="horizontal"){this.refresh()}else{this.refreshNode(0)}},handleScheduleEvent:function(o){var t=o.getTarget("."+this.eventCls,3),l=!t&&o.getTarget("."+this.timeCellCls,3);if(l){var e=this.getDateFromDomEvent(o,"floor");var m=this.findRowByChild(l);var p=this.indexOf(m);var s;if(this.mode=="horizontal"){s=this.getRecordForRowNode(m)}else{var r=o.getTarget(this.timeCellSelector,5);if(r){var n=typeof r.cellIndex=="number"?r.cellIndex:r.getAttribute("data-cellIndex");var q=this.headerCt.getGridColumns()[n];s=q&&q.model}}if(o.type.indexOf("pinch")>=0){this.fireEvent("schedule"+o.type,this,o)}else{this.fireEvent("schedule"+o.type,this,e,p,s,o)}}},onEventDataRefresh:function(){this.clearRowHeightCache();this.callParent(arguments)},onUnbindStore:function(b){b.un({refresh:this.clearRowHeightCache,clear:this.clearRowHeightCache,load:this.clearRowHeightCache,scope:this});this.callParent(arguments)},bindStore:function(b){b&&b.on({refresh:this.clearRowHeightCache,clear:this.clearRowHeightCache,load:this.clearRowHeightCache,scope:this});this.callParent(arguments)},refreshKeepingScroll:function(){this.lockingPartner.saveScrollState();this.lockingPartner.refresh();this.lockingPartner.restoreScrollState();this.callParent(arguments)}}},getEventSelectionModel:function(){var e=this,h=e.eventSelModel,f=e.eventSelModelType,g;if(h&&h.events){return h}if(!h){h={}}if(!f&&e.eventStore.getAssignmentStore()){f="assignmentmodel"}else{if(!f){f="eventmodel"}}g="SINGLE";if(e.simpleSelect){g="SIMPLE"}else{if(e.multiSelect){g="MULTI"}}Ext.applyIf(h,{allowDeselect:e.allowDeselect,mode:g});if(!h.events){h=e.eventSelModel=Ext.create("selection."+f,h)}if(e.disableSelection){h.locked=true}return h},_afterRender:function(){this.bindEventStore(this.eventStore,true);this.getEventSelectionModel().bindToView(this);this.setupEventListeners();this.configureFunctionality();var b=this.headerCt.resizer;if(b){b.doResize=Ext.Function.createSequence(b.doResize,this.afterHeaderResized,this)}this.on("itemupdate",function(){delete this.lastItem})},_destroy:function(){this.bindEventStore(null)},clearRowHeightCache:function(){if(this.mode==="horizontal"){this.eventLayout.horizontal.clearCache()}},configureFunctionality:function(){var b=this.validatorFnScope||this;if(this.eventResizeHandles!=="none"&&Sch.feature.ResizeZone){this.resizePlug=new Sch.feature.ResizeZone(Ext.applyIf({schedulerView:this,validatorFn:function(g,h,a,f){return(this.allowOverlap||this.isDateRangeAvailable(a,f,h,g))&&this.resizeValidatorFn.apply(b,arguments)},validatorFnScope:this},this.resizeConfig||{}))}if(this.enableEventDragDrop!==false&&Sch.feature.DragDrop){this.dragdropPlug=new Sch.feature.DragDrop(this,{validatorFn:function(h,a,g,f){return(this.allowOverlap||this.isDateRangeAvailable(g,Sch.util.Date.add(g,Sch.util.Date.MILLI,f),h[0],a))&&this.dndValidatorFn.apply(b,arguments)},validatorFnScope:this,dragConfig:this.dragConfig||{}})}if(this.enableDragCreation!==false&&Sch.feature.DragCreator){this.dragCreator=new Sch.feature.DragCreator(Ext.applyIf({schedulerView:this,disabled:this.readOnly,validatorFn:function(f,a,e){return(this.allowOverlap||this.isDateRangeAvailable(a,e,null,f))&&this.createValidatorFn.apply(b,arguments)},validatorFnScope:this},this.createConfig||{}))}},onBeforeDragDrop:function(e,f,d){return !this.readOnly&&!d.getTarget().className.match("sch-resizable-handle")},onDragDropStart:function(){if(this.dragCreator){this.dragCreator.setDisabled(true)}if(this.tip){this.tip.hide();this.tip.disable()}if(this.overScheduledEventClass){this.setMouseOverEnabled(false)}},onDragDropEnd:function(){if(this.dragCreator){this.dragCreator.setDisabled(false)}if(this.tip){this.tip.enable()}if(this.overScheduledEventClass){this.setMouseOverEnabled(true)}},onBeforeDragCreate:function(e,h,f,g){return !this.readOnly&&!g.ctrlKey},onDragCreateStart:function(){if(this.overScheduledEventClass){this.setMouseOverEnabled(false)}if(this.tip){this.tip.hide();this.tip.disable()}this.disableViewScroller(true)},onDragCreateEnd:function(c,d){if(!this.getEventEditor()){if(this.fireEvent("beforeeventadd",this,d)!==false){this.onEventCreated(d);this.eventStore.append(d)}this.dragCreator.getProxy().hide()}if(this.overScheduledEventClass){this.setMouseOverEnabled(true)}},onEventCreated:function(b){},onAfterDragCreate:function(){if(this.overScheduledEventClass){this.setMouseOverEnabled(true)}if(this.tip){this.tip.enable()}this.disableViewScroller(false)},onBeforeResize:function(){return !this.readOnly},onResizeStart:function(){if(this.tip){this.tip.hide();this.tip.disable()}if(this.dragCreator){this.dragCreator.setDisabled(true)}this.disableViewScroller(true)},onResizeEnd:function(){if(this.tip){this.tip.enable()}if(this.dragCreator){this.dragCreator.setDisabled(false)}this.disableViewScroller(false)},setupEventListeners:function(){this.on({beforeeventdrag:this.onBeforeDragDrop,eventdragstart:this.onDragDropStart,aftereventdrop:this.onDragDropEnd,beforedragcreate:this.onBeforeDragCreate,dragcreatestart:this.onDragCreateStart,dragcreateend:this.onDragCreateEnd,afterdragcreate:this.onAfterDragCreate,beforeeventresize:this.onBeforeResize,eventresizestart:this.onResizeStart,eventresizeend:this.onResizeEnd,scope:this})},afterHeaderResized:function(){var c=this.headerCt.resizer;if(c&&this.getMode()!=="horizontal"){if(this.panel.forceFit){this.setColumnWidth(c.origWidth)}else{var d=c.dragHd.getWidth();this.setColumnWidth(d)}}},columnRenderer:function(h,j,g,i,f){return this[this.mode].columnRenderer(h,j,g,i,f)},onRowUpdated:function(f){var d=this,e;if(d.getMode()==="horizontal"&&d.hasListener("eventrepaint")){Ext.Array.forEach(f.getEvents(),function(a){e=d.getElementsFromEventRecord(a,f,null,true);Ext.Array.forEach(e,function(b){d.fireEvent("eventrepaint",d,a,b)})})}}});Ext.define("Sch.view.SchedulerGridView",{extend:"Sch.view.TimelineGridView",mixins:["Sch.mixin.SchedulerView","Sch.mixin.Localizable"],alias:"widget.schedulergridview"},function(){this.override(Sch.mixin.SchedulerView.prototype.inheritables()||{})});Ext.define("Sch.mixin.Zoomable",{zoomLevels:[{width:40,increment:1,resolution:1,preset:"manyYears",resolutionUnit:"YEAR"},{width:80,increment:1,resolution:1,preset:"manyYears",resolutionUnit:"YEAR"},{width:30,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:50,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:100,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:200,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:100,increment:1,resolution:7,preset:"monthAndYear",resolutionUnit:"DAY"},{width:30,increment:1,resolution:1,preset:"weekDateAndMonth",resolutionUnit:"DAY"},{width:35,increment:1,resolution:1,preset:"weekAndMonth",resolutionUnit:"DAY"},{width:50,increment:1,resolution:1,preset:"weekAndMonth",resolutionUnit:"DAY"},{width:20,increment:1,resolution:1,preset:"weekAndDayLetter"},{width:50,increment:1,resolution:1,preset:"weekAndDay",resolutionUnit:"HOUR"},{width:100,increment:1,resolution:1,preset:"weekAndDay",resolutionUnit:"HOUR"},{width:50,increment:6,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:100,increment:6,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:60,increment:2,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:60,increment:1,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:30,increment:15,resolution:5,preset:"minuteAndHour"},{width:60,increment:15,resolution:5,preset:"minuteAndHour"},{width:130,increment:15,resolution:5,preset:"minuteAndHour"},{width:60,increment:5,resolution:5,preset:"minuteAndHour"},{width:100,increment:5,resolution:5,preset:"minuteAndHour"},{width:50,increment:2,resolution:1,preset:"minuteAndHour"},{width:30,increment:10,resolution:5,preset:"secondAndMinute"},{width:60,increment:10,resolution:5,preset:"secondAndMinute"},{width:130,increment:5,resolution:5,preset:"secondAndMinute"}],minZoomLevel:null,maxZoomLevel:null,visibleZoomFactor:5,zoomKeepsOriginalTimespan:false,cachedCenterDate:null,isFirstZoom:true,isZooming:false,initializeZooming:function(){this.zoomLevels=this.zoomLevels.slice();this.setMinZoomLevel(this.minZoomLevel||0);this.setMaxZoomLevel(this.maxZoomLevel!==null?this.maxZoomLevel:this.zoomLevels.length-1);this.on("viewchange",this.clearCenterDateCache,this)},getZoomLevelUnit:function(b){return Sch.preset.Manager.getPreset(b.preset).getBottomHeader().unit},getMilliSecondsPerPixelForZoomLevel:function(f,e){var d=Sch.util.Date;return Math.round((d.add(new Date(1,0,1),this.getZoomLevelUnit(f),f.increment)-new Date(1,0,1))/(e?f.width:f.actualWidth||f.width))},presetToZoomLevel:function(c){var d=Sch.preset.Manager.getPreset(c);return{preset:c,increment:d.getBottomHeader().increment||1,resolution:d.timeResolution.increment,resolutionUnit:d.timeResolution.unit,width:d.timeColumnWidth}},zoomLevelToPreset:function(f){var d=Sch.preset.Manager.getPreset(f.preset).clone();var e=d.getBottomHeader();e.increment=f.increment;d.timeColumnWidth=f.width;if(f.resolutionUnit||f.resolution){d.timeResolution={unit:f.resolutionUnit||d.timeResolution.unit||e.unit,increment:f.resolution||d.timeResolution.increment||1}}return d},calculateCurrentZoomLevel:function(){var l=this.presetToZoomLevel(this.viewPreset),o=Number.MAX_VALUE,i=this.timeAxisViewModel,m=i.timeColumnWidth;l.width=m;l.increment=i.getBottomHeader().increment||1;for(var p=0,j=this.zoomLevels.length;p<j;p++){var n=this.zoomLevels[p];if(n.preset!==l.preset){continue}var k=Math.abs(n.width-m);if(k<o){o=k;l.actualWidth=n.actualWidth;l.width=n.width}}return l},getCurrentZoomLevelIndex:function(){var i=this.calculateCurrentZoomLevel();var g=this.getMilliSecondsPerPixelForZoomLevel(i);var j=this.zoomLevels;for(var l=0;l<j.length;l++){var k=this.getMilliSecondsPerPixelForZoomLevel(j[l]);if(k==g){return l}if(l===0&&g>k){return -0.5}if(l==j.length-1&&g<k){return j.length-1+0.5}var h=this.getMilliSecondsPerPixelForZoomLevel(j[l+1]);if(k>g&&g>h){return l+0.5}}throw"Can't find current zoom level index"},setMaxZoomLevel:function(b){if(b<0||b>=this.zoomLevels.length){throw new Error("Invalid range for `setMinZoomLevel`")}this.maxZoomLevel=b},setMinZoomLevel:function(b){if(b<0||b>=this.zoomLevels.length){throw new Error("Invalid range for `setMinZoomLevel`")}this.minZoomLevel=b},getViewportCenterDateCached:function(){if(this.cachedCenterDate){return this.cachedCenterDate}return this.cachedCenterDate=this.getViewportCenterDate()},clearCenterDateCache:function(){this.cachedCenterDate=null},zoomToLevel:function(M,w,J){M=Ext.Number.constrain(M,this.minZoomLevel,this.maxZoomLevel);J=J||{};var x=this.calculateCurrentZoomLevel();var K=this.getMilliSecondsPerPixelForZoomLevel(x);var C=this.zoomLevels[M];var N=this.getMilliSecondsPerPixelForZoomLevel(C);if(K==N&&!w){return null}var u=this;var B=this.getSchedulingView();var G=B.getOuterEl();var v=B.getScrollEventSource();var F=this.mode=="vertical";var H=w?new Date((w.start.getTime()+w.end.getTime())/2):this.getViewportCenterDateCached();var A=F?G.getHeight():G.getWidth();var z=Sch.preset.Manager.getPreset(C.preset).clone();var y=z.getBottomHeader();var I=Boolean(w);w=this.calculateOptimalDateRange(H,A,C,w);z[F?"timeRowHeight":"timeColumnWidth"]=J.customWidth||C.width;y.increment=C.increment;this.isZooming=true;this.viewPreset=C.preset;var L=this.timeAxis;z.increment=C.increment;z.timeResolution.unit=Sch.util.Date.getUnitByName(C.resolutionUnit||z.timeResolution.unit||y.unit);z.timeResolution.increment=C.resolution;this.setViewPreset(z,w.start||this.getStart(),w.end||this.getEnd(),false,true);C.actualWidth=this.timeAxisViewModel.getTickWidth();if(I){H=J.centerDate||new Date((L.getStart().getTime()+L.getEnd().getTime())/2)}var D=null,E=null;if(F){E=B.getYFromDate(H,true)-A/2;u.cachedCenterDate=H;B.getScrollable().scrollTo(null,E);B.headerCt.getScrollable().scrollTo(null,E)}else{D=B.getXFromDate(H,true)-A/2;u.cachedCenterDate=H;B.getScrollable().scrollTo(D);B.headerCt.getScrollable().scrollTo(D)}u.isZooming=false;u.fireEvent("zoomchange",u,M,D,E);return M},setZoomLevel:function(){this.zoomToLevel.apply(this,arguments)},zoomToSpan:function(y,v){if(y.start&&y.end&&y.start<y.end){v=v||{};if(v.leftMargin||v.rightMargin){v.adjustStart=0;v.adjustEnd=0}Ext.applyIf(v,{leftMargin:0,rightMargin:0});var H=y.start,K=y.end,J=v.adjustStart>=0&&v.adjustEnd>=0;if(J){H=Sch.util.Date.add(H,this.timeAxis.mainUnit,-v.adjustStart);K=Sch.util.Date.add(K,this.timeAxis.mainUnit,v.adjustEnd)}var N=this.getSchedulingView().getTimeAxisViewModel().getAvailableWidth();var B=Math.floor(this.getCurrentZoomLevelIndex());if(B==-1){B=0}var u=this.zoomLevels;var M=K-H,E=this.getMilliSecondsPerPixelForZoomLevel(u[B],true),C=M/E+v.leftMargin+v.rightMargin>N?-1:1,I=B+C;var z,G=null;while(I>=0&&I<=u.length-1){z=u[I];E=this.getMilliSecondsPerPixelForZoomLevel(z,true);var x=M/E+v.leftMargin+v.rightMargin;if(C==-1){if(x<=N){G=I;break}}else{if(x<=N){if(B!==I-C){G=I}}else{break}}I+=C}G=G!==null?G:I-C;z=u[G];var L=Sch.preset.Manager.getPreset(z.preset).getBottomHeader().unit;if(v.leftMargin||v.rightMargin){H=new Date(H.getTime()-E*v.leftMargin);K=new Date(K.getTime()+E*v.rightMargin)}var w=Sch.util.Date.getDurationInUnit(H,K,L,true)/z.increment;if(w===0){return}var F=Math.floor(N/w);var D=new Date((H.getTime()+K.getTime())/2);var A;if(J){A={start:H,end:K}}else{A=this.calculateOptimalDateRange(D,N,z)}return this.zoomToLevel(G,A,{customWidth:F,centerDate:D})}return null},zoomIn:function(d){d=d||1;var c=this.getCurrentZoomLevelIndex();if(c>=this.zoomLevels.length-1){return null}return this.zoomToLevel(Math.floor(c)+d)},zoomOut:function(d){d=d||1;var c=this.getCurrentZoomLevelIndex();if(c<=0){return null}return this.zoomToLevel(Math.ceil(c)-d)},zoomInFull:function(){return this.zoomToLevel(this.maxZoomLevel)},zoomOutFull:function(){return this.zoomToLevel(this.minZoomLevel)},calculateOptimalDateRange:function(r,m,p,k){if(k){return k}var n=this.timeAxis;if(this.zoomKeepsOriginalTimespan){return{start:n.getStart(),end:n.getEnd()}}var s=Sch.util.Date;var l=this.getZoomLevelUnit(p);var q=Math.ceil(m/p.width*p.increment*this.visibleZoomFactor/2);var t=s.add(r,l,-q);var o=s.add(r,l,q);return{start:n.floorDate(t,false,l,p.increment),end:n.ceilDate(o,false,l,p.increment)}}});Ext.define("Sch.mixin.AbstractTimelinePanel",{requires:["Sch.data.TimeAxis","Sch.view.model.TimeAxis","Sch.feature.ColumnLines","Sch.preset.Manager"],mixins:["Sch.mixin.Zoomable"],orientation:"horizontal",weekStartDay:1,snapToIncrement:false,readOnly:false,forceFit:false,eventResizeHandles:"both",timeAxis:null,autoAdjustTimeAxis:true,timeAxisViewModel:null,crudManager:null,viewPreset:"weekAndDay",calendarViewPreset:"week",trackHeaderOver:true,startDate:null,endDate:null,startTime:0,endTime:24,columnLines:true,getDateConstraints:Ext.emptyFn,snapRelativeToEventStartDate:false,trackMouseOver:false,readRowHeightFromPreset:true,eventBorderWidth:1,getOrientation:function(){return this.getMode.apply(this,arguments)},getMode:function(){return this.mode},isHorizontal:function(){return this.getMode()==="horizontal"},isVertical:function(){return !this.isHorizontal()},cellBorderWidth:1,cellTopBorderWidth:1,cellBottomBorderWidth:1,renderers:null,_initializeTimelinePanel:function(){this.mode=this.mode||this.orientation||"horizontal";if(this.mode==="calendar"){this.oldViewPreset=this.viewPreset;this.viewPreset=this.calendarViewPreset}var f=this.viewPreset&&Sch.preset.Manager.getPreset(this.viewPreset);if(!f){throw"You must define a valid view preset object. See Sch.preset.Manager class for reference"}this.initializeZooming();this.renderers=[];if(this.readRowHeightFromPreset){this.readRowHeightFromPreset=!this.rowHeight}if(!this.timeAxis){this.timeAxis=new Sch.data.TimeAxis({autoAdjust:this.autoAdjustTimeAxis,mode:this.mode==="calendar"?"calendar":"plain"})}if(!this.timeAxisViewModel||!(this.timeAxisViewModel instanceof Sch.view.model.TimeAxis)){var e=Ext.apply({mode:this.mode,snapToIncrement:this.snapToIncrement,forceFit:this.forceFit,timeAxis:this.timeAxis,eventStore:this.getEventStore(),viewPreset:this.viewPreset},this.timeAxisViewModel||{});this.timeAxisViewModel=new Sch.view.model.TimeAxis(e)}this.timeAxisViewModel.on("update",this.onTimeAxisViewModelUpdate,this);this.timeAxisViewModel.refCount++;this.on("destroy",this.onPanelDestroyed,this);var d;switch(this.mode){case"horizontal":d=["sch-horizontal"];break;case"vertical":d=["sch-vertical","sch-vertical-resource"];break;case"calendar":d=["sch-vertical","sch-calendar"];break}this.addCls([].concat.apply(["sch-timelinepanel"],d))},onTimeAxisViewModelUpdate:function(){var b=this.getSchedulingView();if(b&&b.viewReady){b.refreshKeepingScroll();this.fireEvent("viewchange",this)}},onPanelDestroyed:function(){var b=this.timeAxisViewModel;b.un("update",this.onTimeAxisViewModelUpdate,this);b.refCount--;if(b.refCount<=0){b.destroy()}},getSchedulingView:function(){throw"Abstract method call"},setReadOnly:function(b){this.getSchedulingView().setReadOnly(b)},isReadOnly:function(){return this.getSchedulingView().isReadOnly()},switchViewPreset:function(){this.setViewPreset.apply(this,arguments)},setViewPreset:function(j,r,o,m,q){var n=this.timeAxis;if(this.fireEvent("beforeviewchange",this,j,r,o)!==false){var k=this.getMode()==="horizontal";if(Ext.isString(j)){this.viewPreset=j;j=Sch.preset.Manager.getPreset(j)}if(!j){throw"View preset not found"}if(!(m&&n.isConfigured)){var p={weekStartDay:this.weekStartDay,startTime:this.startTime,endTime:this.endTime};if(m){if(n.getCount()===0||r){p.start=r||new Date()}}else{p.start=r||n.getStart()}p.end=o;n.consumeViewPreset(j);n.reconfigure(p,true);this.timeAxisViewModel.reconfigure({headerConfig:j.headerConfig,columnLinesFor:j.columnLinesFor||"middle",rowHeightHorizontal:this.readRowHeightFromPreset?j.rowHeight:(this.rowHeight||this.timeAxisViewModel.getViewRowHeight()),tickWidth:k?j.timeColumnWidth:j.timeRowHeight||j.timeColumnWidth||60,timeColumnWidth:j.timeColumnWidth,rowHeightVertical:j.timeRowHeight||j.timeColumnWidth||60,timeAxisColumnWidth:j.timeAxisColumnWidth,resourceColumnWidth:this.resourceColumnWidth||j.resourceColumnWidth||100})}var l=this.getSchedulingView();l.setDisplayDateFormat(j.displayDateFormat);if(this.getMode()==="vertical"){l.setColumnWidth(this.resourceColumnWidth||j.resourceColumnWidth||100,true)}if(!q){if(k){l.scrollHorizontallyTo(0)}else{l.scrollVerticallyTo(0)}}}},getViewPreset:function(){return this.viewPreset},getStart:function(){return this.getStartDate()},getStartDate:function(){return this.timeAxis.getStart()},getEnd:function(){return this.getEndDate()},getEndDate:function(){return this.timeAxis.getEnd()},setTimeColumnWidth:function(c,d){this.timeAxisViewModel.setTickWidth(c,d)},getTimeColumnWidth:function(){return this.timeAxisViewModel.getTickWidth()},getRowHeight:function(){return this.timeAxisViewModel.getViewRowHeight()},shiftNext:function(b){this.suspendLayouts&&this.suspendLayouts();this.timeAxis.shiftNext(b);this.suspendLayouts&&this.resumeLayouts(true)},shiftPrevious:function(b){this.suspendLayouts&&this.suspendLayouts();this.timeAxis.shiftPrevious(b);this.suspendLayouts&&this.resumeLayouts(true)},goToNow:function(){this.setTimeSpan(new Date())},setTimeSpan:function(c,d){if(this.timeAxis){this.timeAxis.setTimeSpan(c,d)}},setStart:function(b){this.setTimeSpan(b)},setEnd:function(b){this.setTimeSpan(null,b)},getTimeAxis:function(){return this.timeAxis},scrollToDate:function(h,e){var f=this.getSchedulingView();var g=f.getCoordinateFromDate(h,true);this.scrollToCoordinate(g,h,e,false)},scrollToDateCentered:function(j,f){var g=this.getSchedulingView();var h=0;if(this.mode==="horizontal"){h=g.getBox().width/2}else{h=g.getBox().height/2}var i=Math.round(g.getCoordinateFromDate(j,true)-h);this.scrollToCoordinate(i,j,f,true)},scrollToCoordinate:function(j,l,m,n){var h=this.getSchedulingView();var k=this;if(j<0){if(this.infiniteScroll){h.shiftToDate(l,n)}else{var i=(this.timeAxis.getEnd()-this.timeAxis.getStart())/2;this.setTimeSpan(new Date(l.getTime()-i),new Date(l.getTime()+i));if(n){k.scrollToDateCentered(l,m)}else{k.scrollToDate(l,m)}}return}if(this.mode==="horizontal"){h.scrollHorizontallyTo(j,m)}else{h.scrollVerticallyTo(j,m)}h.fireEvent("scroll",this,j)},getViewportCenterDate:function(){return this.getSchedulingView().getViewportCenterDate()},addCls:function(){throw"Abstract method call"},removeCls:function(){throw"Abstract method call"},registerRenderer:function(c,d){this.renderers.push({fn:c,scope:d})},deregisterRenderer:function(c,d){Ext.each(this.renderers,function(b,a){if(c===b){Ext.Array.removeAt(this.renderers,a);return false}})}});if(!Ext.ClassManager.get("Sch.mixin.TimelinePanel")){Ext.define("Sch.mixin.TimelinePanel",{extend:"Sch.mixin.AbstractTimelinePanel",requires:["Sch.column.timeAxis.Horizontal","Sch.preset.Manager","Sch.patches.NodeCache","Sch.patches.BufferedRenderer","Sch.patches.RowSynchronizer","Sch.patches.Chrome"],mixins:["Sch.mixin.Zoomable"],bufferCoef:5,bufferThreshold:0.2,infiniteScroll:false,showCrudManagerMask:true,waitingForAutoTimeSpan:false,columnLinesFeature:null,renderWaitListener:null,schedulePinchThreshold:30,pinchStartDistanceX:null,pinchStartDistanceY:null,pinchDistanceX:null,pinchDistanceY:null,horizontalColumns:null,verticalColumns:null,calendarColumns:null,forceDefineTimeSpanByStore:false,tipCfg:{cls:"sch-tip",showDelay:1000,hideDelay:0,autoHide:true,anchor:"b"},inheritables:function(){return{columnLines:true,enableLocking:true,lockable:true,stateEvents:["viewchange"],syncRowHeight:false,cellTopBorderWidth:0,constructor:function(b){b=b||{};if(this.layout==="border"){b.layout="border"}this.callParent([b])},initComponent:function(){if(this.partnerTimelinePanel){if(typeof this.partnerTimelinePanel==="string"){this.partnerTimelinePanel=Ext.getCmp(this.partnerTimelinePanel)}this.timeAxisViewModel=this.partnerTimelinePanel.timeAxisViewModel;this.timeAxis=this.partnerTimelinePanel.getTimeAxis();this.startDate=this.timeAxis.getStart();this.endDate=this.timeAxis.getEnd()}this._initializeTimelinePanel();this.configureChildGrids();this.forceFit=false;this.configureColumns();var h=this.normalViewConfig=this.normalViewConfig||{};var g=this.getId();Ext.apply(this.normalViewConfig,{id:g+"-timelineview",eventPrefix:this.autoGenId?null:g,timeAxisViewModel:this.timeAxisViewModel,eventBorderWidth:this.eventBorderWidth,timeAxis:this.timeAxis,readOnly:this.readOnly,mode:this.mode,rtl:this.rtl,cellBorderWidth:this.cellBorderWidth,cellTopBorderWidth:this.cellTopBorderWidth,cellBottomBorderWidth:this.cellBottomBorderWidth,infiniteScroll:this.infiniteScroll,bufferCoef:this.bufferCoef,bufferThreshold:this.bufferThreshold});Ext.Array.forEach(["eventRendererScope","eventRenderer","dndValidatorFn","resizeValidatorFn","createValidatorFn","tooltipTpl","validatorFnScope","eventResizeHandles","enableEventDragDrop","enableDragCreation","resizeConfig","createConfig","tipCfg","getDateConstraints"],function(a){if(a in this){h[a]=this[a]}},this);this.callParent(arguments);this.patchNavigationModel(this);this.setViewPreset(this.viewPreset,this.startDate||this.timeAxis.getStart(),this.endDate||this.timeAxis.getEnd(),true);if(!this.startDate){var f=this.getTimeSpanDefiningStore();if(Ext.data.TreeStore&&f instanceof Ext.data.TreeStore?f.getRootNode().childNodes.length:f.getCount()){this.applyStartEndDatesFromStore()}else{if(f.isLoading()||this.forceDefineTimeSpanByStore){this.bindAutoTimeSpanListeners()}}}var e=this.columnLines;if(e){this.columnLinesFeature=new Sch.feature.ColumnLines(Ext.isObject(e)?e:undefined);this.columnLinesFeature.init(this);this.columnLines=true}this.relayEvents(this.getSchedulingView(),["beforetooltipshow","scheduleclick","scheduledblclick","schedulecontextmenu","schedulepinch","schedulepinchstart","schedulepinchend"]);this.on("boxready",this.__onBoxReady,this);this.on("zoomchange",function(){this.normalGrid.scrollTask.cancel()});if(this.crudManager&&!this.crudManager.autoSync&&this.showCrudManagerMask){this.mon(this.crudManager,{beforesend:this.beforeCrudOperationStart,synccanceled:this.onCrudOperationComplete,loadcanceled:this.onCrudOperationComplete,load:this.onCrudOperationComplete,sync:this.onCrudOperationComplete,loadfail:this.onCrudOperationComplete,syncfail:this.onCrudOperationComplete,scope:this});if(this.crudManager.isLoading()){this.beforeCrudOperationStart(this.crudManager,null,"load")}}this.afterInitComponent()},getState:function(){var d=this,c=d.callParent(arguments);Ext.apply(c,{viewPreset:d.viewPreset,startDate:d.getStart(),endDate:d.getEnd(),zoomMinLevel:d.zoomMinLevel,zoomMaxLevel:d.zoomMaxLevel,currentZoomLevel:d.currentZoomLevel});return c},applyState:function(c){var d=this;d.callParent(arguments);if(c&&c.viewPreset){d.setViewPreset(c.viewPreset,c.startDate,c.endDate)}if(c&&c.currentZoomLevel){d.zoomToLevel(c.currentZoomLevel)}},setTimeSpan:function(){if(this.waitingForAutoTimeSpan){this.unbindAutoTimeSpanListeners()}this.callParent(arguments);if(!this.normalGrid.getView().viewReady){this.getView().refresh()}}}},bindAutoTimeSpanListeners:function(){var b=this.getTimeSpanDefiningStore();this.waitingForAutoTimeSpan=true;this.normalGrid.getView().on("beforerefresh",this.refreshStopper,this);this.lockedGrid.getView().on("beforerefresh",this.refreshStopper,this);this.mon(b,"load",this.applyStartEndDatesFromStore,this);if(Ext.data.TreeStore&&b instanceof Ext.data.TreeStore){this.mon(b,"rootchange",this.applyStartEndDatesFromStore,this);this.mon(b,"nodeappend",this.applyStartEndDatesAfterTreeAppend,this)}else{this.mon(b,"add",this.applyStartEndDatesFromStore,this)}},refreshStopper:function(b){return b.store.getCount()===0},getTimeSpanDefiningStore:function(){throw"Abstract method called"},unbindAutoTimeSpanListeners:function(){this.waitingForAutoTimeSpan=false;var b=this.getTimeSpanDefiningStore();this.normalGrid.getView().un("beforerefresh",this.refreshStopper,this);this.lockedGrid.getView().un("beforerefresh",this.refreshStopper,this);b.un("load",this.applyStartEndDatesFromStore,this);if(Ext.data.TreeStore&&b instanceof Ext.data.TreeStore){b.un("rootchange",this.applyStartEndDatesFromStore,this);b.un("nodeappend",this.applyStartEndDatesAfterTreeAppend,this)}else{b.un("add",this.applyStartEndDatesFromStore,this)}},applyStartEndDatesAfterTreeAppend:function(){var b=this.getTimeSpanDefiningStore();if(!b.isSettingRoot&&!b.__loading){this.applyStartEndDatesFromStore()}},applyStartEndDatesFromStore:function(){var d=this.getTimeSpanDefiningStore();var c=d.getTotalTimeSpan();if(c.end&&c.start&&c.end-c.start===0){c.start=Sch.util.Date.add(c.start,this.timeAxis.mainUnit,-1);c.end=Sch.util.Date.add(c.end,this.timeAxis.mainUnit,1)}this.setTimeSpan(c.start||new Date(),c.end)},onLockedGridItemDblClick:function(f,g,j,h,i){if(this.mode==="vertical"&&g){this.fireEvent("timeheaderdblclick",this,g.get("start"),g.get("end"),h,i)}},getSchedulingView:function(){return this.normalGrid.getView()},getHorizontalTimeAxisColumn:function(){return this.getSchedulingView().getHorizontalTimeAxisColumn()},configureColumns:function(){var e=this.columns||[];if(e.items){e=e.items}else{e=this.columns=e.slice()}var f=[];var d=[];Ext.Array.forEach(e,function(a){if(a.position==="right"){if(!Ext.isNumber(a.width)){Ext.Error.raise('"Right" columns must have a fixed width')}a.locked=false;d.push(a)}else{a.locked=true;f.push(a)}a.lockable=false});Ext.Array.erase(e,0,e.length);Ext.Array.insert(e,0,f.concat({xtype:"timeaxiscolumn",timeAxisViewModel:this.timeAxisViewModel,trackHeaderOver:this.trackHeaderOver,renderer:this.mainRenderer,scope:this}).concat(d));this.horizontalColumns=Ext.Array.clone(e);this.verticalColumns=[Ext.apply({xtype:"verticaltimeaxis",width:100,timeAxis:this.timeAxis,timeAxisViewModel:this.timeAxisViewModel,cellTopBorderWidth:this.cellTopBorderWidth,cellBottomBorderWidth:this.cellBottomBorderWidth},this.timeAxisColumnCfg||{})];this.calendarColumns=[Ext.apply({xtype:"verticaltimeaxis",width:60,timeAxis:this.timeAxis,timeAxisViewModel:this.timeAxisViewModel,cellTopBorderWidth:this.cellTopBorderWidth,cellBottomBorderWidth:this.cellBottomBorderWidth},this.calendarTimeAxisCfg||{})];if(this.mode==="vertical"){this.columns=this.verticalColumns.concat(this.createResourceColumns(this.resourceColumnWidth||this.timeAxisViewModel.resourceColumnWidth));this.store=this.timeAxis}else{if(this.mode==="calendar"){this.columns=[];this.store=null;this.on("afterrender",this.refreshCalendarColumns,this)}}},mainRenderer:function(u,i,p,n,m){var t=this.renderers,s=this.mode==="horizontal"||this.mode==="calendar"?p:this.resourceStore.getAt(m),v="&nbsp;";i.rowHeight=null;for(var r=0;r<t.length;r++){v+=t[r].fn.call(t[r].scope||this,u,i,s,n,m)||""}if(this.variableRowHeight){var o=this.getSchedulingView();var q=this.getRowHeight();i.style="height:"+((i.rowHeight||q)-o.cellTopBorderWidth-o.cellBottomBorderWidth)+"px"}return v},__onBoxReady:function(){var b=this;b.normalGrid.on({collapse:b.onNormalGridCollapse,expand:b.onNormalGridExpand,scope:b});b.lockedGrid.on({collapse:b.onLockedGridCollapse,itemdblclick:b.onLockedGridItemDblClick,scope:b});if(this.partnerTimelinePanel){if(this.partnerTimelinePanel.rendered){this.setupPartnerTimelinePanel()}else{this.partnerTimelinePanel.on("boxready",this.setupPartnerTimelinePanel,this)}}if(Ext.supports.Touch){this.getSchedulingView().on({schedulepinchstart:this.onSchedulePinchStart,schedulepinch:this.onSchedulePinch,schedulepinchend:this.onSchedulePinchEnd,scope:this})}},onLockedGridCollapse:function(){if(this.normalGrid.collapsed){this.normalGrid.expand()}},onNormalGridCollapse:function(){var b=this;if(!b.normalGrid.reExpander){b.normalGrid.reExpander=b.normalGrid.placeholder}if(!b.lockedGrid.rendered){b.lockedGrid.on("render",b.onNormalGridCollapse,b,{delay:1})}else{b.lockedGrid.flex=1;b.lockedGrid.updateLayout();if(b.lockedGrid.collapsed){b.lockedGrid.expand()}b.addCls("sch-normalgrid-collapsed")}},onNormalGridExpand:function(){this.removeCls("sch-normalgrid-collapsed");delete this.lockedGrid.flex;this.lockedGrid.updateLayout()},onPartnerCollapseExpand:function(b){if(b.getCollapsed()){this.lockedGrid.collapse()}else{this.lockedGrid.expand()}},setupPartnerTimelinePanel:function(){var o=this.partnerTimelinePanel;var n=o.down("splitter");var v=this.down("splitter");if(n){n.on("dragend",function(){this.lockedGrid.setWidth(o.lockedGrid.getWidth())},this)}if(v){v.on("dragend",function(){o.lockedGrid.setWidth(this.lockedGrid.getWidth())},this)}var s=o.isVisible()?o.lockedGrid.getWidth():o.lockedGrid.width;if(o.lockedGrid.getCollapsed()){o.lockedGrid.on("viewready",function(a){this.lockedGrid.setWidth(a.getWidth())},this)}else{this.lockedGrid.setWidth(s)}this.on("afterlayout",function(){if(o.lockedGrid.getCollapsed()){this.lockedGrid.collapse()}else{this.lockedGrid.expand();this.lockedGrid.setWidth(s)}},this,{single:true});o.lockedGrid.on({collapse:this.onPartnerCollapseExpand,expand:this.onPartnerCollapseExpand,scope:this});this.lockedGrid.on({collapse:this.onPartnerCollapseExpand,expand:this.onPartnerCollapseExpand,scope:o});var m=o.getSchedulingView(),q=m.scrollManager?m.scrollManager.scroller:m.getEl(),u=this.getSchedulingView(),l=u.scrollManager?u.scrollManager.scroller:u.getEl(),p,r=Ext.Function.createBuffered(function(){p=null},300);var t=function(c,d){var b=d.id===u.id?u:m;var a=d.id===u.id?m:u;if(!p){p=b}r();if(a!==p){a.setScrollX(b.getScroll().left)}};m.mon(l,"scroll",t);u.mon(q,"scroll",t);this.on("viewchange",function(){o.viewPreset=this.viewPreset},this);o.on("viewchange",function(){this.viewPreset=o.viewPreset},this)},beforeCrudOperationStart:function(e,f,d){if(this.rendered){this.setLoading({msg:d==="load"?this.L("loadingText"):this.L("savingText")})}else{Ext.destroy(this.renderWaitListener);this.renderWaitListener=this.on("render",Ext.Function.bind(this.beforeCrudOperationStart,this,Array.prototype.slice.apply(arguments)),this,{delay:1,destroyable:true})}},onCrudOperationComplete:function(){Ext.destroy(this.renderWaitListener);this.setLoading(false)},onSchedulePinchStart:function(d,c){this.pinchStartDistanceX=Math.abs(c.touches[0].pageX-c.touches[1].pageX);this.pinchStartDistanceY=Math.abs(c.touches[0].pageY-c.touches[1].pageY)},onSchedulePinch:function(d,c){this.pinchDistanceX=Math.abs(c.touches[0].pageX-c.touches[1].pageX);this.pinchDistanceY=Math.abs(c.touches[0].pageY-c.touches[1].pageY)},onSchedulePinchEnd:function(i,k){var l=this.pinchDistanceX;var m=this.pinchDistanceY;var j=this.getMode()[0]==="h";if(Math.abs(l-this.pinchStartDistanceX)>this.schedulePinchThreshold){var n=Math.abs(l/this.pinchStartDistanceX);if(j){n>1?this.zoomIn():this.zoomOut()}else{this.timeAxisViewModel.setViewColumnWidth(n*this.timeAxisViewModel.resourceColumnWidth)}}if(Math.abs(m-this.pinchStartDistanceY)>this.schedulePinchThreshold){var e=Math.abs(m/this.pinchStartDistanceY);i.setRowHeight(i.getRowHeight()*e)}this.pinchStartDistanceX=this.pinchStartDistanceY=this.pinchDistanceX=this.pinchDistanceY=null},patchNavigationModel:function(f){f.getView().getNavigationModel().focusItem=function(a){a.addCls(this.focusCls);if((Ext.isIE&&!a.hasCls("sch-timetd"))||(!Ext.isIE&&f.getOrientation()==="horizontal")){a.focus()}};var d=f.lockedGrid.getView();var e=f.normalGrid.getView();d.on("rowclick",function(c,h,b,a){if(e.lastFocused){e.lastFocused.rowIdx=a;e.lastFocused.record=h}});e.on("rowclick",function(c,h,b,a){if(d.lastFocused){d.lastFocused.rowIdx=a;d.lastFocused.record=h}})},configureChildGrids:function(){var e=this;e.lockedGridConfig=Ext.apply({},e.lockedGridConfig||{});e.normalGridConfig=Ext.apply({},e.schedulerConfig||e.normalGridConfig||{});var f=e.lockedGridConfig,d=e.normalGridConfig;if(e.lockedXType){f.xtype=e.lockedXType}if(e.normalXType){d.xtype=e.normalXType}Ext.applyIf(f,{useArrows:true,split:true,animCollapse:false,collapseDirection:"left",trackMouseOver:false,region:"west"});Ext.applyIf(d,{viewType:e.viewType,layout:"fit",enableColumnMove:false,enableColumnResize:false,enableColumnHide:false,trackMouseOver:false,collapseDirection:"right",collapseMode:"placeholder",animCollapse:false,region:"center"});if(e.mode==="vertical"){f.store=d.store=e.timeAxis}if(f.width){e.syncLockedWidth=Ext.emptyFn;f.scroll=Ext.supports.Touch?"both":"horizontal";f.scrollerOwner=true}},afterInitComponent:function(){var g=this;var h=g.lockedGrid.getView();var e=g.normalGrid.getView();var f=Ext.data.TreeStore&&g.store instanceof Ext.data.TreeStore;if(g.normalGrid.collapsed){g.normalGrid.collapsed=false;e.on("boxready",function(){g.normalGrid.collapse()},g,{delay:10})}if(g.lockedGrid.collapsed){if(h.bufferedRenderer){h.bufferedRenderer.disabled=true}}if(Ext.getScrollbarSize().width===0){h.addCls("sch-ganttpanel-force-locked-scroll")}if(f){this.setupLockableFilterableTree()}this.on("afterrender",function(){var a=this.lockedGrid.headerCt.showMenuBy;this.lockedGrid.headerCt.showMenuBy=function(){a.apply(this,arguments);g.showMenuBy.apply(this,arguments)}})},setupLockableFilterableTree:function(){var f=this;var d=f.lockedGrid.getView();var e=Sch.mixin.FilterableTreeView.prototype;d.initTreeFiltering=e.initTreeFiltering;d.onFilterChangeStart=e.onFilterChangeStart;d.onFilterChangeEnd=e.onFilterChangeEnd;d.onFilterCleared=e.onFilterCleared;d.onFilterSet=e.onFilterSet;d.initTreeFiltering()},showMenuBy:function(g,i){var j=this.getMenu(),l=j.down("#unlockItem"),k=j.down("#lockItem"),h=l.prev();h.hide();l.hide();k.hide()},zoomToFit:function(e){e=Ext.apply({adjustStart:1,adjustEnd:1},e);var d=this.getEventStore();var f=d.getTotalTimeSpan();if(this.zoomToSpan(f,e)===null){this.getSchedulingView().fitColumns()}}},function(){var d="5.1.0";Ext.apply(Sch,{VERSION:"3.0.6"});if(Ext.versions.extjs.isLessThan(d)){var c=console;c&&c.log("The Ext JS version you are using needs to be updated to at least "+d)}})}Ext.define("Sch.mixin.AbstractSchedulerPanel",{requires:["Sch.model.Event","Sch.model.Resource","Sch.data.EventStore","Sch.data.ResourceStore","Sch.util.Date","Sch.plugin.ResourceZones"],eventBarIconClsField:"",enableEventDragDrop:true,resourceColumnClass:"Sch.column.Resource",resourceColumnWidth:null,calendarColumnWidth:null,allowOverlap:true,startParamName:"startDate",endParamName:"endDate",passStartEndParameters:false,variableRowHeight:true,eventRenderer:null,eventRendererScope:null,eventStore:null,resourceStore:null,onEventCreated:function(b){},resourceZones:null,resourceZonesConfig:null,initStores:function(){var b=this.resourceStore||this.store;if(!b){if(this.crudManager){b=this.resourceStore=this.crudManager.getResourceStore()}b=b||new Sch.data.ResourceStore()}if(!this.eventStore){if(this.crudManager){this.eventStore=this.crudManager.getEventStore()}this.eventStore=this.eventStore||new Sch.data.EventStore();if(!this.eventStore){Ext.Error.raise("You must specify an eventStore config")}}this.store=Ext.StoreManager.lookup(b);this.resourceStore=this.store;this.eventStore=Ext.StoreManager.lookup(this.eventStore);if(!this.eventStore.isEventStore){Ext.Error.raise("Your eventStore should be a subclass of Sch.data.EventStore (or consume the EventStore mixin)")}this.resourceStore.eventStore=this.eventStore;if(this.passStartEndParameters){this.eventStore.on("beforeload",this.applyStartEndParameters,this)}},_initializeSchedulerPanel:function(){this.initStores();if(this.eventBodyTemplate&&Ext.isString(this.eventBodyTemplate)){this.eventBodyTemplate=new Ext.XTemplate(this.eventBodyTemplate)}},getResourceStore:function(){return this.resourceStore},getEventStore:function(){return this.eventStore},applyStartEndParameters:function(f,e){var d=f.getProxy();d.setExtraParam(this.startParamName,this.getStart());d.setExtraParam(this.endParamName,this.getEnd())},createResourceColumns:function(d){var e=[];var f=this;this.resourceStore.each(function(a){e.push(Ext.create(f.resourceColumnClass,{renderer:f.mainRenderer,scope:f,width:d||100,text:a.getName(),model:a}))});return e}});Ext.define("Sch.mixin.SchedulerPanel",{extend:"Sch.mixin.AbstractSchedulerPanel",requires:["Sch.view.SchedulerGridView","Sch.selection.EventModel","Sch.column.timeAxis.Vertical"],eventSelModelType:null,eventSelModel:null,enableEventDragDrop:true,enableDragCreation:true,dragConfig:null,componentCls:"sch-schedulerpanel",lockedGridDependsOnSchedule:true,verticalListeners:null,horizontalLockedWidth:null,inheritables:function(){return{variableRowHeight:true,initComponent:function(){var e=this.normalViewConfig=this.normalViewConfig||{};this._initializeSchedulerPanel();this.verticalListeners={clear:this.refreshResourceColumns,datachanged:this.refreshResourceColumns,update:this.refreshResourceColumns,load:this.refreshResourceColumns,scope:this};this.calendarListeners={reconfigure:this.refreshCalendarColumns,priority:1,scope:this};this.calendarViewListeners={columnresize:this.onCalendarColumnResize,scope:this};Ext.apply(e,{eventStore:this.eventStore,resourceStore:this.resourceStore,eventBarTextField:this.eventBarTextField||this.eventStore.model.prototype.nameField});Ext.Array.forEach(["barMargin","eventBodyTemplate","eventTpl","allowOverlap","dragConfig","eventBarIconClsField","onEventCreated","constrainDragToResource","snapRelativeToEventStartDate","eventSelModelType","simpleSelect","multiSelect","allowDeselect"],function(a){if(a in this){e[a]=this[a]}},this);this.callParent(arguments);if(this.mode==="vertical"){this.mon(this.resourceStore,this.verticalListeners)}var g=this.lockedGrid.getView();var h=this.getSchedulingView();this.registerRenderer(h.columnRenderer,h);if(this.resourceZones){var f=Ext.StoreManager.lookup(this.resourceZones);f.setResourceStore(this.resourceStore);this.resourceZonesPlug=new Sch.plugin.ResourceZones(Ext.apply({store:f},this.resourceZonesConfig));this.resourceZonesPlug.init(this)}h.on("columnwidthchange",this.onColWidthChange,this);this.relayEvents(h,["eventclick","eventmousedown","eventmouseup","eventdblclick","eventcontextmenu","eventmouseenter","eventmouseleave","eventkeydown","eventkeyup","beforeeventresize","eventresizestart","eventpartialresize","beforeeventresizefinalize","eventresizeend","beforeeventdrag","eventdragstart","eventdrag","beforeeventdropfinalize","eventdrop","aftereventdrop","beforedragcreate","dragcreatestart","beforedragcreatefinalize","dragcreateend","afterdragcreate","beforeeventadd"]);if(!this.syncRowHeight){this.enableRowHeightInjection(g,h)}},applyViewSettings:function(h,e){this.callParent(arguments);var g=this.getSchedulingView(),f;e=e||!this.rendered;if(this.orientation==="vertical"){f=h.timeColumnWidth||60;g.setColumnWidth(h.resourceColumnWidth||100,true);g.setRowHeight(f,true)}},afterRender:function(){this.callParent(arguments);if(this.mode==="calendar"){this.mon(this.timeAxis,this.calendarListeners);this.normalGrid.on(this.calendarViewListeners)}this.getSchedulingView().on({eventdragstart:this.doSuspendLayouts,aftereventdrop:this.doResumeLayouts,eventresizestart:this.doSuspendLayouts,eventresizeend:this.doResumeLayouts,scope:this});if(this.lockedGridDependsOnSchedule){this.normalGrid.getView().on("itemupdate",this.onNormalViewItemUpdate,this)}this.relayEvents(this.getEventSelectionModel(),["selectionchange","deselect","select"],"event")},getTimeSpanDefiningStore:function(){return this.eventStore}}},doSuspendLayouts:function(){var b=this.getSchedulingView();b.infiniteScroll&&b.timeAxis.on({beginreconfigure:this.onBeginReconfigure,endreconfigure:this.onEndReconfigure,scope:this});this.lockedGrid.suspendLayouts();this.normalGrid.suspendLayouts()},doResumeLayouts:function(){var b=this.getSchedulingView();b.infiniteScroll&&b.timeAxis.un({beginreconfigure:this.onBeginReconfigure,endreconfigure:this.onEndReconfigure,scope:this});this.lockedGrid.resumeLayouts();this.normalGrid.resumeLayouts()},onBeginReconfigure:function(){this.normalGrid.resumeLayouts()},onEndReconfigure:function(){this.normalGrid.suspendLayouts()},onColWidthChange:function(c,d){switch(this.getMode()){case"vertical":this.resourceColumnWidth=d;this.refreshResourceColumns();break;case"calendar":this.calendarColumnWidth=d;this.refreshCalendarColumns();break}},enableRowHeightInjection:function(e,g){var f=this;var h=new Ext.XTemplate("{%","this.processCellValues(values);","this.nextTpl.applyOut(values, out, parent);","%}",{priority:1,processCellValues:function(j){if(g.mode==="horizontal"){var d=1;if(g.dynamicRowHeight){var a=j.record;var b=g.eventLayout.horizontal;d=b.getNumberOfBands(a,function(){return g.eventStore.filterEventsForResource(a,g.timeAxis.isRangeInAxis,g.timeAxis)})}var c=(d*f.getRowHeight())-((d-1)*g.barMargin)-g.cellTopBorderWidth-g.cellBottomBorderWidth;j.style=(j.style||"")+";height:"+c+"px;"}}});e.addCellTpl(h);Ext.Array.forEach(e.getColumnManager().getColumns(),function(a){a.hasCustomRenderer=true});e.store.un("refresh",e.onDataRefresh,e);e.store.on("refresh",e.onDataRefresh,e);e.on("destroy",function(){e.store.un("refresh",e.onDataRefresh,e)})},getEventSelectionModel:function(){return this.getSchedulingView().getEventSelectionModel()},refreshResourceColumns:function(){var b=this.resourceColumnWidth||this.timeAxisViewModel.resourceColumnWidth;this.normalGrid.reconfigure(null,this.createResourceColumns(b))},onCalendarColumnResize:function(g,h,e){this.timeAxisViewModel.setViewColumnWidth(e,true);var f=this.getSchedulingView().calendar;f.repaintEventsForColumn(h,h.getIndex())},refreshCalendarColumns:function(){var c=this.createCalendarRows();var d=this.createCalendarColumns();this.reconfigure(c,this.calendarColumns.concat(d))},setOrientation:function(){this.setMode.apply(this,arguments)},setMode:function(o,r){if(!this.normalGrid){this.on("afterrender",function(){this.setMode(o,true)});return}if(o===this.mode&&!r){return}switch(o){case"horizontal":this.addCls("sch-horizontal");this.removeCls(["sch-vertical","sch-calendar","sch-vertical-resource"]);break;case"vertical":this.addCls(["sch-vertical-resource","sch-vertical"]);this.removeCls(["sch-calendar","sch-horizontal"]);break;case"calendar":this.addCls(["sch-calendar","sch-vertical"]);this.removeCls(["sch-vertical-resource","sch-horizontal"]);break}this.mode=o;var k=this,n=function(){return false},l=k.normalGrid,j=k.lockedGrid.getView(),m=k.getSchedulingView(),p=l.headerCt;j.on("beforerefresh",n);m.on("beforerefresh",n);m.blockRefresh=j.blockRefresh=true;m.setMode(o);Ext.suspendLayouts();p.removeAll(true);Ext.resumeLayouts();if(o!=="calendar"){k.timeAxis.setMode("plain");k.mun(k.timeAxis,k.calendarListeners);if(k._oldViewPreset){k.setViewPreset.apply(k,k._oldViewPreset);delete k._oldViewPreset}}else{k._oldViewPreset=[k.viewPreset,k.timeAxis.getStart(),k.timeAxis.getEnd()];k.timeAxis.setMode("calendar");k.setViewPreset(k.calendarViewPreset);k.mon(k.timeAxis,k.calendarListeners)}if(o==="horizontal"){k.mun(k.resourceStore,k.verticalListeners);k.normalGrid.un(k.calendarViewListeners);m.setRowHeight(k.rowHeight||k.timeAxisViewModel.rowHeightHorizontal,true);k.reconfigure(k.resourceStore,k.horizontalColumns);if(this.horizontalLockedWidth!==null){this.lockedGrid.setWidth(this.horizontalLockedWidth)}}else{if(o==="calendar"){k.mun(k.resourceStore,k.verticalListeners);k.normalGrid.on(k.calendarViewListeners);k.refreshCalendarColumns();m.setRowHeight(k.rowHeight||k.timeAxisViewModel.rowHeightVertical,true);m.setColumnWidth(k.timeAxisViewModel.calendarColumnWidth||100,true)}else{k.normalGrid.un(k.calendarViewListeners);var q=0;this.horizontalLockedWidth=this.lockedGrid.getWidth();k.mon(k.resourceStore,k.verticalListeners);k.reconfigure(k.timeAxis,k.verticalColumns.concat(k.createResourceColumns(k.resourceColumnWidth||k.timeAxisViewModel.resourceColumnWidth)));Ext.Array.forEach(k.lockedGrid.query("gridcolumn"),function(a){q+=a.rendered?a.getWidth():a.width||100});m.setColumnWidth(k.timeAxisViewModel.resourceColumnWidth||100,true);k.lockedGrid.setWidth(q)}}j.un("beforerefresh",n);m.un("beforerefresh",n);m.blockRefresh=j.blockRefresh=false;k.getView().refresh();this.fireEvent("modechange",this,o);this.fireEvent("orientationchange",this,o)},createCalendarRows:function(){var d=this;var c=d.timeAxis.getRowTicks();d.timeAxisViewModel.calendarRowsAmount=c.length;return new Ext.data.Store({model:"Sch.model.TimeAxisTick",data:c})},createCalendarColumns:function(){var d=this;var f=d.timeAxis.headerConfig.middle;var e=[];d.timeAxis.forEachAuxInterval(f.splitUnit,null,function(a,h,c){a.setHours(this.startTime);h=new Date(a);h.setHours(this.endTime);var b={xtype:"weekview-day",renderer:d.mainRenderer,scope:d,start:a,end:h};if(f.renderer){b.text=f.renderer.call(f.scope||d,a,h,b,c,d.eventStore)}else{b.text=Ext.Date.format(a,f.dateFormat)}e.push(b)});return e},setRowHeight:function(d,c){c=c||!this.lockedGrid;this.timeAxisViewModel.setViewRowHeight(d,c)},onNormalViewItemUpdate:function(f,e,g){if(this.lockedGridDependsOnSchedule){var h=this.lockedGrid.getView();h.suspendEvents();h.refreshNode(h.indexOf(f));h.resumeEvents()}}});Ext.define("Sch.mixin.FilterableTreeView",{prevBlockRefresh:null,initTreeFiltering:function(){var b=function(){var a=this.store;this.mon(a,"nodestore-datachange-start",this.onFilterChangeStart,this);this.mon(a,"nodestore-datachange-end",this.onFilterChangeEnd,this);if(!a.allowExpandCollapseWhileFiltered){this.mon(a,"filter-clear",this.onFilterCleared,this);this.mon(a,"filter-set",this.onFilterSet,this)}};if(this.rendered){b.call(this)}else{this.on("beforerender",b,this,{single:true})}},onFilterChangeStart:function(){this.prevBlockRefresh=this.blockRefresh;this.blockRefresh=true;Ext.suspendLayouts()},onFilterChangeEnd:function(){Ext.resumeLayouts(true);this.blockRefresh=this.prevBlockRefresh},onFilterCleared:function(){delete this.toggle;var b=this.getEl();if(b){b.removeCls("sch-tree-filtered")}},onFilterSet:function(){this.toggle=function(){};var b=this.getEl();if(b){b.addCls("sch-tree-filtered")}}});Ext.define("Sch.panel.TimelineGridPanel",{extend:"Ext.grid.Panel",mixins:["Sch.mixin.Localizable","Sch.mixin.TimelinePanel"],subGridXType:"gridpanel",initComponent:function(){this.callParent(arguments);this.getSchedulingView()._initializeTimelineView()}},function(){this.override(Sch.mixin.TimelinePanel.prototype.inheritables()||{})});if(!Ext.ClassManager.get("Sch.panel.TimelineTreePanel")){Ext.define("Sch.panel.TimelineTreePanel",{extend:"Ext.tree.Panel",requires:["Ext.grid.Panel","Ext.data.TreeStore","Sch.mixin.FilterableTreeView","Sch.patches.ColumnResizeTree"],mixins:["Sch.mixin.Localizable","Sch.mixin.TimelinePanel"],useArrows:true,rootVisible:false,lockedXType:"treepanel",initComponent:function(){this.callParent(arguments);this.getSchedulingView()._initializeTimelineView()}},function(){this.override(Sch.mixin.TimelinePanel.prototype.inheritables()||{})})}Ext.define("Sch.panel.SchedulerGrid",{extend:"Sch.panel.TimelineGridPanel",mixins:["Sch.mixin.SchedulerPanel"],alias:["widget.schedulergrid","widget.schedulerpanel"],alternateClassName:"Sch.SchedulerPanel",viewType:"schedulergridview",initComponent:function(){this.callParent(arguments);this.getSchedulingView()._initializeSchedulerView()}},function(){this.override(Sch.mixin.SchedulerPanel.prototype.inheritables()||{})});Ext.define("Sch.panel.SchedulerTree",{extend:"Sch.panel.TimelineTreePanel",mixins:["Sch.mixin.SchedulerPanel"],alias:["widget.schedulertree"],viewType:"schedulergridview",setOrientation:function(){return this.setMode.apply(this,arguments)},setMode:function(b){if(b!=="horizontal"){Ext.Error.raise("Sch.panel.SchedulerTree only support horizontal mode")}},initComponent:function(){this.callParent(arguments);this.getSchedulingView()._initializeSchedulerView()}},function(){this.override(Sch.mixin.SchedulerPanel.prototype.inheritables()||{})});Ext.define("Sch.widget.PagingToolbar",{extend:"Ext.toolbar.Paging",alias:"widget.sch_pagingtoolbar",getStoreId:function(){if(this.storeId){return this.storeId}var e=this.store.storeId;if(!e){var f=this.store.crudManager;var d=f&&f.getStore(this.store);e=d&&d.storeId}this.storeId=e;return e},loadPage:function(h){var e=this;if(e.store.crudManager){var f=e.getStoreId();if(f){var g={};g[f]={pageSize:e.store.pageSize,page:h};e.store.crudManager.load(g)}}else{e.store.loadPage(h)}},onPagingKeyDown:function(j,k){var m=this,e=k.getKey(),n=m.getPageData(),i=k.shiftKey?10:1,l;if(e==k.RETURN){k.stopEvent();l=m.readPageFromInput(n);if(l!==false){l=Math.min(Math.max(1,l),n.pageCount);if(m.fireEvent("beforechange",m,l)!==false){m.loadPage(l)}}}else{if(e==k.HOME||e==k.END){k.stopEvent();l=e==k.HOME?1:n.pageCount;j.setValue(l)}else{if(e==k.UP||e==k.PAGE_UP||e==k.DOWN||e==k.PAGE_DOWN){k.stopEvent();l=m.readPageFromInput(n);if(l){if(e==k.DOWN||e==k.PAGE_DOWN){i*=-1}l+=i;if(l>=1&&l<=n.pageCount){j.setValue(l)}}}}}},moveFirst:function(){if(this.fireEvent("beforechange",this,1)!==false){this.loadPage(1)}},movePrevious:function(){var c=this,d=c.store.currentPage-1;if(d>0){if(c.fireEvent("beforechange",c,d)!==false){c.loadPage(d)}}},moveNext:function(){var f=this,d=f.getPageData().pageCount,e=f.store.currentPage+1;if(e<=d){if(f.fireEvent("beforechange",f,e)!==false){f.loadPage(e)}}},moveLast:function(){var c=this,d=c.getPageData().pageCount;if(c.fireEvent("beforechange",c,d)!==false){c.loadPage(d)}},doRefresh:function(){var d=this,c=d.store.currentPage;if(d.fireEvent("beforechange",d,c)!==false){d.loadPage(c)}}});