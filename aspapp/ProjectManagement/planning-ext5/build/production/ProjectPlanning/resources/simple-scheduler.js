if(!stl.service){stl.service={}}stl.service.SimpleScheduler=function(a){var b={tasks:[],links:[],projectStartDate:ServerClientDateClass.getTodaysDate(),calendar:null};$.extend(this,b,a);if(this.calendar){this.setCalendar(this.calendar)}};$.extend(stl.service.SimpleScheduler.prototype,(function(){var a=8*60*60,b={sunday:0,monday:1,tuesday:2,wednesday:3,thursday:4,friday:5,saturday:6};return({scheduleAll:function(){var k={},j={};for(var f=0;f<this.tasks.length;f++){var d=this.tasks[f];d.startDate=this.projectStartDate;this.adjustTaskDatesForCalendarTime(d);k[d.uid]=d}for(var f=0;f<this.links.length;f++){var g=this.links[f],e=k[g.from],c=k[g.to];if(e&&c){var h=c&&j[c.uid];if(!h){h=j[c.uid]=[]}h.push(g)}else{}}for(var f=0;f<this.tasks.length;f++){var d=this.tasks[f];if(!d.visited){this.scheduleTask(d,j,k)}}for(var f=0;f<this.tasks.length;f++){delete this.tasks[f].visited;delete this.tasks[f].tempVisited}},scheduleTask:function(e,l,c){if(e.tempVisited){console.error("Cycle detected in link graph",e);return}if(!e.visited){e.tempVisited=true;var g=l[e.uid],j=0;if(g){for(var h=0;h<g.length;h++){var k=g[h],d=c[k.from];if(d){this.scheduleTask(d,l,c);var f=d.endDate.getTime();if(f>=j){j=f}}else{console.error("Found link from nonexistent task; link is",k,", target task is",e)}}}if(j>0&&j>e.startDate.getTime()){e.startDate=this.addDays(new Date(j),1);e.startDate.setHours(0,0,0,0);this.adjustTaskDatesForCalendarTime(e)}delete e.tempVisited;e.visited=true}},adjustTaskDatesForCalendarTime:function(c){if(c.status==="CO"){return}if(multipleORs(c.taskType,PE_SHORT,CMS_SHORT,IMS_SHORT)){c.endDate=new Date(c.date1);c.startDate=new Date(c.date1);return}c.duration=c.duration||0;c.endDate=c.startDate;var d=0;while(!this.dayIsWorking[c.startDate.getDay()]&&d<7){c.startDate=this.addDays(c.startDate,1);d++}if(d===7){console.log("Error: Couldn't find working day to start task",c);return}var f=c.duration/ONE_DAY_DURATION_DEFAULT_SEC,e=0;while(e<f){if(this.dayIsWorking[c.endDate.getDay()]){e++}c.endDate=this.addDays(c.endDate,1)}if(f!==0){c.endDate=this.addMinutes(c.endDate,-1)}},adjustDatesForDuration:function(d,g,c){var e=d;var h=g/ONE_DAY_DURATION_DEFAULT_SEC,f=0;if(c){while(f<h){e=this.addDays(e,1);if(this.dayIsWorking[e.getDay()]){f++}}}else{while(h&&h>0){e=this.substractDays(e,1);if(this.dayIsWorking[e.getDay()]){h--}}}return e},subtractDurationFromDate:function(e,f,i){var k=e;var d=Math.floor(f/ONE_DAY_DURATION_DEFAULT_SEC),j=0;var h=(f/ONE_DAY_DURATION_DEFAULT_SEC)%1;if(i){while(j<d){k=this.addDays(k,1);if(this.dayIsWorking[k.getDay()]){j++}}if(h!=0){var g=1;while(g==1){k=Ext.Date.add(new Date(k),Ext.Date.DAY,h);if(this.dayIsWorking[k.getDay()]){g++}}}}else{while(d&&d>0){k=this.substractDays(k,1);if(this.dayIsWorking[k.getDay()]){d--}}if(h!=0){var c=1;while(c==1){k=Ext.Date.add(new Date(k),Ext.Date.DAY,-h);if(this.dayIsWorking[k.getDay()]){c--}}}}return k},getDifferenceBetweenDays:function(h,c){var m=h;var f=0;var g=h.getTime();var l=c.getTime();var d=(g-l)/1000;var i=Math.floor(d/86400);var j=(d/86400)%1;var k=0;var e=i;while(e&&e>0){m=this.substractDays(m,1);if(!this.dayIsWorking[m.getDay()]){k++}e--}f=i-k+j;f=parseFloat(f.toFixed(2));return f},addDays:function(d,e){var c=new Date(d);c.setDate(d.getDate()+e);return c},substractDays:function(d,e){var c=new Date(d);c.setDate(d.getDate()-e);return c},addMinutes:function(c,d){return new Date(c.getTime()+(d*60000))},subtractMinutes:function(c,d){return new Date(c.getTime()-(d*60000))},setCalendar:function(c){this.dayIsWorking=[true,true,true,true,true,true,true];c.WeekDays.forEach(function(e){var d=b[e.Day.toLowerCase()];this.dayIsWorking[d]=e.IsWorking}.bind(this))}})})());