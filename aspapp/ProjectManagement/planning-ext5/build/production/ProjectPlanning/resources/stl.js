if(!window.console){window.console={log:function(){},warn:function(){},error:function(){},time:function(){},timeEnd:function(){}}}window.stl=window.stl||{view:{},data:{},model:{}};stl.app={};var ValidationClassInstance=null;stl.app.ProcessTypeEnum={EDITCHECKOUT:1,CHECKOUT:2,IDCC:3,REDOCCFB:4,CHECKBUFFERIMPACT:5,CHECKIN:6,SAVE:7,AUTOSAVE:8,VIEWPROJECT:9,LOADPROJECTREVISON:10,UNDOCHECKOUT:11};var availableResources=[];var DataStore=null;var ConfigData=null;stl.app.ResxStrings=null;var mappedProjectStore=null;var divisionStore=null;var portfolioStore=null;var businessStore=null;var customerStore=null;var managerStore=null;var Attribute1Store=null;var Attribute2Store=null;var Attribute3Store=null;var Attribute4Store=null;var Attribute5Store=null;var Attribute1FilterName="";var Attribute2FilterName="";var Attribute3FilterName="";var Attribute4FilterName="";var Attribute5FilterName="";var TemplateStore=null;var isSaveOnBrowserClose=true;var subtaskTypes=null;var taskTypes=null;var statusTypes=null;var participantStore=Ext.create("Ext.data.Store",{fields:["Id","Name"]});participantStore.loadData([{Id:"par1",Name:"Person 1"},{Id:"par2",Name:"Person 2"},{Id:"par3",Name:"Person 3"}]);var projectStore=null;var milestones=[{id:"m1",date:new Date(2014,8,31),name:"project end"},{id:"m2",date:new Date(2014,8,1),name:"deliverable 1"},{id:"m3",date:new Date(2014,8,1),name:"some other milestone"}];function LoadStoresWithData(){subtaskTypes=[{id:"3",name:stl.app.getColumnDisplayName("SPI_COLUMNS_AND_LABELS_SUBTASK_TYPE_WIP")},{id:"4",name:stl.app.getColumnDisplayName("SPI_COLUMNS_AND_LABELS_SUBTASK_TYPE_PARALLEL")},{id:"1",name:stl.app.getColumnDisplayName("SPI_COLUMNS_AND_LABELS_SUBTASK_TYPE_SEQUENTIAL")}];taskTypes=[{id:"snet",name:SNET_TEXT},{id:"purchasing",name:PURCHASING_TEXT},{id:"normal",name:Normal},{id:"IMS",name:"IMS"},{id:"CMS",name:"CMS"},{id:"PE",name:"PE"}];statusTypes=[{status:"NS",name:DataStore.FilterNames.NotStartedFilterName},{status:"IP",name:DataStore.FilterNames.InProgressFilterName},{status:"RL",name:DataStore.FilterNames.ReleasedFilterName},{status:"CO",name:DataStore.FilterNames.CompletedFilterName}];mappedProjectStore=Ext.create("Ext.data.Store",{id:"mappedProjectStore",fields:["ProjectName","Division","SSTField","Portfolio","BusinessUnit","ProjectManager","Customer","Attribute1","Attribute2","Attribute3","Attribute4","Attribute5",{name:"checked",type:"boolean",defaultValue:true}],sorters:[{property:"ProjectName",direction:"ASC"}]});if(DataStore.MappedProjectsInfo!=null){mappedProjectStore.loadData(DataStore.MappedProjectsInfo,true)}divisionStore=Ext.create("Ext.data.Store",{id:"divisionStore",fields:["DivisionName",{name:"checked",type:"boolean",defaultValue:true}],listeners:{datachanged:function(c,d){}},sorters:[{property:"DivisionName",direction:"ASC"}]});if(DataStore.DivisonList!=null){divisionStore.loadData(DataStore.DivisonList,true)}portfolioStore=Ext.create("Ext.data.Store",{id:"portfolioStore",fields:["PortfolioName","DivisionName",{name:"checked",type:"boolean",defaultValue:true}],listeners:{datachanged:function(c,d){}},sorters:[{property:"PortfolioName",direction:"ASC"}]});if(DataStore.PortfolioList!=null){portfolioStore.loadData(DataStore.PortfolioList,true)}businessStore=Ext.create("Ext.data.Store",{fields:["BusinessUnitName","DivisionName",{name:"checked",type:"boolean",defaultValue:true}],id:"businessUnitStore",listeners:{datachanged:function(c,d){}},sorters:[{property:"BusinessUnitName",direction:"ASC"}]});if(DataStore.BUList!=null){businessStore.loadData(DataStore.BUList,true)}customerStore=Ext.create("Ext.data.Store",{fields:["CustomerName","DivisionName",{name:"checked",type:"boolean",defaultValue:true}],id:"customerStore",listeners:{datachanged:function(d,c){}},sorters:[{property:"CustomerName",direction:"ASC"}]});if(DataStore.CustomerList!=null){customerStore.loadData(DataStore.CustomerList,true)}managerStore=Ext.create("Ext.data.Store",{fields:["ProjectManagerID","ProjectManagerName","DivisionName",{name:"checked",type:"boolean",defaultValue:true}],id:"managerStore",listeners:{datachanged:function(c,d){}},sorters:[{property:"ProjectManagerName",direction:"ASC"}]});if(DataStore.ProjectManagerList!=null){managerStore.loadData(DataStore.ProjectManagerList,true)}TemplateStore=Ext.create("Ext.data.Store",{fields:["Uid","Name","Division",{name:"checked",type:"boolean",defaultValue:true},{name:"Description",type:"string"}],id:"TemplateStore",listeners:{datachanged:function(d,c){}},sorters:[{property:"Name",direction:"ASC"}]});var b=[];a(DataStore.ProjectList,b);TemplateStore.loadData(b,true);function a(e,c){for(i=0;i<e.length;i++){if(e[i].IsTemplate){c.push(e[i])}}var d={};d.Name=SELECT_TEMPLATE;d.Description="";d.Division="";c.push(d)}if(DataStore.Attribute1List!=null){Attribute1Store=Ext.create("Ext.data.Store",{fields:["Attribute1Name","DivisionName",{name:"checked",type:"boolean",defaultValue:true}],id:"Attribute1Store",listeners:{datachanged:function(c,d){}},sorters:[{property:"Attribute1Name",direction:"ASC"}]});Attribute1Store.loadData(DataStore.Attribute1List,true)}if(DataStore.Attribute2List!=null){Attribute2Store=Ext.create("Ext.data.Store",{fields:["Attribute2Name","DivisionName",{name:"checked",type:"boolean",defaultValue:true}],id:"Attribute2Store",listeners:{datachanged:function(c,d){}},sorters:[{property:"Attribute2Name",direction:"ASC"}]});Attribute2Store.loadData(DataStore.Attribute2List,true)}if(DataStore.Attribute3List!=null){Attribute3Store=Ext.create("Ext.data.Store",{fields:["Attribute3Name","DivisionName",{name:"checked",type:"boolean",defaultValue:true}],id:"Attribute3Store",listeners:{datachanged:function(c,d){}},sorters:[{property:"Attribute3Name",direction:"ASC"}]});Attribute3Store.loadData(DataStore.Attribute3List,true)}if(DataStore.Attribute4List!=null){Attribute4Store=Ext.create("Ext.data.Store",{fields:["Attribute4Name","DivisionName",{name:"checked",type:"boolean",defaultValue:true}],id:"Attribute4Store",listeners:{datachanged:function(c,d){}},sorters:[{property:"Attribute4Name",direction:"ASC"}]});Attribute4Store.loadData(DataStore.Attribute4List,true)}if(DataStore.Attribute5List!=null){Attribute5Store=Ext.create("Ext.data.Store",{fields:["Attribute5Name","DivisionName",{name:"checked",type:"boolean",defaultValue:true}],id:"Attribute5Store",listeners:{datachanged:function(c,d){}},sorters:[{property:"Attribute5Name",direction:"ASC"}]});Attribute5Store.loadData(DataStore.Attribute5List,true)}projectStore=Ext.create("Ext.data.Store",{fields:["Name","Manager","Status","Division","Portfolio","BusinessUnit","Customer","Uid"],id:"projectStore",listeners:{datachanged:function(c,d){}},sorters:[{property:"Name",direction:"ASC"}]});projectStore.loadData(DataStore.ProjectList,true)}function showCentralMenu(){$(".centralMenu").show()}function hideCentralMenu(){$(".centralMenu").hide()}stl.app.onTaskSelectionChange=function(a,b){this.selectedTaskEl=b};function getHighlightMenu(l){var k=this.$highlightMenu,h=stl.model.Project.getProject();var m=stl.app.selectedTaskEl;if(!k){$(document.body).children(".highlight-popup").remove();k=this.$highlightMenu=$(".page-header .highlight").find(".tool-popup").clone(true);$(document.body).append(k)}k.empty();function j(x,w){var v=$(['<div class="tool-item">',"<label>",x,"</label>","</div>"].join(""));if(w){v.addClass(w)}return v}var g=j(NONE);g.off("click").on("click",highlightNoneClicked.bind(this,g));if(window.currentViewId!="table"){var f=j(RESOURCES,"highlight-resources");f.append($('<div class="tool-popup highlight-resources-popup"></div>'));f.off("click").on("click",stl.app.onHighlightResourcesClick.bind(this));var e=j(CC_TASKS,(!h.isIDCCed?"disabled":""));e.off("click").on("click",function(v){if(!h.isIDCCed){return}clearAllHighlight();$(".page-header .highlight").find(".button-text").text("Highlight: "+v.currentTarget.textContent);$(document).trigger("expandAllScopeNodes");$(document).trigger("highlightcctasks")});var d=j(RESOURCE_CONTENTION,(!isEnableResourceContentionOptionInHighlight(h)?"disabled":""));d.off("click").on("click",onHighlightResourceContentionClick.bind(this,d));var c=j(IMMEDIATE_PREDECESSORS);c.off("click").on("click",onHighlightImmediatePredecessorsClick.bind(this,c,m));var b=j(IMMEDIATE_SUCCESSORS);b.off("click").on("click",onHighlightImmediateSuccessorsClick.bind(this,b,m));var a=j(ALL_PREDECESSORS);a.off("click").on("click",onHighlightAllPredecessorsClick.bind(this,a,m));var t=j(ALL_SUCCESSORS);t.off("click").on("click",onHighlightAllSuccessorsClick.bind(this,t,m));var q=j(SHOW_CONSTRANING_SUCCESSOR_CHAIN);q.off("click").on("click",onHighlightConstrainingSuccessorChainClick.bind(this,q,m));var u=j(SHOW_LONGEST_PREDECESSOR_CHAIN);u.off("click").on("click",onHighlightLongestPredecessorChainClick.bind(this,u,m));var r=j(PHASES,"highlight-phases");r.append($('<div class="tool-popup highlight-phases-popup"></div>'));r.off("click").on("click",stl.app.onHighlightPhasesClick.bind(this));var p=j(TASK_MANAGERS,"highlight-task-managers");p.append($('<div class="tool-popup highlight-task-managers-popup"></div>'));p.off("click").on("click",stl.app.onHighlightTaskManagersClick.bind(this));var s=false;if($(".replan-mode-btn").hasClass("active btn-primary")){s=true}else{if($(".plan-mode-btn").hasClass("active btn-primary")){s=false}}var o=j(PROJECT_CMS_CHAINS,(s?"highlight-chains":"disabled"));if(s){o.append($('<div class="tool-popup highlight-chains-popup"></div>'));o.off("click").on("click",stl.app.onHighlightChainsClick.bind(this))}var n=j(SLACK,(!isEnableSlackInHighlightDropdown(h)?"disabled":""));n.off("click").on("click",onHighlightSlackClick.bind(this,n))}k.append(g);if(window.currentViewId!="table"){k.append(f);k.append(r);k.append(p);k.append(e);k.append(d);k.append(n);k.append(c);k.append(b);k.append(a);k.append(t);k.append(q);k.append(u);k.append(o)}return k}stl.app.onHighlightResourcesClick=function(a){var c=true;$(".page-header .highlight").find(".button-text").text("Highlight: "+a.currentTarget.textContent);clearAllHighlight(c,false,false,false);$(document).trigger("expandAllScopeNodes");var f=$(a.target).closest(".highlight-resources"),e=f.offset(),b=stl.app.getResourceHighlightMenu();var d=b.is(":visible");if(!d){b.show();b.css({top:e.top,left:e.left+f.outerWidth()});a.stopPropagation()}};stl.app.getResourceHighlightMenu=function(){if(!stl.app.$highlightResourcesMenu){$(document.body).children(".highlight-resources-popup").remove();stl.app.$highlightResourcesMenu=$(".highlight-resources").find(".tool-popup").clone(true);$(document.body).append(stl.app.$highlightResourcesMenu)}if(!stl.app.resourceHighlightMenuIsCurrent){stl.app.updateResourceHighlightMenu(stl.app.$highlightResourcesMenu)}return stl.app.$highlightResourcesMenu};stl.app.updateResourceHighlightMenu=function(c,a){var d=stl.app.getAvailableResourceOptions(),b=1;c.empty();c.append($(['<div class="tool-item" data-cmd="toggle-all-resource-highlight">',"<label>",'<input type="checkbox" /> <span class="resource-name">',ALL_TEXT,"</span>","</label>","</div>"].join("")));d.forEach(function(f){var e=$(['<div class="tool-item" data-cmd="toggle-resource-highlight">',"<label>",'<div class="resource-swatch resource-highlight-background-',String(b++),'"></div>','<input type="checkbox" /> <span class="resource-name"></span>',"</label>","</div>"].join(""));if(b==(MAX_NUMBER_OF_COLORS_USED_FOR_HIGHLIGHTING_RESOURCES+1)){b=1}e.find(".resource-name").text(f.text);e.data("resource-id",f.id);c.append(e)});stl.app.addHighlightPopupMenuHandlers(c);stl.app.resourceHighlightMenuIsCurrent=true};stl.app.getAvailableResourceOptions=function(){stl.app.cachedAvailableResourceOptions=stl.app.ProjectDataFromServer.getAvailableResources().map(function(a){return{id:a.uid,text:a.Name}});stl.app.cachedResourcesById=stl.app.ProjectDataFromServer.getAvailableResourcesByUid();return stl.app.cachedAvailableResourceOptions};stl.app.onHighlightChainsClick=function(a){var d=true,b=$(".matrix-view").data("view");$(".page-header .highlight").find(".button-text").text("Highlight: "+a.currentTarget.textContent);clearAllHighlight(false,false,false,d);var g=$(a.target).closest(".highlight-chains"),f=g.offset(),c=stl.app.getChainsHighlightMenu();var e=c.is(":visible");if(!e){c.show();c.css({top:f.top,left:f.left+g.outerWidth()});a.stopPropagation()}};stl.app.getChainsHighlightMenu=function(a){if(!stl.app.$chainsHighlightMenu){$(document.body).children(".highlight-chains-popup").remove();stl.app.$chainsHighlightMenu=$(".highlight-chains").find(".tool-popup").clone(true);$(document.body).append(stl.app.$chainsHighlightMenu)}if(!stl.app.chainsHighlightMenuIsCurrent){stl.app.updateChainsHighlightMenu(stl.app.$chainsHighlightMenu)}return stl.app.$chainsHighlightMenu};stl.app.updateChainsHighlightMenu=function(c,a){var b=stl.app.ProjectDataFromServer.getAllChainIds().sort(function(f,e){return f-e});var d=stl.app.ProjectDataFromServer.getChainsColorMap();c.empty();c.append($(['<div class="tool-item" data-cmd="toggle-all-chains-highlight">',"<label>",'<input type="checkbox" /> <span class="chain-number">',ALL_TEXT,"</span>","</label>","</div>"].join("")));b.forEach(function(f){var e=$(['<div class="tool-item" data-cmd="toggle-chain-highlight">',"<label>",'<div class="chain-swatch chain-highlight-background-',String(d[f]),'"></div>','<input type="checkbox" /> <span class="chain-number"></span>',"</label>","</div>"].join(""));e.find(".chain-number").text(f);e.data("chain-id",f);c.append(e)});stl.app.addHighlightPopupMenuHandlers(c);stl.app.chainsHighlightMenuIsCurrent=true};stl.app.onHighlightPhasesClick=function(a){var f=true;$(".page-header .highlight").find(".button-text").text("Highlight: "+a.currentTarget.textContent);clearAllHighlight(false,f,false,false);$(document).trigger("expandAllScopeNodes");var e=$(a.target).closest(".highlight-phases"),d=e.offset(),b=stl.app.getPhaseHighlightMenu();var c=b.is(":visible");if(!c){b.show();b.css({top:d.top,left:d.left+e.outerWidth()});a.stopPropagation()}};stl.app.getPhaseHighlightMenu=function(){if(!stl.app.$highlightPhasesMenu){$(document.body).children(".highlight-phases-popup").remove();stl.app.$highlightPhasesMenu=$(".highlight-phases").find(".tool-popup").clone(true);$(document.body).append(stl.app.$highlightPhasesMenu)}if(!stl.app.phaseHighlightMenuIsCurrent){stl.app.updatePhaseHighlightMenu(stl.app.$highlightPhasesMenu)}return stl.app.$highlightPhasesMenu};stl.app.updatePhaseHighlightMenu=function(c){var a=stl.app.ProjectDataFromServer.phases,b=1;c.empty();c.append($(['<div class="tool-item" data-cmd="toggle-all-phase-highlight">',"<label>",'<input type="checkbox" /> <span class="phase-name">',ALL_TEXT,"</span>","</label>","</div>"].join("")));a.forEach(function(d){if(d.type=="normal"){var e=$(['<div class="tool-item" data-cmd="toggle-phase-highlight">',"<label>",'<div class="phase-swatch phase-highlight-background-',String(b++),'"></div>','<input type="checkbox" /> <span class="phase-name"></span>',"</label>","</div>"].join(""));if(b==(MAX_NUMBER_OF_COLORS_USED_FOR_HIGHLIGHTING_PHASES+1)){b=1}e.find(".phase-name").text(d.name);e.data("phase-id",d.uid);c.append(e)}});stl.app.addHighlightPopupMenuHandlers(c);stl.app.phaseHighlightMenuIsCurrent=true};stl.app.onHighlightTaskManagersClick=function(b){var a=true;$(".page-header .highlight").find(".button-text").text("Highlight: "+b.currentTarget.textContent);clearAllHighlight(false,false,a,false);$(document).trigger("expandAllScopeNodes");var f=$(b.target).closest(".highlight-task-managers"),e=f.offset(),c=stl.app.getTaskManagerHighlightMenu();var d=c.is(":visible");if(!d){c.show();c.css({top:e.top,left:e.left+f.outerWidth()});b.stopPropagation()}};stl.app.getTaskManagerHighlightMenu=function(){if(!stl.app.$highlightTaskManagersMenu){$(document.body).children(".highlight-task-managers-popup").remove();stl.app.$highlightTaskManagersMenu=$(".highlight-task-managers").find(".tool-popup").clone(true);$(document.body).append(stl.app.$highlightTaskManagersMenu)}if(!stl.app.taskManagerHighlightMenuIsCurrent){stl.app.updateTaskManagerHighlightMenu(stl.app.$highlightTaskManagersMenu)}return stl.app.$highlightTaskManagersMenu};stl.app.updateTaskManagerHighlightMenu=function(c){var b=stl.app.availablePeopleAndTeams,a=1;c.empty();c.append($(['<div class="tool-item" data-cmd="toggle-all-task-manager-highlight">',"<label>",'<input type="checkbox" /> <span class="task-manager-name">',ALL_TEXT,"</span>","</label>","</div>"].join("")));b.forEach(function(e){var d=$(['<div class="tool-item" data-cmd="toggle-task-manager-highlight">',"<label>",'<div class="task-manager-swatch task-manager-highlight-background-',String(a++),'"></div>','<input type="checkbox" /> <span class="task-manager-name"></span>',"</label>","</div>"].join(""));if(a==(MAX_NUMBER_OF_COLORS_USED_FOR_HIGHLIGHTING_TASK_MANAGERS+1)){a=1}d.find(".task-manager-name").text(e.FullName);d.data("task-manager-id",e.Name);c.append(d)});stl.app.addHighlightPopupMenuHandlers(c);stl.app.taskManagerHighlightMenuIsCurrent=true};function highlightNoneClicked(b,a){if(b.hasClass("select")){b.removeClass("select")}else{$(".highlight").find(".button-text").text(HIGHLIGHT+a.currentTarget.textContent);b.addClass("select");clearAllHighlight()}}function getClassNameForRetainOption(d,e,b,a){var c;if(a){c="highlight-chains-popup"}else{if(d){c="highlight-resources-popup"}else{if(e){c="highlight-phases-popup"}else{if(b){c="highlight-task-managers-popup"}}}}return c}function clearAllHighlight(d,f,b,a){removeErrorHighlight();removePredecessorTaskHighlight();removeCCTaskHighlight();removeResourceContentionHighlight();removeSlackHighlight();var e=Ext.getCmp("timelineview");if(e){e.tasksToBeHighlighted=undefined}var c=getClassNameForRetainOption(d,f,b,a);if(!a){removeChainsHighlight()}if(!d){removeResourcesHighlight()}if(!f){removePhasesHighlight()}if(!b){removeTaskManagersHighlight()}resetPopups(c);removeLinksHighlight();removeConstrainingSuccessorChainHighlight();$(document).trigger("allhighlightscleared");removeMilestoneHighlight();setResourceGridRowClass("")}function setResourceGridRowClass(a){var b=Ext.getCmp("resGrid").getView();b.getRowClass=a;b.refresh()}function removeLinksHighlight(){var b=$(".matrix-view").data("view");if(b){var a=b.linksView.linksByID;$.each(a,function(e,g){var f=g;var c=g.to;var d=g.from;var h=false;h=b.linksView.isLinkInCriticalChain(c,d);if(h){f.color=null;b.linksView.triggerRefresh()}})}}function removeErrorHighlight(){$(".highlightedErrorTask").removeClass("highlightedErrorTask");$(".timeline-view").removeClass("highlightedErrorTask");var a=Ext.getCmp("tableview");if(a){els=Ext.select(".errorhighlightclass",a.getView().getEl());if(els.getCount()>0){els.each(function(b){$(b.dom).removeClass("errorhighlightclass")})}}}function removeMilestoneHighlight(){$(".highlightedMilestoneTask").removeClass("highlightedMilestoneTask");$(".timeline-view").removeClass("highlightedMilestoneTask")}function removePredecessorTaskHighlight(){var a=$("[class*='task-highlight']");for(i=0;i<a.length;i++){a[i].className=$(a[i]).attr("class").replace(/\btask-highlight.*?\b/g,"")}}function removeCCTaskHighlight(){$(".highlightedCCTask").removeClass("highlightedCCTask");$(".timeline-view").removeClass("highlighting-cc")}function removeResourceContentionHighlight(){$(".resourceContentionTask").removeClass("resourceContentionTask");$(".timeline-view").removeClass("resourceContentionTask")}function removeSlackHighlight(){$(".slack").removeClass("slack");$(".timeline-view").removeClass("slack")}function removeConstrainingSuccessorChainHighlight(){$(".constrainingSuccessorTask").removeClass("constrainingSuccessorTask");$(".timeline-view").removeClass("constrainingSuccessorTask")}function removeResourcesHighlight(){var a=$("[class*='highlight-resource-']");for(i=0;i<a.length;i++){a[i].className=$(a[i]).attr("class").replace(/\bhighlight-resource-.*?\b/g,"")}if(a.length>0){removeLegend()}stl.app.resourceHighlightMenuIsCurrent=false}function removePhasesHighlight(){var a=$("[class*='highlight-phase-']");for(i=0;i<a.length;i++){a[i].className=$(a[i]).attr("class").replace(/\bhighlight-phase-.*?\b/g,"")}if(a.length>0){removeLegend()}stl.app.phaseHighlightMenuIsCurrent=false}function removeTaskManagersHighlight(){var a=$("[class*='highlight-task-manager-']");for(i=0;i<a.length;i++){a[i].className=$(a[i]).attr("class").replace(/\bhighlight-task-manager-.*?\b/g,"")}if(a.length>0){removeLegend()}stl.app.taskManagerHighlightMenuIsCurrent=false}function removeChainsHighlight(){var a=$("[class*='highlight-chain-']");for(i=0;i<a.length;i++){a[i].className=$(a[i]).attr("class").replace(/\bhighlight-chain-.*?\b/g,"")}if(a.length>0){removeLegend()}stl.app.chainsHighlightMenuIsCurrent=false}function resetPopups(a){var b=Object.create(HIGHLIGHT_POPUPS_CSS_CLASS_SELECTOR);if(a){b.splice(b.indexOf("."+a),1);$('.tool-popup:not(".'+a+'")').find("input").prop("checked",false)}else{$(".tool-popup").find("input").prop("checked",false)}$(b.join(",")).hide()}function onHighlightCCTasksClicked(b,a){if($(this).hasClass("select")){$(this).removeClass("select")}else{$(document).trigger("expandAllScopeNodes");$(".highlight").find(".button-text").text(HIGHLIGHT+a.currentTarget.textContent);$(this).addClass("select")}}function onHighlightResourceContentionClick(b,a){if(!isEnableResourceContentionOptionInHighlight(stl.app.ProjectDataFromServer)){return}if($(this).hasClass("select")){$(this).removeClass("select")}else{$(".highlight").find(".button-text").text(HIGHLIGHT+a.currentTarget.textContent);$(this).addClass("select")}clearAllHighlight();toggleDockingGrids("resGrid","resourceSheet",true);$(document).trigger("expandAllScopeNodes");$(document).trigger("highlightResourceContention")}function onHighlightSlackClick(b,a){if(!isEnableSlackInHighlightDropdown(stl.app.ProjectDataFromServer)){return}if($(this).hasClass("select")){$(this).removeClass("select")}else{$(".highlight").find(".button-text").text(HIGHLIGHT+a.currentTarget.textContent);$(this).addClass("select")}clearAllHighlight();$(document).trigger("expandAllScopeNodes");$(document).trigger("highlightSlack")}function onHighlightConstrainingSuccessorChainClick(c,b,a){if(b){clearAllHighlight();$(document).trigger("expandAllScopeNodes");var d=window.currentViewId;if(d=="matrix"){stl.app.matrixView.onHighlightConstraining(null,b)}else{Ext.getCmp("timelineview").onHighlightConstraining(null,b)}$(".page-header .highlight").find(".button-text").text(HIGHLIGHT+a.currentTarget.textContent)}else{PPI_Notifier.info(SELECT_TASK_CONSTR_SUCC_CHAIN)}}stl.app.onHighlightConstraining=function(a,b){stl.app.highlightConstrainingTasks(b)};stl.app.highlightConstrainingTasks=function(a){var b=this;var c=a.data("model");constrainingTaskIds=this.project.getConstrainingTasks(c.uid);if(constrainingTaskIds.length>0){b.highlightChain(constrainingTaskIds,true,"constrainingSuccessorTask")}};function onHighlightLongestPredecessorChainClick(c,b,a){if(b){clearAllHighlight();$(document).trigger("expandAllScopeNodes");var d=window.currentViewId;if(d=="matrix"){stl.app.matrixView.onhighlightLongestPredecessorChain(null,b)}else{Ext.getCmp("timelineview").onhighlightLongestPredecessorChain(null,b)}$(".page-header .highlight").find(".button-text").text(HIGHLIGHT+a.currentTarget.textContent)}else{PPI_Notifier.info(PLEASE_SELECT_A_TASK_TO_HIGHLIGHT+SPACE_CONST+LONGEST_PREDECESSOR_CHAIN)}}function onHighlightImmediatePredecessorsClick(c,b,a){if(b){clearAllHighlight();$(document).trigger("expandAllScopeNodes");var e=window.currentViewId;var d;if(e=="matrix"){d=$(b).data("model").uid}else{d=$(b).find(".task").data("task-uid")}highlightImmediatePredecessors(d)}else{PPI_Notifier.info(SELECT_TASK_IMMED_PRED)}}function onHighlightAllPredecessorsClick(c,b,a){if(b){clearAllHighlight();$(document).trigger("expandAllScopeNodes");var e=window.currentViewId;var d;if(e=="matrix"){d=$(b).data("model").uid}else{d=$(b).find(".task").data("task-uid")}highlightAllPredecessors(d)}else{PPI_Notifier.info(SELECT_TASK_ALL_PRED)}}function highlightImmediatePredecessors(a){highlightPredecessors(a,false);$(".page-header .highlight").find(".button-text").text(HIGHLIGHT+IMMEDIATE_PREDECESSORS)}function highlightAllPredecessors(a){highlightPredecessors(a,true);$(".page-header .highlight").find(".button-text").text(HIGHLIGHT+ALL_PREDECESSORS)}function highlightLongestPredecessorChainByUid(a){var e=stl.app.ProjectDataFromServer,d=$(".matrix-view").data("view"),c=Ext.getCmp("timelineview");var b=e.getTaskOrMilestoneByUid(a);tasksInPredecessorChain=chainHighlightInstance.highlightLongestPredecessorChain(b);if(tasksInPredecessorChain.length>0){if(c){c.tasksToBeHighlighted=tasksInPredecessorChain;c.highlightChain(tasksInPredecessorChain,"constrainingSuccessorTask")}if(d){d.highlightChain(tasksInPredecessorChain,false,"constrainingSuccessorTask")}$(".page-header .highlight").find(".button-text").text(HIGHLIGHT+SHOW_LONGEST_PREDECESSOR_CHAIN);$(document).trigger("highlightchange")}}function highlightPredecessors(f,e){var d=this;var a=[];var c=$(".matrix-view").data("view");var b=Ext.getCmp("timelineview");getAllPredecessorsOfTask(a,f,e);if(b){b.tasksToBeHighlighted=a;b.highlightChain(a,"constrainingSuccessorTask")}if(c){c.highlightChain(a,false,"constrainingSuccessorTask")}}function onHighlightImmediateSuccessorsClick(c,b,a){if(b){clearAllHighlight();$(document).trigger("expandAllScopeNodes");var e=window.currentViewId;var d;if(e=="matrix"){d=$(b).data("model").uid}else{d=$(b).find(".task").data("task-uid")}highlightImmediateSuccessors(d);$(".page-header .highlight").find(".button-text").text(HIGHLIGHT+a.currentTarget.textContent)}else{PPI_Notifier.info(SELECT_TASK_IMMED_SUCC)}}function onHighlightAllSuccessorsClick(c,b,a){if(b){clearAllHighlight();$(document).trigger("expandAllScopeNodes");var e=window.currentViewId;var d;if(e=="matrix"){d=$(b).data("model").uid}else{d=$(b).find(".task").data("task-uid")}highlightAllSuccessors(d);$(".page-header .highlight").find(".button-text").text(HIGHLIGHT+a.currentTarget.textContent)}else{PPI_Notifier.info(SELECT_TASK_ALL_SUCC)}}function highlightImmediateSuccessors(a){highlightSuccessors(a,false)}function highlightAllSuccessors(a){highlightSuccessors(a,true)}function highlightSuccessors(e,f){var c=this;var d=[];var b=$(".matrix-view").data("view");var a=Ext.getCmp("timelineview");getAllSuccessorsOfTask(d,e,f);if(a){a.tasksToBeHighlighted=d;a.highlightChain(d,"constrainingSuccessorTask")}if(b){b.highlightChain(d,false,"constrainingSuccessorTask")}}function getAllPredecessorsOfTask(g,f,e){var d=this;var a,c,b;var h=stl.app.ProjectDataFromServer;b=h.getTaskOrMilestoneByUid(f);if(b){c=b._predecessors;g.push(b);if(e){$.each(c,function(k,j){getAllPredecessorsOfTask(g,j.uid,e)})}else{$.each(c,function(j,k){g.push(k)})}}}function getAllSuccessorsOfTask(d,e,g){var c=this;var a,h,b;var f=stl.app.ProjectDataFromServer;b=f.getTaskOrMilestoneByUid(e);if(b){h=b._successors;d.push(b);if(g){$.each(h,function(k,j){getAllSuccessorsOfTask(d,j.uid,g)})}else{$.each(h,function(j,k){d.push(k)})}}}function removeLegend(){if(stl.app.legendEl){$(stl.app.legendEl.dom).remove();delete stl.app.legendEl}}function updateLegend(a,e,d){var c=stl.app.getCurrentHighLightOption();if(!stl.app.legendEl||stl.app.legendEl.dom.getAttribute("parentid")!=window.currentViewId){switch(window.currentViewId){case"matrix":var b=$(".matrix-view")[0];break;case"table":var b=Ext.getCmp("tableview").getEl().dom;break;case"timeline":var b=Ext.getCmp("timelineview").getEl().dom;break}if(stl.app.legendEl){$(stl.app.legendEl.dom).remove();delete stl.app.legendEl}stl.app.legendEl=Ext.DomHelper.append(b,{tag:"div",cls:"legend",cmd:c,parentId:window.currentViewId},true)}switch(c){case RESOURCES:case PHASES:case TASK_MANAGERS:case PROJECT_CMS_CHAINS:this.updateLegendContent(a,e,d);break;default:stl.app.legendEl.hide();break}}function updateLegendContent(c,e,a){var h=$(stl.app.legendEl.dom).find(".legend-item");if(c){var j=h.find(".resource-highlight-background-"+e);if(j.length<=0){$(stl.app.legendEl.dom).append(['<div class="legend-item">','<div class="highlight-legend-swatch resource-swatch resource-highlight-background-',e,'"></div>','<div class="legend-item-label">',a,"</div>","</div>"].join(""));var h=$(stl.app.legendEl.dom).find(".legend-item");if(h.length>1){h.sort(function(m,l){return $(l).find(".legend-item-label").text()>$(m).find(".legend-item-label").text()?m:l});stl.app.legendEl.show()}if(h.length<0){stl.app.legendEl.hide()}}else{var f=j[0].parentElement;var b=$(f).find(".legend-item-label");var d=b.text();var g=d.split(STRING_SEPARATOR);if(g.indexOf(a)<0){g.push(a)}g.sort();b.html(g.join())}}else{var f=$(stl.app.legendEl.dom).find(".resource-highlight-background-"+e).parent();var b=$(f).find(".legend-item-label");var d=b.text();if(d!=null&&d!=undefined){var g=d.split(STRING_SEPARATOR);if(g.length===1){f.remove()}else{var k=g.indexOf(a);if(k>-1){g.splice(k,1)}b.html(g.join())}}setTimeout(function(){if(stl.app.legendEl&&$(stl.app.legendEl.dom).find(".legend-item").length<=0){$(stl.app.legendEl.dom).remove();delete stl.app.legendEl}},30)}}stl.app.isViewChangeRequired=false;stl.app.isHighlightRequired=false;stl.app.onProjectJsonChange=function(b,c,a,d,e){if(typeof(d)=="undefined"){stl.app.isViewChangeRequired=false}else{stl.app.isViewChangeRequired=d}if(typeof(e)=="undefined"){stl.app.isHighlightRequired=false}else{stl.app.isHighlightRequired=e}stl.app.loadProjectJson(c,a)};stl.app.initView=function(g){if(stl.app){stl.app.deleteLinks();var b=Ext.getCmp("matrix-view-container");if(b){$(stl.app.matrixView.linksView).off();$(stl.app.matrixView.taskView).off();b.destroy();stl.app.matrixView.destroy();stl.app.deleteTaskView()}if(stl.app.matrixView){delete stl.app.matrixView}var d=Ext.getCmp("scopeItemTree");if(d){d.destroy()}var c=Ext.getCmp("timelineview");if(c){c.destroy()}var a=Ext.getCmp("tableview");if(a){a.destroy()}if(stl.model.Project.project){stl.model.Project.project.destroy()}delete stl.app.ProjectDataFromServer}var f=Ext.getCmp("dockingPanel");if(!Ext.getCmp("CCSummarygrid")){f.add([{xtype:"milestoneSheet",id:"CCSummarygrid",resizable:false,width:"30%",flex:1},{xtype:"errorWarningSheet",id:"Error_Warning_Window",resizable:false,width:"40%",flex:1},{xtype:"resourceSheet",id:"resGrid",resizable:false,width:"30%",flex:1}])}var e=Ext.getCmp("content");$("#fade").addClass("reduced-height");switch(g){case PERT_VIEW:e.add({xtype:"component",id:"matrix-view-container"});break;case TIMELINE_VIEW:e.add({xtype:"timelineview",id:"timelineview"});break;case TABLE_VIEW:e.add({xtype:"ptableview",id:"tableview",tbar:Ext.create("ProjectPlanning.view.tableView.Toolbar")});break}Ext.getCmp("project-header").show();showLoadingIcon(true);if(!stl.app.CreateTaskToolBar){stl.app.CreateTaskToolBar=new stl.view.CreateTaskToolBar()}};stl.app.addView=function(f){var e=Ext.getCmp("content");switch(f){case PERT_VIEW:var b=Ext.getCmp("matrix-view-container");if(b){$(stl.app.matrixView.linksView).off();$(stl.app.matrixView.taskView).off();b.destroy();stl.app.matrixView.destroy();stl.app.deleteTaskView()}var d=Ext.getCmp("scopeItemTree");if(d){d.destroy()}e.add({xtype:"component",id:"matrix-view-container"});break;case TIMELINE_VIEW:var c=Ext.getCmp("timelineview");if(c){c.destroy()}e.add({xtype:"timelineview",id:"timelineview"});break;case TABLE_VIEW:var a=Ext.getCmp("tableview");if(a){a.destroy()}e.add({xtype:"ptableview",id:"tableview",tbar:Ext.create("ProjectPlanning.view.tableView.Toolbar")});break}};stl.app.deleteLinks=function(){if(stl.app.matrixView){if(stl.app.matrixView.linksView){stl.app.matrixView.linksView.clearAll();delete stl.app.matrixView.linksView}}if(Ext.getCmp("timelineview")){if(Ext.getCmp("timelineview").linksView){Ext.getCmp("timelineview").linksView.clearAll();delete Ext.getCmp("timelineview").linksView}}};stl.app.deleteTaskView=function(){if(stl.view.TaskView){for(var a in stl.view.TaskView){if(stl.view.TaskView.hasOwnProperty(a)){delete stl.view.TaskView[a]}}delete stl.view.TaskView.project}};stl.app.removeLink=function(b,a){stl.app.ProjectDataFromServer.removeLink(b,a)};stl.app.addLink=function(b,a){stl.app.ProjectDataFromServer.addLink({from:b,to:a})};stl.app.removeTaskFromRowModel=function(b,g,d){var f=stl.app.ProjectDataFromServer;var h=d;var c=f.getRowById(g).tasks[h];var e;var j;_.each(c,function(l,k){if(l.uid==b.uid){e=k}});var a=0;c.splice(e,1);if(b.isMS){stl.app.removeLinksForTask(b.uid)}else{stl.app.removeLinksForMS(b.uid)}};stl.app.removeLinksForTask=function(e){var d=stl.app.ProjectDataFromServer;var a=d.links;for(var b=a.length-1;b>=0;b--){var c=a[b];if(c.from===e||c.to===e){d.removeLink(c.from,c.to)}}};stl.app.removeLinksForMS=function(b){var e=stl.app.ProjectDataFromServer;var a=e.links;for(var c=a.length-1;c>=0;c--){var d=a[c];if(d.from===b||d.to===b){e.removeLink(d.from,d.to)}}};stl.app.updateExpandedStateOfRowModel=function(c,b){var a=_.find(stl.app.ProjectDataFromServer.rows,function(d){return d.uid==c});a.isExpanded=b};stl.app.ProjectDataFromServer;stl.app.SERVER_ROOT_URL="../../AppServices/PlanningUIService.svc/";stl.app.save=function(d,b){var c=this,a=stl.app.ProjectDataFromServer;if(a){stl.app.saveProjectToServer(d,b)}};stl.app.triggerSave=function(){if(this.saveTriggerEnabled==true){if(this.saveTimeout){clearTimeout(this.saveTimeout)}if(!this.saveDelegate){this.saveDelegate=stl.app.save.bind(this,stl.app.ProcessTypeEnum.AUTOSAVE)}var a=(parseInt(ConfigData.commonSettingsMap.DURATION_AUTO_SAVE.Value)*DURATION_MILISEC_MULTIPLIER)||AUTOSAVE_DURATION_MILISEC;this.saveTimeout=window.setTimeout(this.saveDelegate,a)}};stl.app.toggleSaveTrigger=function(a){if(a){this.saveTriggerEnabled=true}else{this.saveTriggerEnabled=false;if(this.saveTimeout){clearTimeout(this.saveTimeout)}}};stl.app.getProjectSummaryInfo=function(){return{ProjectUid:stl.app.ProjectDataFromServer.uid||"",name:stl.app.ProjectDataFromServer.name,duedate:new Date(stl.app.ProjectDataFromServer.dueDate),Division:stl.app.ProjectDataFromServer.division,Author:stl.app.ProjectDataFromServer.author,Subject:stl.app.ProjectDataFromServer.subject,Category:stl.app.ProjectDataFromServer.category,LastSaved:new Date(stl.app.ProjectDataFromServer.lastSaved),Manager:stl.app.ProjectDataFromServer.manager,isIDCCed:stl.app.ProjectDataFromServer.isIDCCed,Attribute1:stl.app.ProjectDataFromServer.attribute1,Attribute2:stl.app.ProjectDataFromServer.attribute2,Attribute3:stl.app.ProjectDataFromServer.attribute3,Attribute4:stl.app.ProjectDataFromServer.attribute4,Attribute5:stl.app.ProjectDataFromServer.attribute5,ProjectFileType:stl.app.ProjectDataFromServer.projectFileType,IsSubtaskEnabled:stl.app.ProjectDataFromServer.isSubtaskEnabled,ProjectParticipants:stl.app.ProjectDataFromServer.participants,ProjectPlanningMode:stl.app.ProjectDataFromServer.ProjectPlanningMode,ProjectCalendarName:stl.app.ProjectDataFromServer.projectCalendarName,DefaultStartTime:stl.app.ProjectDataFromServer.defaultStartTime,DefaultFinishTime:stl.app.ProjectDataFromServer.defaultFinishTime,DefaultHrsPerDay:stl.app.ProjectDataFromServer.defaultHrsPerDay,DefaultDaysPerWeek:stl.app.ProjectDataFromServer.defaultDaysPerWeek,CheckedOutUser:stl.app.ProjectDataFromServer.CheckedOutUser,CheckedOutStatus:stl.app.ProjectDataFromServer.CheckedOutStatus,ProjectStatus:stl.app.ProjectDataFromServer.ProjectStatus,IsComplexMode:stl.app.ProjectDataFromServer.IsComplexMode,Description:stl.app.ProjectDataFromServer.Description,CustomDate1:stl.app.checkIfValidDate(stl.app.ProjectDataFromServer.CustomDate1)?new Date(stl.app.ProjectDataFromServer.CustomDate1):null,CustomDate2:stl.app.checkIfValidDate(stl.app.ProjectDataFromServer.CustomDate2)?new Date(stl.app.ProjectDataFromServer.CustomDate2):null,PlannedDate:new Date(stl.app.ProjectDataFromServer.PlannedDate),InheritProjCalForResFlag:stl.app.ProjectDataFromServer.InheritProjCalForResFlag}};stl.app.checkIfValidDate=function(a){if(a){if(typeof a=="string"){if(a.indexOf("0001")!=-1){return false}if(a.indexOf("1901")!=-1){return false}if(a.indexOf("1899")!=-1){return false}}else{if(a.getFullYear()==1){return false}if(a.getFullYear()==1901){return false}if(a.getFullYear()==1899){return false}}return true}};stl.app.saveProjectToServer=function(d,a){var c=this,b=stl.app.getProjectSummaryInfo();if(!stl.app.ProjectDataFromServer.uid){$.ajax({type:"POST",dataType:"json",url:stl.app.SERVER_ROOT_URL+"SaveProjectTableData",data:JSON.stringify(b),contentType:"application/json; charset=utf-8"}).success(function(e){if(e!=SESSION_TIMED_OUT){stl.app.onProjectSummarySaved(d,b,e,a)}else{RedirectToLogInPage()}}.bind(this))}else{this.saveProjectJsonToServer(d,b,a)}};stl.app.saveTemplateToServer=function(f,b,d){var a=true;var e=this,c={ProjectUid:"",Description:d.description,name:d.name,duedate:stl.app.ProjectDataFromServer.dueDate,Division:stl.app.ProjectDataFromServer.division,Author:stl.app.ProjectDataFromServer.author,Subject:stl.app.ProjectDataFromServer.subject,Category:stl.app.ProjectDataFromServer.category,LastSaved:stl.app.ProjectDataFromServer.lastSaved,Manager:stl.app.ProjectDataFromServer.manager,isIDCCed:stl.app.ProjectDataFromServer.isIDCCed,Attribute1:stl.app.ProjectDataFromServer.attribute1,Attribute2:stl.app.ProjectDataFromServer.attribute2,Attribute3:stl.app.ProjectDataFromServer.attribute3,Attribute4:stl.app.ProjectDataFromServer.attribute4,Attribute5:stl.app.ProjectDataFromServer.attribute5,ProjectFileType:PROJECT_TYPE_PPI_TEMPLATE,IsSubtaskEnabled:stl.app.ProjectDataFromServer.isSubtaskEnabled,ProjectParticipants:stl.app.ProjectDataFromServer.participants,ProjectCalendarName:stl.app.ProjectDataFromServer.projectCalendarName,DefaultStartTime:stl.app.ProjectDataFromServer.defaultStartTime,DefaultFinishTime:stl.app.ProjectDataFromServer.defaultFinishTime,DefaultHrsPerDay:stl.app.ProjectDataFromServer.defaultHrsPerDay,DefaultDaysPerWeek:stl.app.ProjectDataFromServer.defaultDaysPerWeek,IsComplexMode:stl.app.ProjectDataFromServer.IsComplexMode,CheckedOutUser:stl.app.ProjectDataFromServer.CheckedOutUser,CheckedOutStatus:stl.app.ProjectDataFromServer.CheckedOutStatus,ProjectStatus:stl.app.ProjectDataFromServer.ProjectStatus,InheritProjCalForResFlag:stl.app.ProjectDataFromServer.InheritProjCalForResFlag};$.ajax({type:"POST",dataType:"json",url:stl.app.SERVER_ROOT_URL+"SaveProjectTableData",data:JSON.stringify(c),contentType:"application/json; charset=utf-8"}).success(function(g){if(g!=SESSION_TIMED_OUT){stl.app.onProjectSummarySaved(f,c,g,b,a)}else{RedirectToLogInPage()}})};stl.app.onProjectSummarySaved=function(c,e,d,b,a){if(parseInt(d)!==0){e.ProjectUid=d;if(e.ProjectFileType===PROJECT_TYPE_PPI){stl.app.ProjectDataFromServer.uid=d}if(b){stl.app.saveProjectJsonToServer(c,e,b,a)}else{stl.app.saveProjectJsonToServer(c,e,null,a)}}else{PPI_Notifier.error(PROJECT_SAVE_FAILED,FAILURE_MESSAGE);if(b){b(d)}}};stl.app.saveProjectJsonToServer=function(d,e,c,b){var a='{ "processType": '+d+',"projectData": '+JSON.stringify(e)+', "jsonBlob": '+stl.app.ProjectDataFromServer.getJSON(b,e.name)+', "CCSettings": '+JSON.stringify(CCSettingsStore.GetCCSettings())+', "CCSummary": '+JSON.stringify(GetUpdatedCCSummaryData())+" }";$.ajax({type:"POST",dataType:"json",url:stl.app.SERVER_ROOT_URL+"SaveJsonBlobData",data:a,contentType:"application/json; charset=utf-8"}).success(function(f){if(f!=SESSION_TIMED_OUT){if(f!==FALSE_CONSTANT){if(c){c(f)}if(!stl.app.revisionHistory){stl.app.revisionHistory=new stl.view.RevisionHistory({projectUid:e.ProjectUid});stl.app.revisionHistory.init()}else{stl.app.revisionHistory.callBackAfterSave()}}else{PPI_Notifier.error(PROJECT_SAVE_FAILED,FAILURE_MESSAGE)}}else{RedirectToLogInPage()}})};stl.app.getActiveView=function(a){if(stl.app.isViewChangeRequired){if(!a.projectData.isIDCCed){return PERT_VIEW}else{return TIMELINE_VIEW}}else{if($(".view-selector .btn.active").length==0){if(!a.projectData.isIDCCed){return PERT_VIEW}else{return TIMELINE_VIEW}}else{var b=$(".view-selector .btn.active").attr("class").split(" ")[0];if(b==TABLE_VIEW){b=PERT_VIEW}return b}}};stl.app.loadProjectEnd;stl.app.readOnlyFlag;stl.app.loadProjectJson=function(d,m,g,k,a,f){try{stl.app.isMatrixViewLoaded=false;stl.app.isTimelineViewLoaded=false;stl.app.isTableViewLoaded=false;console.log("Method called stl.app.loadProjectJson");var c=Ext.getCmp("resGrid");if(c){c.clearResourceStore()}var p;if(d!=""){p=JSON.parse(d,stl.model.Project.reconstituteDates)}var o=m;stl.app.readOnlyFlag=o;if(p!=null){if(!p.Errors){var q=p.projectData.name,l=p.projectData.ProjectUid;Ext.suspendLayouts();stl.app.DestroyMilestoneDialog();var b=stl.app.getActiveView(p);stl.app.initView(b,false);stl.app.setActiveView(b);p.projectData.viewOnlyMode=stl.app.readOnlyFlag;var j=this,n=stl.model.Project.fromJSON(p);n.readOnly=stl.app.readOnlyFlag;n.CC_Settings=p.CC_Settings;if(typeof(f)!="undefined"){n.updateProjectRootScopeName(k);n.uid=g;n.name=k;stl.app.setProjectInfo(n,f);stl.app.updateMilestoneDueDate(n,f.duedate)}if(p.projectData){n.isIDCCed=p.projectData.isIDCCed;n.isSubtaskEnabled=p.projectData.IsSubtaskEnabled;n.viewOnlyMode=p.projectData.viewOnlyMode;n.ProjectPlanningMode=p.projectData.ProjectPlanningMode;n.projectCalendarName=p.projectData.ProjectCalendarName;n.defaultStartTime=p.projectData.DefaultStartTime;n.defaultFinishTime=p.projectData.DefaultFinishTime;n.defaultHrsPerDay=p.projectData.DefaultHrsPerDay;n.defaultDaysPerWeek=p.projectData.DefaultDaysPerWeek;n.CheckedOutUser=p.projectData.CheckedOutUser;n.CheckedOutStatus=p.projectData.CheckedOutStatus;n.Description=p.projectData.Description;n.CustomDate1=p.projectData.CustomDate1;n.CustomDate2=p.projectData.CustomDate2;n.PlannedDate=p.projectData.PlannedDate}if(n.readOnly){$(".page-header-top .page-header-center .title")[0].innerHTML=n.name+PROJECT_NAME_READONLY_SUFFIX}else{$(".page-header-top .page-header-center .title")[0].innerHTML=n.name}stl.app.setDrawLinksOnLoad(n.links.length);stl.app.RevisionHistory=new stl.view.RevisionHistory({projectUid:l});if(p.projectData.ProjectPlanningMode==PLAN){if(p.CCSummary!=null){enableCCSummarybutton();disableBufferSummaryButton();PopulateCCSummaryStore(p.CCSummary)}}else{if(p.projectData.ProjectPlanningMode==REPLAN){if(p.BufferSummaryData){enableBufferSummaryButton();disableCCSummarybutton();PopulateBufferSummaryStore(p.BufferSummaryData)}}}if(p.CCSettings!=null){CCSettingsStore.PopulateStore(p.CCSettings)}if(stl.app.readOnlyFlag){stl.app.CreateTaskToolBar.disableAllBtn()}else{stl.app.CreateTaskToolBar.enableAllBtn()}stl.app.ProjectDataFromServer=n;stl.app.updateMilestoneSheet();stl.app.enableRemoveBuffersOption();stl.app.loadProjectInReqdView(b);Ext.resumeLayouts(true);if(!o){stl.app.save(stl.app.ProcessTypeEnum.AUTOSAVE)}}else{showErrorsAndWarnings(d,"Check Out")}if(o){$(".page-header-toolbar-top .requires-write").not(".calendarIcon").attr("disabled",true).addClass("disabled");$(".page-header-top .requires-write").not(".calendarIcon").attr("disabled",true).addClass("disabled")}else{$(".page-header-toolbar-top .requires-write").attr("disabled",false).removeClass("disabled");$(".page-header-top .requires-write").attr("disabled",false).removeClass("disabled")}if(c){c.updateAddDeleteButtons()}}}catch(h){console.log(h);onProjectLoadFailed()}};stl.app.setProjectInfo=function(b,a){b.dueDate=a.duedate;b.author=a.portfolio;b.category=a.businessUnit;b.subject=a.customer;b.manager=a.manager;b.attribute1=a.attribute1;b.attribute2=a.attribute2;b.attribute3=a.attribute3;b.attribute4=a.attribute4;b.attribute5=a.attribute5;b.projectFileType=a.projectFileType;b.participants=a.participants};stl.app.doUIChangesafterIDCC=function(){var a=!($("#ccSummary").hasClass("disabled")?true:false);if(stl.app.ProjectDataFromServer.isIDCCed&&a){toggleDockingGrids("CCSummarygrid","milestoneSheet",true);$(".page-header .highlight").find(".button-text").text(HIGHLIGHT+NONE);if(stl.app.isViewChangeRequired){$(".matrix-view-task-alignment").hide();$(".zoom-controls").css("display","inline-block");$(".highlight.btn").css("display","");$(document).trigger("viewchange","timeline");Ext.getCmp("timelineview").handleHighlightDropdownSelection();stl.app.CreateTaskToolBar.onViewChange("timelineview")}if(stl.app.isHighlightRequired){$(document).trigger("expandAllScopeNodes");$(".page-header .highlight").find(".button-text").text(HIGHLIGHT+CC_TASKS);$(document).trigger("highlightcctasks")}}};stl.app.doUIChangesafterReDoCCFB=function(){var a=!($("#bufferSummary").hasClass("disabled")?true:false);if(a){toggleDockingGrids("CCSummarygrid","milestoneSheet",true);$(".page-header .highlight").find(".button-text").text(HIGHLIGHT+NONE);if(stl.app.isViewChangeRequired){$(".matrix-view-task-alignment").hide();$(".zoom-controls").css("display","inline-block");$(".highlight.btn").css("display","");$(document).trigger("viewchange","timeline");Ext.getCmp("timelineview").handleHighlightDropdownSelection();stl.app.CreateTaskToolBar.onViewChange("timelineview")}if(stl.app.isHighlightRequired){$(document).trigger("expandAllScopeNodes");$(".page-header .highlight").find(".button-text").text(HIGHLIGHT+PEN_CHAIN);$(document).trigger("highlightPenChain")}}};stl.app.DestroyMilestoneDialog=function(){if(Ext.getCmp("msGrid")){Ext.getCmp("msGrid").store.clearData();toggleDockingGrids("CCSummarygrid","milestoneSheet",false)}};stl.app.updateMilestoneSheet=function(){var a=stl.app.ProjectDataFromServer;_.each(a._milestones,function(c,b){Ext.getCmp("CCSummarygrid").updateMilestoneSheet(c)})};stl.app.setProjectDataFromServer=function(a){stl.app.ProjectDataFromServer=a};stl.app.getCalendarSettingsData=function(){var a={};a.ProjectCalendarName=stl.app.ProjectDataFromServer.projectCalendarName;a.InheritProjCalForResFlag=stl.app.ProjectDataFromServer.InheritProjCalForResFlag;return a};stl.app.loadProjectInReqdView=function(a){var b=stl.app.ProjectDataFromServer.division;stl.app.loadResources(b,function(){stl.app.loadPeopleAndTeams(b,function(){stl.app.loadAvailableCalendars(b,function(){if(stl.app.CheckIfSelectedCalendarDeleted(stl.app.ProjectDataFromServer.projectCalendarName)){stl.app.ProjectDataFromServer.setDeletedCalendarNames(stl.app.ProjectDataFromServer.projectCalendarName);stl.app.ProjectDataFromServer.projectCalendarName=stl.app.defaultCalendarName}LoadCalendarData(b,stl.app.ProjectDataFromServer.projectCalendarName,function(){stl.app.ProjectDataFromServer.initializeCalendarData();CalendarStore.PopulateStore(stl.app.getCalendarSettingsData());stl.app.ProjectDataFromServer.updateGlobalMaxUnitsOfGlobalResourcesAssignedToProject();stl.app.ProjectDataFromServer.updateResourceSheet();stl.app.ProjectDataFromServer.getInfoMsgForUpdateCalendarNamesForResources();stl.app.setProjectModel(stl.app.ProjectDataFromServer,a);if(stl.app.isViewChangeRequired===false&&a==TIMELINE_VIEW){$(document).trigger("viewchange","timeline")}if(stl.app.ProjectDataFromServer.ProjectPlanningMode==1){stl.app.switchToPlanMode();stl.app.doUIChangesafterIDCC()}else{if(stl.app.ProjectDataFromServer.ProjectPlanningMode==2){stl.app.switchToReplanMode();stl.app.doUIChangesafterReDoCCFB()}}})})})})};stl.app.CheckIfSelectedCalendarDeleted=function(a){var e=stl.app.arrAvailableCalendars;var b=e.length;var d=true;for(var c=0;c<b;c++){if(e[c]==a){d=false;break}}return d};stl.app.enableRemoveBuffersOption=function(){if(stl.app.ProjectDataFromServer.isBufferTasksExist&&!stl.app.readOnlyFlag){$("#undoCCAB").removeClass("disabled");$("#undoCCAB").removeAttr("disabled")}},stl.app.updateMilestoneDueDate=function(b,a){_.each(b._milestones,function(d,c){d.date1=a})};stl.app.setProjectModel=function(b,d){switch(d){case PERT_VIEW:stl.app.matrixView=new stl.view.MatrixView({container:Ext.getCmp("matrix-view-container").el.dom,readOnly:stl.app.readOnlyFlag});stl.app.matrixView.init(null,b.name);stl.app.matrixView.loadProjectJson(b);break;case TIMELINE_VIEW:var c=Ext.getCmp("timelineview");if(c){c.setProjectModel(b);timelineview.readOnly=stl.app.readOnlyFlag}break;case TABLE_VIEW:var a=Ext.getCmp("tableview");if(a){a.readOnly=stl.app.readOnlyFlag;a.setProjectModel(b,stl.app.availablePeopleAndTeams)}break}};stl.app.loadResources=function(e,a){var b=this,c=e;var d=function(g){var k=JSON.parse(g);stl.app.globalResources=[];delete stl.app.globalResourcesByUid;stl.app.globalResourcesByUid={};for(var j=0;j<k.length;j++){var h=k[j],f=stl.app.addGlobalResource(h)}a()};LoadResourceData(c,d)};stl.app.loadPeopleAndTeams=function(e,b){var c=stl.app,d=e;stl.app.availablePeopleAndTeams=[];var a=function(f){c.availablePeopleAndTeams=JSON.parse(f);DataStore.availablePeopleAndTeams=c.availablePeopleAndTeams;b()};LoadUserAndTeamData(d,a)};stl.app.defaultCalendarName;stl.app.arrAvailableCalendars=[];stl.app.loadAvailableCalendars=function(e,a){var b=this,c=e;var d=function(g){var h=JSON.parse(g);var f=h[0];stl.app.defaultCalendarName=f[1];stl.app.arrAvailableCalendars=f[0];a()};GetDivisionBaseCalendars(c,d)};stl.app.globalResources=[];stl.app.globalResourcesByUid={};stl.app.nextResourceUid=1;stl.app.nextDefaultResourceIdx=0;stl.app.nextDefaultPhaseIdx=0;stl.app.addGlobalResource=function(b){var a=stl.app;if(b.uid){stl.app.nextResourceUid=Math.max(stl.app.nextResourceUid,Number(b.uid)+1)}else{b.uid=a.getNextResourceUid()}existingResource=a.globalResourcesByUid[b.uid];if(existingResource){a.globalResources.splice(a.globalResources.indexOf(existingResource),1,b)}else{a.globalResources.push(b)}a.globalResourcesByUid[b.uid]=b;$(a).trigger("resourcesinvalidated");return b};stl.app.getNextResourceUid=function(){return String(stl.app.nextResourceUid++)};stl.app.getNextAvailableResourceUid=function(){return String(stl.app.nextResourceUid)};stl.app.setNextAvailableResourceUid=function(a){stl.app.nextResourceUid=a};stl.app.getNextDefaultResourceIdx=function(a){return String(stl.app.nextDefaultResourceIdx++)};stl.app.getNextAvailableDefaultResourceIdx=function(a){return stl.app.nextDefaultResourceIdx};stl.app.setDefaultResourceIdx=function(a){stl.app.nextDefaultResourceIdx=a};stl.app.getGlobalResources=function(){return stl.app.globalResources};stl.app.getNextDefaultPhaseIdx=function(a){return String(stl.app.nextDefaultPhaseIdx++)};stl.app.getNextAvailableDefaultPhaseIdx=function(a){return stl.app.nextDefaultPhaseIdx};stl.app.setDefaultPhaseIdx=function(a){stl.app.nextDefaultPhaseIdx=a};stl.app.isProjectOpenInViewOnlyMode=function(){var a=false;if(stl.app.ProjectDataFromServer){a=stl.app.ProjectDataFromServer.viewOnlyMode}return a};stl.app.getColumnDisplayName=function(a){if(a&&ConfigData&&ConfigData.columnSettingsMap[a]){return ConfigData.columnSettingsMap[a].ColumnDisplayName}else{return a}};stl.app.isColumnHidden=function(a){if(a&&ConfigData&&ConfigData.columnSettingsMap[a]){return ConfigData.columnSettingsMap[a].IsHidden}else{return false}};stl.app.commonSettingValue=function(a){if(a&&ConfigData&&ConfigData.commonSettingsMap[a]){return ConfigData.commonSettingsMap[a].Value}else{return""}};stl.app.getDefaultSubtaskType=function(){var b=stl.app.commonSettingValue("DEFAULT_SUBTASK_TYPE");var a;if(b==WIPSubtasktypesConfigKey){a=SubtaskTypesEnum.WIP}else{if(b==SeqentialSubtasktypesConfigKey){a=SubtaskTypesEnum.SEQUENTIAL}else{if(b==ParallelSubtasktypesConfigKey){a=SubtaskTypesEnum.PARALLEL}}}return a};stl.app.defaultFeedingBufferPolicyValue=function(){if(ConfigData.commonSettingsMap.FEEDING_BUFFERS_POLICY){if(ConfigData.commonSettingsMap.FEEDING_BUFFERS_POLICY.Value=="LEAVE_TASKS_IN_PAST_VAL"){return"0"}else{if(ConfigData.commonSettingsMap.FEEDING_BUFFERS_POLICY.Value=="PUSH_OUT_PROJECT_DUE_DATE_VAL"){return"1"}else{if(ConfigData.commonSettingsMap.FEEDING_BUFFERS_POLICY.Value=="CONSUME_FEEDING_BUFFERS_VAL"){return"2"}}}}else{return"1"}};stl.app.defaultDurationReductionRoundingValue=function(){if(ConfigData.commonSettingsMap.DURATION_REDUCTION_ROUNDING){if(ConfigData.commonSettingsMap.DURATION_REDUCTION_ROUNDING.Value=="NO_ROUNDING"){return"0"}else{if(ConfigData.commonSettingsMap.DURATION_REDUCTION_ROUNDING.Value=="ROUND_TO_DAY"){return"1"}else{if(ConfigData.commonSettingsMap.DURATION_REDUCTION_ROUNDING.Value=="ROUND_TO_QUARTER"){return"2"}}}}else{return"1"}};stl.app.deletePropertiesOfObjectCollection=function(a){$.each(a,function(b,d){if(d){$(d).off();for(var c in d){delete d[c]}delete d}})};stl.app.getDownloadURL=function(b){var a="../DownloadFileWithoutTimeStamp.aspx?ProjectName="+this.ProjectDataFromServer.name+"&FileNameWithTimeStamp="+b+"&FileExtension=ccx&viewDebuf=False";return a};stl.app.DownloadSPIProject=function(a){if(!a.success){PPI_Notifier.error(a.data.toString());return}if(Number(stl.app.ProjectCheckOutStatus)==1){PPI_Notifier.info(LAST_CHECKEDIN_FILE_DOWNLOADED)}document.getElementById("download_iframe").src=stl.app.getDownloadURL(a.data.toString())};stl.app.CheckOutAndDownloadSPIProject=function(){var a=this.ProjectDataFromServer;CheckOutSPIProject(a.uid,a.name,this.DownloadSPIProject)};stl.app.setServerDateTimeFormat=function(){ServerClientDateClass.serverDateTimeInJS=new Date(serverTodayDate);ServerTimeFormat.setformat(serverTimeformat)};stl.app.setDrawLinksOnLoad=function(b){var a=50;if(getInternetExplorerVersion()===9&&b>a){$(".toggle-links-button").removeClass("pressed");PPI_Notifier.info(LINKS_ARE_NOT_DISPLAYED)}else{$(".toggle-links-button").addClass("pressed")}};stl.app.manageTimeOutSettings=function(){var a=new SessionTimeOut(ReDirectUrl,HandlerUrl);TimeLag=DefaultSessionTimeout-1;if(TimeLag<=0){TimeLag=1}TimeToPing=TimeLag*60*1000;timeOutID=0};stl.app.getCurrentHighLightOption=function(){var a=$(".highlight").find(".button-text").text();var c=a.split(COLON_SEPARATOR);var b=c[1].trim();return b};stl.app.addHighlightPopupMenuHandlers=function(b){if(!b){b=$("body")}var a=this;b.find(".tool-item").off("click").on("click",function(n){var k=$(n.target).closest(".tool-item"),j=k.closest(".tool-popup").data("phase-column"),f=k.data("cmd"),l=false;if(k.hasClass("disabled")){return}switch(f){case"toggle-all-resource-highlight":HighlightAllResources(k);l=true;break;case"toggle-resource-highlight":$("div[data-cmd='toggle-all-resource-highlight']").find("input").removeAttr("checked");HighlightResources(k);l=true;break;case"toggle-all-phase-highlight":HighlightAllPhases(k);l=true;break;case"toggle-phase-highlight":$("div[data-cmd='toggle-all-phase-highlight']").find("input").removeAttr("checked");HighlightPhases(k);l=true;break;case"toggle-all-task-manager-highlight":HighlightAllTaskManagers(k);l=true;break;case"toggle-task-manager-highlight":$("div[data-cmd='toggle-all-task-manager-highlight']").find("input").removeAttr("checked");HighlightTaskManagers(k);l=true;break;case"toggle-all-chains-highlight":stl.app.HighlightAllProjectChains(k);l=true;break;case"toggle-chain-highlight":$("div[data-cmd='toggle-all-chains-highlight']").find("input").removeAttr("checked");stl.app.HighlightProjectChain(k);l=true;break;case"highlight-immediate-predecessors":clearAllHighlight();var d=$(n.target).closest(".tool-popup").data("ms");highlightImmediatePredecessors(d.uid);break;case"highlight-all-predecessors":clearAllHighlight();var d=$(n.target).closest(".tool-popup").data("ms");highlightAllPredecessors(d.uid);break;case"highlight-successors":break;case"highlight-constraining-successors":clearAllHighlight();var d=$(n.target).closest(".tool-popup").data("ms"),o=a.milestoneElementsById[d.uid];a.highlightConstrainingTasks(o);$(".page-header .highlight").find(".button-text").text(HIGHLIGHT+SHOW_CONSTRANING_SUCCESSOR_CHAIN);$(document).trigger("highlightchange");break;case"highlight-longest-predecessor-chain":clearAllHighlight();var m=stl.app.ProjectDataFromServer;var d=$(n.target).closest(".tool-popup").data("ms");highlightLongestPredecessorChainByUid(d.uid);break;case"highlight-immediate-predecessors-for-fullkit":clearAllHighlight();var h=$(n.target).closest(".task").data("model").uid;var e=a.tasksByUid[$(n.target).closest(".task").data("model").uid].$el;highlightImmediatePredecessors(h);break;case"highlight-all-predecessors-for-fullkit":clearAllHighlight();var h=$(n.target).closest(".task").data("model").uid;var e=a.tasksByUid[$(n.target).closest(".task").data("model").uid].$el;highlightAllPredecessors(h);break;case"highlight-longest-predecessor-chain-for-fullkit":clearAllHighlight();var c=$(n.target).closest(".task");var g=[];g=a.highlightLongestPredecessorChain(c);if(g.length>0){a.highlightChain(g,false,"constrainingSuccessorTask");$(".page-header .highlight").find(".button-text").text(HIGHLIGHT+SHOW_LONGEST_PREDECESSOR_CHAIN)}break}if(l){n.stopPropagation()}else{k.closest(".tool-popup").fadeOut(250)}})};