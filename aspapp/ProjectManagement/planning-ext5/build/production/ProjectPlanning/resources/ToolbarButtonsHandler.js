window.stl=window.stl||{};stl.app=stl.app||{};stl.app.ActionType={CREATENEW:1,EDITCHECKEDOUT:2,CHECKEDOUT:3,VIEW:4,CHECKIN:5,UNDOCHECKOUT:6,INPLANEDITCHECKOUT:7,INPLANCHECKEDOUT:8,};stl.app.ProjectDetailsFromURL=null;stl.app.ProjectCheckOutStatus=1;stl.app.ProjectType=PROJECT_STATUS_IN_PLAN_INTEGER;stl.app.actionTypeValue=-1;stl.app.handleCheckInChekOutButtons=function(c){var a=stl.app.disableButton;var d=stl.app.changeButtonText;var b=stl.app.hideButton;stl.app.actionTypeValue=c;switch(c){case 1:case 7:case 8:b($("#checkin"),false);b($("#checkindropdown"),false);b($("#checkout"),true);break;case 2:case 3:b($("#checkin"),false);b($("#checkindropdown"),false);b($("#checkout"),true);break;case 4:case 5:case 6:b($("#checkin"),true);b($("#checkindropdown"),true);b($("#checkout"),false);break;default:break}};stl.app.HandleCheckoutButtonAsPerProjectPrivilege=function(a,b){if(stl.app.IsViewproject){if(stl.app.projectPrivileges){if(a==1){if(b!=stl.app.loggedInUserName){stl.app.disableButton($("#checkout"),true)}}else{if(a==0){if(stl.app.projectPrivileges.CHECK_OUT==false){stl.app.disableButton($("#checkout"),true)}}}}}stl.app.IsViewproject=false};stl.app.UpdateDownloadButtonBasedOnProjectStatus=function(a,b){var c=(b===PROJECT_TYPE_PPI_TEMPLATE||a===IN_PLAN_TYPE);stl.app.disableButton($("#download"),c)};stl.app.WireToolBarlisteners=function(){$("#savedropdown").on("click",function(a){var c=$(a.target);if(c.hasClass("disabled")||c.attr("disabled")){return}if(c.parent().length>0){if(c.parent().hasClass("disabled")){return}}var b=$(a.target),e=b.offset(),f=getSaveMenu(a);var d=f.is(":visible");$(".tool-popup").hide();if(!d){f.show();f.css({top:e.top+b.outerHeight(),left:e.left+b.outerWidth()-f.outerWidth()});a.stopPropagation()}});$("#checkindropdown").on("click",function(c){var d=$(c.target);var b=$(c.target),f=b.offset(),a=getCheckinMenu(c);var e=a.is(":visible");$(".tool-popup").hide();if(!e){a.show();a.css({top:f.top+b.outerHeight(),left:f.left+b.outerWidth()-a.outerWidth()});c.stopPropagation()}});$("#calendar-button").on("click",function(a){var b=$(a.target);if(b.hasClass("disabled")||b.attr("disabled")){return}showCalendarDialog()});$("#settings-button").on("click",function(a){var b=$(a.target);if(b.hasClass("disabled")||b.attr("disabled")){return}showCCSettingDialog()});$("#save").on("click",function(a){var b=$(a.target);if(b.hasClass("disabled")||b.attr("disabled")){return}SaveProject()});$("#checkin").on("click",function(a){InvokeCheckIn();toggleDockingGrids("resGrid","resourceSheet",false);toggleDockingGrids("Error_Warning_Window","errorWarningSheet",false)});$(".checkout-btn").on("click",function(a){InvokeCheckOut(stl.app.ProjectDataFromServer.uid,stl.app.ProjectDataFromServer.name,stl.app.ProjectType,stl.app.ProjectCheckOutStatus);toggleDockingGrids("resGrid","resourceSheet",false);toggleDockingGrids("Error_Warning_Window","errorWarningSheet",false)});$(".download-btn").on("click",function(a){stl.app.CheckOutAndDownloadSPIProject()});$(".matrix-view-btn").on("click",function(a){stl.app.redirectToMatrixView()});$(".timeline-view-btn").on("click",function(a){stl.app.redirectToTimelineView()});$(".table-view-btn").on("click",function(a){stl.app.redirectToTableView()});$(".plan-mode-btn").on("click",function(a){stl.app.switchToPlanMode()});$(".replan-mode-btn").on("click",function(a){stl.app.switchToReplanMode()});$(".logo").on("click",function(a){});$(".resourceSheet").on("click",function(a){if($(".resourceSheet").hasClass("pressed")){toggleDockingGrids("resGrid","resourceSheet",false)}else{toggleDockingGrids("resGrid","resourceSheet",true)}});$(".milestoneSheet").on("click",function(a){if($(".milestoneSheet").hasClass("pressed")){toggleDockingGrids("CCSummarygrid","milestoneSheet",false)}else{toggleDockingGrids("CCSummarygrid","milestoneSheet",true)}});$(".errorWarningSheet").on("click",function(a){toggleDockingGrids("Error_Warning_Window","errorWarningSheet",!$(this).hasClass("pressed"))});$(".toggle-links-button").on("click",function(a){$(this).toggleClass("pressed");$(document).trigger("togglelinks",[$(this).hasClass("pressed")])});$(".zoom-button.zoom-in").off().on("click",function(a){$(document).trigger("zoomin")});$(".zoom-button.zoom-out").off().on("click",function(a){$(document).trigger("zoomout")});$(".zoom-button.zoom-in").addClass("disabled");$(".revisionHistoryImg").on("click",function(a){$(this).toggleClass("pressed");if(!stl.app.revisionHistory){stl.app.revisionHistory=new stl.view.RevisionHistory({projectUid:stl.model.Project.project.uid});stl.app.revisionHistory.init()}else{stl.app.revisionHistory.readOnly=stl.app.isProjectOpenInViewOnlyMode();stl.app.revisionHistory.toggleRefreshRevsionHistoryPanel()}});$("#undo").on("click",function(a){});$("#identifyCC").on("click",function(a){if(stl.model.Project.validateProject(stl.app.ProjectDataFromServer)){$(".page-header .highlight").find(".button-text").text(HIGHLIGHT);RunIDCC()}});$("#redoCCFB").on("click",function(a){if(stl.model.Project.validateProject(stl.app.ProjectDataFromServer)){ReDoCC()}});$("#ccSummary").on("click",function(a){$(".milestoneSheet").trigger("click")});$("#acceptPlan").on("click",function(a){AcceptPlanClicked()});$("#bufferSummary").on("click",function(a){$(".milestoneSheet").trigger("click")});$("#undoCCAB").on("click",function(a){stl.app.ProjectDataFromServer.removeBufferTasks();var c=stl.app.getProjectSummaryInfo();c.isIDCCed=false;var b='{ "projectData": '+JSON.stringify(c)+', "jsonBlob": '+stl.app.ProjectDataFromServer.getJSON()+', "CCSettings": '+JSON.stringify(CCSettingsStore.GetCCSettings())+" }";$(document).trigger("projectjsonchange",[b,false,false]);toggleDockingGrids("CCSummarygrid","milestoneSheet",false);Ext.getCmp("msGrid").store.clearData();undoCCABClick()});$(".highlight").off().on("click",function(a){var e=$(a.target).closest(".highlight"),d=e.offset(),b=getHighlightMenu(a);var c=b.is(":visible");$(".tool-popup").hide();if(!c){b.show();if(window.currentViewId!="table"){b.css({top:d.top+e.outerHeight(),left:d.left})}else{b.css({top:d.top+e.outerHeight(),left:d.left})}a.stopPropagation()}})};stl.app.disableButton=function(b,a){b.attr("disabled",a)};stl.app.changeButtonText=function(a,b){a.text(b)};stl.app.hideButton=function(b,a){if(a){b.hide()}else{b.show()}};stl.app.switchToPlanMode=function(a){$(".planningmode-selector-buttons .btn").removeClass("active btn-primary");$(".plan-mode-btn").addClass("active btn-primary");showPlanningButtons();clearAllHighlight();$(".highlight").find(".button-text").text(HIGHLIGHT+NONE)};stl.app.switchToReplanMode=function(a){$(".planningmode-selector-buttons .btn").removeClass("active btn-primary");$(".replan-mode-btn").addClass("active btn-primary");showReplanningButtons();clearAllHighlight();$(".highlight").find(".button-text").text(HIGHLIGHT+NONE)};stl.app.isMatrixViewLoaded=false;stl.app.isTimelineViewLoaded=false;stl.app.isTableViewLoaded=false;stl.app.milestoneUIDForChainToBeHighlighted;stl.app.isLoadPending=function(){return(!(stl.app.isMatrixViewLoaded&&stl.app.isTimelineViewLoaded&&stl.app.isTableViewLoaded))};stl.app.loadOtherViews=function(){if(!stl.app.isMatrixViewLoaded){stl.app.addView(PERT_VIEW,true);stl.app.setProjectModel(stl.app.ProjectDataFromServer,PERT_VIEW);stl.app.matrixView.isFirstSwitch=false}if(!stl.app.isTimelineViewLoaded){stl.app.addView(TIMELINE_VIEW);stl.app.setProjectModel(stl.app.ProjectDataFromServer,TIMELINE_VIEW)}if(!stl.app.isTableViewLoaded){stl.app.addView(TABLE_VIEW);stl.app.setProjectModel(stl.app.ProjectDataFromServer,TABLE_VIEW)}};stl.app.restoreHighlightBtnText=function(){var a=$(".highlight").find(".button-text");if(a.text()==HIGHLIGHT&&stl.app.oldHighlightText){a.text(stl.app.oldHighlightText);delete stl.app.oldHighlightText}};stl.app.saveHighlightText=function(){var a=$(".highlight").find(".button-text");if(a.text()!=HIGHLIGHT+ERROR){stl.app.oldHighlightText=a.text();a.text(HIGHLIGHT)}};stl.app.redirectToMatrixView=function(){if(!stl.app.isMatrixViewLoaded){stl.app.addView(PERT_VIEW,true);showLoadingIcon(true);setTimeout(function(){stl.app.setProjectModel(stl.app.ProjectDataFromServer,PERT_VIEW);stl.app.matrixView.isFirstSwitch=false;stl.app.postProcessMatrixViewLoad()},50)}else{stl.app.postProcessMatrixViewLoad()}};stl.app.postProcessMatrixViewLoad=function(){$(".view-selector .btn").removeClass("selected-btn");$(".matrix-view-btn").addClass("selected-btn");if(!(Ext.getCmp("content").getLayout().getActiveItem().getId()=="matrix-view-container")){Ext.getCmp("content").getLayout().setActiveItem("matrix-view-container")}$(".view-selector .btn").removeClass("active btn-primary");$(".matrix-view-task-alignment").show();$(".zoom-controls").css("display","inline-block");$(".highlight.btn").css("display","");stl.app.restoreHighlightBtnText();$(".matrix-view-btn").addClass("active btn-primary");$(document).trigger("viewchange","matrix");stl.app.matrixView.handleHighlightDropdownSelection();stl.app.CreateTaskToolBar.onViewChange("matrixview");if(stl.app.matrixView.isFirstSwitch){stl.app.matrixView.isFirstSwitch=false}};stl.app.redirectToTimelineView=function(){if(!stl.app.isTimelineViewLoaded){stl.app.addView(TIMELINE_VIEW);showLoadingIcon(true);stl.app.setProjectModel(stl.app.ProjectDataFromServer,TIMELINE_VIEW)}$(".view-selector .btn").removeClass("selected-btn");$(".timeline-view-btn").addClass("selected-btn");if(!(Ext.getCmp("content").getLayout().getActiveItem().getId()=="timelineview")){Ext.getCmp("content").getLayout().setActiveItem("timelineview")}$(".view-selector .btn").removeClass("active btn-primary");$(".matrix-view-task-alignment").hide();$(".zoom-controls").css("display","inline-block");$(".highlight.btn").css("display","");stl.app.restoreHighlightBtnText();$(".timeline-view-btn").addClass("active btn-primary");$(document).trigger("viewchange","timeline");Ext.getCmp("timelineview").handleHighlightDropdownSelection();stl.app.CreateTaskToolBar.onViewChange("timelineview")};stl.app.redirectToTableView=function(){if(stl.app.isLoadPending()){showLoadingIcon(true);setTimeout(function(){stl.app.loadOtherViews();stl.app.postProcessTableViewLoad();hideLoadingIcon()},50)}else{stl.app.postProcessTableViewLoad()}};stl.app.postProcessTableViewLoad=function(){$(".view-selector .btn").removeClass("selected-btn");$(".table-view-btn").addClass("selected-btn");Ext.getCmp("content").getLayout().setActiveItem("tableview");$(".view-selector .btn").removeClass("active btn-primary");$(".matrix-view-task-alignment").hide();$(".zoom-controls").css("display","none");stl.app.saveHighlightText();$(".table-view-btn").addClass("active btn-primary");window.currentViewId="table";stl.app.CreateTaskToolBar.onViewChange("tableview")};stl.app.setActiveView=function(a){$(".view-selector .btn").removeClass("active btn-primary");$(".view-selector .btn").removeClass("selected-btn");$("."+a).addClass("active btn-primary");switch(a){case"matrix-view-btn":Ext.getCmp("content").getLayout().setActiveItem("matrix-view-container");stl.app.CreateTaskToolBar.onViewChange("matrixview");stl.app.setCurrentViewId(MATRIX_VIEW_ID);$(".matrix-view-btn").addClass("selected-btn");break;case"timeline-view-btn":Ext.getCmp("content").getLayout().setActiveItem("timelineview");stl.app.CreateTaskToolBar.onViewChange("timelineview");stl.app.setCurrentViewId(TIMELINE_VIEW_ID);$(".timeline-view-btn").addClass("selected-btn");break;case"table-view-btn":Ext.getCmp("content").getLayout().setActiveItem("tableview");stl.app.CreateTaskToolBar.onViewChange("tableview");stl.app.setCurrentViewId(TABLE_VIEW_ID);$(".table-view-btn").addClass("selected-btn");break;default:Ext.getCmp("content").getLayout().setActiveItem("matrix-view-container");stl.app.CreateTaskToolBar.onViewChange("matrixview");stl.app.setCurrentViewId(MATRIX_VIEW_ID);$(".matrix-view-btn").addClass("selected-btn");break}};stl.app.setCurrentViewId=function(a){window.currentViewId=a};stl.app.getCurrentViewId=function(){return window.currentViewId};stl.app.initToolTips=function(){$(".matrix-view-btn").prop("title",MATRIX_VIEW_TOOLTIP);$(".timeline-view-btn").prop("title",TIMELINE_VIEW_TOOLTIP);$(".table-view-btn").prop("title",TABLE_VIEW_TOOLTIP);$("#settings-button").prop("title",SETTINGS_TOOLTIP);$("#help-button").prop("title",HELP_TOOLTIP);$(".milestoneSheet").prop("title",MILESTONE_PANEL_TOOLTIP);$(".errorWarningSheet").prop("title",ERROR_PANEL_TOOLTIP);$(".resourceSheet").prop("title",RESOURCE_PANEL_TOOLTIP);$(".toggle-links-button").prop("title",LINKS_TOOLTIP);$(".revisionHistoryImg").prop("title",REVISION_HISTORY_TOOLTIP);$(".zoom-out").prop("title",ZOOM_OUT_TOOLTIP);$(".zoom-in").prop("title",ZOOM_IN_TOOLTIP);$(".task-align-left").prop("title",LEFT_INDENT_TOOLTIP);$(".task-align-right").prop("title",RIGHT_INDENT_TOOLTIP);$("#calendar-button").prop("title",CALENDAR_SETTING_TOOLTIP);$(".PEIcon-btn").prop("title",CREATE_PE_TOOLTIP);$(".CMSIcon-btn").prop("title",CREATE_CMS_TOOLTIP);$(".IMSIcon-btn").prop("title",CREATE_IMS_TOOLTIP);$(".FKIcon-btn").prop("title",CREATE_FK_TOOLTIP);$(".PPIcon-btn").prop("title",CREATE_PP_TOOLTIP);$(".normalTaskIcon-btn").prop("title",CREATE_TASK_TOOLTIP);$("#undoCCAB").prop("title",REMOVE_BUFFERS_TOOLTIP)};function AcceptPlanClicked(){PPI_Notifier.confirm(ACCEPT_PLAN_CONFIRM_MESSAGE,ACCEPT_PLAN_TITLE,AcceptPlan,null)}function AcceptPlan(){var b=stl.model.Project.project;var a=b._milestones;$.each(a,function(c,d){if(d.date1!=null){d.date1=new Date(d.projectedDate);if(d.taskType===PE_SHORT){b.dueDate=d.date1}Ext.getCmp("CCSummarygrid").updateMilestoneSheetForAcceptPlan(d,false)}});stl.app.save(stl.app.ProcessTypeEnum.AUTOSAVE);$(document).trigger("acceptPlanClicked",[this,a])}function getSaveMenu(a){var b=this.$saveMenu;if(!b){$(document.body).children(".save-popup").remove();b=this.$saveMenu=$(".page-header-top .input-group").find(".tool-popup").clone(true);$(document.body).append(b)}b.empty();function c(h,g){var f=$(['<div class="tool-item">',"<label>",h,"</label>","</div>"].join(""));if(g){f.addClass(g)}return f}var e=c(SAVE_PROJECT_TEXT);e.off("click").on("click",function(){SaveProject();b.hide()});var d=c(SAVE_TEMPLATE_TEXT);d.off("click").on("click",function(){showSaveTemplateDialog();b.hide()});b.append(e);b.append(d);return b}function getCheckinMenu(){var a=this.$checkinMenu;if(!a){$(document.body).children(".checkin-popup").remove();a=this.$checkinMenu=$(".page-header-top .input-group").find(".tool-popup").clone(true);$(document.body).append(a)}a.empty();function b(f,e){var d=$(['<div class="tool-item">',"<label>",f,"</label>","</div>"].join(""));if(e){d.addClass(e)}if(multipleORs(stl.app.actionTypeValue,1,7,8)){d.addClass("disabled")}return d}var c=b(UNDO_CHECK_OUT);c.off("click");if(!c.hasClass("disabled")){c.on("click",function(d){InvokeUndoCheckOut(stl.app.ProjectDataFromServer.uid,stl.app.ProjectDataFromServer.name,stl.app.ProjectType);toggleDockingGrids("resGrid","resourceSheet",false);toggleDockingGrids("Error_Warning_Window","errorWarningSheet",false);a.hide()})}a.append(c);return a}function getSettingMenu(a){var b=this.$settingMenu;if(!b){$(document.body).children(".setting-popup").remove();b=this.$settingMenu=$(".page-header-top .page-header-right .setting-group").find(".tool-popup").clone(true);$(document.body).append(b)}b.empty();function c(g,f){var e=$(['<div class="tool-item">',"<label>",g,"</label>","</div>"].join(""));if(f){e.addClass(f)}return e}var d=c(SETTINGS_TEXT);d.off("click").on("click",showCCSettingDialog.bind(this,d));b.append(d);return b}function SaveProject(){$(".page-header .logo").removeClass("selected");if(stl.app.save){stl.app.save(stl.app.ProcessTypeEnum.SAVE,function(a){if(a===TRUE_CONSTANT){PPI_Notifier.success(PROJECT_SAVED_SUCCESS,SUCCESS_MESSAGE)}else{PPI_Notifier.error(PROJECT_SAVE_FAILED,FAILURE_MESSAGE)}})}}function identifyCCClick(){if(stl.app.isProjectOpenInViewOnlyMode()){return}$("#ccSummary").removeClass("disabled");$("#ccSummary").removeAttr("disabled");$("#acceptPlan").removeClass("disabled");$("#acceptPlan").removeAttr("disabled");$("#redoCCFB").removeClass("disabled");$("#redoCCFB").removeAttr("disabled");$("#bufferSummary").addClass("disabled");$("#bufferSummary").attr("disabled");$("#undoCCAB").removeClass("disabled");$("#undoCCAB").removeAttr("disabled")}function checkBufferImpactClick(){$("#ccSummary").addClass("disabled");$("#ccSummary").attr("disabled");$("#bufferSummary").removeClass("disabled");$("#bufferSummary").removeAttr("disabled")}function enableBufferSummaryButton(){$("#bufferSummary").removeClass("disabled");$("#bufferSummary").removeAttr("disabled")}function enableCCSummarybutton(){$("#ccSummary").removeClass("disabled");$("#ccSummary").removeAttr("disabled")}function disableBufferSummaryButton(){$("#bufferSummary").addClass("disabled");$("#bufferSummary").prop("disabled",true)}function disableCCSummarybutton(){$("#ccSummary").addClass("disabled");$("#ccSummary").prop("disabled",true)}function showPlanningButtons(){$(".page-header-toolbar-top .plan-buttons").show();$(".page-header-toolbar-top .replan-buttons").hide()}function showReplanningButtons(){$(".page-header-toolbar-top .plan-buttons").hide();$(".page-header-toolbar-top .replan-buttons").show()}function undoCCABClick(){$("#ccSummary").addClass("disabled");$("#ccSummary").attr("disabled","disabled");$("#acceptPlan").addClass("disabled");$("#acceptPlan").attr("disabled","disabled");$("#bufferSummary").addClass("disabled");$("#bufferSummary").attr("disabled","disabled");$("#undoCCAB").addClass("disabled");$("#undoCCAB").attr("disabled","disabled")}function showCCSettingDialog(){var a=CCSettingsStore.GetCCSettings();Ext.create("ProjectPlanning.view.cCSettings.CCSettings",a).show()}function showCalendarDialog(){var a=CalendarStore.GetCalendarSettings();Ext.create("ProjectPlanning.view.CalendarSettings.CalendarSettings",a).show()}function showSaveTemplateDialog(){Ext.create("ProjectPlanning.view.saveTemplate.SaveTemplate").show()}function OnTemplateSelect(d,a,b,e){var c=a;LoadJsonBlobData(d.id,d.name,false,function(f){var g=showErrorsAndWarnings(f,LOAD_JSON_DATA);if(g){stl.app.loadProjectJson(f,false,a,b,true,e)}})}function showToolbarNotifier(a){$("#page-header-notifier").removeClass("displayNone").addClass("displayBlock");$("#page-header-notifier span").text(a)}function hideToolbarNotifier(){$("#page-header-notifier").removeClass("displayBlock").addClass("displayNone")};