stl.model.Project=function(a,c){var b=ServerClientDateClass.getTodaysDate();b.setHours(0,0,0,0);var e={startDate:b,uid:"",name:c?c:"",viewOnlyMode:false,isIDCCed:false,ProjectPlanningMode:PLAN,ProjectStatus:IN_PLAN_TYPE,dueDate:ServerClientDateClass.getTodaysDate(),division:"DEFAULT",author:"Author1",subject:"Cust1",category:"BU1",lastSaved:ServerClientDateClass.getTodaysDate(),manager:"Shashank",projectFileType:PROJECT_TYPE_PPI,projectCalendarName:"",isSubtaskEnabled:true,defaultStartTime:null,defaultFinishTime:null,defaultHrsPerDay:0,defaultDaysPerWeek:0,attribute1:"",attribute2:"",attribute3:"",attribute4:"",attribute5:"",Description:"",CustomDate1:"",CustomDate2:"",PlannedDate:"",phases:[],rows:[],scopeItems:[],_milestones:[],links:[],subtaskLinks:[],resources:[],_nextUID:{task:1,phase:1,row:1,scopeItem:1,link:1,checklistItem:1,subtask:10000,calendar:2,resource:1},_taskCount:0,_resourcesByUid:{},_tasksAndMilestonesByUid:{},_phaseScopeAndTaskCountMap:{},_scopeItemsByUid:{},CC_Summary:{},CC_Settings:{},_scheduler:null,bufferSummary:{},CheckedOutUser:"",CheckedOutStatus:0,IsComplexMode:true,jsonVersion:null};if(!a){a={phases:[{id:"1",uid:"1",order:0,type:"normal",name:DEFAULT_PHASE_NAME+SPACE_CONST+"1"},{id:"2",uid:"2",order:1,type:"milestone",name:DEFAULT_PHASE_NAME+SPACE_CONST+"1"}],rows:[{id:"1",uid:"1",order:"0",outlineLevel:1,scopeItemUid:"1",name:DEFAULT_SCOPE_NAME,tasks:{},isExpanded:true}],scopeItems:[{id:"1",uid:"1",name:DEFAULT_SCOPE_NAME}],CC_Settings:{PercentageCCCB:stl.app.commonSettingValue("DEFAULT_CCCB_BUFFER_PERCENT_SIZE"),PercentageCCFB:stl.app.commonSettingValue("DEFAULT_CCFB_BUFFER_PERCENT_SIZE"),PercentageCMSB:stl.app.commonSettingValue("DEFAULT_CMSB_BUFFER_PERCENT_SIZE"),FixedCCCB:stl.app.commonSettingValue("DEFAULT_CCCB_BUFFER_FIXED_SIZE"),FixedCCFB:stl.app.commonSettingValue("DEFAULT_CCFB_BUFFER_FIXED_SIZE"),FixedCMSB:stl.app.commonSettingValue("DEFAULT_CMSB_BUFFER_FIXED_SIZE"),RoundOffDuration:stl.app.defaultDurationReductionRoundingValue(),ReduceTaskDuration:stl.app.commonSettingValue("DURATION_REDUCTION_PERCENT"),HorizonDate:"",FeedingBuffersPolicyVal:stl.app.defaultFeedingBufferPolicyValue(),LastIDCCedHorizonDate:new Date(ServerClientDateClass.getTodaysDate().toUTCString())}}}$.extend(this,e,a);this.computeMaxUIDs();this.processMilestones();var d;if(this.name.trim()!=""&&this.getScopeItemByName(this.name)==null){d=this.createScope(this.name)}$(stl.app).on("globalresourceschanged",this.invalidateResources.bind(this));this.scopeItems.map(function(f){this._scopeItemsByUid[f.uid]=f}.bind(this))};$.extend(stl.model.Project.prototype,(function(){return({createScheduler:function(a){if(!this._scheduler){this._scheduler=new stl.service.SimpleScheduler({calendar:a})}},cloneObj:function(a){return JSON.parse(a)},getJSON:function(c,a){var e;this.generateAllSequentialSubtaskAutoLinks();this.flattenForServer();this.nextTaskUID=this._nextUID.task;this.nextLinkUID=this._nextUID.link;var d=JSON.stringify(this,stl.model.Project.JSONFilter);this.unflattenFromServer();if(c){e=this.cloneObj(d);var b=this.getProjectRootScopeNodeForTemplate(e);b.name=a;e.name=a;d=JSON.stringify(e,stl.model.Project.JSONFilter)}return d},getProjectRootScopeNodeForTemplate:function(b){var a=_.find(b.scopeItems,function(c){return c.name==b.name});return a},getAllTaskIds:function(){var c=[];var a=this.getAllTasks();for(var b=0;b<a.length;b++){c=c.concat(a[b].id)}return c},getAllTasks:function(){var a=[];for(var b=0;b<this.rows.length;b++){a=a.concat(this.flattenTasksForRow(this.rows[b]))}return a},getAllSummaryTasks:function(){var a=[];var b=this.getAllTasks();_.each(b,function(d,c,e){if(d.isSummary){a.push(d)}});return a},getAllTasksInPhaseBlock:function(c){var d=this.rows;var a=[];for(var b=0;b<d.length;b++){var e=d[b].tasks;if(e[c]){a=_.union(a,_.filter(e[c],function(f){return f.taskType!="buffer"}))}}return a},setProjectSummaryInfo:function(a){me=this;me.uid=a.ProjectUid;me.name=a.name;me.dueDate=a.duedate;me.division=a.Division;me.author=a.Author;me.subject=a.Subject;me.category=a.Category;me.lastSaved=a.LastSaved;me.manager=a.Manager;me.isIDCCed=a.isIDCCed;me.attribute1=a.Attribute1;me.attribute2=a.Attribute2;me.attribute3=a.Attribute3;me.attribute4=a.Attribute4;me.attribute5=a.Attribute5;me.projectFileType=a.ProjectFileType;me.projectCalendarName=a.ProjectCalendarName;me.isSubtaskEnabled=a.IsSubtaskEnabled;me.participants=a.ProjectParticipants;me.defaultStartTime=a.DefaultStartTime;me.defaultFinishTime=a.DefaultFinishTime;me.defaultHrsPerDay=a.DefaultHrsPerDay;me.defaultDaysPerWeek=a.DefaultDaysPerWeek;me.CheckedOutUser=a.CheckedOutUser;me.CheckedOutStatus=a.CheckedOutStatus;me.ProjectStatus=a.ProjectStatus;me.InheritProjCalForResFlag=a.InheritProjCalForResFlag},reassignTaskIds:function(){var b=1;var a=this;_.each(a.rows,function(d,c,f){var e=a.getSummaryTaskFromRow(d);if(e){e.id=b++}_.each(a.phases,function(h,g,i){var j=d.tasks[h.id];_.each(j,function(k,l,m){if(!k.isSummary){k.id=b++}})})})},flattenTasksForRow:function(c){var a=[];var b=this;if(c.tasks){Object.keys(c.tasks).map(function(e){var g=c.tasks[e];for(var f=0;f<g.length;f++){var d=g[f];d=b.convertDateStringsToDateTimeStampStrings(d);d.phaseId=e;a.push(d)}})}return a},convertDateStringsToDateTimeStampStrings:function(a){if(a.actualStartDate&&a.actualStartDate!=""){a.actualStartDate=new Date(a.actualStartDate)}if(a.actualFinishDate&&a.actualFinishDate!=""){a.actualFinishDate=new Date(a.actualFinishDate)}if(a.date1&&a.date1!=""){a.date1=new Date(a.date1)}if(a.date7&&a.date7!=""){a.date7=new Date(a.date7)}if(a.projectedDate&&a.projectedDate!=""){a.projectedDate=new Date(a.projectedDate)}if(a.startNoEarlierThan&&a.startNoEarlierThan!=""){a.startNoEarlierThan=new Date(a.startNoEarlierThan)}if(a.suggestedStartDate&&a.suggestedStartDate!=""){a.suggestedStartDate=new Date(a.suggestedStartDate)}return a},flattenForServer:function(){var c=this;for(var b=0;b<this.rows.length;b++){var d=this.rows[b],a=this.flattenTasksForRow(d);a.map(function(e){c.wrapParticipants(e);e.subtasks.forEach(function(f){c.wrapParticipants(f);f=c.convertDateStringsToDateTimeStampStrings(f)})});d._unflattenedTasks=d.tasks;d.tasks=a}},unflattenFromServer:function(){var a=this;this.rows.map(function(f){var g=f._unflattenedTasks;delete f._unflattenedTasks;if(g){f.tasks=g}else{var c={};for(var d=0;d<f.tasks.length;d++){var b=f.tasks[d],e=c[b.phaseId];if(!e){e=[];c[b.phaseId]=e}e.push(b);if(b.isMS){a._milestones.push(b)}}f.tasks=c}Object.keys(f.tasks).forEach(function(h){f.tasks[h]=f.tasks[h].sort(function(j,i){return j.order-i.order});f.tasks[h].forEach(function(i){a.unwrapParticipants(i);i.subtasks.forEach(a.unwrapParticipants);i.subtasks=i.subtasks.sort(function(k,j){return k.order-j.order})})})});this.resources.forEach(function(b){a._resourcesByUid[b.uid]=b})},wrapParticipants:function(a){if(a.participants){a.participants=a.participants.map(function(b){return{id:b}})}},unwrapParticipants:function(a){if(a.participants){a.participants=a.participants.map(function(b){return b.id})}},computeMaxUIDs:function(){var a=this;a._taskCount=a._taskCount||0;a._nextUID.phase=stl.model.Project.getMaxUIDInArray(a._nextUID.phase,this.phases);a._nextUID.scopeItem=stl.model.Project.getMaxUIDInArray(a._nextUID.scopeItem,this.scopeItems);a._nextUID.row=stl.model.Project.getMaxUIDInArray(a._nextUID.row,this.rows);a._nextUID.task=stl.model.Project.getMaxUIDInArray(a._nextUID.task,this._milestones);a._nextUID.link=stl.model.Project.getMaxUIDInArray(a._nextUID.link,this.links);a._nextUID.calendar=stl.model.Project.getCalMaxUIDInArray(a._nextUID.calendar,this.resources,"calendarUid");this.rows.map(function(b){Object.keys(b.tasks).map(function(f){var h=b.tasks[f];a._nextUID.task=stl.model.Project.getMaxUIDInArray(a._nextUID.task,h);a._taskCount+=h.length;for(var e=0;e<h.length;e++){var c=h[e];a._nextUID.subtask=stl.model.Project.getMaxUIDInArray(a._nextUID.subtask,c.subtasks);for(var d=0;d<c.subtasks.length;d++){var g=c.subtasks[d];if(g.checklistItems){a._nextUID.checklistItem=stl.model.Project.getMaxUIDInArray(a._nextUID.checklistItem,g.checklistItems)}}}})})},getNextUID:function(b){var a=this._nextUID[b];if(typeof(a)==="undefined"){console.error("Unrecognized UID entity type:",b);return}this._nextUID[b]++;return String(a)},createMilestone:function(b,e,c){var a=this.getNextUID("task"),d=$.extend({},stl.model.Task,{id:a,uid:a,startDate:ServerClientDateClass.getTodaysDate(),endDate:ServerClientDateClass.getTodaysDate(),date1:ServerClientDateClass.getTodaysDate(),name:this.getMilestoneName(c),duration:0,remainingDuration:0,phaseId:b.id,rowId:e.uid,taskType:c,resources:[],_predecessors:[],_successors:[],status:"NS",percentBufferConsumption:"0",percentChainComplete:"0",milestoneColor:"",taskColor:"",bufferType:"None",isMS:true,isAutolinked:true,checklistItems:[],checklistStatus:0,subtaskType:stl.app.getDefaultSubtaskType(),subtasksWIPLimit:stl.app.commonSettingValue("SUBTASKS_DEFAULT_WIP_LIMIT")});this._milestones.push(d);if(c===PE_SHORT){this._projectEndMs=d;stl.app.CreateTaskToolBar.onPEAddDelete(true)}this._tasksAndMilestonesByUid[d.uid]=d;return d},getNextDefaultMSName:function(b,c){var d=0,a=b+" ";_.each(c,function(f){if(f.name.trim()==b){d=Math.max(d,1)}else{if(f.name.indexOf(a)==0){var e=f.name.substr(a.length);if(e.trim().length!=0&&!isNaN(e)){var g=parseInt(e);d=Math.max(d,g)}}}});return b+(d>0?(" "+String(++d)):"")},changeMilestone:function(c,e,d){var b,a;switch(c){case PE_SHORT:case PROJECT_END:a=PROJECT_END;break;case STRING_NONE_UPPER_CASE:a=this.getNextDefaultMSName(PINCH_POINT_TITLE,this._milestones);break;default:b=c+HYPHEN_SEPARATOR+MILESTONE_NAME_PREFIX;a=this.getNextDefaultMSName(b,this._milestones);break}e.set?e.set("name",a):e.name=a;d()},getMilestoneName:function(c){var a,b=c+HYPHEN_SEPARATOR+MILESTONE_NAME_PREFIX;switch(c){case PE_SHORT:a=PROJECT_END;break;case STRING_NONE_UPPER_CASE:a=this.getNextDefaultMSName(PINCH_POINT_TITLE,this._milestones);break;default:a=this.getNextDefaultMSName(b,this._milestones);break}return a},checkIfNameAlreadyExists:function(a){var b=_.find(this._milestones,function(c){return c.name===a});return b},createTaskModel:function(a,d,c,b){if(b){return this.createSummaryTask(a,d,c)}if(multipleORs(c,TASKTYPE_FULLKIT,STRING_NORMAL)){return this.createTask(a,d,c)}else{return this.createMilestone(a,d,c)}},createTask:function(a,f,c){var d=this.getNextUID("task");var b=$.extend({},stl.model.Task,{id:d,uid:d,startDate:ServerClientDateClass.getTodaysDate(),endDate:Sch.util.Date.add(ServerClientDateClass.getTodaysDate(),Sch.util.Date.DAY,TASK_DURATION_DEFAULT),duration:(c===TASKTYPE_FULLKIT?0:TASK_DURATION_DEFAULT_SEC),remainingDuration:(c===TASKTYPE_FULLKIT?0:TASK_DURATION_DEFAULT_SEC),taskType:c,subtaskType:stl.app.getDefaultSubtaskType(),subtasksWIPLimit:stl.app.commonSettingValue("SUBTASKS_DEFAULT_WIP_LIMIT"),status:"NS",rowId:f.uid,phaseId:a.id,emptyText:this.getNextDefaultTaskName(a,f,c),name:this.getNextDefaultTaskName(a,f,c),resources:[],participants:[],subtasks:[],subtaskCount:0,checklistItems:[],_successors:[],_predecessors:[],taskColor:"",date1:ServerClientDateClass.getTodaysDate(),date7:ServerClientDateClass.getTodaysDate(),isReadyToStart:false,fullkitPercentCompleteAtRL:0,isSummary:false});this._tasksAndMilestonesByUid[d]=b;var e=this.getScopeItemByUid(f.scopeItemUid);this.incrementTaskCountInPhaseScopeMap(a.uid+"."+e.uid);return b},createSummaryTask:function(a,e,c){var d=this.getNextUID("task");var b=$.extend({},stl.model.Task,{id:d,uid:d,startDate:ServerClientDateClass.getTodaysDate(),endDate:Sch.util.Date.add(ServerClientDateClass.getTodaysDate(),Sch.util.Date.DAY,TASK_DURATION_DEFAULT),duration:0,remainingDuration:0,taskType:c,subtaskType:stl.app.getDefaultSubtaskType(),subtasksWIPLimit:stl.app.commonSettingValue("SUBTASKS_DEFAULT_WIP_LIMIT"),status:"NS",rowId:e.uid,phaseId:a.uid,emptyText:e.name!=""?this.getScopeName(e):" Summary Task",name:e.name!=""?this.getScopeName(e):" Summary Task",resources:[],participants:[],subtasks:[],subtaskCount:0,checklistItems:[],_successors:[],_predecessors:[],taskColor:"",date1:ServerClientDateClass.getTodaysDate(),date7:ServerClientDateClass.getTodaysDate(),isReadyToStart:false,fullkitPercentCompleteAtRL:0,isSummary:true});return b},createSubtask:function(a,b){var c=$.extend({},stl.model.Subtask,{checklistItems:[]},a);if(!c.uid){c.uid=this.getNextUID("subtask");c.id=c.uid;c.startDate=b.startDate;c.startDate=this.getSubTaskStartDate(c,b);c.endDate=null;c.checklistStatus=0;c.order=b.subtasks.length;c.participants=[];duration:SUBTASK_DURATION_DEFAULT;remainingDuration:SUBTASK_DURATION_DEFAULT}return c},getSubTaskStartDate:function(c,b){var a=b.subtasks.length;if(b.subtaskType===SEQUENTIAL&&a>0){this.createScheduler(stl.app.calendar);return this._scheduler.adjustDatesForDuration(b.subtasks[a-1].startDate,b.subtasks[a-1].remainingDuration,true)}else{if(b.subtaskType==SubtaskTypesEnum.PARALLEL){return b.startDate}}return c.startDate},reCalculateSubTaskStartDate:function(c){me=this;var b=c.suggestedStartDate?new Date(c.suggestedStartDate):c.startDate;if(c.subtaskType==SubtaskTypesEnum.SEQUENTIAL){var a=c.subtasks.length;me.createScheduler(stl.app.calendar);c.subtasks=c.subtasks.map(function(f,d,e){if(d==0){f.startDate=me._scheduler.adjustDatesForDuration(b,0,true)}else{f.startDate=me._scheduler.adjustDatesForDuration(e[d-1].startDate,e[d-1].remainingDuration,true)}return f})}else{if(c.subtaskType==SubtaskTypesEnum.PARALLEL){c.subtasks=c.subtasks.map(function(d){d.startDate=b;return d})}}},calculateRollupDuration:function(j){var t=0;if(j.subtasks){var d=j.subtaskType;var f=j.subtasksWIPLimit;var g=0;if(d==SubtaskTypesEnum.SEQUENTIAL||d==SubtaskTypesEnum.PARALLEL){for(var r=0,s=j.subtasks;r<s.length;r++){var c=s[r];if(d==SubtaskTypesEnum.SEQUENTIAL){g+=parseInt(c.remainingDuration)}else{if(d==SubtaskTypesEnum.PARALLEL){if(parseInt(c.remainingDuration)>g){g=parseInt(c.remainingDuration)}}}}}if(d==SubtaskTypesEnum.WIP&&f){var b=_.filter(j.subtasks,function(i){return i.status!=STATUS_CO});var l=_.filter(b,function(i){return i.status==STATUS_NS});var a=_.filter(b,function(i){return i.status==STATUS_IP});var e=a.concat(l);var n=[];_.each(e,function(v,i){var u={};u.id=v.id;u.uid=v.uid;u.name=v.name;u.status=STATUS_NS;u.totalDuration=parseInt(v.remainingDuration);u.remainingDuration=parseInt(v.remainingDuration);n.push(u)});var k=e.length;var o=0;var p=0;while(o<k){var m=0;var h=false;var s=this.getAvailableSubtasksForExecution(n,f);var q=this.getMinimalExecutionTimeOfAllSubtasksInExecution(s);o=this.updateRemainingDurationOfSubtasksInExecution(s,q,o);g=g+q}}t=g}return t},isSubtaskTypeOptionHidden:function(c,g){var e=this;var d=false;var b=e.getHiddenSubtaskTypeConfigValue();var f=e.getSubtaskKeyForOptionValue(g);if(b&&b.length>0){var a=_.find(b,function(h){return h==f});if(a&&c!=g){d=true}}return d},getSubtaskKeyForOptionValue:function(b){var a=WIPSubtasktypesConfigKey;switch(parseInt(b)){case SubtaskTypesEnum.SEQUENTIAL:a=SeqentialSubtasktypesConfigKey;break;case SubtaskTypesEnum.VOLUME:a="volume";break;case SubtaskTypesEnum.WIP:a=WIPSubtasktypesConfigKey;break;case SubtaskTypesEnum.PARALLEL:a=ParallelSubtasktypesConfigKey;break}return a},getHiddenSubtaskTypeConfigValue:function(){var a=stl.app.hiddenSubtaskTypes.split(STRING_SEPARATOR);return a},getAvailableSubtasksForExecution:function(b,a){var c=_.filter(b,function(d){return d.status!=STATUS_CO});return c.slice(0,a)},getMinimalExecutionTimeOfAllSubtasksInExecution:function(a){var b=_.map(a,function(c){return c.remainingDuration});return _.min(b)},updateRemainingDurationOfSubtasksInExecution:function(b,c,a){_.each(b,function(d){d.remainingDuration=d.remainingDuration-c;if(d.remainingDuration==0){d.status=STATUS_CO;a=a+1}});return a},isWIPLimitExceeded:function(d,c){var b=d.subtasks;var a=d.subtasksWIPLimit;var e=0;e=_.filter(b,function(g,f){return g.status==STATUS_IP}).length;if(c==STATUS_IP){if(e>=a){return true}}else{if(e>a){return true}else{return false}}},getNextDefaultTaskName:function(b,f,c){var e=this.getScopeItemByUid(f.scopeItemUid);if(this.isProjectComplex()&&f.outlineLevel==1&&!this.getSummaryTaskFromRow(f)){var a=this._phaseScopeAndTaskCountMap[b.uid+"."+e.uid];var d=(a===0)?EMPTY_STRING:++a;if(c===FULL_KIT){return FK_SHORT+PERIOD_CONSTANT+b.name+((d)?PERIOD_CONSTANT+d:EMPTY_STRING)}else{return b.name+((d)?PERIOD_CONSTANT+d:EMPTY_STRING)}}else{return this.getDefaultTaskName(b,e,c)}},getScopeName:function(b){var a=this.getScopeItemByUid(b.scopeItemUid);return a.name},getDefaultTaskNameCompareString:function(b,a){if(b!=EMPTY_STRING&&a!=EMPTY_STRING){return b+PERIOD_CONSTANT+a}else{if(b){return b}else{if(a){return a}else{return EMPTY_STRING}}}},getDefaultTaskName:function(a,c,b){var d=this.getDefaultTaskNameWithIndex(a,c);if(b===FULL_KIT){return FK_SHORT+((d)?PERIOD_CONSTANT+d:EMPTY_STRING)}else{return d}},getDefaultTaskNameWithIndex:function(c,f){var b=this._phaseScopeAndTaskCountMap[c.uid+"."+f.uid];var e=(b===0)?EMPTY_STRING:++b;var d=c.name,a=f.name;if(d!=EMPTY_STRING&&a!=EMPTY_STRING){return d+PERIOD_CONSTANT+a+((e)?PERIOD_CONSTANT+e:EMPTY_STRING)}else{if(d){return d+((e)?PERIOD_CONSTANT+e:EMPTY_STRING)}else{if(a){return a+((e)?PERIOD_CONSTANT+e:EMPTY_STRING)}else{return e}}}},createPhaseScopeAndTaskCountMap:function(){var b=this;b._phaseScopeAndTaskCountMap={};_.each(b.phases,function(c){if(multipleORs(c.type,STRING_NORMAL,FULL_KIT)){_.each(_.keys(b._scopeItemsByUid),function(d){b._phaseScopeAndTaskCountMap[c.uid+"."+d]=0})}});var a=_.filter(this._tasksAndMilestonesByUid,function(d){if(multipleORs(d.taskType,STRING_NORMAL,FULL_KIT)){var c=_.findWhere(b.phases,{uid:d.phaseId});var f=_.findWhere(b.rows,{uid:d.rowId});if(f&&c){var e=_.findWhere(b.scopeItems,{uid:f.scopeItemUid});if(d&&c&&e){if(d.name.indexOf(c.name+"."+e.name)!==-1){d.phase=c;d.scope=e;return d}}}}});_.each(a,function(c){var d=parseInt(c.name.split(".")[2])||parseInt(c.name.split(".")[1])||parseInt(c.name.split(".")[0])||1;b._phaseScopeAndTaskCountMap[c.phase.uid+"."+c.scope.uid]=Math.max(d,b._phaseScopeAndTaskCountMap[c.phase.uid+"."+c.scope.uid])})},resetTaskCountInPhaseScopeMap:function(a,d){var b=this;var c=d;if(a){_.each(_.keys(b._scopeItemsByUid),function(e){b._phaseScopeAndTaskCountMap[c+"."+e]=0})}else{_.each(b.phases,function(e){if(multipleORs(e.type,STRING_NORMAL,FULL_KIT)){b._phaseScopeAndTaskCountMap[e.uid+"."+c]=0}})}},incrementTaskCountInPhaseScopeMap:function(a){this._phaseScopeAndTaskCountMap[a]=++this._phaseScopeAndTaskCountMap[a]},generateSequentialSubtaskAutoLinksForTask:function(a,e){for(var d=0,c=a.subtasks;d<c.length-1;d++){var g=c[d],f=c[d+1];var b={from:g.uid,to:f.uid,uid:this.getNextUID("link")};this.subtaskLinks.push(b)}},removeSequentialSubtaskAutoLinks:function(b,k,f){for(var e=0,c=b.subtasks;e<c.length;e++){if(c[e].deleted!==true){var a=c[e],h=f[a.uid];if(h){for(var d=0;d<h.length;d++){var g=this.subtaskLinks.indexOf(h[d]);if(g>=0){this.subtaskLinks.splice(this.subtaskLinks.indexOf(h[d]),1)}}}}}},generateAllSequentialSubtaskAutoLinks:function(){var a=this;this.subtaskLinks=[];this.rows.map(function(b){Object.keys(b.tasks).map(function(e){var f=b.tasks[e];for(var d=0;d<f.length;d++){var c=f[d];if(c.subtaskType===SEQUENTIAL){a.generateSequentialSubtaskAutoLinksForTask(f[d])}}})})},addLink:function(c){if(!this.links){this.links=[]}if(this.links.indexOf(c)!=-1){return}c.uid=this.getNextUID("link");c.id=c.uid;this.links.push(c);var b=this._tasksAndMilestonesByUid[c.from],a=this._tasksAndMilestonesByUid[c.to];b._successors.push(a);a._predecessors.push(b);$(document).trigger("predSuccChangeFromOtherView",[b,a]);$(this).trigger("linkadd",[c]);return c},deleteMilestone:function(b,c){this.removeAllLinksForTaskOrMilestone(c);var a=this._tasksAndMilestonesByUid[c];this._milestones.splice(this._milestones.indexOf(a),1);delete this._tasksAndMilestonesByUid[c];Ext.getCmp("CCSummarygrid").updateMilestoneSheet(a,true);$(this).trigger("milestoneremove",[b,a]);if(a.taskType==PE_SHORT){this._projectEndMs=null;stl.app.CreateTaskToolBar.onPEAddDelete(false)}this.isIDCCed=false},updateMilestone:function(g,a){var d=g.uid;var f;for(var c=this._milestones.length-1;c>=0;c--){var b=this._milestones[c];if(b.uid===d){if(a==PE_SHORT&&g.taskType!=PE_SHORT){this._projectEndMs=null}b.name=g.name;b.startDate=g.startDate;b.endDate=g.endDate;b.date1=g.date1;b.bufferSize=g.bufferSize;b.taskType=!g.type?g.taskType:g.type;b.status=g.status;b.percentBufferConsumption=g.percentBufferConsumption;b.percentChainComplete=g.percentChainComplete;b.milestoneColor=g.milestoneColor;f=b;break}}if(b.taskType===PE_SHORT){this._projectEndMs=this._tasksAndMilestonesByUid[d]}if(this._projectEndMs){stl.app.CreateTaskToolBar.onPEAddDelete(true)}else{stl.app.CreateTaskToolBar.onPEAddDelete(false)}var e={uid:f.uid,name:f.name,type:f.taskType,taskType:f.taskType,startDate:f.startDate,endDate:f.endDate,date1:f.date1,bufferSize:f.bufferSize!=null?f.bufferSize:"",isAutolinked:f.isAutolinked,status:f.status,percentBufferConsumption:f.percentBufferConsumption,percentChainComplete:f.percentChainComplete,milestoneColor:f.milestoneColor};Ext.getCmp("CCSummarygrid").updateMilestoneSheet(e);stl.app.triggerSave()},processMilestones:function(){this._projectEndMsUid=null;this._projectEndHiddenMsUid=null;for(var b=0;b<this._milestones.length;b++){var a=this._milestones[b];this._tasksAndMilestonesByUid[a.uid]=a;if(a.taskType==="PE"){this._projectEndMsUid=a.uid;this._projectEndMs=a}else{if(a.taskType==="PEMS"){this._projectEndHiddenMsUid=a.uid}}if(!a._successors){a._successors=[]}if(!a._predecessors){a._predecessors=[]}}},getProjectRootScope:function(){return this.getScopeItemByName(this.name)},updateProjectRootScopeName:function(a){var b=this.getScopeItemByName(this.name);b.name=a},addNameToRows:function(){var b=this;b.rows=this.rows.sort(function(d,c){return d.order-c.order});var a=[this.getProjectRootScope().uid];if(this.isProjectComplex()){a=[this.getProjectRootScope().uid]}b.rows=b.rows.map(function(e,c,d){if(($.inArray(e.scopeItemUid,a)==-1)){if(b._scopeItemsByUid[e.scopeItemUid]){e.name=b._scopeItemsByUid[e.scopeItemUid].name;a.push(e.scopeItemUid)}}else{e.name=""}return e})},sortPhases:function(){var a=this;a.phases=this.phases.sort(function(d,c){return d.order-c.order})},getProjectEndMilestone:function(){return this._projectEndMs},addProjectSpecificResource:function(b){if(!b.calendarUid){b.calendarUid=this.getNextUID("calendar")}var a=this._resourcesByUid[b.uid];if(a){this.resources.splice(this.resources.indexOf(a),1,b)}else{this.resources.push(b)}this._resourcesByUid[b.uid]=b;this.invalidateResources();return b},updateResourceBaseCalendars:function(b){var a=this;$.each(stl.app.ProjectDataFromServer.resources,function(c,d){d.BaseCalendarName=b;Ext.getCmp("resGrid").updateResourceBaseCalendarsInResourceSheet(d,b)})},createResource:function(d,e,c,b,a){if(e===null||typeof(e)=="undefined"){b=false}else{b=true}var g=this.ComputeNextNewResourceUniqueID(e);var f={Name:d,id:g,uid:g,MaxUnits:c,isGlobal:b,calendarUid:a,BaseCalendarName:stl.app.ProjectDataFromServer.projectCalendarName};this.addProjectSpecificResource(f);return f},ComputeNextNewResourceUniqueID:function(a){var b=a||stl.app.getNextResourceUid();if(this.IsProjectSpecificResourceExist()==false){b=parseInt(b)+1000}return b},IsProjectSpecificResourceExist:function(){var a=_.find(this.getAvailableResources(),function(b){return b.isGlobal==false});return !_.isUndefined(a)},deleteResource:function(b,l,f,n,h,e,d){var c={Name:b,id:l,uid:l,MaxUnits:f,isGlobal:n,calendarUid:h,TaskModel:e,taskElem:d};if($(".matrix-view").data("view")){$(".matrix-view").data("view").invalidateResourceCache()}for(var k=0;k<this.resources.length;k++){var j=this.resources[k];if(j.uid==c.uid){this.resources.splice(k,1);k--}}delete this._resourcesByUid[c.uid.toString()];var m=false;var g=stl.model.Project.getProject().getAllTasks();var a=[];$.each(g,function(o,q){var s=q.resources;for(var p=0;p<s.length;p++){var r=s[p];if(r.resourceId==c.uid){s.splice(p,1);p--;m=true}}if(stl.model.Project.getProject().isResourceDeletedFromSubtasks(q.subtasks,c.uid)){m=true}if(m){m=false;a.push(q)}});$(document).trigger("updateResourcesDeleted",[this,a]);this.invalidateResources()},isResourceDeletedFromSubtasks:function(b,a){var c=false;$.each(b,function(d,f){var h=f.resources;for(var e=0;e<h.length;e++){var g=h[e];if(g.resourceId==a){h.splice(e,1);e--;c=true}}});return c},getAllPhaseNames:function(){var a=[];_.each(this.phases,function(c,b){var d={Name:c.name};a.push(d)});return a},isPhaseNameDuplicate:function(c,d){var b=this.phases;var a=false;$.each(b,function(e,f){if(f.name.toLowerCase()!=d.toLowerCase()){if(f.name.toLowerCase()==c.toLowerCase()){a=true}}});return a},isResourceNameDuplicate:function(d,e){var a=this.getAvailableResources();var b=false;var c=(e!=""&&e!=null);$.each(a,function(f,g){if(c){if(g.Name.toLowerCase().trim()==d.toLowerCase().trim()&&g.uid.toString()!=e.toString()){b=true}}else{if(g.Name.toLowerCase().trim()==d.toLowerCase().trim()){b=true}}});return b},isVirtualResourceNameDuplicate:function(b){var c=stl.app.AllVirtualResources;var a=false;$.each(c,function(d,e){if(e.toLowerCase().trim()==b.toLowerCase().trim()){a=true}});return a},setDeletedCalendarNames:function(a){if(stl.app.ProjectDataFromServer.deletedCalendarNames){if(stl.app.ProjectDataFromServer.deletedCalendarNames.indexOf(a)==-1){stl.app.ProjectDataFromServer.deletedCalendarNames.push(a)}}else{stl.app.ProjectDataFromServer.deletedCalendarNames=[];stl.app.ProjectDataFromServer.deletedCalendarNames.push(a)}},getDeletedCalendarNames:function(){return stl.app.ProjectDataFromServer.deletedCalendarNames},getInfoMsgForUpdateCalendarNamesForResources:function(){var b=this.getDeletedCalendarNames();if(b&&b.length!=0){var a="";_.each(b,function(e,c,d){if(c!=d.length-1){a=a+e+", "}else{a=a+e}});PPI_Notifier.info(getStringWithArgs(SELECTED_CALENDAR_DELETED,a,stl.app.ProjectDataFromServer.projectCalendarName))}},updateResourceSheet:function(){_.each(this.resources,function(c,a,b){Ext.getCmp("resGrid").updateResourceSheet(c,"0",null);if(Number(c.uid)>=Number(stl.app.getNextAvailableResourceUid())){stl.app.setNextAvailableResourceUid(Number(c.uid)+1)}})},updateGlobalMaxUnitsOfGlobalResourcesAssignedToProject:function(){_.each(this.resources,function(c,a){if(c.isGlobal){var b=_.find(stl.app.getGlobalResources(),function(d){return d.uid==c.uid});if(b){c.GlobalMaxUnits=b.MaxUnits}}})},getAvailableResources:function(){if(!this._combinedResourceList||this._resourcesInvalidated){var b={},a=[];this._combinedResourceList=stl.app.getGlobalResources().concat(this.resources).reduce(function(c,d){if(!b[d.uid]){c.push(d);b[d.uid]=d}return c},[]);this.renameProjectResourcesIfDuplicate();this.updateProjectSpecificGlobalResources();this._combinedResourceList.sort(function(d,c){return d.Name.localeCompare(c.Name)});this._combinedResourcesByUid=b;this._resourcesInvalidated=false}return this._combinedResourceList},renameProjectResourcesIfDuplicate:function(){var d=this._combinedResourceList;if(d){var b=[];for(var a=0;a<d.length;a++){var c=_.find(b,function(e){return e.Name==d[a].Name});if(_.isUndefined(c)==false){if(this.IsGlobalResource(d[a])==false){d[a].Name+="_local"}if(this.IsGlobalResource(c)==false){c.Name+="_local"}}b.push(d[a])}}},IsGlobalResource:function(c){var d=stl.app.getGlobalResources();var a=_.find(d,function(e){return e.uid==c.uid});var b=true;if(_.isUndefined(a)){b=false}c.isGlobal=b;return b},updateProjectSpecificGlobalResources:function(){var d=stl.app.getGlobalResources();for(var b=0;b<this.resources.length;b++){var c=this.resources[b];var a=_.find(d,function(e){return e.uid==c.uid});if(!_.isUndefined(a)){c.Name=a.Name;c.isGlobal=true}else{c.isGlobal=false}}},updateBaseCalendarForGlobalResources:function(){var a=stl.app.getGlobalResources();_.each(a,function(c,b){c.BaseCalendarName=stl.app.ProjectDataFromServer.projectCalendarName})},updateBaseCalendarForTimeBufferResource:function(){var a=_.find(this.resources,function(b){return b.Name.toLowerCase()==TIME_BUFFER_LOWERCASE});if(a){a.BaseCalendarName=stl.app.ProjectDataFromServer.projectCalendarName;Ext.getCmp("resGrid").updateResourceBaseCalendarForTimeBufferInResourceSheet(a)}},getAvailableResourcesByUid:function(){if(!this._combinedResourcesByUid||this._resourcesInvalidated){this.getAvailableResources()}return this._combinedResourcesByUid},getResourceByUid:function(a){return this.getAvailableResourcesByUid()[a]},getTaskOrMilestoneUidById:function(a){var b;var c=this.getAllTasks();$.each(c,function(e,d){if(a==d.id){b=d.uid;return false}});return b},getTaskOrMilestoneByUid:function(a){var b;var c=this.getAllTasks();$.each(c,function(e,d){if(a==d.uid){b=d;return false}});return b},getTaskOrMilestoneIdByUid:function(a){var b;var c=this.getAllTasks();$.each(c,function(e,d){if(a==d.uid){b=d.id;return false}});return b},onResourcesAssigned:function(b){var a=this;b.forEach(function(c){var d=a._resourcesByUid[c.uid];if(!d){d=a.addProjectSpecificResource(c)}})},invalidateResources:function(){this._resourcesInvalidated=true;$(this).trigger("resourceschanged")},getTotalUnitsAssignedForResource:function(d){var c=this,a=0,b=function(e){e.resources.forEach(function(f){if(f.resourceId===d){a+=Number(f.units)}})};this.rows.forEach(function(e){Object.keys(e.tasks).forEach(function(f){e.tasks[f].forEach(function(g){b(g);g.subtasks.forEach(b)})})});return a},createRow:function(d,c,a){var e=this.getNextUID("row");var b;if(!d){b=this.createScope(c);d=b.uid}else{b={id:d,uid:d,name:c||""}}return $.extend({},stl.model.Project.defaultRowModel,{id:e,uid:e,scopeItemUid:d,name:c,outlineLevel:stl.app.ProjectDataFromServer.isProjectComplex()?a:-1,scopeItemName:c,scopeItem:b,isExpanded:true})},createScope:function(b){scopeItemUid=this.getNextUID("scopeItem");var a={id:this.scopeItems.length+1,uid:scopeItemUid,name:b||""};this.scopeItems.push(a);this._scopeItemsByUid[scopeItemUid]=a;this.createPhaseScopeAndTaskCountMap();return a},getScopeItemByUid:function(a){return this._scopeItemsByUid[a]},getScopeUidForRowId:function(a){return _.findWhere(this.rows,{uid:a}).scopeItemUid},getScopeItemByName:function(b){var a=null;if(b||b==""){this.scopeItems.forEach(function(c){if(c.name===b){a=c}})}return a},deleteScopeItemByName:function(c){var b=null;for(var a=0;a<this.scopeItems.length;a++){if(this.scopeItems[a].name===c){b=this.scopeItems.splice(a,1);delete this._scopeItemsByUid[b[0].uid];break}}return b},deleteScopeItemByUid:function(c){var b=null;for(var a=0;a<this.scopeItems.length;a++){if(this.scopeItems[a].uid===c){b=this.scopeItems.splice(a,1);delete this._scopeItemsByUid[b[0].uid];break}}return b},deleteSummaryTaskFromRowModel:function(f){var b={};var e=f.uid;var c={};var d=[];var a=false;_.each(f.tasks,function(i,h,j){var g=h;if(!a){d=_.filter(i,function(k){return k.isSummary==true});if(d){a=true}}c[g]=_.filter(i,function(k){if(!k.isSummary){return true}})});f.tasks=c;b.rowModel=f;if(d.length>0){delete me._tasksAndMilestonesByUid[d[0].uid];b.summaryTask=d[0]}return b},getSummaryTaskFromRow:function(b){var a=this.flattenTasksForRow(b);var c=_.find(a,function(d){return d.isSummary});return c},renameScopeItem:function(c,a){var b=0;this.scopeItems=this.scopeItems.map(function(d){if(d.uid===c){d.name==a;b=d.uid}return d});this._scopeItemsByUid[b].name=a;this.resetTaskCountInPhaseScopeMap(false,b);return this._scopeItemsByUid[b]},getResourceColorMap:function(){if(!this._resourceColorMap){var a=1;this._resourceColorMap={};this.getAvailableResources().forEach(function(b){this._resourceColorMap[b.uid]=a++;if(a==(MAX_NUMBER_OF_COLORS_USED_FOR_HIGHLIGHTING_RESOURCES+1)){a=1}}.bind(this))}return this._resourceColorMap},getPhaseColorMap:function(){if(!this._phaseColorMap){var a=1;this._phaseColorMap={};this.phases.forEach(function(b){if(b.type=="normal"){if(!this._phaseColorMap[b.name]){this._phaseColorMap[b.name]=a++;if(a==(MAX_NUMBER_OF_COLORS_USED_FOR_HIGHLIGHTING_PHASES+1)){a=1}}}}.bind(this))}return this._phaseColorMap},getTaskManagerColorMap:function(){if(!this._taskManagerColorMap){var a=1;this._taskManagerColorMap={};DataStore.availablePeopleAndTeams.forEach(function(b){this._taskManagerColorMap[b.Name]=a++;if(a==(MAX_NUMBER_OF_COLORS_USED_FOR_HIGHLIGHTING_TASK_MANAGERS+1)){a=1}}.bind(this))}return this._taskManagerColorMap},getChainsColorMap:function(){if(!this._chainsColorMap){var a=0;this._chainsColorMap={};this.getAllChainIds().forEach(function(b){a=b;if(b>MAX_NUMBER_OF_COLORS_USED_FOR_HIGHLIGHTING_CHAINS){a=b-MAX_NUMBER_OF_COLORS_USED_FOR_HIGHLIGHTING_CHAINS}this._chainsColorMap[b]=a}.bind(this))}return this._chainsColorMap},removeBufferTasks:function(){var g=this.getAllTasks();var f=this;for(var b=0;b<g.length;b++){var d=g[b];if(d.taskType==CMS_SHORT||d.taskType==IMS_SHORT||d.taskType==PE_SHORT){d.projectedDate=null}}var e=$.grep(g,function(h){if(h.taskType==="buffer"){if(f.isIDCCed&&f.ProjectPlanningMode===PLAN){return h}else{if(f.ProjectPlanningMode===REPLAN&&h.bufferType==="CCFB"){return h}}}});if(e.length>0){for(var a=0;a<e.length;a++){var c=$.grep(this.rows,function(h){if(h.uid==e[a].rowId){return h}});if(c.length>0){g=c[0].tasks[parseInt(e[a].phaseId)];g.splice(g.indexOf(e[a]),1);this.autoLinkMissingLinks(e[a]);this.removeBufferLinksFromModel(e[a].uid);$(document).trigger("removeBufferTaskLinks",[e[a].uid])}}}stl.app.ProjectDataFromServer.isBufferTasksExist=false;this.isIDCCed=false},removeBufferLinksFromModel:function(c){var a=this.links;for(var b=a.length-1;b>=0;b--){var d=a[b];if(d.from===c||d.to===c){this.removeLink(d.from,d.to)}}},autoLinkMissingLinks:function(a){if(a._predecessors.length>0&&a._successors.length>0){stl.app.addLink(a._predecessors[0].uid,a._successors[0].uid)}},updateLinkDAG:function(){var f=this.getAllTasks();for(var c=0;c<f.length;c++){var d=f[c];this._tasksAndMilestonesByUid[d.uid]=d;d._predecessors=[];d._successors=[]}for(var c=0;c<this.links.length;c++){var e=this.links[c],b=this._tasksAndMilestonesByUid[e.from],a=this._tasksAndMilestonesByUid[e.to];a._predecessors.push(b);b._successors.push(a)}},ValidateAllTasksHaveSuccessors:function(c){var h=this.getAllTasks();var b=[];var f=false;var d={};d.Code=ERR_CODE;d.Description=ERR_TASKS_WITH_NO_SUCCESSORS;d.Type=ERR_GEN;d.itemIds=[];for(var e=0;e<h.length;e++){var a=h[e];if(!a.isSummary){if(multipleORs(a.taskType,TASKTYPE_FULLKIT,TASKTYPE_BUFFER,TASKTYPE_SNET,TASKTYPE_PT,STRING_NORMAL)){if(a._successors.length<=0){d.Description=d.Description+" "+a.id.toString()+", ";var g={};g.Id=a.id.toString();d.itemIds.push(g)}}}}if(d.itemIds.length>0){f=true;c.Errors.push(d)}return f},ResourceAssignmentValidation:function(b){var f=this;var g=this.rows;var e=false;var c={};c.Code=ERR_CODE;c.Description=ERR_MSG_RESOURCE_ASSIGNMENT_VALIDATION;c.Type=ERR_GEN;c.itemIds=[];var a=this.getAllTasks();$.each(a,function(h,i){if(f.IsResourceValidationRequired(i)){var j=i.resources;if(j.length==0){c.Description=c.Description+" "+i.id.toString()+", ";var k={};k.Id=i.id.toString();c.itemIds.push(k);e=true}}});if(c.Description){var d=".";c.Description=c.Description.replace(REMOVE_TRAILING_COMMASPACE,d)}if(c.itemIds.length>0){e=true;b.Errors.push(c)}return e},IsResourceValidationRequired:function(b){var a=false;if(!b.isSummary&&b.taskType!=FULL_KIT&&(!b.isMS)&&b.duration>0){a=true}return a},objectHasPredecessor:function(a,c){var d=false,b=[this._tasksAndMilestonesByUid[a]];while(!d&&b.length>0){b=[].concat.apply([],b.map(function(e){return e._predecessors}));d=b.some(function(e){return e.uid===c})}return d},isRedundantLinkPresent:function(c,d){var b=false,a=[this._tasksAndMilestonesByUid[d]];while(!b&&a.length>0){a=[].concat.apply([],a.map(function(e){return e._successors}));b=a.some(function(e){return e.uid===c})}return b},removeLink:function(g,a){for(var e=this.links.length-1;e>=0;e--){var f=this.links[e];if(f.from===g&&f.to===a){this.links.splice(e,1);var d=this._tasksAndMilestonesByUid[f.from],c=this._tasksAndMilestonesByUid[f.to];d._successors.splice(d._successors.indexOf(c),1);c._predecessors.splice(c._predecessors.indexOf(d),1);$(document).trigger("predSuccChangeFromOtherView",[d,c]);if(d.rowId!=c.rowId){var b=$.grep(this.phases,function(h){return h.uid==d.phaseId})[0];if(b.maxFlexAllowed){if(b.usedFlexibleLinks>0){b.usedFlexibleLinks--}}}$(this).trigger("linkremove",[f])}}},removeAllLinksForTaskOrMilestone:function(c){for(var a=this.links.length-1;a>=0;a--){var b=this.links[a];if(b.from===c||b.to===c){this.removeLink(b.from,b.to)}}},getConstrainingTasks:function(b){var c=this._tasksAndMilestonesByUid[b];var a=[];a.push(b);var d=parseInt(c.text5);if(d>0){this.getConstrainingTaskRecursive(d,a)}return a},getConstrainingTaskRecursive:function(d,a){var b=this._tasksAndMilestonesByUid[d];a.push(d);if(b.isCritical==false){var c=parseInt(b.text5);if(c>0&&b.uid!=c){this.getConstrainingTaskRecursive(b.text5,a)}}},getAllChainIds:function(){var b=[];for(var d=0;d<=BufferSummaryStore.length-1;d++){var c=BufferSummaryStore[d];for(var a=0;a<=c.Chains.length-1;a++){b.push(c.Chains[a].ChainNumber)}}return b},getPenChainID:function(c){var a=_.find(BufferSummaryStore,function(d){return d.MilestoneUID==c});if(a){var b=_.sortBy(a.Chains,"ChainNumber")}if(b){return b[0].ChainNumber}else{return -1}},getTaskIdsForChainNumber:function(c){var f=[];var e=true;for(var d=0;d<=BufferSummaryStore.length-1&&e;d++){var b=BufferSummaryStore[d];for(var a=0;a<=b.Chains.length-1;a++){if(b.Chains[a].ChainNumber==c){f=b.Chains[a].Tasks.split(",");e=false;break}}}return f},getChecklistStatus:function(a){try{switch(a){case 0:return"none";case 1:return"incomplete";case 2:return"complete"}}catch(b){throw"Checklist status code not recognized: "+a}},getRowById:function(b){for(var a=0;a<this.rows.length;a++){var c=this.rows[a];if(c.uid==b){return c}}return null},getPhaseById:function(c){for(var b=0;b<this.phases.length;b++){var a=this.phases[b];if(a.uid==c){return a}}return null},extractCalendarInfoFromCalendarData:function(f){var d={projectCalendarName:"",defaultStartTime:null,defaultFinishTime:null,defaultHrsPerDay:HOURS_PER_DAY,defaultDaysPerWeek:0};d.projectCalendarName=f.CalendarName;var g=f.WeekDays;var e=[];for(var c=0;c<g.length;c++){var b=g[c];if(b.IsWorking){if(b.Shifts.length>=1){d.defaultStartTime=b.Shifts[0].FromTime;d.defaultFinishTime=b.Shifts[0].ToTime}for(var a=1;a<b.Shifts.length;a++){d.defaultFinishTime=new Date(d.defaultFinishTime)>new Date(b.Shifts[a].ToTime)?d.defaultFinishTime:b.Shifts[a].ToTime}break}}d.defaultHrsPerDay=Math.ceil(f.DefaultWorkingSecsPerDay/SECS_PER_HR);d.defaultDaysPerWeek=this.getNumWorkingWeekDays(g);return d},getNumWorkingWeekDays:function(c){var a=0,b=_.filter(c,function(d){return d.IsWorking==true});if(false==_.isUndefined(b)){a=_.size(b)}return a},initializeCalendarData:function(){var a=this.extractCalendarInfoFromCalendarData(stl.app.calendar);this.projectCalendarName=a.projectCalendarName;this.defaultStartTime=a.defaultStartTime;this.defaultFinishTime=a.defaultFinishTime;this.defaultHrsPerDay=a.defaultHrsPerDay;this.defaultDaysPerWeek=a.defaultDaysPerWeek;HOURS_PER_DAY=this.defaultHrsPerDay;TASK_DURATION_DEFAULT_SEC=10*HOURS_PER_DAY*60*60;SUBTASK_DURATION_DEFAULT_SEC=1*HOURS_PER_DAY*60*60;ONE_DAY_DURATION_DEFAULT_SEC=1*HOURS_PER_DAY*60*60;stl.model.Task.setTaskDefaultDuration(TASK_DURATION_DEFAULT_SEC);stl.model.Subtask.setTaskDefaultDuration(SUBTASK_DURATION_DEFAULT_SEC);juration.setHoursPerDay(this.defaultHrsPerDay)},getTaskStatusColorFromHexValue:function(a){if(!a){return""}switch(a.replace("#","").trim().toUpperCase()){case"008000":case"GREEN":return"task-status-dark-green";case"FFFF00":case"YELLOW":return"task-status-dark-yellow";case"FF0000":case"RED":return"task-status-dark-red";case"80FF80":case"00FF00":return"task-status-light-green";case"FFFF80":case"FFFF7F":return"task-status-light-yellow";case"FF8080":return"task-status-light-red";case"FFFFFF":case"WHITE":return"task-status-white";default:return""}},destroy:function(){var e=this._tasksAndMilestonesByUid;stl.app.deletePropertiesOfObjectCollection(e);delete this._tasksAndMilestonesByUid;var b=this._scopeItemsByUid;stl.app.deletePropertiesOfObjectCollection(b);delete this._scopeItemsByUid;var c=this.links;stl.app.deletePropertiesOfObjectCollection(c);delete this.links;var a=this.subtaskLinks;stl.app.deletePropertiesOfObjectCollection(a);delete this.subtaskLinks;for(var d in stl.model.Project.project){if(stl.model.Project.project.hasOwnProperty(d)){delete stl.model.Project.project[d]}}},isThisTaskBuffer:function(a){var b=true;if(a.taskType!==TASKTYPE_BUFFER){b=false}return b},validatePEandPPTypeConversion:function(b,a){var c=true;if(a===PE_SHORT){if(this.getProjectEndMilestone()){PPI_Notifier.info(PE_ALREADY_EXISTS);c=false}}else{if(a===PP_SHORT||a===STRING_NONE_UPPER_CASE){var d=this.getPhaseById(b.phaseId);if(d.type===STRING_NORMAL){PPI_Notifier.info(PINCH_POINT_CREATE_INFO);c=false}}}return c},isProjectComplex:function(){this.IsComplexMode=false;if(stl.app.isComplexProjectEnabled=="1"){this.IsComplexMode=true}else{this.IsComplexMode=false}return this.IsComplexMode},changeStatusForIPMSOrPEMS:function(b){var a;switch(b.taskType){case PE_SHORT:a=this.getPEMS();break;case CMS_SHORT:a=this.getIPMSForCMS(b);break}if(a){this.updateFieldsForCOStatus(a,b)}},updateFieldsForCOStatus:function(a,b){a.status=b.status;a.actualStartDate=ServerClientDateClass.getTodaysDate();a.startDate=ServerClientDateClass.getTodaysDate();a.actualFinishDate=ServerClientDateClass.getTodaysDate();a.endDate=ServerClientDateClass.getTodaysDate();a.percentComplete=100;a.remainingDuration=0;this.updateMilestone(a)},getIPMSForCMS:function(b){var a;var c=_.find(b._predecessors,function(d){return(d.taskType===IPMS_SHORT||d.taskType===TASKTYPE_BUFFER)});if(c&&c.taskType===IPMS_SHORT){a=c}else{if(c&&c.bufferType===BUFFER_TYPE_CMSB){a=_.find(c._predecessors,function(d){return(d.taskType===IPMS_SHORT)})}}return a},getBufferTaskForMS:function(a){var b;var c=_.find(a._predecessors,function(d){return(d.taskType===TASKTYPE_BUFFER)});if(c&&(c.bufferType===BUFFER_TYPE_CMSB||c.bufferType===BUFFER_TYPE_CCCB)){b=c}return b},getPEMS:function(){var a=_.find(this._milestones,function(b){return(b.taskType===PEMS_SHORT)});return a},checkIfZeroDurationTask:function(b){var a=false;if((b.taskType===STRING_NORMAL||b.taskType===IMS_SHORT)&&parseInt(b.duration)===0){a=true}return a},checkIfZeroDurationMilestoneTask:function(b){var a=false;if(b.taskType===IMS_SHORT&&(((b.status==STATUS_IP||b.status==STATUS_CO)&&parseInt(b.remainingDuration)===0)||parseInt(b.duration)===0)){a=true}if(b.taskType==CMS_SHORT||b.taskType==PE_SHORT){a=true}return a}})}()));stl.model.Project.datePropertyNames=["startDate","endDate","dueDate","lastSaved"];stl.model.Project.defaultRowModel={id:"",uid:"",scopeItemUid:"",name:"",tasks:{},outlineLevel:1,scopeItemName:"",scopeItem:null};stl.model.Project.reconstituteDates=function(a,c){if(typeof c==="string"&&stl.model.Project.datePropertyNames.indexOf(a)>=0){if(stl.app.checkIfValidDate(c)){var b=new Date(c)}else{var b=null}return b}return c};stl.model.Project.fromJSON=function(b){var a=b.jsonBlob;var c=new stl.model.Project(a);c.setProjectSummaryInfo(b.projectData);c.addNameToRows();c.sortPhases();c.unflattenFromServer();c.processMilestones();c.computeMaxUIDs();stl.model.Project.project=c;c.updateLinkDAG();c.createPhaseScopeAndTaskCountMap();if(c._projectEndMs){stl.app.CreateTaskToolBar.PEExists=true;stl.app.CreateTaskToolBar.onPEAddDelete(true)}return c};stl.model.Project.JSONFilter=function(a,b){if(a.charAt(0)==="_"){return undefined}return b};stl.model.Project.getMaxUIDInArray=function(e,b,c){var a=e;if(!c){c="uid"}for(var d=0;d<b.length;d++){var f=b[d];if(!f.uid){console.warn("Filled in missing UID on object",f);f.uid=String(a);a++}else{if(f.uid>=a||(f.id&&f.id>=a)){if(f.id){a=Math.max(Number(f.uid),Number(f.id))+1}else{a=Number(f.uid)+1}}}}return a};stl.model.Project.getCalMaxUIDInArray=function(e,b,c){var a=e;if(!c){c="uid"}for(var d=0;d<b.length;d++){var f=b[d];if(!f[c]){console.warn("missing CalendarUID on object",f)}else{if(f[c]>=a){a=Number(f[c])+1}}}return a};stl.model.Project.createProject=function(a){var b=new stl.model.Project(null,a);return b};stl.model.Project.InitializeNewProject=function(d){var c=d.createMilestone(d.phases[1],d.rows[0],PE_SHORT);var e=d.createSummaryTask(d.phases[0],d.rows[0],STRING_NORMAL);var a=[];if(d.isProjectComplex()){a.push(e)}d.rows[0].tasks[d.phases[0].uid]=a;var b=d.createTask(d.phases[0],d.rows[0],STRING_NORMAL);a.push(b);d.updateLinkDAG();d.createPhaseScopeAndTaskCountMap();d.rows[0].tasks[d.phases[0].uid]=a;d.rows[0].tasks[d.phases[1].uid]=[c];d.addLink({from:b.uid,to:d._milestones[0].uid});stl.model.Project.project=d};stl.model.Project.getProject=function(){return stl.model.Project.project};stl.model.Project.validateProject=function(b){var a=b._projectEndMs;if(!a){PPI_Notifier.alert(PE_MISSING,PROJECT_END);return false}if(a._predecessors.length>0){return true}PPI_Notifier.alert(PE_SHOULD_HAVE_PRED,PROJECT_END);return false};