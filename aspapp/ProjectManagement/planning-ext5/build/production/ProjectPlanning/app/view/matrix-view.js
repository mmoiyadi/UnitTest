stl.view.MatrixView=function(a){var b={nextResourceId:1,readOnly:false,saveTriggerEnabled:true};$.extend(this,b,a);this.$container=$(this.container)};$.extend(stl.view.MatrixView.prototype,(function(){var m=32,q=24,p="fullyCondensed",f="normalCondensed",g=660,d=1000,b={CONDENSED:0,SHORT_TASK_BARS:1,LONG_TASK_BARS:2,TASK_ZOOM_SMALL:3,TASK_ZOOM_FULL:4},a={0:23,1:150,2:300,3:400,4:g},o={0:q,1:m,2:m,3:"auto",4:"auto"},n={0:p,1:f,2:f,3:f,4:f},h={x:0,y:16},k={x:-4,y:12};var j="../../AppServices/PlanningUIService.svc/";var c="streamlinerProjectModel";var l="concertoPlanningLastProjectUid";var e=1;return({wireRowEditEvents:function(){var r=this},checkIfScopeDeletableFromModel:function(r){var s=true;if(!this.project.getScopeItemByUid(r)){s=false}return s},isRowWithSameScopePresent:function(r,t){var s=_.find(this.project.rows,function(u){return(u.scopeItemUid==r&&u.uid!=t)});if(s){return true}else{return false}},insertPhaseColumnUI:function(r,x){var z=this,B=this.project.phases,v=(x===B.length-1),t=(v?this.$view.find(".matrix-view-row:not(.header-row) .phase-column:last-child"):this.$view.find(".matrix-view-row:not(.header-row) .phase-column:nth-child("+(x+1)+")")),D=this.$view.find(".matrix-view-row"),C=$("#templates div[role=phase-column-cell]"),s=C.clone(true),u=this.$view[0],A=this.$view.find(".matrix-view-row.header-row .phase-column").last(),w=this.$phaseHeaderTemplate.clone(true);if(v){t.after(s);A.after(w)}else{t.before(s);this.$view.find(".matrix-view-row.header-row .phase-column:nth-child("+(x+1)+")").before(w)}w.data("model",r);if(v){u.scrollleft=u.scrollwidth}this.bindPhaseColumn(w,r);if(r.type!=="fullkit"&&r.type!=="milestone"){w.find(".phase-name").text(r.name);var y=w.find(".phase-name");this.makeEditable(y);y.on("sl.edit",this.onElementMoveCompleteDelegate)}else{w.find(".phase-name").text("")}this.addPhaseHeaderMenuListeners(w);this.$view.find(".matrix-view-row:not(.header-row) .phase-column:nth-child("+(x+1)+")").each(function(F,E){z.initDragEventsOnPhaseCell($(E),r)});this.syncColumnWidths()},insertPhaseColumn:function(r,v){this.checkAndSetNextDefaultPhaseIdx();var y=this.project,u=y.phases,s=$.grep(y.phases,function(z){return z.type==STRING_NORMAL}).length,x=y.getNextUID("phase"),w={name:DEFAULT_PHASE_NAME+SPACE_CONST+String(stl.app.getNextDefaultPhaseIdx()),id:x,uid:x,type:STRING_NORMAL},t=(r===0?ServerClientDateClass.getTodaysDate():Sch.util.Date.add(new Date(u[r-1].endDate)));w.startDate=Sch.util.Date.add(t,Sch.util.Date.DAY,1);w.endDate=Sch.util.Date.add(w.startDate,Sch.util.Date.DAY,30);$.extend(w,v);u.splice(r,0,w);this.insertPhaseColumnUI(w,r);this.refreshLinks();this.saveProject();this.project.createPhaseScopeAndTaskCountMap();$(document).trigger("phaseadd",[this,w,r]);$(".matrix-view-row.header-row .phase-column").eq(r).find(".phase-name").click();return w},checkAndSetNextDefaultPhaseIdx:function(){var r=0;var s=stl.model.Project.getProject();_.each(s.getAvailableResources().concat(s.getAllPhaseNames()),function(t){if(t.Name.indexOf(DEFAULT_PHASE_NAME)==0){var u=t.Name.substr(DEFAULT_PHASE_NAME.length);if(u.trim().length!=0&&!isNaN(u)){var v=parseInt(u);r=Math.max(r,v)}}});stl.app.setDefaultPhaseIdx(r+1)},onPhaseChange:function(s,v,r,u){if(v===this){return}var t=this.project.phases;$(".matrix-view-row.header-row .phase-column:nth-child("+(t.indexOf(r)+2)+")").children(".phase-name").text(r.name);this.saveProject()},onPhaseAdd:function(s,v,r,u){if(v===this){return}var t=this.project.phases;this.insertPhaseColumnUI(r,u);t.splice(u,0,r);this.refreshLinks();this.saveProject()},onPhaseRemove:function(s,v,r,u){if(v==this){return}var t=this.project.phases;var w=t.splice(u,1);$(".matrix-view-row.header-row .phase-column:nth-child("+(u+2)+")").remove();$(".matrix-view-row:not(.header-row) .phase-column:nth-child("+(u+2)+")").remove();this.saveProject()},savePhases:function(){var r=0;var s=this;this.project.phases=this.$view.find(".header-row .phase-column").toArray().map(function(z,x,u){var t=$(z),w=t.data("model");if(w.type===STRING_NORMAL){w.name=t.find(".phase-name").text().trim()}else{var v=(w.type==="fullkit")?x+1:x-1,y=$(u[v]).data("model");if(y){w.name=$(u[v]).data("model").name.trim()}$(document).trigger("phasechange",[s,w])}w.order=r++;return w})},makeEditable:function(s,r){var t=this;s.not(".sl-editable-ready").on("click",function(u){if(t.readOnly){return}var w=$(u.target);var v=$('<input type="text" class="field-editor" />');w.css({position:"relative"});w.append(v);v.data("oldText",w.text().trim());v.data("owner",w);v.data("origcolor",w.css("color"));w.css("color","transparent");v.css({"font-family":w.css("font-family"),"font-size":w.css("font-size"),"text-align":w.css("text-align"),width:w.width()+"px",height:w.height()+"px","line-height":w.css("line-height"),"vertical-align":w.css("vertical-align"),background:"#f0f0f0",border:w.css("border"),padding:w.css("padding")});v.val(w.text());v.focus();v.select();v.on("click",function(x){return false});v.on("keypress",function(x){if(x.which===13){x.preventDefault()}});v.on("keyup",function(x){w.trigger("",x);if(x.which===13){v.trigger("blur")}});v.on("blur",function(z){var y=$(z.target),D=y.data("owner"),C=y.data("oldText"),A=y.data("origcolor");setTimeout(function(){D.text(y.val().trim());D.css("color",A);D.data("lastVal",C);y.remove();D.trigger("sl.edit")},(w.hasClass("sl-editable-date")?500:0));var B=t.project.isResourceNameDuplicate(y.val().trim());var x=t.project.isPhaseNameDuplicate(y.val().trim(),C);if(!B&&!x){if(y.val().trim()===""&&y.parent().hasClass("phase-name")){y.val(C);PPI_Notifier.info(EMPTY_PHASE_NAMES_NOT_ALLOWED)}}else{if(x){y.val(C);PPI_Notifier.error(PHASE_NAME_DUPLICATE)}else{if(B){y.val(C);PPI_Notifier.error(RESOURCE_NAME_DUPLICATE)}}}});if(w.hasClass("sl-editable-date")){v.datepicker({format:"m/d/yy",autoclose:true});v.datepicker("show")}}).addClass("sl-editable-ready")},onEditableFieldBlur:function(s){var r=$(s.target),u=r.data("owner"),t=r.data("origcolor");u.text(r.val());u.css("color",t);r.remove()},onTaskViewChange:function(r){var t=r.target,s=t.task;$(document).trigger("taskchange",[this,s]);this.triggerSave()},onFullKitTaskClick:function(r){var s=stl.app.isProjectOpenInViewOnlyMode();if(s){return}$(".tool-popup").hide();$(r.target)[0].$el.closest(".task").find(".tool-popup").show();r.stopPropagation()},generateRow:function(A,E,u){var B=this,z=B.$matrixRowTemplate.clone(true);z.find(".phase-column").remove();for(var y=0;y<E.length;y++){var v=B.$cellTemplate.clone(true),D=E[y],x=A.tasks[D.id];v.addClass("phase-type-"+(D.type||"normal"));if(x){for(var w=0;w<x.length;w++){task=x[w];var C;if(!task.isSummary){if(task.isMS){C=this.addEmptyMSUI(D,v);C.load(task);var s=C.$el;this.renderMilestone(s,v,D);if(task.taskType===PE_SHORT){z.addClass("has-PE")}}else{C=this.addEmptyTaskUI(D,v);C.load(task);this.tasksByUid[task.uid]=C}}if(!B.project.isBufferTasksExist||B.project.isBufferTasksExist==false){if(task.taskType=="buffer"){B.project.isBufferTasksExist=true}}}}z.append(v)}z.find(".phase-column").each(function(H,G){B.initDragEventsOnPhaseCell($(G),E[H])});z.find(".scope-item-label").on("change",this.onScopeItemChange.bind(this));this.makeEditable(z.find(".scope-item-label"),{observekeyup:true});if(A.uid!="dummy"){var F=this.project.getScopeItemByUid(A.scopeItemUid);if(F){var t=F.name,r=F.id}if(A.name&&A.name!=""){z.find(".tree-column").addClass("has-scopename");z.find(".scope-item-label").text(t)}else{if(t===EMPTY_STRING){z.find(".tree-column").addClass("blank-scope-name")}}z.data("model",A);z.data("scopeItemUId",A.scopeItemUid);z.attr("scopeItemUId",A.scopeItemUid);z.attr("rowUid",A.uid);this.rowsById[A.uid]=z}return z},populateScopeTreeStore:function(){var u=this;var v=this.project.getProjectRootScope();var s=this.project.rows;var t={expanded:true,children:[],text:this.project.name,leaf:false,data:this.getScopeItemRootNodeData(v)};var r;_.each(s,function(y,x){var w={};var A=stl.app.ProjectDataFromServer.isProjectComplex();w.expanded=typeof(y.isExpanded)!="undefined"?y.isExpanded:false;w.data=u.getScopeItemNodeDataObject(y);w.text=y.name;w.rowUid=y.uid;w.leaf=true;w.children=[];if(A){if(y.outlineLevel){if(y.outlineLevel==1){t.leaf=false;t.children.push(w)}else{if(y.outlineLevel>1){var z=_.last(t.children);while(z&&z.data.outlineLevel!=y.outlineLevel-1){z=_.last(z.children)}if(z){z.leaf=false;z.children.push(w)}}}}else{t.children.push(w)}}else{t.leaf=false;y.outlineLevel=-1;t.children.push(w)}});return t},getScopeItemNodeDataObject:function(s,u){var t=this;var r={};r.id=s.id;r.name=s.name;r.order=s.order;if(stl.app.ProjectDataFromServer.isProjectComplex()){r.outlineLevel=s.outlineLevel}else{r.outlineLevel=-1}r.scopeItemUid=s.scopeItemUid;r.rowUid=s.uid;r.$el=t.rowsById[s.uid];r.uid=s.uid;return r},getScopeItemRootNodeData:function(s){var r={};r.id=s.id;r.name=this.project.name;r.order="0";r.outlineLevel=0;r.scopeItemUid=s.id;r.uid=s.uid;return r},createExtJSTree:function(){var s=this.populateScopeTreeStore();var y=this.$view.find(".matrix-view-end-marker").last();var t=Ext.get(this.$view.find(".matrix-view-end-marker")[0]);var r=Ext.create("Ext.data.TreeStore",{id:"scopeItemTreeStore",root:s});var v=this;var x=Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:0});var w=Ext.getCmp("scopeItemTree");if(w){w.destroy()}var u=Ext.create("ProjectPlanning.view.ScopeColumn.ScopeColumnView",{scopeItemStore:r,renderToProperty:t,matrixView:v,cellEditingPlugin:x});u.show();this.$leftColContainer.prepend($("#scopeItemTree"));this.hideRowsForCollapsedNodes();this.syncRowHeights()},hideRowsForCollapsedNodes:function(){var s=this;var r=Ext.getCmp("scopeItemTree").getRootNode();_.each(this.project.rows,function(v,t){var u=s.findChildRecursively(r,"rowUid",v.uid);if(!v.isExpanded){s.hideAllChildRows(u)}})},hideAllChildRows:function(r){if(r.childNodes.length==0){}else{for(i=0;i<r.childNodes.length;i++){var s=r.childNodes[i];$(s.get("data").$el).css("display","none");this.hideAllChildRows(s)}}},renderMilestone:function(t,v,s){var u=t.data("model");t.find(".milestone-name").text(u.name);var r=t.find(".ms-content-wrap");if(u.taskType===PE_SHORT){r.find(".milestone-icon").text(PE_SHORT);t.addClass("projectEnd")}else{if(u.taskType===CMS_SHORT){r.find(".milestone-icon").text(CMS_SHORT)}else{if(u.taskType===IMS_SHORT){r.find(".milestone-icon").text(IMS_SHORT);t.addClass("internal-milestone")}else{if(u.taskType==="NONE"){r.find(".milestone-icon").text("");t.addClass("internal-milestone");t.addClass("PP-milestone")}else{r.addClass("PE-milestone")}}}}r.data("linkable-element-name",u.name);r.data("link-target-selector",".milestone-icon-wrap");if(this.linksView){this.linksView.addElements(r)}this.milestoneElementsById[u.uid]=t;this.addIsCriticalClassForMilestone(t,u);Ext.getCmp("CCSummarygrid").updateMilestoneSheet(u);return t},addEmptyTaskUI:function(r,s,u){var t=new stl.view.TaskView({insertBefore:s.find(".task-placeholder"),insertAfter:u,project:this.project,availablePeopleAndTeams:stl.app.availablePeopleAndTeams,readOnly:this.readOnly,phase:r,isSubtaskEnabled:ConfigData.moduleSettingsMap.IS_SUBTASK_ENABLED.Enabled&&this.project.isSubtaskEnabled,completeSubtaskOnChecklistComplete:ConfigData.reportSettingsMap.TASKLIST_COMPLETECHECK_WITH_COMPLETECHECKCLIST.Enabled,includeCompletedSubtask:true});s.addClass("has-task");$(t).on({zoom:this.onTaskZoom.bind(this),addTask:this.onNewTaskPlaceholderClick.bind(this),"delete":this.onTaskViewDelete.bind(this),deletesubtask:this.onTaskViewSubtaskDelete.bind(this),resourcechange:this.saveProject.bind(this),enterquickedit:this.onTaskEnterQuickEdit.bind(this),exitquickedit:this.onTaskExitQuickEdit.bind(this),fullkittaskclick:this.onFullKitTaskClick.bind(this),change:this.onTaskViewChange.bind(this),autolinkallChange:this.onAutoLinkAllChange.bind(this)});return t},addEmptyMSUI:function(r,t,u){var s=new stl.view.MilestoneView({insertBefore:t.find(".task-placeholder"),insertAfter:u,project:this.project,availablePeopleAndTeams:stl.app.availablePeopleAndTeams,readOnly:this.readOnly,phase:r,isSubtaskEnabled:ConfigData.moduleSettingsMap.IS_SUBTASK_ENABLED.Enabled&&this.project.isSubtaskEnabled,completeSubtaskOnChecklistComplete:ConfigData.reportSettingsMap.TASKLIST_COMPLETECHECK_WITH_COMPLETECHECKCLIST.Enabled,includeCompletedSubtask:true});t.addClass("has-task");$(s).on({zoom:this.onTaskZoom.bind(this),addTask:this.onNewTaskPlaceholderClick.bind(this),"delete":this.onMilestoneDeleteLocal.bind(this),deletesubtask:this.onTaskViewSubtaskDelete.bind(this),resourcechange:this.saveProject.bind(this),enterquickedit:this.onMSEnterQuickEdit.bind(this),exitquickedit:this.onMSExitQuickEdit.bind(this),change:this.onTaskViewChange.bind(this),autolinkallChange:this.onAutoLinkAllChange.bind(this)});return s},getPreviousVisibleRow:function(r){return r.prevAll(":visible:first")},onNewTaskPlaceholderClick:function(C){var I=this,F,H,y;var v=stl.app.CreateTaskToolBar.getCurrentSelectedTaskType();F=C.target.$el;if(F){y=$(F).closest(".phase-column")}else{H=$(C.target);y=$(H).closest(".phase-column")}var G=y.closest(".matrix-view-row"),x=this.project.phases[G.find(".phase-column").index(y)];if(G.hasClass("row-placeholder")){$fixedCell=this.$view.find(".tree-column.row-placeholder");var A=this.getPreviousVisibleRow(G);var E=A.attr("scopeitemuid");var u=A.attr("rowUid");I.convertRowPlaceholderToRow(E,u)}var z=G.data("model"),t=this.project._scopeItemsByUid[z.scopeItemUid];var w,D,r;if(x.type===STRING_MILESTONE_LOWER_CASE){if(multipleORs(v,CMS_SHORT,PE_SHORT,IMS_SHORT,STRING_NONE_UPPER_CASE)){w=I.project.createTaskModel(x,z,v)}else{w=I.project.createTaskModel(x,z,CMS_SHORT)}}else{if(x.type===FULL_KIT){w=I.project.createTaskModel(x,z,TASKTYPE_FULLKIT)}else{w=I.project.createTaskModel(x,z,v);if(multipleORs(v,CMS_SHORT,IMS_SHORT,TASKTYPE_FULLKIT)){stl.app.CreateTaskToolBar.selectDefaultTaskType()}}}if(w.isMS){D=this.addEmptyMSUI(x,y,F);D.load(w);r=D.$el;I.renderMilestone(r,y,x)}else{D=this.addEmptyTaskUI(x,y,F);D.load(w);r=D.$el;this.tasksByUid[w.uid]=D;I.linksView.addElements(r)}r.find(".task-content-wrapper").css({height:o[this.zoomLevel],width:a[this.zoomLevel]});I.saveRow(G);I.generateAutoLinks(r,x);if(x.type!==STRING_NORMAL){I.configureAutoLinkAll(r)}I.syncColumnWidths();I.refreshLinks();I.scrollIntoView(r);var s=r.prev();var B;if(s&&s.length>0){B=r.prev().data("model").uid}if(!w.isMS){$(document).trigger("taskadd",[I,w,t,z,x,B])}else{$(document).trigger("milestoneadd",[I,w,t,z,x,B])}},generateAutoLinks:function(t,r){var s=t.data("model");if(s.isMS){this.generateAutoLinksForMilestone(t,r)}else{this.generateAutoLinksForTask(t,r)}},configureAutoLinkAll:function(t){var r,s;r=t.data("model");if(r.isMS){s=".ms-autolink input"}else{if(r.taskType===FULL_KIT){s=".fk-autolink input"}}if(s){t.find(s).prop("checked",true);this.onAutoLinkAllChecked(t)}},initDragEventsOnPhaseCell:function(v,r){var u=this,t=v[0];var s=r.type;if(!s||s==="normal"){v.sortable({handle:".task-name .drag-drop-handle",itemSelector:".task",scroll:true,distance:5,vertical:false,group:"matrix-view-"+this.matrixViewId+"-tasks",placeholder:'<div class="placeholder task-reorder-placeholder"></div>',pullPlaceholder:true,onMousedown:function(w,y,x){return !u.readOnly&&w.length>0&&!w.hasClass("quick-task-edit")&&!w.hasClass("task-zoom-normal")&&!w.hasClass("zero-duration-task")},onDragStart:function(x,y,w){u.linksView.setVisible(false);u.$taskDragOrigRow=x.closest(".matrix-view-row");u.$taskDragOrigColumn=x.closest(".phase-column");x.css("position","relative");u.$view.addClass("dragging");w(x)},onDrop:function(w,F,M){u.$view.removeClass("dragging");var G=w.closest(".matrix-view-row"),I=u.$taskDragOrigRow,z=w.closest(".phase-column"),C=u.$taskDragOrigColumn,x=u.project.phases[G.find(".phase-column").index(z)],y=w.data("model");M(w);z.addClass("has-task");var L=C.find(".task,.milestone");if(L.length===0){C.removeClass("has-task")}var K=z.find(".task-placeholder").next(".task");if(K.length>0){z.find(".task-placeholder").before(K)}y.phaseId=x.uid;if(G.hasClass("row-placeholder")){var E=u.getPreviousVisibleRow(G);var H=E.attr("scopeitemuid");var A=E.attr("rowUid");u.convertRowPlaceholderToRow(H,A);u.saveRow(G)}y.rowId=G.data("model").uid;u.saveRow(I);delete u.$taskDragOrigRow;delete u.$taskDragOrigColumn;u.removeAutoAndInvalidLinksForTask(w.data("model").uid);var B=z.find(".task"),D=B.index(w);if(D>0&&D<D-1){u.removeLink(B.eq(D-1),B.eq(D+1))}u.generateAutoLinksForTask(w,x);var J=u.tasksByUid[y.uid];J.updateTaskPhaseColors(w,y);if(!G.is(I)){u.saveRow(G);$(document).trigger("rowchange",[u,I.data("model"),G.data("model"),x])}else{$(document).trigger("phasechange",[u,u.project.phases[G.find(".phase-column").index(C)],x])}u.saveProject();u.refreshLinks();if($(".toggle-links-button").hasClass("pressed")){u.linksView.setVisible(true)}u.syncColumnWidths();u.syncRowHeights()}})}},onTaskZoom:function(A){var y=A.target,r=y.$el,w=r.closest(".phase-column.hidden-title"),u=null,s=null,z=false,x=r.find(".task-properties"),t=(x.outerWidth()-x.width());if(r.hasClass("task-zoom-normal")){if(this.project.checkIfZeroDurationTask(y.task)){r.addClass("zero-duration-task")}this.removeOverlayModeCssChanges();u=a[this.zoomLevel];s=o[this.zoomLevel];this.selectedTask=null;if(this.zoomLevel==0){r.find(".task-controls").css("display","")}$(document).trigger("taskchange",[this,y.task]);$(document).trigger("taskselectionchange",[this.selectedTask])}else{var u=g;s="auto";z=true;var v=$(".matrix-view-viewport").find(".quick-task-edit");if(v.length>0){$(v).data("view").exitQuickEditMode()}if(y.isSubtaskEnabled&&y.task.subtaskCount>0){if(!r.find(".subtask-type").is(":visible")){r.find(".subtask-type").show()}}if(y.task.taskType=="purchasing"){}else{if(!r.find(".subtasks").is(":visible")){r.find(".subtasks").show()}}this.addOverlayModeCssChanges();w.css("min-width",w.outerWidth());r.addClass("task-zoom-normal");r.removeClass("task-zoom-small");r.removeClass("quick-task-edit");r.next(".task-spaceholder, .task-spaceholder-fk").remove()}if(u&&s){x.width(z?(u-t):"auto");r.find(".task-content-wrapper").transition({height:s,width:u},500,"in-out",function(){if(!z){w.css("min-width",0);r.removeClass("task-zoom-normal");if(this.zoomLevel===b.TASK_ZOOM_SMALL){r.addClass("task-zoom-small");r.find(".subtasks").css("display","")}}this.scrollIntoView(r,u,(s&&s!=="auto"?s:null))}.bind(this))}else{this.scrollIntoView(r,u,(s&&s!=="auto"?s:null))}},onElementMoveComplete:function(){var r=this;r.refreshLinks();r.syncColumnWidths();r.syncRowHeights();setTimeout(function(){if($(".toggle-links-button").hasClass("pressed")){r.linksView.setVisible(true)}},150)},invalidateResourceCache:function(){delete this.cachedResourcesById;delete this.cachedAvailableResourceOptions;delete this.resourceHighlightMenuIsCurrent},onCellClick:function(){if(this.$view.hasClass("tasks-collapsed")){this.$view.find(".active-task").removeClass("active-task")}},getNewTaskName:function(u,r){var t=u.tasks[r.id],s=(t?t.length:0);return r.name+" "+u.name+(s===0?"":(" "+String(s+1)))},handleDragenter:function(r){r.preventDefault();if(this.draggingTask&&$(r.target).hasClass("phase-column")){$(r.target).addClass("drop-highlight")}},handleDragleave:function(r){r.preventDefault();if($(r.target).hasClass("drop-highlight")){$(r.target).removeClass("drop-highlight")}},handleDragover:function(r){r.preventDefault()},handleDrop:function(s){var u=this,r=$(s.target).closest(".phase-column"),v=$(".sortable-dragging"),t=$(".task-dragging");if(v.length>0&&!r.hasClass("has-task")){setTimeout(function(){var z=v.find(".subtask-name input").val(),x=v.closest(".task"),y=r.closest(".matrix-view-row"),w=u.project.phases[y.find(".phase-column").index(r)],B=u.project.createTask(w,y.data("model"),STRING_NORMAL);v.remove();B.name=z;var A=this.addEmptyTaskUI(w,r);A.load(B);this.tasksByUid[task.uid]=A;$(document).trigger("taskadd",[u,A.$el,B,y.data("model"),w,y]);$("li.sortable-placeholder").remove();u.saveRow(y);u.refreshLinks()},0)}this.draggingTask=false;s.preventDefault()},setZoomLevel:function(v,w,B){var y=this,z=!(w===null||typeof(w)==="undefined"||w===v)||B,A=(v>w);this.$view.removeClass("zoom-level-"+w).addClass("zoom-level-"+v);if(v===b.CONDENSED){$(".zoom-button.zoom-out").addClass("disabled");this.$view.addClass("tasks-condensed");this.linksView.setOutEndpointOffsets(k)}else{$(".zoom-button.zoom-out").removeClass("disabled");this.$view.removeClass("tasks-condensed");this.linksView.setOutEndpointOffsets(h)}if(v===Object.keys(b).length-1){$(".zoom-button.zoom-in").addClass("disabled")}else{$(".zoom-button.zoom-in").removeClass("disabled")}this.$view.addClass("tasks-collapsed");var s=o[v];var x=n[v];var u;if(z&&A&&v==b.TASK_ZOOM_FULL){u=this.$view.find(".task:not(.buffer-task), .fk, .ms")}else{u=this.$view.find(".task, .fk, .ms")}u.removeClass("task-zoom-collapsed task-zoom-normal");u.toggleClass("task-zoom-small",(v===b.TASK_ZOOM_SMALL));if(v===Object.keys(b).length-1){if(!u.hasClass("task-properties-alignment")){u.addClass("task-properties-alignment")}}else{u.removeClass("task-properties-alignment")}this.$view.find(".fullkit, .fk").toggleClass("fk",(v===b.TASK_ZOOM_SMALL)).toggleClass("fullkit",(v!==b.TASK_ZOOM_SMALL));u.find(".subtasks").css("display","");var C=a[v];if(z){y.linksView.setVisible(false);if(u.length>0){var r=u.first().find(".task-properties"),t=(r.outerWidth()-r.width());u.find(".task-content-wrapper").each(function(E,D){var G=$(D);G.stop().transition({height:s,width:C},500,"in-out",y.onElementMoveCompleteDelegate);if(v===b.TASK_ZOOM_FULL){var F=G.closest(".task").data("model");if(F){G.find(".subtasks").toggle(F.taskType!=="purchasing")}}})}}else{u.find(".task-content-wrapper").css({height:s,width:C});this.syncColumnWidths();this.syncRowHeights()}this.setCondensationClass(u,x);this.$view.data("zoom-level",v);this.zoomLevel=v;this.setExtraZoomOutEnabled(false)},setCondensationClass:function(r,s){r.removeClass(p);r.removeClass(f);r.addClass(s)},refreshLinks:function(){if(this.linksView){this.linksView.showRefreshLinksNotifier();this.linksView.triggerRefresh()}},addAutoLink:function(r,s){var w=this.resolveLinkEndpointUID(r);var v=this.resolveLinkEndpointUID(s);var t=this.project._tasksAndMilestonesByUid[w];var u=this.project._tasksAndMilestonesByUid[v];if(multipleORs(t.taskType,PE_SHORT,CMS_SHORT)){return}if(u._predecessors.indexOf(t)!=-1){return}if(t._successors.indexOf(u)!=-1){return}this.addLink({from:w,to:v,auto:true})},addLink:function(r){this.project.addLink(r);this.triggerSave()},removeLink:function(s,t){var r=t.attr("id");if(!r){if(!t.data("model")){r=t.parent().data("model").uid}else{r=t.data("model").uid}}this.project.removeLink(s.attr("id"),r);this.linksView.removeConnection(s,t)},onBeforeLinkAdd:function(r,s){s.valid=this.isLinkAllowed(s.from,s.to,true,s.errors,s.newlinkIds);if(s.valid==false){if(s.errors.length>0){PPI_Notifier.alert(s.errors[0],LINK_ERROR)}}},numberOfInPhaseLinksAllowed:function(t){var v=parseInt(stl.app.commonSettingValue("TECHNICAL_DEPENDENCIES_PERCENT"));var s=this.project.getAllTasksInPhaseBlock(t);var u=s.length;var r=Math.ceil((v*u)/100);return r},resetPhaseLinksAllowedWithAddDeleteTask:function(r){r.maxFlexAllowed=this.numberOfInPhaseLinksAllowed(r.uid);if(!r.usedFlexibleLinks){r.usedFlexibleLinks=0}},isLinkAllowed:function(U,s,N,J,O){var t=U.closest(".phase-column"),C=s.closest(".phase-column"),A=this.resolveLinkEndpointUID(U),K=this.resolveLinkEndpointUID(s),z=t.index()-1,u=C.index()-1,E=t.closest(".matrix-view-row"),G=C.closest(".matrix-view-row"),y=this.milestoneElementsById[A],S=this.milestoneElementsById[K],I=t.find(".task"),x=I.index(U),P=I.length>0&&(x===I.length-1),T=C.find(".task"),B=T.index(s),r=T.length>0&&B===0;if(y){var w=y.data("model")}else{var w=U.data("model")}if(S){var L=S.data("model")}else{var L=s.data("model")}if(this.project.isIDCCed){var F=t.find(".ccfb-task").length;if(F>0&&!P){var H=true;var v=x;while(v<I.length){if(!(I.eq(v+1).hasClass("ccfb-task"))){H=false;break}v=v+1}}}var M=true;if(t.find(".ms").hasClass("PP-milestone")){M=true}if(U.is(s)){M=false;if(J){J.push("A Task cannot be linked to its own.")}return false}if(this.project.isRedundantLinkPresent(K,A)){M=false;if(J){J.push("Link from "+w.id+" to "+L.id+" is invalid. "+REDUNDANT_LINK)}return false}if(this.project.isRedundantLinkPresent(A,K)){M=false;if(J){J.push("Link from "+w.id+" to "+L.id+" is invalid. "+CYCLIC_LINK)}return false}if(w.taskType===PE_SHORT||L.taskType==PE_SHORT){if(L.taskType==PE_SHORT){if(w.bufferType=="CMSB"||w.taskType==CMS_SHORT||w.taskType==IPMS_SHORT||w.taskType=="fullkit"){M=false;if(J){J.push(INCOMING_LINKS_TO_PE)}return false}}if(w.taskType==PE_SHORT){M=false;if(J){J.push(NO_SUCC_FOR_CMS_PE)}return false}if(L.taskType==PE_SHORT){if(w.taskType==PEMS_SHORT){if(C.find(".cccb-task").length>0){this.addAutoLink(U,C.find(".cccb-task"));M=false;if(O){O.push(C.find(".cccb-task").data("model").id)}return false}return true}if(w.bufferType=="CCCB"){return true}var Q=C.find(".pems-milestone");if(Q.length>0){this.addAutoLink(U,Q.find(".PE-milestone"));M=false;if(O){O.push(Q.data("model").id)}return false}else{if(C.find(".cccb-task").length>0){this.addAutoLink(U,C.find(".cccb-task"));M=false;if(O){O.push(C.find(".cccb-task").data("model").id)}return false}}}else{if(w.taskType==PEMS_SHORT){if(C.find(".cccb-task").length>0){this.addAutoLink(U,C.find(".cccb-task"));M=false;if(O){O.push(C.find(".cccb-task").data("model").id)}return false}}}}if(w.taskType===CMS_SHORT||L.taskType==CMS_SHORT){if(L.taskType==CMS_SHORT){if(w.bufferType=="CCCB"||w.taskType==PE_SHORT||w.taskType==PEMS_SHORT||w.taskType=="fullkit"){M=false;if(J){J.push(INCOMING_LINKS_TO_CMS)}return false}}if(w.taskType==CMS_SHORT){M=false;if(J){J.push(NO_SUCC_FOR_CMS_PE)}return false}if(L.taskType==CMS_SHORT){if(w.taskType==IPMS_SHORT){if(C.find(".cmsb-task").length>0){this.addAutoLink(U,C.find(".cmsb-task"));M=false;if(O){O.push(C.find(".cmsb-task").data("model").id)}return false}return true}if(w.bufferType=="CMSB"){return true}var R=C.find(".ipms-milestone");if(R.length>0){this.addAutoLink(U,R.find(".PE-milestone"));M=false;if(O){O.push(R.data("model").id)}return false}else{if(C.find(".cmsb-task").length>0){this.addAutoLink(U,C.find(".cmsb-task"));M=false;if(O){O.push(C.find(".cmsb-task").data("model").id)}return false}}}else{if(w.taskType==IPMS_SHORT){if(C.find(".cmsb-task").length>0){this.addAutoLink(U,C.find(".cmsb-task"));M=false;if(O){O.push(C.find(".cmsb-task").data("model").id)}return false}}}}if(w.taskType==PEMS_SHORT||L.taskType==PEMS_SHORT){if(L.taskType==PEMS_SHORT){if(!(multipleORs(w.taskType,STRING_NORMAL,IMS_SHORT,"NONE")||w.bufferType=="CCFB")){M=false;if(J){J.push(INCOMING_LINKS_TO_PEMS_IPMS)}return false}}if(w.taskType==PEMS_SHORT){if(!(L.bufferType=="CCCB"||L.taskType==PE_SHORT)){M=false;if(J){J.push(OUTGOING_LINKS_FROM_PEMS)}return false}else{if(!t.is(C)){M=false;if(J){J.push(PEMS_CCCB_LINK_LIMITATION)}return false}}}}if(w.taskType==IPMS_SHORT||L.taskType==IPMS_SHORT){if(L.taskType==IPMS_SHORT){if(!(multipleORs(w.taskType,STRING_NORMAL,IMS_SHORT,"NONE")||w.bufferType=="CCFB")){M=false;if(J){J.push(INCOMING_LINKS_TO_PEMS_IPMS)}return false}}if(w.taskType==IPMS_SHORT){if(!(L.bufferType=="CMSB"||L.taskType==CMS_SHORT||L.taskType==IMS_SHORT)){M=false;if(J){J.push(IPMS_CMSB_LINK_LIMITATION)}return false}else{if(!t.is(C)){M=false;if(J){J.push(IPMS_CMSB_LINK_LIMITATION)}return false}}}}if(w.bufferType=="CCCB"||L.bufferType=="CCCB"){if(L.bufferType=="CCCB"){if(w.bufferType=="CCCB"||w.bufferType=="CMSB"||w.taskType=="fullkit"){M=false;if(J){J.push(INCOMING_LINKS_TO_CCCB)}return false}}if(w.bufferType=="CCCB"){if(L.taskType!=PE_SHORT){M=false;if(J){J.push(OUTGOING_LINKS_FROM_CCCB)}return false}}if(L.bufferType=="CCCB"){if(!t.is(C)){var Q=C.find(".pems-milestone");if(Q.length>0){this.addAutoLink(U,Q.find(".PE-milestone"));M=false;if(O){O.push(Q.data("model").id)}return false}}}}if(w.bufferType=="CMSB"||L.bufferType=="CMSB"){if(L.bufferType=="CMSB"){if(w.bufferType=="CMSB"||w.taskType=="fullkit"){M=false;if(J){J.push(INCOMING_LINKS_TO_CMSB)}return false}}if(w.bufferType=="CMSB"){if(!(L.taskType==CMS_SHORT||L.taskType==IMS_SHORT)){M=false;if(J){J.push(OUTGOING_LINKS_FROM_CMSB)}return false}}if(L.bufferType=="CMSB"){if(!t.is(C)){var R=C.find(".ipms-milestone");if(R.length>0){this.addAutoLink(U,R.find(".PE-milestone"));M=false;if(O){O.push(R.data("model").id)}return false}}}}if(w.bufferType=="CCFB"||L.bufferType=="CCFB"){}if(w.taskType==STRING_NORMAL||L.taskType==STRING_NORMAL){}if(w.taskType=="fullkit"||L.taskType=="fullkit"){}if(!(t.is(C))&&!(E.is(G))&&((z<u&&!r)||z==u)){if(w&&L){if(w.taskType==STRING_NORMAL&&L.taskType==STRING_NORMAL){var D=this.project.phases[z+1];if(!D.maxFlexAllowed){D.maxFlexAllowed=this.numberOfInPhaseLinksAllowed(D.uid);D.usedFlexibleLinks=0}if(D.maxFlexAllowed>0&&D.usedFlexibleLinks<D.maxFlexAllowed){M=true;D.usedFlexibleLinks++}else{PPI_Notifier.alert("Allows only "+D.maxFlexAllowed+" dependencies."+FLEXIBLE_LINKS_ALLOWANCE_CONFIG,LINK_ERROR);M=false}}}}return M},linkHasCycle:function(u,r,v){if(r[u.to]){v.to=u.to;return true}r[u.to]=true;for(var s=0;s<this.project.links.length;s++){var t=this.project.links[s];if(t.from===u.to&&this.linkHasCycle(t,r,v)){v.from=t.from;return true}}return false},onLinksViewLinkAdd:function(r,s){this.addLink({from:this.resolveLinkEndpointUID(s.from),to:this.resolveLinkEndpointUID(s.to)})},resolveLinkEndpointUID:function(r){return(r.hasClass("ms-content-wrap")?r.closest(".milestone").data("model").uid:r.data("model").uid)},getTaskOrMilestoneLinkTargetElementByUid:function(s){var t=this.tasksByUid[s];if(t&&(!t.task.isMS)){return t.$el}var r=this.milestoneElementsById[s];if(r){return r.find(".ms-content-wrap")}return null},onLinksViewLinkRemove:function(r,u){var t=u.to.attr("id");var s=u.from.attr("id");if(u.to.hasClass("PE-milestone")||!t){if(!(u.to.attr("id"))){t=u.to.closest(".milestone").data("model").uid}}if(u.from.hasClass("PE-milestone")||!s){if(!(u.from.attr("id"))){s=u.from.closest(".milestone").data("model").uid}}this.project.removeLink(s,t);this.triggerSave()},onLinkRemove:function(r,t){var s=this.getTaskOrMilestoneLinkTargetElementByUid(t.from),u=this.getTaskOrMilestoneLinkTargetElementByUid(t.to);if(s.length>0&&u.length>0){this.linksView.removeConnection(s,u)}},onLinkAdd:function(r,t){var s=this.getTaskOrMilestoneLinkTargetElementByUid(t.from),u=this.getTaskOrMilestoneLinkTargetElementByUid(t.to);if(s&&u&&s.length>0&&u.length>0){this.linksView.addConnection(s,u)}},initializeLinks:function(){this.linksView=new stl.view.Links({container:this.$view.find(".matrix-view-inner"),elements:this.$view.find(".task, .milestone .ms-content-wrap"),outEndpointYOffset:16,topEdge:this.$view.find(".matrix-view-row.header-row").height(),readOnly:this.readOnly,visible:$(".toggle-links-button").hasClass("pressed")});$(this.linksView).on("beforelinkadd",this.onBeforeLinkAdd.bind(this));$(this.linksView).on("linkadd",this.onLinksViewLinkAdd.bind(this));$(this.linksView).on("linkremove",this.onLinksViewLinkRemove.bind(this))},renderRow:function(u,t,s,v){var r=this.generateRow(u,t,v);s.before(r);this.moveNewRowFirstCellIntoFixedColumn(r);r.removeAttr("role");return r},moveNewRowFirstCellIntoFixedColumn:function(r){var s=this.$view.find(".matrix-view-row").index(r),t=r.find(".tree-column");t.data("row-body",r);r.data("fixed-cell",t);if(s===0){this.$leftColContainer.prepend(t)}else{this.$leftColContainer.children().eq(s-1).after(t)}},loadProject:function(v){try{console.log("Method called matrix view - loadProject");var r=ServerClientDateClass.getTodaysDate();var z=this,s=this.$view.parent();this.$view.detach();this.$view.data("model",v).addClass("connections-hidden");this.project=v;$(this.project).on({resourceschanged:function(){z.invalidateResourceCache()},linkremove:this.onLinkRemove.bind(this),linkadd:this.onLinkAdd.bind(this),milestoneremove:this.onMilestoneRemove.bind(this)});this.project.createScheduler(stl.app.calendar);var y=false;this.$view.find(".matrix-view-row:not(.header-row)").remove();this.renderPhaseHeaders(v.phases);var B=this.$view.find(".matrix-view-end-marker").last();var t=v.rows.length;var A=v.phases;for(var u=0;u<t;u++){var x=this.renderRow(v.rows[u],A,B,0)}this.addPlaceholderRow();z.initializeLinks();setTimeout(function(){if(v.links){_.each(v.links,function(H){var E=z.getTaskOrMilestoneLinkTargetElementByUid(H.from),G=z.getTaskOrMilestoneLinkTargetElementByUid(H.to);if(E&&G){z.linksView.addConnection(E,G);var F=E.data("model");var D=G.data("model");if(F&&D){if(F.phaseId==D.phaseId&&F.rowId!=D.rowId){var C=$.grep(v.phases,function(I){return I.uid==F.phaseId})[0];if(!C.maxFlexAllowed){C.maxFlexAllowed=z.numberOfInPhaseLinksAllowed(C.uid)}if(!C.usedFlexibleLinks){C.usedFlexibleLinks=0}C.usedFlexibleLinks++}}}})}hideLoadingIcon();z.refreshLinks();z.$view.removeClass("connections-hidden")},50);s.append(this.$view);$(document).trigger("projectload",[this]);this.createExtJSTree();this.syncColumnWidths();this.syncRowHeights();stl.app.isMatrixViewLoaded=true}catch(w){console.log(w);onProjectLoadFailed()}},doUIChangesafterIDCC:function(){var r=!($("#ccSummary").hasClass("disabled")?true:false);if(this.project.isIDCCed&&r){$(".page-header .highlight").find(".button-text").text(HIGHLIGHT+NONE);if(stl.app.isViewChangeRequired){stl.app.redirectToTimelineView()}if(stl.app.isHighlightRequired){$(document).trigger("expandAllScopeNodes");$(".page-header .highlight").find(".button-text").text(HIGHLIGHT+CC_TASKS);$(document).trigger("highlightcctasks")}}},doUIChangesafterReDoCCFB:function(){var r=!($("#bufferSummary").hasClass("disabled")?true:false);if(r){$(".page-header .highlight").find(".button-text").text(HIGHLIGHT+NONE);if(stl.app.isViewChangeRequired){stl.app.redirectToTimelineView()}if(stl.app.isHighlightRequired){$(document).trigger("expandAllScopeNodes");$(".page-header .highlight").find(".button-text").text(HIGHLIGHT+PEN_CHAIN);$(document).trigger("highlightPenChain")}}},showCCSummaryDialog:function(r){var s=!($("#ccSummary").hasClass("disabled")?true:false);var t=!($("#bufferSummary").hasClass("disabled")?true:false);if(s||t){toggleDockingGrids("CCSummarygrid","milestoneSheet",true)}},showResourceSheet:function(){},DestroyMilestoneDialog:function(r){Ext.getCmp("msGrid").store.clearData();toggleDockingGrids("CCSummarygrid","milestoneSheet",false)},enableRemoveBuffersOption:function(){if(this.project.isBufferTasksExist&&!this.readOnly){$("#undoCCAB").removeClass("disabled");$("#undoCCAB").removeAttr("disabled")}},renderPhaseHeaders:function(s){this.$phaseHeaderTemplate=this.$view.find(".matrix-view-row.header-row .phase-column").last().clone(true);var r=this.$view.find(".matrix-view-row.header-row");this.$view.find(".matrix-view-row.header-row .phase-column").remove();for(var u=0;u<s.length;u++){var t=this.$phaseHeaderTemplate.clone(true);this.addPhaseHeaderMenuListeners(t);r.append(t);var v=t.find(".phase-name");this.makeEditable(v);v.on("sl.edit",this.onElementMoveCompleteDelegate);this.bindPhaseColumn(t,s[u]);$lastHeaderCell=t}},bindPhaseColumn:function(s,v){var u=this,t=s.index();if(v.name){if(v.type=="normal"){s.find(".phase-name").text(v.name)}}else{s.find(".phase-name").text("")}s.data("model",v);s.addClass("phase-type-"+v.type);s.find(".tool-popup .tool-item").removeClass("disabled");s.find(".tool-popup .tool-hidden-for-"+(v.type||"normalphase")).addClass("disabled");var r=this.$view.find(".matrix-view-row .phase-column:nth-child("+(t+1)+")");r.removeClass("phase-type-normal phase-type-fullkit phase-type-milestone").addClass("phase-type-"+(v.type||"normal"));if(v.type==="milestone"){s.find(".tool-popup .tool-item-delete-phase").text(REMOVE_MS_PHASE);s.find(".tool-popup .tool-item-phase-task-properties").addClass("disabled")}else{if(v.type==="fullkit"){s.find(".tool-popup .tool-item-delete-phase").text(REMOVE_FULLKIT);s.find(".tool-popup .tool-item-phase-task-properties").addClass("disabled")}else{if(v.hasFullkit){s.find(".tool-popup .tool-item-insert-phase-before").addClass("disabled");s.find(".tool-popup .tool-item-insert-fullkit-before").addClass("disabled")}}}},onInsertPhaseClick:function(t){var r=$(t.target).closest(".phase-column");var s=$(t.target).closest(".matrix-view-row");insertPhaseColumn(r.index()-1,s)},saveRow:function(s,w){var u=this,w=s.data("model"),v=this.$view.find(".matrix-view-row.header-row .phase-column"),r=s.find(".phase-column"),t={};r.each(function(z,y){var C=$(y);if(C.hasClass("has-task")){var A=u.project.phases[z].uid;var B=C.find(".task, .milestone");var x=0;t[A]=B.map(function(E,D){var F=$(D).data("model");if(u.checkPrevTaskIsCMSorPE(E,B)){x=x+3}F.order=x++;return F}).get()}});if(this.project.isProjectComplex()){t=this.retainSummaryTaskInRowModel(w,t)}if(w){w.tasks=t}this.triggerSave();return w},checkPrevTaskIsCMSorPE:function(u,t){var r=false;if(u>0){var s=$(t[u-1]).data("model").taskType;if(s===PE_SHORT||s===CMS_SHORT){r=true}}return r},onRowChange:function(s,t,v,u){if(t===this){return}var r=this.rowsById[v.uid];r.data("model",v);r.find(".scope-item-label").text(v.name);this.saveRow(r,v);this.saveProject()},onRowRemove:function(s,t,r){if(t===this){return}if(t.xtype!="ptableview"){if(r.data("model")){var u=r.data("model")}}else{var u=this.rowsById[r.data.Id].data("model");r=this.rowsById[r.data.Id]}delete u.tasks;delete this.rowsById[u.uid];delete u;r.data("fixed-cell").remove();r.remove();this.refreshLinks();this.saveProject()},callDeleteRow:function(r){this.deleteRow(r);$(document).trigger("rowremove",[this,r])},deleteRow:function(y){var v=this.project.rows;var r=y.data.data.$el;var x=y.data.data.uid;for(var u=this.project._milestones.length-1;u>=0;u--){var t=this.project._milestones[u];if(t.rowId===x){this.deleteMilestone(t.uid)}}Object.keys(this.tasksByUid).forEach(function(z){var A=this.tasksByUid[z];if(A.task.rowId===x){this.deleteTask(A.$el)}}.bind(this));var s=v.map(function(z){return z.uid}).indexOf(x);var w=v.splice(s,1);delete this.rowsById[x];$(r).remove();this.refreshLinks();this.saveProject();this.syncRowHeights()},onRowAdd:function(C,u,x,B,A,w){if(u===this){return}var y=this;var z=this.$view.find(".matrix-view-row").last(),t=this.$view[0],s=$(t).data("model").rows.length,r="new project"+(s>0?(" "+String(s+1)):""),x=this.project.createRow(null,r);if(u.xtype=="ptableview"&&x){x.id=x.Id}var v=y.generateRow(x,this.project.phases);z.after(v);v.addClass("level-0");v.find(".tree-column .scope-item-label").text(x.name);v.addClass("project-row");this.moveNewRowFirstCellIntoFixedColumn($row);y.saveRow(v);y.saveProject();t.scrolltop=t.scrollheight;y.refreshLinks()},onScopeNameChange:function(w,s,t,v,r){if(s===this){return}var u=this;var x=Ext.getCmp("scopeItemTree").getRootNode().findChild("rowUid",t.uid,true);x.set("text",r);this.onScopeItemChange(w,x,v,r)},onScopeItemChange:function(L,H,y,v,u){var N=this;var F=H.get("data").$el;var G=H.get("data").scopeItemUid;var K=H.get("data").uid;var I=H.childNodes.length==0?false:true;var w=$(H.get("data").$el).data("model");var r=this.project.getSummaryTaskFromRow(w);var N=this,C=y?y:L.originalValue,J=v?v:L.value;if(J!==C||u){var x=N.checkIfScopeDeletableFromModel(G),B=N.project.getScopeItemByUid(G),E=N.isRowWithSameScopePresent(G,K);var t=false,s=false,z=false;if(u){scopeItemNewVal=N.project.createScope(J);s=true}else{if((J.trim()==EMPTY_STRING)&&x&&!I){N.project.deleteScopeItemByUid(G);z=true}else{if((J.trim()!=EMPTY_STRING)&&C.trim()==EMPTY_STRING&&!r){scopeItemNewVal=N.project.createScope(J);s=true}else{scopeItemNewVal=N.project.renameScopeItem(G,J);t=true}}}var A=H.get("data").$el,D=H.get("data"),w=A.data("model");if(z){var M=null;if(!this.project.isProjectComplex()){w.scopeItemUid=this.getScopeUidOfSeletedNodeForSimpleProject(H);w.name="";D.scopeItemUid=w.scopeItemUid;D.name="";this.setScopeItemUidOfAllRows(H);M=N.project.getProjectRootScope()}else{w.scopeItemUid=H.parentNode.get("data").scopeItemUid;w.name="";D.scopeItemUid=H.parentNode.get("data").scopeItemUid;D.name="";M=N.project.getScopeItemByUid(w.scopeItemUid)}}else{if(s){w.scopeItemUid=scopeItemNewVal.uid;w.name=scopeItemNewVal.name;D.scopeItemUid=scopeItemNewVal.uid;D.name=scopeItemNewVal.name;if(!this.project.isProjectComplex()){this.setScopeItemUidOfAllRows(H)}}else{if(t){w.scopeItemUid=scopeItemNewVal.uid;w.name=scopeItemNewVal.name;D.scopeItemUid=scopeItemNewVal.uid;D.name=scopeItemNewVal.name;if(this.project.isProjectComplex()){this.updateNameOfSummaryTask(w,scopeItemNewVal.name)}}}}if(N.project.isProjectComplex()){if(s){w=N.addSummaryTaskToRow(w,scopeItemNewVal,A,H)}if(z){w=N.deleteSummaryTaskFromRow(w,H)}}A.attr("scopeitemuid",w.scopeItemUid);A.attr("rowUid",w.uid);A.data("model",w);if(window.currentViewId!="table"){$(document).trigger("scopenamechange",[N,w,M?M:scopeItemNewVal])}if(z){N.project.createPhaseScopeAndTaskCountMap()}if(J==""){N.saveProject()}}},updateNameOfSummaryTask:function(t,r){var s=this.project.getSummaryTaskFromRow(t);if(s){s.name=r}},setScopeItemUidOfAllRows:function(t){var v=this.getAllRowsOfScope(t);var s=t.get("data").scopeItemUid;var u=this;var r=this.project.getScopeItemByUid(s);_.each(v,function(y,w){var z=y.get("data").$el,x=y.get("data"),A=z.data("model");A.scopeItemUid=s;x.scopeItemUid=s;z.attr("scopeitemuid",A.scopeItemUid);z.data("model",A);if(window.currentViewId!="table"){$(document).trigger("rowchange",[u,A,r])}})},getAllRowsOfScope:function(t){var s=[];var r=t.parentNode;for(i=r.indexOf(t)+1;i<r.childNodes.length;i++){if(r.childNodes[i].get("text").trim()!=""){break}else{s.push(r.childNodes[i])}}return s},getScopeUidOfSeletedNodeForSimpleProject:function(r,t){var s=Ext.getCmp("scopeItemTree").getRootNode();var u=r.parentNode.indexOf(r);if(t){u=u-1}for(i=u;i>=0;i--){if(s.childNodes[i].get("text").trim()!=""){return s.childNodes[i].get("data").scopeItemUid}}return s.get("data").scopeItemUid},saveProject:function(){var r=this.$view.find(".matrix-view-row:not(.header-row, .row-placeholder)"),u=this.$view.find(".matrix-view-row.header-row .phase-column"),s=this.$view.data("model");this.savePhases();var t=0;s.rows=r.toArray().map(function(v){var w=$(v).data("model");w.order=t++;return w});this.triggerSave()},triggerSave:function(){if(this.saveTriggerEnabled==true){if(this.saveTimeout){clearTimeout(this.saveTimeout)}if(!this.saveDelegate){this.saveDelegate=stl.app.save.bind(this,stl.app.ProcessTypeEnum.AUTOSAVE)}var r=(parseInt(ConfigData.commonSettingsMap.DURATION_AUTO_SAVE.Value)*DURATION_MILISEC_MULTIPLIER)||AUTOSAVE_DURATION_MILISEC;this.saveTimeout=window.setTimeout(this.saveDelegate,r)}},toggleSaveTrigger:function(r){if(r){this.saveTriggerEnabled=true}else{this.saveTriggerEnabled=false;if(this.saveTimeout){clearTimeout(this.saveTimeout)}}},save:function(u,s){var t=this,r=this.project;if(r){this.saveProjectToServer(u,s)}},showChecklistPopup:function(t,u,v){var s=t.map(function(w){return{complete:w.complete,name:w.name,uid:w.uid,dummy:false,order:1}});if(!this.checklistPopupStore){this.checklistPopupStore=Ext.create("Ext.data.Store",{fields:["complete","name","uid"]})}this.checklistPopupStore.loadData(s);this.checklistPopupWindow=Ext.create("ProjectPlanning.view.checkList.Checklist",{title:u,store:this.checklistPopupStore});var r=Ext.getCmp("checklistGrid");if(this.readOnly){r.disable()}this.checklistPopupWindow.on("save",v);this.checklistPopupWindow.show();this.checklistPopupOpen=true},onChecklistSave:function(s,v,z,y,A){if(!this.readOnly){var C=this,B={},t=s.checklistItems,F=0;this.checklistPopupStore.each(function(J,H){var I=J.get("uid")||C.project.getNextUID("checklistItem");B[I]={uid:I,name:J.get("name"),complete:J.get("complete"),order:H}});var D={};for(var u=t.length-1;u>=0;u--){var G=t[u],w=B[G.uid];if(w){G.name=w.name;G.complete=w.complete;D[G.uid]=G}else{t.splice(u,1)}}Object.keys(B).forEach(function(H){if(!D[H]){t.push(B[H])}});var E=0;var x=true;t=t.map(function(I,H){F=1;if(!I.complete){x=false}else{E++}I.order=H;return I});if((F==1&x==true)){F=2}s.checklistStatus=F;if(s.taskType==="fullkit"){s.completedItems=E;this.updateFKStatus(s)}if(y){y.call(C)}var r=(this.tasksByUid[s.uid])?this.tasksByUid[s.uid].$el:this.milestoneElementsById[s.uid];if(r){this.refreshChecklistIcon(r,s)}$(document).trigger("taskchange",[this,v]);this.triggerSave()}},reloadTaskView:function(r){this.tasksByUid[r.uid].$el.find(".task-status select").select2("val",r.status);this.tasksByUid[r.uid].load(r)},updateFKStatus:function(u){var s=0;var r=u.status;if(u.checklistItems.length>0){s=Math.round((u.completedItems/u.checklistItems.length)*100)}var v={completedItems:u.completedItems,percentCompletion:s};stl.app.FKStatusUpdateBasedOnCheckListStatus(u,v);if(stl.app.updatePercentCompleteFKBasedOnChecklistItems==="1"){u.percentComplete=s;stl.app.FKStatusUpdateBasedOnPercentComplete(u)}if(r!=u.status){var w=this.tasksByUid[u.uid],t=w.$el;w.setTaskStatus(u.status,t)}},showChecklistPopupForSubtask:function(r){var t=r.closest(".task").data("model").subtasks[r.index()],s=CHECKLIST_TITLE_SUBTASK+t.name;if(!t.checklistItems){t.checklistItems=[]}this.showChecklistPopup(t.checklistItems,s,this.onChecklistSave.bind(this,t,r.closest(".task").data("model"),true,function(){r.find(".subtask-checklist-icon").removeClass("none incomplete complete").addClass(this.project.getChecklistStatus(t.checklistStatus));r.data("model").checklistStatus=t.checklistStatus}))},showChecklistPopupForFullKitTask:function(t){var r=t.data("model"),s=CHECKLIST_TITLE+r.name;if(!r.checklistItems){r.checklistItems=[]}this.showChecklistPopup(r.checklistItems,s,this.onChecklistSave.bind(this,r,r,true))},showChecklistPopupForTask:function(t){var r=t.data("model"),s=CHECKLIST_TITLE+r.name;if(!r.checklistItems){r.checklistItems=[]}this.showChecklistPopup(r.checklistItems,s,this.onChecklistSave.bind(this,r,r,true,function(){t.find(".task-checklist-icon").removeClass(" none incomplete complete").addClass(this.project.getChecklistStatus(r.checklistStatus));t.data("model").checklistStatus=r.checklistStatus}))},showChecklistPopupForMilestone:function(r){var s=CHECKLIST_TITLE+r.name;if(!r.checklistItems){r.checklistItems=[]}this.showChecklistPopup(r.checklistItems,s,this.onChecklistSave.bind(this,r,r,false))},hideChecklistPopup:function(){if(!this.checklistPopupWindow){return}this.checklistPopupWindow.close();this.checklistPopupOpen=false},addPopupMenuHandlers:function(s){if(!s){s=$("body")}var r=this;s.find(".tool-item").off("click").on("click",function(K){var af=$(K.target).closest(".tool-item"),D=af.closest(".tool-popup").data("phase-column"),aa=af.data("cmd"),ab=false;if(af.hasClass("disabled")){return}switch(aa){case"insert-phase-before":r.insertPhaseColumn(D.index());r.syncColumnWidths();break;case"insert-phase-after":r.insertPhaseColumn(D.index()+1);r.syncColumnWidths();break;case"insert-milestone-after":var A=r.insertPhaseColumn(D.index()+1,{type:"milestone",name:D.data("model").name});var L=r.$view.find(".matrix-view-row:first"),S=L.find(".phase-column:nth-child("+(D.index()+2)+")"),t=A.uid;r.syncColumnWidths();break;case"delete-phase":var R=r.project.phases,P=D.index(),ae=R[P].name,N=R[P],B=D.parent().children().eq(P+1),u=r.$view.find(".matrix-view-row:not(.header-row) .phase-column:nth-child("+(P+1)+") .task").length;var J=DEFAULT_PHASE_NAME.toLowerCase();if(N.type==="milestone"){J="milestone phase for "}var V="Are you sure you want to remove the "+J+' "'+ae+(u>0?('" with '+u+" task"+(u===1?"":"s")+"?"):'?"');if(r.project.phases.length==1){V=V+". Since this is the last phase you are deleting, a dummy phase will be added to the network."}PPI_Notifier.confirm(V,DELETE_PHASE,function(){r.deletePhase(P);if(N.type=="fullkit"){r.bindPhaseColumn(B,R[P])}r.refreshLinks()},function(){});break;case"phase-level-task-properties":case"phase-level-task-properties":var R=r.project.phases,P=D.index(),t=R[P].id,O=r.$view;var W=_.toArray(O.find(".task.has-phase-"+stringToHex(t)));var ad=".milestone.has-phase-"+stringToHex(t);var T=_.toArray(O.find(ad));var U=W.concat(T);var y=new Object();y.remainingDuration="NOT_SAME";y.status="NOT_SAME";y.manager="NOT_SAME";y.participants="NOT_SAME";y.taskType="NOT_SAME";y.resources="NOT_SAME";var Y=new Object();for(var Z=0;Z<U.length;Z++){var E=$(U[Z]).data("model");if(Z==0){Y.remainingDuration=E.remainingDuration;Y.status=E.status;Y.manager=E.manager;Y.participants=E.participants;Y.taskType=E.taskType;Y.resources=E.resources}if(Y.remainingDuration=="NOT_SAME"&&Y.status=="NOT_SAME"&&Y.manager=="NOT_SAME"&&Y.participants=="NOT_SAME"&&Y.taskType=="NOT_SAME"&&Y.resources=="NOT_SAME"){break}if(Y.remainingDuration!=E.remainingDuration){Y.remainingDuration="NOT_SAME"}if(Y.status!=E.status){Y.status="NOT_SAME"}if(Y.manager!=E.manager){Y.manager="NOT_SAME"}if(Y.taskType!=E.taskType){Y.taskType="NOT_SAME"}if(Y.participants!=E.participants){Y.participants="NOT_SAME"}if(!CompareArrayOfObjects(Y.resources,E.resources)){Y.resources="NOT_SAME"}}y=Y;var x=Ext.create("Ext.data.Store",{id:"ManagerStore",fields:["Name","FullName"],data:stl.app.availablePeopleAndTeams});Ext.create("ProjectPlanning.view.TaskProperties",{PhaseId:t,Managerstore:x,PropertiesObject:y,Project:r.project}).show();break;case"insert-fullkit-before":var R=r.project.phases,P=D.index(),M=R[P];var A=r.insertPhaseColumn(P,{name:D.data("model").name,type:"fullkit",fullkitForPhaseId:R[P].id});M.hasFullkit=true;r.bindPhaseColumn(D,M);r.syncColumnWidths();break;case"delete-task":break;case"delete-row":var Q=$(K.target).closest(".tree-column");V=REMOVE_ROW_CONFIRM_MESSAGE,X=false,isScope=Q.hasClass("has-scopename"),isBlankScopeRow=Q.hasClass("blank-scope-name"),scopeName=Q.find(".scope-item-label").text(),isScopeDeletable=r.checkIfScopeDeletableFromModel(Q,scopeName);if(isScope){V=getStringWithArgs(REMOVE_SCOPE_CONFIRM_MESSAGE,scopeName);PPI_Notifier.confirm(V,DELETE_SCOPE,function(){Q.nextUntil(".has-scopename").andSelf().not(".row-placeholder").each(function(ag,ah){var ai=$(ah).data("row-body");if(ai.hasClass("has-PE")){X=true}r.callDeleteRow(ai)});if(isScopeDeletable&!X){r.project.deleteScopeItemByName(scopeName);r.project.createPhaseScopeAndTaskCountMap()}},null)}else{var v=Q.data("row-body"),X=v.hasClass("has-PE");PPI_Notifier.confirm(V,DELETE_ROW,function(){r.callDeleteRow(v)},null);if(isBlankScopeRow&&isScopeDeletable&&!X){r.project.deleteScopeItemByName(scopeName);r.project.createPhaseScopeAndTaskCountMap()}}r.syncColumnWidths();break;case"insert-row-above":var H=$(K.target).closest(".tree-column").index();var I=$(K.target).closest(".tree-column").prevAll(".has-scopename").first();r.insertBlankRowAtPosition(H,I);break;case"insert-row-below":var H=$(K.target).closest(".tree-column").index()+1;var I=$(K.target).closest(".tree-column").hasClass("has-scopename")?$(K.target).closest(".tree-column"):$(K.target).closest(".tree-column").prevAll(".has-scopename").first();r.insertBlankRowAtPosition(H,I);break;case"toggle-all-resource-highlight":HighlightAllResources(af);ab=true;break;case"toggle-resource-highlight":$("div[data-cmd='toggle-all-resource-highlight']").find("input").removeAttr("checked");HighlightResources(af);ab=true;break;case"toggle-all-phase-highlight":HighlightAllPhases(af);ab=true;break;case"toggle-phase-highlight":$("div[data-cmd='toggle-all-phase-highlight']").find("input").removeAttr("checked");HighlightPhases(af);ab=true;break;case"toggle-all-task-manager-highlight":HighlightAllTaskManagers(af);ab=true;break;case"toggle-task-manager-highlight":$("div[data-cmd='toggle-all-task-manager-highlight']").find("input").removeAttr("checked");HighlightTaskManagers(af);ab=true;break;case"toggle-all-chains-highlight":stl.app.HighlightAllProjectChains(af);ab=true;break;case"toggle-chain-highlight":$("div[data-cmd='toggle-all-chains-highlight']").find("input").removeAttr("checked");stl.app.HighlightProjectChain(af);ab=true;break;case"highlight-immediate-predecessors":clearAllHighlight();var z=$(K.target).closest(".tool-popup").data("ms");highlightImmediatePredecessors(z.uid);$(".page-header .highlight").find(".button-text").text(HIGHLIGHT+IMMEDIATE_PREDECESSORS);break;case"highlight-all-predecessors":clearAllHighlight();var z=$(K.target).closest(".tool-popup").data("ms");highlightAllPredecessors(z.uid);$(".page-header .highlight").find(".button-text").text(HIGHLIGHT+ALL_PREDECESSORS);break;case"highlight-successors":break;case"highlight-constraining-successors":clearAllHighlight();var z=$(K.target).closest(".tool-popup").data("ms"),w=r.milestoneElementsById[z.uid];r.highlightConstrainingTasks(w);$(".page-header .highlight").find(".button-text").text(HIGHLIGHT+SHOW_CONSTRANING_SUCCESSOR_CHAIN);$(document).trigger("highlightchange");break;case"highlight-longest-predecessor-chain":clearAllHighlight();var z=$(K.target).closest(".tool-popup").data("ms");highlightLongestPredecessorChainByUid(z.uid);break;case"delete-fullkitTask":r.onDeleteFullkitTaskClick(K);break;case"edit-fullkit-checklist":r.showChecklistPopupForFullKitTask($(K.target).closest(".task"));break;case"highlight-immediate-predecessors-for-fullkit":clearAllHighlight();var F=$(K.target).closest(".task").data("model").uid;var ac=r.tasksByUid[$(K.target).closest(".task").data("model").uid].$el;r.linksView.highlightImmediatePredecessors(F);$(".page-header .highlight").find(".button-text").text(HIGHLIGHT+IMMEDIATE_PREDECESSORS);break;case"highlight-all-predecessors-for-fullkit":clearAllHighlight();var F=$(K.target).closest(".task").data("model").uid;var ac=r.tasksByUid[$(K.target).closest(".task").data("model").uid].$el;r.linksView.highlightAllPredecessors(F);$(".page-header .highlight").find(".button-text").text(HIGHLIGHT+ALL_PREDECESSORS);break;case"highlight-longest-predecessor-chain-for-fullkit":clearAllHighlight();var C=$(K.target).closest(".task");var G=[];G=r.highlightLongestPredecessorChain(C);if(G.length>0){r.highlightChain(G,false,"constrainingSuccessorTask");$(".page-header .highlight").find(".button-text").text(HIGHLIGHT+SHOW_LONGEST_PREDECESSOR_CHAIN)}break}if(ab){K.stopPropagation()}else{af.closest(".tool-popup").fadeOut(250)}})},scrollToSelected:function(r){this.$viewport.animate({scrollTop:r})},indentRow:function(u,y){var s=this.$viewport.scrollTop();var x=[];var v=this;var t=y.sort(function(A,z){return A.get("data").outlineLevel-z.get("data").outlineLevel});_.each(t,function(A,z){if($.inArray(A.get("data").uid,x)==-1){v.changeScopeData(u,A,INDENT_ROW,x)}});this.saveProject();this.createExtJSTree();var w=this.project.rows;var r=Ext.getCmp("scopeItemTree").getRootNode();_.each(t,function(B,z){var A=v.findChildRecursively(r,"rowUid",B.get("data").uid);v.convertRowToScope(A,INDENT_ROW)});_.each(w,function(B,A){var z=v.findChildRecursively(r,"rowUid",B.uid);if(z.get("text").trim()==""){v.changeScopeItemUid(z)}});this.selectNodes(t);this.scrollToSelected(s);$(document).trigger("rowIndentationChanged",[this,w])},outdentRow:function(v,y){var s=this.$viewport.scrollTop();var u=[];var w=this;var t=y.sort(function(A,z){return A.get("data").outlineLevel-z.get("data").outlineLevel});_.each(t,function(A,z){if($.inArray(A.get("data").uid,u)==-1){w.changeScopeData(v,A,OUTDENT_ROW,u)}});this.saveProject();this.createExtJSTree();var x=this.project.rows;var r=Ext.getCmp("scopeItemTree").getRootNode();_.each(t,function(B,z){var A=w.findChildRecursively(r,"rowUid",B.get("data").uid);w.convertRowToScope(A,OUTDENT_ROW)});_.each(x,function(B,A){var z=w.findChildRecursively(r,"rowUid",B.uid);if(z.get("text").trim()==""){w.changeScopeItemUid(z)}});this.selectNodes(t);this.scrollToSelected(s);$(document).trigger("rowIndentationChanged",[this,x])},selectNodes:function(u){var s=this;var r=Ext.getCmp("scopeItemTree");var t=r.getRootNode();_.each(u,function(x,w){var v=s.findChildRecursively(t,"rowUid",x.get("data").uid);r.getSelectionModel().select(v,true)})},convertRowToScope:function(t,r){var s=t.parentNode;var u=t.childNodes.length>0?true:false;if(r==1&&t.parentNode.get("text").trim()==""){this.changeRowToScope(t.parentNode)}else{if(r==2&&u&&t.get("text").trim()==""){this.changeRowToScope(t)}}},changeScopeData:function(t,w,u,r){var v=this;var x=w.get("data").$el,s=w.get("data"),y=x.data("model");this.changeOutlineLevel(w,u,r)},changeScopeItemUid:function(t){var u=t.get("data").$el,r=t.get("data"),v=u.data("model");var s=this.getIndexOfItem(t.get("data").uid);r.scopeItemUid=this.getScopeItemUidForRow(t.get("data").outlineLevel,s);v.scopeItemUid=r.scopeItemUid;u.attr("scopeitemuid",v.scopeItemUid);u.data("model",v);this.saveRow(u)},getIndexOfItem:function(r){var s=this.project.rows;for(i=0;i<s.length;i++){if(s[i].uid==r){return i;break}}},getScopeItemUidForRow:function(s,v){var u=this.project.rows;var r=Ext.getCmp("scopeItemTree").getRootNode();for(i=v;i>=0;i--){if(s==1){if(u[i].name.trim()==""){return"1"}else{return u[i].scopeItemUid}}else{if(u[i].outlineLevel==s-1){var t=this.findChildRecursively(r,"rowUid",u[i].uid);return t.get("data").scopeItemUid;break}}}},changeOutlineLevel:function(v,u,r){var w=v.get("data").$el,t=v.get("data"),x=w.data("model");var s=v.childNodes.length==0?false:true;switch(u){case INDENT_ROW:this.indentNode(v,r);break;case OUTDENT_ROW:this.outdentNode(v,r);break}},getParentForRow:function(s,v){var u=this.project.rows;var r=Ext.getCmp("scopeItemTree").getRootNode();for(i=v;i>=0;i--){if(s==1){return r}else{if(u[i].outlineLevel==s-1){var t=this.findChildRecursively(r,"rowUid",u[i].uid);return t;break}}}},updateExpandedStateOfParentNode:function(s){var r=this.getParentForRow(s.outlineLevel,this.getIndexOfItem(s.uid));r.expand(false)},indentNode:function(u,r){var v=u.get("data").$el,t=u.get("data"),w=v.data("model");var s=u.childNodes.length==0?false:true;t.outlineLevel=t.outlineLevel+1;w.outlineLevel=t.outlineLevel;this.updateExpandedStateOfParentNode(w);r.push(t.uid);if(s){this.indentAllChildren(u,r)}},indentAllChildren:function(v,r){var t=this;var w=v.get("data").$el,s=v.get("data"),x=w.data("model");if(v.hasChildNodes()==false){s.outlineLevel=s.outlineLevel+1;x.outlineLevel=s.outlineLevel}else{if(v.hasChildNodes()){for(var u=0;u<v.childNodes.length;u++){t.indentNode(v.childNodes[u],r)}}}},outdentNode:function(u,r){var v=u.get("data").$el,t=u.get("data"),w=v.data("model");var s=u.childNodes.length==0?false:true;t.outlineLevel=t.outlineLevel-1;r.push(t.uid);w.outlineLevel=t.outlineLevel;if(s){this.outdentAllChildren(u,r)}},outdentAllChildren:function(v,r){var t=this;var w=v.get("data").$el,s=v.get("data"),x=w.data("model");if(v.hasChildNodes()==false){s.outlineLevel=s.outlineLevel-1;x.outlineLevel=s.outlineLevel}else{if(v.hasChildNodes()){for(var u=0;u<v.childNodes.length;u++){t.outdentNode(v.childNodes[u],r)}}}},deleteScope:function(u){var t=REMOVE_ROW_CONFIRM_MESSAGE,s=false,r=u[0].get("text");pertView=this;if(u.length==1){t=getStringWithArgs(REMOVE_SCOPE_CONFIRM_MESSAGE,r)}else{t=REMOVE_SCOPES_CONFIRM_MESSAGE}PPI_Notifier.confirm(t,DELETE_SCOPE,function(){_.each(u,function(C,z){var y=C.get("data").scopeItemUid;var x=C.get("text");var A=C.get("text").trim()==""?true:false;var B=pertView.isRowWithSameScopePresent(y,C.get("data").uid);var D=pertView.checkIfScopeDeletableFromModel(y);pertView.deleteNodeFromScopeItemTree(C);if(!A&&D&&!B&&!s){pertView.project.deleteScopeItemByUid(y);pertView.project.createPhaseScopeAndTaskCountMap()}if(!pertView.project.isProjectComplex()){if(!A){pertView.addNameToNextRowOfSameScope(y,x)}}});var v=Ext.getCmp("scopeItemTree");if(v.getRootNode().childNodes.length==0){var w=true;pertView.insertBlankRowAtPosition(1,v.getRootNode(),ADD_CHILD,w)}pertView.syncColumnWidths()},null)},addNameToNextRowOfSameScope:function(t,s){var v=_.find(this.project.rows,function(w){return w.scopeItemUid==t});if(v){v.name=s;var r=Ext.getCmp("scopeItemTree").getRootNode();var u=this.findChildRecursively(r,"rowUid",v.uid);u.set("text",s)}},deleteNodeFromScopeItemTree:function(s){var s=s;var r=s.parentNode;this.deleteRowItem(s);s.remove();this.updateParentAsLeafNode(r)},updateParentAsLeafNode:function(r){if(r&&r.childNodes.length==0){r.set("leaf",true)}},deleteRowItem:function(s){var r=this;this.callDeleteRow(s);if(s.hasChildNodes()){r.deleteAllChildRowItems(s)}},deleteAllChildRowItems:function(s){var r=this;if(s.hasChildNodes()){_.each(s.childNodes,function(u,t){if(typeof(u)!="undefined"){r.deleteRowItem(u)}})}},addNodeToScopeItemTree:function(v,x,u,y){var v;var t;var w;var s=false;if(v!=Ext.getCmp("scopeItemTree").getRootNode()){v=v;t=v.parentNode.indexOf(v);w=v.parentNode}else{s=true}var z={};z.uid=x.uid;z.name=x.name;z.outlineLevel=x.outlineLevel;z.$el=u;z.scopeItemUid=x.scopeItemUid;z.order=x.order;z.tasks=x.tasks;var r={};r.expanded=true;r.leaf=true;r.data=z;r.rowUid=x.uid;r.text=x.name;r.children=[];switch(y){case INSERT_ROW_ABOVE:w.insertChild(t,r);break;case INSERT_ROW_BELOW:w.insertChild(t+1,r);break;case ADD_CHILD:v.appendChild(r);if(!s){v.expand(false)}break}},changeRowToScope:function(t){var s=DEFAULT_SCOPE_NAME;t.set("text",s);var r=true;var u={};u.originalValue="";u.value=s;this.onScopeItemChange(u,t,u.originalValue,u.value,r)},getLastAvailableChildren:function(s){var r=this;if(s.hasChildNodes()==false){return s}else{if(s.hasChildNodes()){return r.getLastAvailableChildren(s.childNodes[s.childNodes.length-1])}}},insertBlankRowAtPosition:function(u,H,G,C){var J=this;var r=this.$viewport.scrollTop();var E=null;var H=H;var I=false;var v=H.get("text").trim()===""?true:false;var t=H.childNodes.length==0?false:true;var x=H.get("data").$el;if(!x){x=this.$view.find(".matrix-view-inner .matrix-view-row").first()}var D;var A;if(H.childNodes.length>0){D=this.getLastAvailableChildren(H.childNodes[H.childNodes.length-1]).get("data").$el}else{D=x}A=this.getLastAvailableChildren(H).get("data").$el;var y;if(G==ADD_CHILD&&!C){y="";if(v&&!t){this.changeRowToScope(H);I=true}E=H.get("data").scopeItemUid}else{if(!J.project.isProjectComplex()){y="";if(G==INSERT_ROW_ABOVE){E=this.getScopeUidOfSeletedNodeForSimpleProject(H,true);if(typeof(E)=="undefined"){y=DEFAULT_SCOPE_NAME}}else{if(C){E=null;y=DEFAULT_SCOPE_NAME}else{E=H.get("data").scopeItemUid}}}else{y=DEFAULT_SCOPE_NAME}}var B=this.project.createRow(E,y,u),w=this.generateRow(B,this.project.phases),F=this.$view[0];this.addNodeToScopeItemTree(H,B,w,G);switch(G){case INSERT_ROW_ABOVE:$(x).before(w);break;case INSERT_ROW_BELOW:$(A).after(w);break;case ADD_CHILD:if(C){var s=this.$view.find(".matrix-view-inner .matrix-view-row.row-placeholder");$(s).before(w)}else{$(D).after(w)}break}this.moveNewRowFirstCellIntoFixedColumn(w);this.saveRow(w);this.saveProject();if(J.project.isProjectComplex()){if(G!=ADD_CHILD){B=J.addSummaryTaskToRow(B,B.scopeItem,w,H)}}this.createExtJSTree();if(!C){var z=[H];this.selectNodes(z)}this.scrollToSelected(r);$(document).trigger("rowadd",[this,B,this.project.phases,G,H,null]);this.refreshLinks();this.syncRowHeights()},getDefaultScopeName:function(r,t,w,v){var s=v;if(t==1||t==2){if(r==1){w="WBS "+Number(s.parentNode.childNodes.length+1)}else{var u=w.trim().substring(0,w.trim().length-1);w=u+Number(s.parentNode.childNodes.length+1)}}else{if(t==3){w=w+"."+Number(s.childNodes.length+1)}}return w},onTaskViewDelete:function(r){this.deleteTask(r.target.$el);this.removeOverlayModeCssChanges();r.stopPropagation();this.syncRowHeights()},addOverlayModeCssChanges:function(){this.$viewport.css("overflow","hidden");this.$viewport.find(".matrix-view-inner").css({"padding-right":"1000px","padding-bottom":"1000px"});this.$leftColContainer.css("padding-bottom","1000px");this.$headerContainer.css("padding-right","1000px");$(".mask-view").show()},removeOverlayModeCssChanges:function(){$(".mask-view").hide();this.$viewport.find(".matrix-view-inner").css({"padding-right":"0","padding-bottom":"0"});this.$leftColContainer.css("padding-bottom","0");this.$headerContainer.css("padding-right","0");this.$viewport.css("overflow","auto")},onDeleteFullkitTaskClick:function(r){this.deleteTask($(r.target).closest(".task"),false)},onTaskViewSubtaskDelete:function(r,t,s){$(document).trigger("subtaskremove",[this,t,s]);r.stopPropagation()},deleteTask:function(v,t){var u=v.closest(".phase-column"),r=u.closest(".matrix-view-row"),s=this.project.phases[r.find(".phase-column").index(u)].uid;if(t){u.removeClass("has-task")}rowId=r.data("model").uid,task=v.data("model"),$allTasksInCell=u.find(".task"),taskCount=$allTasksInCell.length,taskIndex=$allTasksInCell.index(v);$(document).trigger("taskremove",[this,task,rowId,s]);delete this.project._tasksAndMilestonesByUid[task.uid];this.selectedTask=null;$(document).trigger("taskselectionchange",[this.selectedTask]);this.syncColumnWidths();this.syncRowHeights();this.refreshLinks();if((task.bufferType==="CCCB")||(task.bufferType==="CMSB")||(task.bufferType==="CCFB")){this.project.isIDCCed=false}},removeLinksForTask:function(v){var r=this.project.links,u=this.tasksByUid[v].$el;for(var s=r.length-1;s>=0;s--){var t=r[s];if(t.from===v||t.to===v){this.project.removeLink(t.from,t.to)}}this.triggerSave()},removeLinksForMS:function(s){var r=this.project.links,v=this.milestoneElementsById[s].$el;for(var t=r.length-1;t>=0;t--){var u=r[t];if(u.from===s||u.to===s){this.project.removeLink(u.from,u.to)}}this.triggerSave()},removeAutoAndInvalidLinksForTask:function(x){var r=this.project.links,w=this.tasksByUid[x].$el;for(var s=r.length-1;s>=0;s--){var u=r[s];if(u.from===x||u.to===x){var t=(u.from===x?w:this.getTaskOrMilestoneLinkTargetElementByUid(u.from)),v=(u.to===x?w:this.getTaskOrMilestoneLinkTargetElementByUid(u.to));if(u.auto||!this.isLinkAllowed(t,v)){this.project.removeLink(u.from,u.to)}}}this.triggerSave()},removeForwardLinksForTask:function(w){var r=this.project.links,t=(this.tasksByUid[w])?this.tasksByUid[w].$el:this.milestoneElementsById[w];for(var s=r.length-1;s>=0;s--){var u=r[s];if(u.from===w){var v=this.getTaskOrMilestoneLinkTargetElementByUid(u.to);this.project.removeLink(u.from,u.to)}}},removeBufferTaskLinks:function(v){var s=this.project.links,x=this.getTaskOrMilestoneLinkTargetElementByUid(v),r,t;for(var u=s.length-1;u>=0;u--){var w=s[u];if(w.from===v||w.to===v){if(w.to===v){r=this.getTaskOrMilestoneLinkTargetElementByUid(w.from)}if(w.from===v){t=this.getTaskOrMilestoneLinkTargetElementByUid(w.to)}if(r&&t){this.addAutoLink(r,t);r=null;t=null}}}this.refreshLinks()},onAcceptPlan:function(r,t,s){var u=this;$.each(s,function(v,x){var w=u.milestoneElementsById[x.uid];w.data("view").load(x)})},addPhaseHeaderMenuListeners:function(r){r.find(".dropdown-menu-caret").on("click",this.onPhaseHeaderMenuButtonClick.bind(this))},onPhaseHeaderMenuButtonClick:function(r){var w=$(r.target).closest(".phase-column-header"),v=w.find(".dropdown-menu-caret"),u=v.offset(),s=w.find(".tool-popup").clone(true),t=s.is(":visible");$(document.body).find(".phase-header-popup-menu-active").remove();$(".tool-popup").hide();s.css({position:"absolute",right:"auto"}).data("phase-column",w);s=this.getToolPopUpMenuForNormalPhase(w,s);$(document.body).append(s);if(!t){s.show().offset({top:u.top+v.height(),left:u.left+v.width()-s.width()}).addClass("phase-header-popup-menu-active");r.stopPropagation()}},getToolPopUpMenuForNormalPhase:function(v,t){if(v.hasClass("phase-type-normal")){var u=$(".phase-column-header").index(v),s=$($(".phase-column-header")[u+1]),r=$($(".phase-column-header")[u-1]);isNextPhaseHeaderLastDummyHeader=s.is($(".phase-column-header").last());if(s&&s.hasClass("phase-type-milestone")){t.find(".tool-item-insert-milestone-after").addClass("disabled")}if(r&&r.hasClass("phase-type-fullkit")){t.find(".tool-item-insert-fullkit-before").addClass("disabled")}t.find(".tool-item-delete-phase").addClass("disabled");if((isNextPhaseHeaderLastDummyHeader)||(s&&s.hasClass("phase-type-normal"))||(r&&r.hasClass("phase-type-normal"))||((r&&r.hasClass("phase-type-milestone"))&&(s&&s.hasClass("phase-type-fullkit")))){t.find(".tool-item-delete-phase").removeClass("disabled")}}return t},onHighlightCCTasks:function(){var t=this;var u=this.tasksByUid;var s=this.milestoneElementsById;$.each(u,function(v,w){if(w.$el&&w.$el.hasClass("isCCTask")){w.$el.addClass("highlightedCCTask")}});$.each(s,function(v,w){if(w.data("model")){if(w.data("model").isCritical==true){$(w).addClass("highlightedCCTask")}}});var r=this.linksView.linksByID;$.each(r,function(x,y){var v=y.to;var w=y.from;var z=false;z=t.linksView.isLinkInCriticalChain(v,w);if(z){this.linksView.setLinkColor(w,v,"red");this.linksView.setLinkZIndex(w,v,100)}}.bind(this))},onHighlightPenChain:function(){if(!stl.app.milestoneUIDForChainToBeHighlighted){stl.app.HighlightProjectPenChain(this.project)}else{var r=this.project.getPenChainID(stl.app.milestoneUIDForChainToBeHighlighted);stl.app.HighlightPenChain(r)}},onHighlightResourceContention:function(){var u=$(".matrix-view").data("view");var t=u.tasksByUid;var r=CCSummaryStore.ResourceContentionData;for(index=0;index<r.length;index++){var s=t[r[index].StartActivityUID];var v=t[r[index].EndActivityUID];s.$el.addClass("resourceContentionTask");v.$el.addClass("resourceContentionTask")}$(".highlight").find(".button-text").text("Highlight: "+RESOURCE_CONTENTION);setResourceGridRowClass(Ext.getCmp("resGrid").resourceContentionInGrid)},onHighlightSlack:function(){var w=$(".matrix-view").data("view");var v=w.tasksByUid;var u=w.milestoneElementsById;var r=CCSummaryStore.SlackData;for(index=0;index<r.length;index++){var t=v[r[index].FromActivityUID];if(t&&t.$el){t.$el.addClass("slack")}else{var y=u[r[index].FromActivityUID];if(y){$(y).addClass("slack")}}var x=v[r[index].ToActivityUID];if(x&&x.$el){x.$el.addClass("slack")}else{var s=u[r[index].ToActivityUID];if(s){$(s).addClass("slack")}}}$(".highlight").find(".button-text").text("Highlight: "+SLACK)},onAllHighlightsCleared:function(){if(this.linksView){this.linksView.setAllLinkProperties(null,null)}},getResourceHighlightMenu:function(r){var s=r.$highlightResourcesMenu;if(!s){$(document.body).children(".highlight-resources-popup").remove();s=r.$highlightResourcesMenu=$(".highlight-resources").find(".tool-popup").clone(true);$(document.body).append(s)}if(!r.resourceHighlightMenuIsCurrent){r.updateResourceHighlightMenu(s,r)}return s},getPhaseHighlightMenu:function(r){var s=r.$highlightPhasesMenu;if(!s){$(document.body).children(".highlight-phases-popup").remove();s=r.$highlightPhasesMenu=$(".highlight-phases").find(".tool-popup").clone(true);$(document.body).append(s)}if(!r.phaseHighlightMenuIsCurrent){r.updatePhaseHighlightMenu(s,r)}return s},getTaskManagerHighlightMenu:function(r){var s=r.$highlightTaskManagersMenu;if(!s){$(document.body).children(".highlight-task-managers-popup").remove();s=r.$highlightTaskManagersMenu=$(".highlight-task-managers").find(".tool-popup").clone(true);$(document.body).append(s)}if(!r.taskManagerHighlightMenuIsCurrent){r.updateTaskManagerHighlightMenu(s,r)}return s},highlightConstrainingTasks:function(r){var s=this;if($(r).closest(this.$view).length===0){return}var t=r.data("model");constrainingTaskIds=this.project.getConstrainingTasks(t.uid);if(constrainingTaskIds.length>0){s.highlightChain(constrainingTaskIds,true,"constrainingSuccessorTask")}},highlightLongestPredecessorChainOnViewChange:function(t,v){var u=this;var s=$(".matrix-view").data("view");var r=s.highlightLongestPredecessorChain(v);if(r.length>0){u.highlightLongestPredecessorChainTasks(r)}},onhighlightLongestPredecessorChain:function(t,s){if($(s).closest(this.$view).length===0){return}var u=this;var r=[];r=u.highlightLongestPredecessorChain(s);if(r.length>0){u.highlightChain(r,false,"constrainingSuccessorTask")}},getTaskElementByUid:function(s){var r=this.tasksByUid[s];if(r){return r.$el}return null},getMilestoneElementByUid:function(s){var r=this.milestoneElementsById[s];if(r){return r}return null},highlightPenChain:function(s){var r=this.project.getPenChainID(s);if(r&&r!=-1){stl.app.HighlightPenChain(r)}},highlightLongestPredecessorChain:function(t){if($(t).closest(this.$view).length===0){return}var x=this;var z=$(t).data("model");var v={};var r={};var u=this.tasksByUid;var y=this.milestoneElementsById;x.AllTasksInProject=[];$.each(u,function(A,B){x.AllTasksInProject.push(B.task)});$.each(y,function(A,B){x.AllTasksInProject.push($(B).data("model"))});$.each(x.AllTasksInProject,function(A,C){var B={};if(C.uid!=undefined){r[C.uid]=B}});$.each(x.AllTasksInProject,function(A,B){x.S2M_AddTaskAsPredecessor(B,r)});var s=z;x.ParentCounterMap={};var w=z.text9;x.S2M_MarkNumberOfParents(s,x.ParentCounterMap,w,r);x.MaxPathLeaves=[];x.MaximumWeights={};x.tasksToBeHighlighted=[];x.S2M_MarkMaximumWeights(s,x.ParentCounterMap,x.MaxPathLeaves,x.MaximumWeights,w,r);x.S2M_FlagLongestFeedingPaths(x.MaxPathLeaves,x.ParentCounterMap,x.MaximumWeights);return x.tasksToBeHighlighted},highlightChain:function(t,v,u){var s=this.tasksByUid;var r=this.milestoneElementsById;if(!v){$.each(t,function(y,x){var z=s[x.uid];if(z&&z.$el){z.$el.addClass(u)}var w=r[x.uid];if(w){$(w).addClass(u)}})}else{$.each(t,function(x,y){var z=s[y];if(z&&z.$el){z.$el.addClass(u)}var w=r[y];if(w){$(w).addClass(u)}})}},S2M_AddTaskAsPredecessor:function(r,s){var u=this;var v;if(r._successors){$.each(r._successors,function(w,x){u.S2M_AddToPredecessorCollection(r,x,s)})}var t=r.text7;if(t&&t>0){this.S2M_AddToPredecessorCollection_ErrCheckText7(r,u.AllTasksInProject,t,s)}t=r.text5;if(t&&t>0&&t!=r.uid){this.S2M_AddToPredecessorCollection_ErrCheckText5(r,u.AllTasksInProject,t,s)}},S2M_MarkNumberOfParents:function(w,r,s,u){var v=this;var t={};v.ParentCounterMap[w.uid]=0;this.S2M_MarkNumberOfParentsRecursive(w,v.ParentCounterMap,t,s,u)},S2M_MarkMaximumWeights:function(B,w,A,x,v,r){var y=this;var t=[];var C,z;var s={};y.MaximumWeights[B.uid]=0;s[B.uid]=0;t.push(B);while(t.length>0){C=t[0];t.splice(0,1);var u={};u=r[C.uid];$.each(u,function(E,D){y.S2M_ComputeWeight(D,C,y.MaximumWeights);y.S2M_IncrementCounter(D,s);var F=y.S2M_AreAllParentsWeighted(D,s,y.ParentCounterMap);if(F){t.push(D)}});y.S2M_UpdateMaxPathLeaves(C,y.MaximumWeights,y.MaxPathLeaves)}},S2M_ComputeWeight:function(r,w,s){var x=this;var v=0;var u=0;var t=0;var y;t=x.GetRemDuration(r);v=s[w.uid];u=s[r.uid];if(u){if((v+parseInt(t))>u){delete s[r.uid];s[r.uid]=v+parseInt(t)}}else{s[r.uid]=v+parseInt(t)}},S2M_UpdateMaxPathLeaves:function(w,r,t){var u=this;var s=0;var v=0;if(u.MaxPathLeaves.length>0){s=u.MaximumWeights[u.MaxPathLeaves[0].uid]}if(t.length>0&&u.MaximumWeights[u.MaxPathLeaves[0].uid]!=undefined){v=u.MaximumWeights[w.uid];if(v>s){u.MaxPathLeaves=[];u.MaxPathLeaves.push(w)}else{if(v==s){u.MaxPathLeaves.push(w)}}}else{u.MaxPathLeaves.push(w)}},S2M_AreAllParentsWeighted:function(r,v,s){var u=this;var t=false;if(v[r.uid]==u.ParentCounterMap[r.uid]){t=true}return t},S2M_FlagLongestFeedingPaths:function(u,s,r){var v=this;var t;var w=[];var x=false;$.each(v.MaxPathLeaves,function(z,y){if(y.percentComplete==100){x=true}else{x=false}v.S2M_FlagLongestFeedingPath(y,v.ParentCounterMap,v.MaximumWeights,w,x)})},S2M_FlagLongestFeedingPath:function(B,u,v,z,y){var x=this;var A;var w=0;var s=0;var t=0;if(z[B.uid]){return}if(!z[B.uid]){z[B.uid]=true;s=x.GetRemDuration(B);if(y==false){x.S2M_MarkTask(B)}w=x.MaximumWeights[B.uid]-s;$.each(B._successors,function(C,D){if(x.ParentCounterMap[D.uid]!=undefined){if(w==x.MaximumWeights[D.uid]){y=y&&(D.percentComplete==100);x.S2M_FlagLongestFeedingPath(D,x.ParentCounterMap,x.MaximumWeights,z,y)}}});t=B.text7;if(t>0){var r;$.each(x.AllTasksInProject,function(D,C){if(C.uid==t){r=C;return false}});A=r;if(A&&x.ParentCounterMap[A.uid]!=undefined){if(w==x.MaximumWeights[A.uid]){y=y&&(A.percentComplete==100);x.S2M_FlagLongestFeedingPath(A,x.ParentCounterMap,x.MaximumWeights,z,y)}}}t=B.text5;if(t>0){var r;$.each(x.AllTasksInProject,function(D,C){if(C.uid==t){r=C;return false}});A=r;if(A&&x.ParentCounterMap[A.uid]!=undefined){if(w==x.MaximumWeights[A.uid]){y=y&&(A.percentComplete==100);x.S2M_FlagLongestFeedingPath(A,x.ParentCounterMap,x.MaximumWeights,z,y)}}}}},S2M_AddToPredecessorCollection:function(r,s,t){var u=this;var v={};v=t[s.uid];if(v){if(!v[r.uid]){v[r.uid]=r}}else{v={};v[r.uid]=r;t[s.uid]=v}},S2M_AddToPredecessorCollection_ErrCheckText7:function(r,x,v,u){var w=this;try{var t;$.each(x,function(z,y){if(y.uid==v){t=y;return false}});w.S2M_AddToPredecessorCollection(r,t,u)}catch(s){}},S2M_AddToPredecessorCollection_ErrCheckText5:function(r,x,v,u){var w=this;try{var t;$.each(x,function(z,y){if(y.uid==v){t=y;return false}});w.S2M_AddToPredecessorCollection(r,t,u)}catch(s){}},S2M_MarkNumberOfParentsRecursive:function(x,s,w,t,v){var y=this;var u={};u=v[x.uid];if(w[x.uid]==undefined){var r;$.each(u,function(A,z){y.S2M_IncrementCounter(z,y.ParentCounterMap);y.S2M_MarkNumberOfParentsRecursive(z,y.ParentCounterMap,w,t,v)});w[x.uid]=1}},S2M_IncrementCounter:function(r,t){var s=0;s=t[r.uid];if(s!=undefined){delete t[r.uid];t[r.uid]=s+1}else{t[r.uid]=1}},S2M_MarkTask:function(r){var s=this;r.Flag17=true;r.Flag18=true;s.tasksToBeHighlighted.push(r)},GetRemDuration:function(s){var w=this;var B="FKCD";var x=0;var t=0;var r=0;var A=null;var y=[];var v=null;var u;var z=false;if(w.S2M_IsFullKitTask(s)){u=s.text22;if(u!=undefined){A=u.split(";");for(t=0;t<A.length;t++){v=A[t];v=v.trim();z=v.indexOf(B);if(z!=-1){y=v.split("=");if(y[0]==B){r=y[1];x=r}}}}}else{if(w.S2M_IsBuffer(s)){x=0}else{if(s.remainingDuration!=undefined){x=s.remainingDuration}}}return parseInt(x)},S2M_IsFullKitTask:function(r){var s=2;var t=false;if(r.text1==2){t=true}return t},S2M_IsBuffer:function(r){var t=false;var s=0;s=parseInt(r.text9);if(s==1||s==2||s==6){t=true}return t},getAvailableResourceOptions:function(){this.cachedAvailableResourceOptions=this.project.getAvailableResources().map(function(r){return{id:r.uid,text:r.Name}});this.cachedResourcesById=this.project.getAvailableResourcesByUid();return this.cachedAvailableResourceOptions},updateResourceHighlightMenu:function(t,r){var u=r.getAvailableResourceOptions(),s=1;t.empty();t.append($(['<div class="tool-item" data-cmd="toggle-all-resource-highlight">',"<label>",'<input type="checkbox" /> <span class="resource-name">All</span>',"</label>","</div>"].join("")));u.forEach(function(w){var v=$(['<div class="tool-item" data-cmd="toggle-resource-highlight">',"<label>",'<div class="resource-swatch resource-highlight-background-',String(s++),'"></div>','<input type="checkbox" /> <span class="resource-name"></span>',"</label>","</div>"].join(""));if(s==(MAX_NUMBER_OF_COLORS_USED_FOR_HIGHLIGHTING_RESOURCES+1)){s=1}v.find(".resource-name").text(w.text);v.data("resource-id",w.id);t.append(v)});r.addPopupMenuHandlers(t);r.resourceHighlightMenuIsCurrent=true},updatePhaseHighlightMenu:function(u,r){var s=r.project.phases,t=1;u.empty();u.append($(['<div class="tool-item" data-cmd="toggle-all-phase-highlight">',"<label>",'<input type="checkbox" /> <span class="phase-name">All</span>',"</label>","</div>"].join("")));s.forEach(function(v){if(v.type=="normal"){var w=$(['<div class="tool-item" data-cmd="toggle-phase-highlight">',"<label>",'<div class="phase-swatch phase-highlight-background-',String(t++),'"></div>','<input type="checkbox" /> <span class="phase-name"></span>',"</label>","</div>"].join(""));if(t==(MAX_NUMBER_OF_COLORS_USED_FOR_HIGHLIGHTING_PHASES+1)){t=1}w.find(".phase-name").text(v.name);w.data("phase-id",v.uid);u.append(w)}});r.addPopupMenuHandlers(u);r.phaseHighlightMenuIsCurrent=true},updatePhaseNameInHighlightMenu:function(r){var s=this.project.getPhaseColorMap();var t=s[r.uid];var u=$(".highlight-phases-popup .tool-item:eq("+(t-1)+")").find(".phase-name").text(r.name)},updateTaskManagerHighlightMenu:function(u,r){var t=stl.app.availablePeopleAndTeams,s=1;u.empty();u.append($(['<div class="tool-item" data-cmd="toggle-all-task-manager-highlight">',"<label>",'<input type="checkbox" /> <span class="task-manager-name">All</span>',"</label>","</div>"].join("")));t.forEach(function(w){var v=$(['<div class="tool-item" data-cmd="toggle-task-manager-highlight">',"<label>",'<div class="task-manager-swatch task-manager-highlight-background-',String(s++),'"></div>','<input type="checkbox" /> <span class="task-manager-name"></span>',"</label>","</div>"].join(""));if(s==(MAX_NUMBER_OF_COLORS_USED_FOR_HIGHLIGHTING_TASK_MANAGERS+1)){s=1}v.find(".task-manager-name").text(w.FullName);v.data("task-manager-id",w.Name);u.append(v)});r.addPopupMenuHandlers(u);r.taskManagerHighlightMenuIsCurrent=true},updateChainsHighlightMenu:function(t,r){var s=this.project.getAllChainIds().sort(function(w,v){return w-v});var u=stl.app.ProjectDataFromServer.getChainsColorMap();t.empty();t.append($(['<div class="tool-item" data-cmd="toggle-all-chains-highlight">',"<label>",'<input type="checkbox" /> <span class="chain-number">All</span>',"</label>","</div>"].join("")));s.forEach(function(w){var v=$(['<div class="tool-item" data-cmd="toggle-chain-highlight">',"<label>",'<div class="chain-swatch chain-highlight-background-',String(u[w]),'"></div>','<input type="checkbox" /> <span class="chain-number"></span>',"</label>","</div>"].join(""));v.find(".chain-number").text(w);v.data("chain-id",w);t.append(v)});r.addPopupMenuHandlers(t);r.chainsHighlightMenuIsCurrent=true},addRowHeaderMenuListeners:function(){$(".tree-column .dropdown-menu-caret").on("click",function(r){var u=$(r.target).closest(".tree-column"),s=u.find(".tool-popup"),t=s.is(":visible");$(".tool-popup").hide();if(!t){s.show();r.stopPropagation()}})},getTaskById:function(s){var r=this.tasksByUid[s];if(r){return r.task}return null},refreshChecklistIcon:function(s,r){s.find(".task-checklist-icon").removeClass("none incomplete complete").addClass(this.project.getChecklistStatus(r.checklistStatus));s.data("model").checklistStatus=r.checklistStatus},onTaskChange:function(r,u,t,s){var w;if(this.tasksByUid[t.uid]){w=this.tasksByUid[t.uid].$el}else{w=this.milestoneElementsById[t.uid]}var v=w.data("view");if(u===this){return}v.load(t,null,u);this.refreshChecklistIcon(w,t);if(s!=undefined){var x=w.find(".subtask").eq(s).remove();v.saveSubtasks(w)}this.refreshLinks();stl.app.triggerSave()},onTaskChangeAtPhaseLevel:function(r,s,u){var t=this;_.each(u,function(w,v){if(w.isSummary){return}if(t.tasksByUid[w.uid]){$task=t.tasksByUid[w.uid].$el}else{$task=t.milestoneElementsById[w.uid]}var x=$task.data("view");x.load(w,null,s)});stl.app.triggerSave()},onUpdateResourcesDeleted:function(r,s,u){var t=this;_.each(u,function(w,v){if(w.isSummary){return}if(t.tasksByUid[w.uid]){$task=t.tasksByUid[w.uid].$el}else{$task=t.milestoneElementsById[w.uid]}var x=$task.data("view");x.load(w,null,s)});stl.app.triggerSave()},onTaskAdd:function(z,t,s,A,y,B,C){this.resetPhaseLinksAllowedWithAddDeleteTask(y);if(t===this){return}var u=this.rowsById[B.uid];var v,w;if(this.tasksByUid[C]){v=this.tasksByUid[C].$el}else{v=this.milestoneElementsById[C]}if(v){w=$(v).closest(".phase-column")}else{w=$(u.find(".phase-column")[0])}if(v){var x=this.addEmptyTaskUI(y,w,v)}else{var x=this.addEmptyTaskUI(y,w)}var r=x.$el;x.load(s);this.tasksByUid[s.uid]=x;this.saveRow(u);this.linksView.addElements(r);this.generateAutoLinksForTask(r,y);r.hide().fadeIn();this.setZoomLevel(this.zoomLevel);this.refreshLinks();this.scrollIntoView(r)},onMilestoneAdd:function(z,t,s,A,y,B,C){if(t===this){return}var u=this.rowsById[B.uid];var v;if(this.tasksByUid[C]){v=this.tasksByUid[C].$el}else{v=this.milestoneElementsById[C]}var w=$(v).closest(".phase-column");var x=this.addEmptyMSUI(y,w,v),r=x.$el;x.load(s);this.renderMilestone(r,w,y);if(s.taskType===PE_SHORT){u.addClass("has-PE")}this.saveRow(u);this.generateAutoLinksForMilestone(r,y);this.setZoomLevel(this.zoomLevel);this.refreshLinks();this.scrollIntoView(r)},onExpandAllScopeNodes:function(){var r=Ext.getCmp("scopeItemTree");r.expandAll()},onExpandScopeNode:function(s,t,v){if(t===this){return}var r=Ext.getCmp("scopeItemTree").getRootNode();var u=this.findChildRecursively(r,"rowUid",v);if(u){if(!u.get("expanded")){u.expand(false)}}},onCollapseScopeNode:function(s,t,v){if(t===this){return}var r=Ext.getCmp("scopeItemTree").getRootNode();var u=this.findChildRecursively(r,"rowUid",v);if(u.childNodes.length>0&&u.get("expanded")){u.collapse(false)}},onTaskRemove:function(D,w,t,z,x,s){this.resetPhaseLinksAllowedWithAddDeleteTask($.grep(this.project.phases,function(F){return F.uid==x})[0]);var A=this;var C=-1,y=this.$view.find(".matrix-view-row").filter(function(F,G){var H=$(G).data("model");return H&&H.uid===z}).first();this.$view.find(".matrix-view-row.header-row .phase-column").each(function(G,F){var H=$(F).data("model");if(H&&H.uid===x){C=G;return}});var r=A.tasksByUid[t.uid].$el,B=r.closest(".phase-column"),E=B.find(".task, .milestone, .fk, .fullkit"),v=E.length,u=E.index(r);if(u>0&&u<v-1){this.addAutoLink(E.eq(u-1),E.eq(u+1))}if(B.find(".task , .milestone, .fk, .fullkit").length===1&&B.hasClass("has-task")){B.removeClass("has-task")}this.removeLinksForTask(t.uid);A.tasksByUid[t.uid].modifyTaskColor(x,v);delete A.tasksByUid[t.uid];this.linksView.removeElement(r);r.next(".task-spaceholder, .task-spaceholder-fk").remove();r.remove();A.saveRow(y);A.refreshLinks()},deletePhase:function(u){var t=this.project.phases,r=t[u],w=r.uid;for(var v=this.project._milestones.length-1;v>=0;v--){var s=this.project._milestones[v];if(s.phaseId===w){this.deleteMilestone(s.uid)}}var y=this.getSummaryTasksFromPhase(w);Object.keys(this.tasksByUid).forEach(function(z){var B=this.tasksByUid[z];if(B.task.phaseId===w){var A=B.$el;this.deleteTask(A)}}.bind(this));if(r.type==="fullkit"){if(t[u+1]){t[u+1].hasFullkit=false}}var x=t.splice(u,1);if(t.length!=0){this.$view.find(".matrix-view-row .phase-column:nth-child("+(u+1)+")").remove()}this.saveProject();this.moveSummaryTasksToDifferentPhase(y);this.project.createPhaseScopeAndTaskCountMap();$(document).trigger("phaseremove",[this,x,u])},onBackgroundClick:function(r){$(".tool-popup").hide();var s=[];if($(r.target).closest(".task").length!=0){s=$(r.target).closest(".task")}else{if($(r.target).closest(".ms").length!=0){s=$(r.target).closest(".ms")}else{if($(r.target).closest(".fk").length!=0){s=$(r.target).closest(".fk")}}}if(this.isAnyTaskOpenForEdit(s)){this.selectedTask.data("view").exitQuickEditMode()}if(this.checklistPopupOpen&&$(r.target).closest(".x-window").length===0){this.hideChecklistPopup()}},isAnyTaskOpenForEdit:function(s){var r=($(".datepicker").css("display")=="block");if(this.selectedTask&&(s.length===0||!s.is(this.selectedTask))&&!r){if(this.selectedTask.hasClass("quick-task-edit")){return true}}},onTaskEnterQuickEdit:function(r){var u=r.target;if(this.selectedTask&&this.selectedTask.hasClass("quick-task-edit")){this.selectedTask.data("view").exitQuickEditMode()}this.selectedTask=u.$el;var t;if(u.task.isMS){t=this.selectedTask.find(".ms-content-wrap").data("linkable-element-id")}else{t=this.selectedTask.data("linkable-element-id")}var s=this.linksView.endpointsByID[t+"-out"];if(s){s.hide()}$(document).trigger("taskselectionchange",[this.selectedTask])},onTaskExitQuickEdit:function(r){this.selectedTask=null;$(document).trigger("taskselectionchange",[null]);r.target.$el.find(".task-content-wrapper").width(a[this.zoomLevel]).scrollTop(0);if(this.zoomLevel===b.TASK_ZOOM_SMALL){r.target.$el.addClass("task-zoom-small")}},onMSExitQuickEdit:function(r){var s=r.target;s.$el.closest(".ms").find(".task-content-wrapper").hide();s.$el.closest(".milestone").find(".ms-icon").show();this.onTaskExitQuickEdit(r)},onMSEnterQuickEdit:function(r){var s=r.target;s.$el.closest(".ms").find(".task-content-wrapper").show();s.$el.closest(".milestone").find(".ms-icon").hide();this.onTaskEnterQuickEdit(r)},onMaskViewClick:function(r){this.$view.find(".task-zoom-normal .task-magnify-button").trigger("click");this.triggerSave()},onTaskAlignOptionClick:function(r){var s=$(r.target);if(s.hasClass("pressed")){return}$(".matrix-view-task-alignment .task-align-option").removeClass("pressed");s.addClass("pressed");this.$view.removeClass("task-align-left task-align-right");this.$view.addClass("task-align-"+s.data("alignment"));this.refreshLinks()},addPlaceholderRow:function(){if(this.readOnly){return}var t=this.$view.find(".matrix-view-end-marker").last(),v={id:"dummy",uid:"dummy",tasks:{}};var r=this.renderRow(v,this.project.phases,t,0),s=$('<input placeholder="New WBS item..." type="text" />'),u=this.$leftColContainer.find(".tree-column").eq(this.$view.find(".matrix-view-row").index(r));u.addClass("row-placeholder").append(s);r.addClass("row-placeholder");s.on("blur",this.onRowPlaceholderNameEdit.bind(this));s.on("keypress",function(x){if(x.which===13){x.preventDefault();var y=$(x.target),w=y.closest(".tree-column");y.blur();w.next().find("input").focus()}})},onRowPlaceholderNameEdit:function(r){var s=$(r.target).val();if(s!==""){this.convertRowPlaceholderToRow()}},convertRowPlaceholderToRow:function(u,s){var v=this.$view.find(".matrix-view-row.row-placeholder");var A=Ext.getCmp("scopeItemTree").getRootNode();var t=this.findChildRecursively(A,"rowUid",s);var x;var w=this.rowsById[s].data("model");if(!this.project.isProjectComplex()){x=t}else{if(!this.project.getSummaryTaskFromRow(w)){x=t}else{x=t.parentNode}}var y;if(x.get("data")){y=x.get("data").scopeItemUid}else{y=""}var r="",z=this.project.createRow(y,r,t.get("data").outlineLevel);z.name=r;this.addNodeToScopeItemTree(t,z,v,2);v.attr("scopeItemUid",y);v.attr("rowUid",z.uid);v.data("model",z);v.removeClass("row-placeholder");this.rowsById[z.uid]=v;this.saveRow(v);this.saveProject();this.addPlaceholderRow();$(document).trigger("rowadd",[this,z,this.project.phases,INSERT_ROW_BELOW,t,null]);this.syncRowHeights()},findChildRecursively:function(s,v,w){var u=s.childNodes;for(var t=0,r=u.length;t<r;t++){if(u[t].getData()[v]==w){return u[t]}else{if(found=this.findChildRecursively(u[t],v,w)){return found}}}return null},init:function(u,r,v,x){console.log("Method called matrix view - init");var t=this;t.$matrixRowTemplate=$("#templates div[role=row-template]");t.$cellTemplate=$("#templates div[role=phase-column-cell]");t.$matrixViewTemplate=$("#templates div[role=matrix-view-template]");this.matrixViewId=String(e++);this.$view=t.$matrixViewTemplate.clone(true).removeAttr("role");this.tasksByUid={};this.milestones={};this.taskById={};this.rowsById={};this.milestoneElementsById={};this.onElementMoveCompleteDelegate=Ext.Function.createBuffered(this.onElementMoveComplete,50,this);this.setReadOnly(this.readOnly,true);$("#templates *").off().removeData();this.$view.empty().off().append('<div class="matrix-view-viewport" />');this.$view.find(".matrix-view-viewport").append($("#templates div[role=matrix-view-inner-template]").clone(true));this.$container.append(this.$view);$(".matrix-view-viewport").off("scroll").on("scroll",function(){var A=$(this);var z=$(".matrix-view-fixed-column-viewport");if(!this.isHeightAdjusted&&(A.prop("scrollWidth")>A.width())){var B=parseInt(z.css("padding-bottom"))+17;this.isHeightAdjusted=true;z.css("padding-bottom",B)}z.scrollTop(A.scrollTop())});var w=Ext.getCmp(this.$container[0].id);if(w){w.on("resize",this.onContainerResize.bind(this))}this.wireRowEditEvents();this.addPopupMenuHandlers();this.addRowHeaderMenuListeners();this.initFixedRegions();this.backgroundClickDelegate=this.onBackgroundClick.bind(this);$(document.body).on("click",this.backgroundClickDelegate);$(".mask-view").off("click").on("click",this.onMaskViewClick.bind(this));$(".matrix-view-row:not(.header-row) .phase-column").on("click",this.onCellClick.bind(this));$(".matrix-view-row.header-row .phase-column .phase-name").on("sl.edit",function(A){var z=$(A.target).closest(".phase-column").data("model"),C=this.$view.data("model").phases,B=C.indexOf(z);t.savePhases();t.project.resetTaskCountInPhaseScopeMap(true,z.uid);var D=this.$view.find(".matrix-view-row .phase-column:nth-child("+(B+1)+") .task.has-default-name");D.each(function(F,J){var H=$(J),E=H.data("model"),I=H.closest(".matrix-view-row").data("model"),G=t.project.getScopeItemByUid(I.scopeItemUid);E.name=t.project.getDefaultTaskName(z,G,E.taskType);t.project.incrementTaskCountInPhaseScopeMap(z.uid+"."+G.uid);H.find(".task-name input").val(E.name);H.data("linkable-element-name",E.name);H.data("view").setTooltip(E)});t.saveProject();t.updatePhaseNameInHighlightMenu(z);$(document).trigger("phasechange",[t,z,B])}.bind(this));$(".milestone .task-properties .task-checklist-icon").on("click",function(z){var A;if($(z.target).closest(".fk").length>0){A=$(z.target).closest(".fk")}else{A=$(z.target).closest(".task").length==0?$(z.target).closest(".ms"):$(z.target).closest(".task")}t.showChecklistPopupForTask($(A));z.stopPropagation()});$(".task-placeholder").on("click",this.onNewTaskPlaceholderClick.bind(this));$(".phase-column:not(.has-task)").each(function(A,z){z.addEventListener("dragover",t.handleDragover.bind(t),false);z.addEventListener("dragenter",t.handleDragenter.bind(t),false);z.addEventListener("dragleave",t.handleDragleave.bind(t),false);z.addEventListener("drop",t.handleDrop.bind(t),false)});$(".matrix-view-task-alignment .task-align-option").off().on("click",this.onTaskAlignOptionClick.bind(this));$(".zoom-button.zoom-in").off().on("click",function(z){$(document).trigger("zoomin")});$(".zoom-button.zoom-out").off().on("click",function(z){$(document).trigger("zoomout")});$(".zoom-button.zoom-in").addClass("disabled");this.addGlobalListener("viewchange",function(A,z){window.currentViewId=z;if(z==="table"){$(".zoom-controls").hide()}else{$(".zoom-controls").show()}if(z==="matrix"){this.refreshLinks();this.syncColumnWidths()}if(z==="timeline"){Ext.getCmp("timelineview").requestReschedule()}}.bind(this));window.currentViewId="matrix";this.addGlobalListener("zoomin",function(z){if(window.currentViewId!=="matrix"){return}var A=Number(t.$view.data("zoom-level"));if(A<Object.keys(b).length-1){t.setZoomLevel(A+1,A)}});this.addGlobalListener("zoomout",function(z){if(window.currentViewId!=="matrix"){return}var A=Number(t.$view.data("zoom-level"));if(A>0){t.setZoomLevel(A-1,A)}else{if(A===0&&t.extraZoomOutEnabled){t.setZoomLevel(0,A,true)}}});this.addGlobalListener("taskChangeAtPhaseLevel",this.onTaskChangeAtPhaseLevel.bind(this));this.addGlobalListener("updateResourcesDeleted",this.onUpdateResourcesDeleted.bind(this));this.addGlobalListener("taskchange",this.onTaskChange.bind(this));this.addGlobalListener("taskadd",this.onTaskAdd.bind(this));this.addGlobalListener("summaryTaskAdd",this.onSummaryTaskAdd.bind(this));this.addGlobalListener("summaryTaskRemove",this.onSummaryTaskRemove.bind(this));this.addGlobalListener("summaryTaskDateChanged",this.onSummaryTaskDatesChanged.bind(this));this.addGlobalListener("taskremove",this.onTaskRemove.bind(this));this.addGlobalListener("phaseadd",this.onPhaseAdd.bind(this));this.addGlobalListener("phaseremove",this.onPhaseRemove.bind(this));this.addGlobalListener("phasechange",this.onPhaseChange.bind(this));this.addGlobalListener("rowremove",this.onRowRemove.bind(this));this.addGlobalListener("rowadd",this.onRowAdd.bind(this));this.addGlobalListener("rowchange",this.onRowChange.bind(this));this.addGlobalListener("scopenamechange",this.onScopeNameChange.bind(this));this.addGlobalListener("milestoneupdate",this.onMilestoneInfoChange.bind(this));this.addGlobalListener("projectload",this.onProjectLoaded.bind(this));this.addGlobalListener("highlightcctasks",this.onHighlightCCTasks.bind(this));this.addGlobalListener("highlightPenChain",this.onHighlightPenChain.bind(this));this.addGlobalListener("allhighlightscleared",this.onAllHighlightsCleared.bind(this));this.addGlobalListener("errorHighlight",this.onErrorHighlight.bind(this));this.addGlobalListener("errorHighlightWithUID",this.onErrorHighlightUsingUID.bind(this));this.addGlobalListener("highlightResourceContention",this.onHighlightResourceContention.bind(this));this.addGlobalListener("highlightSlack",this.onHighlightSlack.bind(this));this.addGlobalListener("highlight-milestone",this.onHighlightMilestone.bind(this));this.addGlobalListener("togglelinks",this.onToggleLinks.bind(this));this.addGlobalListener("milestoneadd",this.onMilestoneAdd.bind(this));this.addGlobalListener("removeBufferTaskAndPEMS",this.removeBufferTaskAndPEMS.bind(this));this.addGlobalListener("removeBufferTaskAndIPMS",this.removeBufferTaskAndIPMS.bind(this));this.addGlobalListener("removeBufferTaskLinks",this.removeBufferTaskLinks.bind(this));this.addGlobalListener("acceptPlanClicked",this.onAcceptPlan.bind(this));this.addGlobalListener("expandAllScopeNodes",this.onExpandAllScopeNodes.bind(this));this.addGlobalListener("expandScopeNode",this.onExpandScopeNode.bind(this));this.addGlobalListener("collapseScopeNode",this.onCollapseScopeNode.bind(this));if(u&&u===true){var s=stl.model.Project.createProject(r);s.name=r;s.division=v;$(".page-header-top .page-header-center .title")[0].innerHTML=r;if(x){s.dueDate=x.duedate;s.author=x.portfolio;s.category=x.businessUnit;s.subject=x.customer;s.manager=x.manager;s.attribute1=x.attribute1;s.attribute2=x.attribute2;s.attribute3=x.attribute3;s.attribute4=x.attribute4;s.attribute5=x.attribute5;s.projectFileType=x.projectFileType;s.participants=x.participants}stl.app.setActiveView("matrix-view-btn");var y=s.CC_Settings;CCSettingsStore.PopulateStore(y);stl.app.setProjectDataFromServer(s);stl.app.loadResources(v,function(){stl.app.loadPeopleAndTeams(v,function(){stl.app.loadAvailableCalendars(v,function(){stl.app.ProjectDataFromServer.projectCalendarName=stl.app.defaultCalendarName;LoadCalendarData(v,stl.app.ProjectDataFromServer.projectCalendarName,function(){stl.app.ProjectDataFromServer.initializeCalendarData();CalendarStore.PopulateStore(stl.app.getCalendarSettingsData());stl.model.Project.InitializeNewProject(s);stl.app.ProjectDataFromServer.updateGlobalMaxUnitsOfGlobalResourcesAssignedToProject();stl.app.ProjectDataFromServer.updateResourceSheet();s._milestones[0].date1=x.duedate;t.loadProject(s);stl.app.updateMilestoneSheet();if(!s.viewOnlyMode){stl.app.save(stl.app.ProcessTypeEnum.AUTOSAVE)}})})})})}else{}$(".drag-drop-handle").mousedown(function(z){z.preventDefault()})},updateScrollPos:function(s){var r=$(".matrix-view-viewport").scrollLeft()+Math.abs(s.pageX-this.clickX);if(s.pageX>($(window).width()-200)&&s.pageX<($(".phase-type-milestone").last().position().left+$(".phase-type-milestone").last().width())-200){$(".matrix-view-viewport").scrollLeft(r);this.onViewportScroll(s)}else{$(".task-reorder-placeholder").offset({top:s.pageY-10,left:s.pageX-10})}},onToggleLinks:function(s,r){this.linksView.setVisible(r)},onContainerResize:function(){},handleHighlightDropdownSelection:function(){var v=this;var u=stl.app.getCurrentHighLightOption();switch(u){case RESOURCES:var t=$($(".highlight-resources-popup").find(".tool-item"));$.each(t,function(x,y){if(x!=0){HighlightResources($(y))}});break;case PHASES:var r=$($(".highlight-phases-popup").find(".tool-item"));$.each(r,function(x,y){if(x!=0){HighlightPhases($(y))}});break;case TASK_MANAGERS:var w=$($(".highlight-task-managers-popup").find(".tool-item"));$.each(w,function(x,y){if(x!=0){HighlightTaskManagers($(y))}});break;case PROJECT_CMS_CHAINS:var s=$($(".highlight-chains-popup").find(".tool-item"));$.each(s,function(x,y){stl.app.HighlightProjectChain($(y))});break;case CC_TASKS:this.onHighlightCCTasks();break;case ERROR:v.highlightOnViewChange("highlightedErrorTask");break;case IMMEDIATE_PREDECESSORS:case IMMEDIATE_SUCCESSORS:case ALL_PREDECESSORS:case ALL_SUCCESSORS:case SHOW_CONSTRANING_SUCCESSOR_CHAIN:case SHOW_LONGEST_PREDECESSOR_CHAIN:case LONGEST_PATH:if(!stl.app.matrixView.isFirstSwitch){v.highlightOnViewChange("constrainingSuccessorTask")}break;case PEN_CHAIN:v.onHighlightPenChain();break;case SLACK:v.onHighlightSlack();break;case RESOURCE_CONTENTION:v.onHighlightResourceContention();break}},highlightOnViewChange:function(u){var v=this;var t=Ext.getCmp("timelineview");var r=$(".sch-timelineview table .sch-event").find("."+u);var w=$(".milestone-event."+u,t.getEl().dom);var s=[];$.each(r,function(x,y){var z=y.getAttribute("data-task-uid");s.push(z)});$.each(w,function(x,y){var z=y.getAttribute("data-ms-uid");s.push(z)});v.highlightChain(s,true,u)},initFixedRegions:function(){var s=this.$view.find(".matrix-view-row.header-row"),w=$('<div class="matrix-view-header-viewport" />'),t=$('<div class="matrix-view-fixed-column-viewport" />'),v=this.$view.find(".matrix-view-viewport"),r=31;leftColWidth=200;this.$viewport=v;w.append(s);this.$view.append(w);w.height(r);v.css("top",r-1);v.on("scroll",this.onViewportScroll.bind(this));this.$header=s;this.$headerContainer=w;var u=v.find(".matrix-view-row .tree-column");t.append(u);t.width(leftColWidth);this.$view.append(t);t.css("top",r-1);v.css("left",leftColWidth);this.$leftColContainer=t;t.on("scroll",this.onFixedColumnScroll.bind(this));this.$viewportCornerMask=$('<div class="viewport-corner-mask" />');this.$view.append(this.$viewportCornerMask);this.$viewportCornerMask.width(leftColWidth-1).height(r-1);this.syncColumnWidths();this.syncRowHeights();this.lastScrollTop=0;this.lastScrollLeft=0},onViewportScroll:function(r){var u=$(r.target),t=u.scrollLeft(),s=u.scrollTop();this.$headerContainer.scrollLeft(t);this.$leftColContainer.scrollTop(s);if(s>0&&this.lastScrollTop===0){this.$view.addClass("scrolled-vertically")}else{if(s===0&&this.lastScrollTop>0){this.$view.removeClass("scrolled-vertically")}}if(t>0&&this.lastScrollLeft===0){this.$view.addClass("scrolled-horizontally")}else{if(t===0&&this.lastScrollLeft>0){this.$view.removeClass("scrolled-horizontally")}}this.lastScrollTop=s;this.lastScrollLeft=t},onFixedColumnScroll:function(r){var s=$(r.target),t=s.scrollTop();this.$viewport.scrollTop(t);if(t>0&&this.lastScrollTop===0){this.$view.addClass("scrolled-vertically")}else{if(t===0&&this.lastScrollTop>0){this.$view.removeClass("scrolled-vertically")}}this.lastScrollTop=t},syncColumnWidths:function(y){var w=this.$header.find(".phase-column"),u=this.$view.find(".matrix-view-inner .matrix-view-row:first .phase-column");u.css("min-width",0);w.css("min-width",0);var s=[];for(var v=0;v<w.length;v++){var r=w.eq(v),z=u.eq(v),x=Math.max(100,r.outerWidth()),t=Math.max(x,z.outerWidth());s.push({header:r,cell:z,width:t})}for(var v=0;v<s.length;v++){var A=s[v];A.header.css("min-width",A.width);A.cell.css("min-width",A.width)}this.$headerContainer.scrollLeft(this.$viewport.scrollLeft())},syncRowHeights:function(C){var y=this;var u=this.$leftColContainer.find(".tree-column"),A=this.$view.find(".matrix-view-inner .matrix-view-row");u.css("min-height",0);A.css("height","auto");var w=Ext.getCmp("scopeItemTree");var E=(w)?w.getRootNode():null;var x;var s=[];var z=0;if(this.project){for(var v=0;v<=this.project.rows.length;v++){var B=A.eq(v);var t=(E)?this.findChildRecursively(E,"rowUid",B.attr("rowUid")):null,r=B.outerHeight();s.push({scopeItem:t,scroll:B,height:r});z=z+r}}for(var v=0;v<s.length;v++){var D=s[v];if(D.scopeItem){$(w.getView().getNode(D.scopeItem)).css("height",D.height)}D.scroll.css("height",D.height)}if(w){w.setHeight(z)}},onProjectLoaded:function(r,s){if(s===this){console.log("Method called matrix view - onProjectLoaded");this.setZoomLevel(1);this.$view.data("view",this);stl.app.HandleCheckoutButtonAsPerProjectPrivilege(this.project.CheckedOutStatus,this.project.CheckedOutUser);stl.app.UpdateDownloadButtonBasedOnProjectStatus(this.project.ProjectStatus,this.project.projectFileType)}},loadProjectJson:function(s){console.log("Method called stl.app.matrixView.loadProjectJson");var r=this;r.loadProject(s)},updateMilestoneDueDate:function(s,r){_.each(s._milestones,function(u,t){u.date1=r})},addIsCriticalClassForMilestone:function(r,s){if(s.isCritical){r.addClass("isCCTask")}},onMilestoneDeleteLocal:function(s,r,u){var t=u.data("model").taskType;if(t===PE_SHORT){this.removeBufferTaskAndPEMS("",r)}if(t===CMS_SHORT){this.removeBufferTaskAndIPMS("",r)}this.deleteMilestone(r)},onMilestoneRemove:function(t,w,v){var u=this.milestoneElementsById[v.uid];var r=this.rowsById[v.rowId];if(u){var x=u.closest(".phase-column").find(".milestone , .task");if(x.length<=1){u.closest(".phase-column").removeClass("has-task")}}this.removeLinksForMS(v.uid);var s=u.find(".ms-content-wrap");this.linksView.removeElement(s);u.next(".task-spaceholder-ms").remove();u.remove();this.selectedTask=null;$(document).trigger("taskselectionchange",[this.selectedTask]);this.syncColumnWidths();this.syncRowHeights();this.refreshLinks();this.saveRow(r);this.saveProject()},deleteMilestone:function(r){this.project.deleteMilestone(this,r)},removeBufferTaskAndPEMS:function(s,r){var u=this.milestoneElementsById[r];var v=u.prev();if(v.length>0&&v.hasClass("cccb-task")){this.deleteTask(v)}var t=stl.app.ProjectDataFromServer.getPEMS();if(t){this.deleteMilestone(t.uid)}},removeBufferTaskAndIPMS:function(t,s){var v=this.milestoneElementsById[s];var r=v.data("model");var w=v.prev();if(w.length>0&&w.hasClass("cmsb-task")){this.deleteTask(w)}var u=stl.app.ProjectDataFromServer.getIPMSForCMS(r);if(u){this.deleteMilestone(u.uid)}},onMilestoneInfoChange:function(A,s,t,z){var B=this.milestoneElementsById[s.uid];var w=B.data("view");var y=B.data("model");var C=B.find(".ms-content-wrap");var v=this.selectedTask;if(s.checklistStatus){this.refreshChecklistIcon(B,s)}if(t&&t==="type"){var u=s.type;if(u==CMS_SHORT){y.duration="0";s.duration="0";y.remainingDuration="0";s.remainingDuration="0";if(s.status==STATUS_IP){y.status=STATUS_NS;s.status=STATUS_NS;y.percentComplete=0}C.find(".milestone-icon").text(CMS_SHORT);if(B.hasClass("internal-milestone")){B.removeClass("internal-milestone")}if(B.hasClass("PP-milestone")){B.removeClass("PP-milestone")}if(z==PE_SHORT){this.removeBufferTaskAndPEMS("",y.uid)}else{this.removeBufferTaskAndIPMS("",y.uid)}var r=this.removeSuccessorLinks(y.uid);this.selectedTask=v}else{if(u===IMS_SHORT){C.find(".milestone-icon").text(IMS_SHORT);if(!B.hasClass("internal-milestone")){B.addClass("internal-milestone")}if(B.hasClass("PP-milestone")){B.removeClass("PP-milestone")}if(z==PE_SHORT){this.removeBufferTaskAndPEMS("",y.uid)}else{this.removeBufferTaskAndIPMS("",y.uid)}this.selectedTask=v}else{if(u==="NONE"){C.find(".milestone-icon").text("");if(!B.hasClass("internal-milestone")){B.addClass("internal-milestone")}B.addClass("PP-milestone");if(z==PE_SHORT){this.removeBufferTaskAndPEMS("",y.uid)}else{if(z==CMS_SHORT||z==IMS_SHORT){this.removeBufferTaskAndIPMS("",y.uid)}else{}}this.selectedTask=v}else{if(u===PE_SHORT){y.duration="0";s.duration="0";y.remainingDuration="0";s.remainingDuration="0";if(s.status==STATUS_IP){y.status=STATUS_NS;s.status=STATUS_NS;y.percentComplete=0}C.find(".milestone-icon").text(PE_SHORT);if(B.hasClass("internal-milestone")){B.removeClass("internal-milestone")}if(B.hasClass("PP-milestone")){B.removeClass("PP-milestone")}if(z==CMS_SHORT||z==IMS_SHORT){this.removeBufferTaskAndIPMS("",y.uid)}var r=this.removeSuccessorLinks(y.uid);this.selectedTask=v}}}}}if(u==CMS_SHORT){if(y.resources.length!=0){y.resources=[]}}this.project.updateMilestone(s,z);w.load(y);if(multipleORs(u,PE_SHORT,CMS_SHORT)){var x=this.rowsById[y.rowId];this.saveRow(x)}},removeSuccessorLinks:function(r){var s=this.project.links;var u=_.filter(s,function(v){return v.from===r});for(var t=0;t<u.length;t++){this.project.removeLink(u[t].from,u[t].to)}},onErrorHighlight:function(s,y){var u=false;var r=this.tasksByUid;var w=this.milestoneElementsById;var v=this.project.getTaskOrMilestoneUidById(y);var t=r[v];if(t){t.$el.addClass("highlightedErrorTask");u=true}if(!u){var x=w[v];if(x){$(x).addClass("highlightedErrorTask")}}},onErrorHighlightUsingUID:function(t,s){var v=false;var r=this.tasksByUid;var w=this.milestoneElementsById;var u=r[s];if(u){u.$el.addClass("highlightedErrorTask");v=true}if(!v){var x=w[s];if(x){$(x).addClass("highlightedErrorTask")}}},generateAutoLinksForTask:function(t,z){var X=this;if(z.type===STRING_NORMAL){var J=DOMManipulatorWrapperInstance.getPrevElement(t,".task , .milestone"),W=DOMManipulatorWrapperInstance.getNextElement(t,".task , .milestone");if(J.length>0&&W.length>0){X.removeLink(J,W);X.addAutoLink(J,t);X.addAutoLink(t,W);return}if(W.length>0){if(!X.project.isThisTaskBuffer(W.data("model"))){X.addAutoLink(t,W)}}if(J.length>0){if(!X.project.isThisTaskBuffer(J.data("model"))){X.addAutoLink(J,t)}}}var C=t.closest(".phase-column"),P=C.index(),M=C.closest(".matrix-view-row"),E=C.find(".task, .milestone"),H=E.length,I=E.index(t),O=(I===H-1);var F=C.prev();var D=C.closest(".matrix-view-row").find(".phase-column").index(F);if(z.type==="fullkit"){var V=M.prev(),x=$(),N=true;while(V.length>0){x=V.children().eq(P).find(".task").first();if(x.length>0){break}V=V.prev()}while(N){var G=M.children().eq(P+1).find(".task").first();if(G.length>0){if(x.length>0){X.removeLink(x,G)}X.addAutoLink(t,G)}M=M.next();N=(M.length>0)&&!(M.hasClass("row-placeholder"))&&(M.children().eq(P).find(".task").length===0)}}else{if(I>0){var B=E.eq(I-1);X.removeForwardLinksForTask(B.data("model").uid);X.addAutoLink(B,t)}else{if(E.length===1){if(D>=0&&this.project.phases[D].type==="fullkit"){var U=M;while(U.length>0){x=U.children().eq(P-1).find(".task").first();if(x.length>0){X.addAutoLink(x,t);break}U=U.prev()}}else{do{if(F&&F.length>0){if(F.hasClass("phase-type-milestone")&&F.hasClass("has-task")){var S=F.find(".milestone").last();if(S&&S.length>0&&multipleORs(S.data("model").taskType,IMS_SHORT,NONE_UPPER_CASE)){var s=S}else{break}}else{var s=F.find(".task");F=F.prev()}}else{break}}while(s.length===0);if(s&&s.length>0){if(s.last().hasClass("ccfb-task")){var H=s.length-1;while(H>=0){if(!(s.eq(H).hasClass("ccfb-task"))){X.addAutoLink(s.eq(H),t);break}H=H-1}}else{var K=s.last().data("model")._successors;if(K.length>0){for(var Q=0;Q<K.length;Q++){var y=this.getTaskOrMilestoneLinkTargetElementByUid(K[Q].uid);if(y.length>0){if(y.closest(".phase-column").index()>P){X.addAutoLink(t,y)}}}}X.addAutoLink(s.last(),t)}}}}}var T=C.next();if(O){if(T&&T.length>0){var L=T.find(".linkable-element");var u=T.find(".ms-content-wrap");if(L.length<=0&&u.length<=0){while(T.length>0&&L.length<=0&&u.length<=0){L=T.next().find(".linkable-element");u=T.next().find(".ms-content-wrap");T=T.next()}}if(L.length>0){if($.grep(this.project.links,function(Y){return Y.from==X.resolveLinkEndpointUID(t)&&Y.to==X.resolveLinkEndpointUID(L.first())}).length==0){X.addAutoLink(t,L.first())}}else{if(u.length>0){if($.grep(this.project.links,function(Y){return Y.from==X.resolveLinkEndpointUID(t)&&Y.to==X.resolveLinkEndpointUID(u.first())}).length==0){X.addAutoLink(t,u.first())}}}}}else{if(H>1){if($.grep(this.project.links,function(Y){return Y.from==X.resolveLinkEndpointUID(t)&&Y.to==X.resolveLinkEndpointUID(E.eq(I+1))}).length==0){X.addAutoLink(t,E.eq(I+1))}}}if(s&&L){if(s.last().length>0){var K=s.last().data("model")._successors;if(L.first().hasClass("milestone-icon-wrap")){var v=L.first().parent().data("model")}else{var v=L.first().data("model")}if(K.length>0&&K.indexOf(v)!=-1){X.removeLink(s.last(),L.first())}for(var Q=0;Q<K.length;Q++){if(multipleORs(K[Q].taskType,PE_SHORT,PEMS_SHORT,CMS_SHORT,IPMS_SHORT,IMS_SHORT,NONE_UPPER_CASE)){var r=s.last().data("model").rowId,w=K[Q].rowId;if(r===w){var R=s.last(),A=this.getTaskOrMilestoneLinkTargetElementByUid(K[Q].uid);X.removeLink(R,A)}break}}}}}},onAutoLinkAllChange:function(r,u,t){var s=this;PPI_Notifier.confirm(LINKS_WILL_BE_REMOVED_AFTER_AUTO_LINK,AUTO_LINK,function(){if(t){s.onAutoLinkAllChecked(u)}else{s.onAutoLinkAllUnchecked(u)}},function(){$(r.target)[0].$el.find("input:checkbox").prop("checked",!t);s.generateAutoLinksForMilestone(u)})},onAutoLinkAllChecked:function(r){var s=this;$cell=r.closest(".phase-column"),thisColIndex=$cell.index(),$row=$cell.closest(".matrix-view-row");if(thisColIndex!==0){s.connectAllValidPredecessors($row,r,thisColIndex)}if(r.data("model").taskType!=CMS_SHORT&&r.data("model").taskType!=PE_SHORT){s.connectAllValidSuccessors($row,r,thisColIndex)}},onAutoLinkAllUnchecked:function(t){var s=this,r=t.data("model").taskType;if(r===PE_SHORT){t=s.getPEMSorCCCBForPEAutoLink(t)}else{if(r===CMS_SHORT){t=s.getIPMSorCMSBForCMSAutoLink(t)}}taskClass=(r===FULL_KIT)?".task":".milestone";s.removeAdjecentLinksForAutoLink(t,taskClass,true);s.removeAdjecentLinksForAutoLink(t,taskClass,false)},removeAdjecentLinksForAutoLink:function(z,t,s){var v=this,x=z.closest(".phase-column"),r=x.index(),y=s?r-1:r+1;$row=x.closest(".matrix-view-row"),rowMeetsCriteria=true;if(y>=0){while(rowMeetsCriteria){v.removeInvalidAutoLinks(z.data("model").uid,$row.data("model"));$row=$row.next();var w=$row.children().eq(y).find(".task");var u=s?w.last():w.first();if(u.length>0){if(s){v.removeLink(u,z)}else{v.removeLink(z,u)}}rowMeetsCriteria=($row.length>0)&&!($row.hasClass("row-placeholder"))&&($row.children().eq(r).find(t).length===0)}}},removeOutgoingConnectionsOfPreviousTaskForPP:function(w,x,r){var v=this;if(x){for(var s=v.project.links.length-1;s>=0;s--){var u=v.project.links[s];if(u.from===w){var t=v.project.getPhaseById(v.project._tasksAndMilestonesByUid[u.to].phaseId);if(t.order>r){v.project.removeLink(u.from,u.to)}}}}},removeInvalidAutoLinks:function(u,w){var t=this;var v=t.project._tasksAndMilestonesByUid[u].phaseId;for(var r=t.project.links.length-1;r>=0;r--){var s=t.project.links[r];if(s.from===u){if(w.uid==t.project._tasksAndMilestonesByUid[s.to].rowId&&v!=t.project._tasksAndMilestonesByUid[s.to].phaseId){t.project.removeLink(s.from,s.to)}}}},connectAllValidSuccessors:function(v,r,s){var w=this,u=w.getPreviousMilestoneInPhase(v,s),y=r.data("model").taskType,t=y===FULL_KIT?".task":".milestone";rowMeetsCriteria=true;while(rowMeetsCriteria){var x=v.children().eq(s+1).find(".task").first(),z;if(x.length>0){if(u.length>0){w.removeLink(u,x)}if(w.isLinkAllowed(r,x,false,[],null)){w.addAutoLink(r,x)}}v=v.next();rowMeetsCriteria=(v.length>0)&&!(v.hasClass("row-placeholder"))&&(v.children().eq(s).find(t).length===0)}},connectAllValidPredecessors:function(s,w,r){var u=this;$previousMS=u.getPreviousMilestoneInPhase(s,r),taskType=w.data("model").taskType,isPP=(taskType===NONE_UPPER_CASE)?true:false;rowMeetsCriteria=true;while(rowMeetsCriteria){var t=s.children().eq(r-1).find(".task").last(),v;if(t.length>0){v=t.data("model").uid;if($previousMS.length>0){u.removeLink(t,$previousMS)}if(taskType===PE_SHORT){w=u.getPEMSorCCCBForPEAutoLink(w)}else{if(taskType===CMS_SHORT){w=u.getIPMSorCMSBForCMSAutoLink(w)}}u.removeOutgoingConnectionsOfPreviousTaskForPP(v,isPP,r);if(u.isLinkAllowed(t,w,false,[],null)){u.addAutoLink(t,w)}}if(taskType!==FULL_KIT){s=s.next();rowMeetsCriteria=(s.length>0)&&!(s.hasClass("row-placeholder"))&&(s.children().eq(r).find(".milestone").length===0)}else{rowMeetsCriteria=false}}},getPreviousMilestoneInPhase:function(s,r){var u=s.prev(),v=$(),t=true;while(u.length>0){v=u.children().eq(r).find(".milestone").first();if(v.length>0){break}u=u.prev()}return v},getPEMSorCCCBForPEAutoLink:function(t){var s=t.closest(".phase-column");var r=s.find(".pems-milestone");if(r.length>0){return r}else{if(s.find(".cccb-task").length>0){return s.find(".cccb-task").closest(".task")}else{return t}}},getIPMSorCMSBForCMSAutoLink:function(t){var s=t.closest(".phase-column");var r=s.find(".ipms-milestone");if(r.length>0){return r}else{if(s.find(".cmsb-task").length>0){return s.find(".cmsb-task").closest(".task")}else{return t}}},generateAutoLinksForMilestone:function(A){var y=this,t=DOMManipulatorWrapperInstance.getPrevElement(A,".task , .milestone"),B=DOMManipulatorWrapperInstance.getNextElement(A,".task , .milestone");if(t.length>0&&B.length>0){y.removeLink(t,B);y.addAutoLink(t,A);y.addAutoLink(A,B);return}if(B.length>0){if(!y.project.isThisTaskBuffer(B.data("model"))){y.addAutoLink(A,B)}}if(t.length>0){if(!y.project.isThisTaskBuffer(t.data("model"))){y.addAutoLink(t,A)}}else{var z=A.closest(".phase-column"),x=z.closest(".matrix-view-row");var u=z.prev();var r=z.closest(".matrix-view-row").find(".phase-column").index(u);var s=u.find(".task ,.milestone");while(u.length>0&&s.length==0){u=u.prev();var w=z.closest(".matrix-view-row").find(".phase-column").index(u);if(w!=-1&&this.project.phases[w].type==="milestone"){return}s=u.find(".task ,.milestone")}if(s.length>0){var v=s.eq(s.length-1);if(v.length>0){if(!multipleORs(v.data("model").taskType,TASKTYPE_BUFFER,PE_SHORT,CMS_SHORT)){y.addAutoLink(v,A)}}return}}},addGlobalListener:function(r,s){if(!this.globalListeners){this.globalListeners=[]}$(document).on(r,s);this.globalListeners.push({name:r,fn:s})},removeGlobalListeners:function(){for(var r=0;r<this.globalListeners.length;r++){var s=this.globalListeners[r];$(document).off(s.name,s.fn)}this.globalListeners=[]},destroy:function(){this.removeGlobalListeners();this.$view.find(".phase-column").sortable("destroy");$(document.body).off("click",this.backgroundClickDelegate);this.destroyed=true;var u=stl.app.matrixView.tasksByUid;stl.app.deletePropertiesOfObjectCollection(u);delete stl.app.matrixView.tasksByUid;var r=stl.app.matrixView.milestones;stl.app.deletePropertiesOfObjectCollection(r);delete stl.app.matrixView.milestones;var t=stl.app.matrixView.rowsById;stl.app.deletePropertiesOfObjectCollection(t);stl.app.matrixView.rowsById;for(var s in this){if(this.hasOwnProperty(s)){delete this[s]}}},saveProjectToServer:function(u,r){var t=this,s=stl.app.getProjectSummaryInfo();if(!this.project.uid){$.ajax({type:"POST",dataType:"json",url:j+"SaveProjectTableData",data:JSON.stringify(s),contentType:"application/json; charset=utf-8"}).success(function(v){if(v!=SESSION_TIMED_OUT){this.onProjectSummarySaved(u,s,v,r)}else{RedirectToLogInPage()}}.bind(this))}else{this.saveProjectJsonToServer(u,s,r)}},onProjectSummarySaved:function(t,v,u,s,r){if(parseInt(u)!==0){v.ProjectUid=u;if(v.ProjectFileType===PROJECT_TYPE_PPI){this.project.uid=u}if(s){this.saveProjectJsonToServer(t,v,s,r)}else{this.saveProjectJsonToServer(t,v,null,r)}}else{PPI_Notifier.error(PROJECT_SAVE_FAILED,FAILURE_MESSAGE);if(s){s(u)}}},saveProjectJsonToServer:function(u,v,t,s){var r='{ "processType": '+u+',"projectData": '+JSON.stringify(v)+', "jsonBlob": '+this.project.getJSON(s,v.name)+', "CCSettings": '+JSON.stringify(CCSettingsStore.GetCCSettings())+', "CCSummary": '+JSON.stringify(GetUpdatedCCSummaryData())+" }";$.ajax({type:"POST",dataType:"json",url:j+"SaveJsonBlobData",data:r,contentType:"application/json; charset=utf-8"}).success(function(w){if(w!=SESSION_TIMED_OUT){if(w!==FALSE_CONSTANT){if(t){t(w)}if(!stl.app.revisionHistory){stl.app.revisionHistory=new stl.view.RevisionHistory({projectUid:v.ProjectUid});stl.app.revisionHistory.init()}else{stl.app.revisionHistory.callBackAfterSave()}}else{PPI_Notifier.error(PROJECT_SAVE_FAILED,FAILURE_MESSAGE)}}else{RedirectToLogInPage()}})},setReadOnly:function(s,r){if(s===this.readOnly&&!r){return}this.readOnly=s;this.$view.find(":input").prop("disabled",s);$("#templates :input").prop("disabled",s);if(s){this.$view.addClass("read-only")}else{this.$view.removeClass("read-only")}},setExtraZoomOutEnabled:function(r){this.extraZoomOutEnabled=r;if(r){$(".zoom-button.zoom-out").addClass("pseudo-enabled")}else{$(".zoom-button.zoom-out").removeClass("pseudo-enabled")}},getTaskOrMilestoneInfoById:function(t){var u;var s=false;var r=this.tasksByUid;var v=this.milestoneElementsById;$.each(r,function(x,w){if(w.task.id==t){u=w;s=true;return false}});if(!s){$.each(v,function(x,y){var w=y.data("model");if(y.id==t){u=y;s=true;return false}})}return u},scrollIntoView:function(r,w,x){var y=this.$viewport.scrollLeft(),v=this.$viewport.scrollTop(),C=this.$viewport.offset(),z=r.offset(),D=w||r.width(),u=x||r.height(),A=20,B=20,t=y,s=v;if(z.left<C.left+A){t-=(C.left+A-z.left)}else{if(z.left+D>C.left+this.$viewport.width()-A-B){t+=(z.left+D-(C.left+this.$viewport.width()-A-B))}}if(z.top<C.top+A){s-=(C.top+A-z.top)}else{if(z.top+u>C.top+this.$viewport.height()-A-B){s+=(z.top+u-(C.top+this.$viewport.height()-A-B))}}this.$viewport.scrollLeft(t).scrollTop(s)},onHighlightAdjacent:function(r,t,s){if(t.closest(this.$view).length===0){return}this.linksView.highlightImmediateTasks(t,s)},onHighlightPredecessors:function(r,s){if(s.closest(this.$view).length===0){return}this.linksView.highlightAllPredecessors(s)},onHighlightSuccessors:function(r,s){if(s.closest(this.$view).length===0){return}this.linksView.highlightSuccessorTasks(s)},onHighlightConstraining:function(r,s){if(s.closest(this.$view).length===0){return}this.highlightConstrainingTasks(s)},onHighlightMilestone:function(s,x){var u=false;var r=this.tasksByUid;var v=this.milestoneElementsById;var t=r[x];if(t){t.$el.addClass("highlightedMilestoneTask");u=true}if(!u){var w=v[x];if(w){$(w).addClass("highlightedMilestoneTask")}}},retainSummaryTaskInRowModel:function(w,s){var t=this;var u=t.project.getSummaryTaskFromRow(w);if(u){var v=u.phaseId;if(s[v]){s[v].splice(0,0,u)}else{var r=[];r[0]=u;s[v]=r}}return s},saveSummaryTaskInRowModel:function(r,v){var x=r.data("model");var u=v.phaseId;var w=x.tasks;var t=x.tasks;if(v){if(t[u]){t[u].splice(0,0,v)}else{var s=[];s[0]=v;t[u]=s}}if(x){x.tasks=t}this.triggerSave();return x},onSummaryTaskAdd:function(t,v,x,u,w,s,r){if(v===this){return}this.saveRow(r)},onSummaryTaskRemove:function(r,s,t){if(s===this){return}},addSummaryTaskToRow:function(y,s,u,w){var t=this;var r=this.project.phases[0];var x;var v=t.project.createTaskModel(r,y,STRING_NORMAL,true);y=t.saveSummaryTaskInRowModel(u,v);$(document).trigger("summaryTaskAdd",[t,x,v,s,r,u]);return y},deleteSummaryTaskFromRow:function(w,u){var t=this;var r=t.project.phases[0];var v;var s=t.project.deleteSummaryTaskFromRowModel(w);if(s.summaryTask){$(document).trigger("summaryTaskRemove",[t,s.summaryTask])}return s.rowModel},getScopeTreeNode:function(t){var r=Ext.getCmp("scopeItemTree").getRootNode();var s=this.findChildRecursively(r,"rowUid",t);return s},onSummaryTaskDatesChanged:function(){},getSummaryTasksFromPhase:function(w){var u=this;var s=[];var r=u.project.getAllSummaryTasks();for(var t=0;t<r.length;t++){var v=r[t];if(v.phaseId==w){s.push(v)}}return s},moveSummaryTasksToDifferentPhase:function(t){var u=this;var s=u.project.phases;if(s.length>0){var v=s[0];var r=v.uid;_.each(t,function(B,z,A){var x=B.rowId;var w=u.rowsById[x],C=w.data("model");var y=B.phaseId;B.phaseId=r;u.saveSummaryTaskInRowModel(w,B);delete C.tasks[y]})}}})}()));