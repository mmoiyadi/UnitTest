stl.view.RevisionHistory=function(a){var b={revisionHistoryParentPanel:$(".revision-history-parent-panel"),revisionHistoryContentPanel:$(".revision-history-content"),template:$("#revision-history-template"),revisionHistoryList:{},filteredRevisionHistoryList:{},completeRevisionHistoryList:{},readOnly:false,visible:false,projectUid:null,defaultCountInList:stl.app.commonSettingValue(NUMBER_OF_REVISIONS)||DEFAULT_REVISIONLIST_COUNT,curentCountInList:stl.app.commonSettingValue(NUMBER_OF_REVISIONS)||DEFAULT_REVISIONLIST_COUNT,filterActionTypes:[1],isShowLessDetailActive:true,lastRestoredVersion:1,fixedRevisionCount:true};$.extend(this,b,a)};$.extend(stl.view.RevisionHistory.prototype,(function(){var b;var a={};return({init:function(){a={0:{key:"Invalid_Action",value:INVALID_ACTION},1:{key:"Auto_Save",value:AUTO_SAVED_ACTION},2:{key:"Save",value:SAVED_MANUALLY_ACTION},3:{key:"BM",value:BUFFER_MANAGEMENT_ACTION},4:{key:"Check_In",value:CHECKED_IN_ACTION},5:{key:"Check_Out",value:CHECKED_OUT_ACTION},6:{key:"IDCC",value:IDCC_ACTION},7:{key:"Redocc",value:REDOCC_ACTION},8:{key:"Buffer_Impact",value:BUFFER_IMPACT_ACTION},9:{key:"Undo_CheckOut",value:UNDO_CHECKOUT_ACTION},};Object.freeze(a);var c=this.template.html();b=Handlebars.compile(c);this.getRevisionListFromServerIntializePanel(this.projectUid,false)},appendItemsRevisionHistoryPanel:function(c){this.revisionHistoryList.revisions=c;this.revisionHistoryContentPanel.append(b(this.revisionHistoryList))},reloadItemsRevisionHistoryPanel:function(c){this.revisionHistoryList.revisions=c;this.revisionHistoryContentPanel.empty().append(b(this.revisionHistoryList))},refreshRevisionHistory:function(c){var d=this;d.getRevisionListFromServerIntializePanel(d.projectUid,c)},showRevisionHistoryPanel:function(){this.revisionHistoryParentPanel.show();this.visible=true;if(!$(".revisionHistoryImg").hasClass("pressed")){$(".revisionHistoryImg").addClass("pressed")}},hideRevisionHistoryPanel:function(){this.revisionHistoryParentPanel.hide();this.visible=false;$(".revisionHistoryImg").removeClass("pressed")},toggleRevisionHistoryPanel:function(){if(this.visible){this.hideRevisionHistoryPanel()}else{this.showRevisionHistoryPanel()}},toggleDetailLevel:function(c){var d=$(c.target);this.fixedRevisionCount=false;if(d.html()===SHOW_MORE_DETAILED_VERSIONS){d.html(SHOW_LESS_DETAILED_VERSIONS);this.isShowLessDetailActive=false;this.loadRevisionListInContentPanel(this.completeRevisionHistoryList,true)}else{d.html(SHOW_MORE_DETAILED_VERSIONS);this.isShowLessDetailActive=true;this.loadRevisionListInContentPanel(this.filteredRevisionHistoryList,true)}},wireParentPanelEvents:function(){this.revisionHistoryParentPanel.find(".revision-history-close").off("click").on("click",this.toggleRevisionHistoryPanel.bind(this));this.revisionHistoryParentPanel.find(".revision-history-less-detailed").off("click").on("click",this.toggleDetailLevel.bind(this));this.revisionHistoryParentPanel.find(".restore").off("click").on("click",this.refreshRevisionHistory.bind(this))},wireContentPanelEvents:function(){this.revisionHistoryContentPanel.find(".revision-history-img.restore > img").on("click",this.restoreRevision.bind(this))},getRevisionListFromServerIntializePanel:function(d,c){var e=this;LoadProjectRevisionList(d,function(f){var g=showErrorsAndWarnings(f,GET_REVISION_HISTORY);if(g){e.parseResponseList(f);e.initializeRevisionPanel();if(c){e.toggleRevisionHistoryPanel()}}})},getRevisionAsPerDetailFlag:function(){if(this.isShowLessDetailActive){return this.filteredRevisionHistoryList}else{return this.completeRevisionHistoryList}},initializeRevisionPanel:function(){var c=this.getRevisionAsPerDetailFlag();this.loadRevisionListInContentPanel(c,true);this.wireParentPanelEvents()},loadRevisionListInContentPanel:function(g,e){if(e){var d=this.fixedRevisionCount?this.extractItemsFromRevisonList(g,0,this.defaultCountInList):g;this.reloadItemsRevisionHistoryPanel(d);this.curentCountInList=d.length;var i=this.revisionHistoryContentPanel.find("#revision-history-"+this.lastRestoredVersion).closest(".revision-history-tile");this.highlightRestoredVersion(i)}else{var f=this.curentCountInList+this.defaultCountInList,h=this.curentCountInList,c=this.extractItemsFromRevisonList(g,h,f);this.appendItemsRevisionHistoryPanel(c);this.curentCountInList+=c.length}this.wireContentPanelEvents();this.OnReadOnly()},restoreRevision:function(e){var c=$(e.target).closest(".revision-history-img.restore").attr("id").substring(17);var d=$(e.target).closest(".revision-history-tile");this.getRevision(this.projectUid,c,d);this.lastRestoredVersion=c},highlightRestoredVersion:function(c){this.revisionHistoryContentPanel.find(".revision-history-tile").removeClass("selected");c.addClass("selected")},getRevision:function(d,c,f){var e=this;LoadProjectRevision(d,c,function(g){var h=showErrorsAndWarnings(g,GET_REVISION);if(h){$(document).trigger("projectjsonchange",[g,e.readOnly,false]);e.highlightRestoredVersion(f)}})},parseResponseList:function(c){var e=JSON.parse(c,function(g,f){if(g==="Timestamp"){return ServerTimeFormat.getRevisionHistoryFormat(f)}else{return f}});var d=e.map(function(f){f.restoreRevsionTooltip=RESTORE_REVISION;f.ActionString=a[f.Type].value;f.isBM=false;if(f.Type===3){f.UserId=BUFFER_MANAGEMENT;f.isBM=true}return f});this.completeRevisionHistoryList=d;this.filteredRevisionHistoryList=this.filterRevisionListOnType(d)},filterRevisionListOnType:function(c){var e=this;var d=c.filter(function(f){if(e.filterActionTypes.indexOf(f.Type)===-1){return f}});return d},extractItemsFromRevisonList:function(c,f,e){var d=c.slice(f,e);return d},showMoreItems:function(c){var d=this;if(d.isShowLessDetailActive){d.loadRevisionListInContentPanel(d.filteredRevisionHistoryList,false)}else{d.loadRevisionListInContentPanel(d.completeRevisionHistoryList,false)}},toggleRefreshRevsionHistoryPanel:function(){if(!this.visible){this.refreshRevisionHistory(true)}else{this.toggleRevisionHistoryPanel()}},callBackAfterSave:function(){this.refreshRevisionHistory(false)},OnReadOnly:function(){if(this.readOnly){this.revisionHistoryContentPanel.find(".revision-history-img.restore").hide()}else{this.revisionHistoryContentPanel.find(".revision-history-img.restore").show()}}})}()));