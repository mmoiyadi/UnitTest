stl.view.MilestoneView=function(a){var b={};$.extend(this,b,a);if(a.insertAfter||a.insertBefore){this.render($(a.insertBefore),$(a.insertAfter))}if(a.task){this.load(a.task)}};$.extend(stl.view.MilestoneView.prototype,(function(){var a=250;return({load:function(e,d,j){var l=this,b=l.$el;this.task=e;b.data("model",e);b.data("view",this);b.attr("id",e.uid);if(typeof(e.name)!=="undefined"&&e.name!==null){b.find(".task-name input").val(e.name);b.find(".task-name-overflow-edit").text(e.name)}else{b.find(".task-name input").val("");b.find(".task-name-overflow-edit").text("")}b.data("linkable-element-name",e.name);b.find("#task-id-value").text(e.id);this.updateChecklistStatus(e);b.find(".task-checklist-icon").addClass(this.project.getChecklistStatus(e.checklistStatus));this.setQuickEditStatusBox(b);var n=e.date1||ServerClientDateClass.getTodaysDate();b.find(".duedate input").val(ServerTimeFormat.getDateInLocaleFormat(n));if(e.taskType===IPMS_SHORT){b.addClass("ipms-milestone")}else{if(e.taskType===PEMS_SHORT){b.addClass("pems-milestone")}}if(e.taskType!="PE"){b.addClass("cms-ims-milestone")}b.attr("class").split(/\s+/).forEach(function(i){if(i.indexOf("has-phase-")===0){b.removeClass(i)}if(i.indexOf("has-task-manager-")===0){b.removeClass(i)}if(i.indexOf("has-resource-")===0){b.removeClass(i)}if(i.indexOf("highlight-phase-")===0){b.removeClass(i)}if(i.indexOf("highlight-task-manager-")===0){b.removeClass(i)}if(i.indexOf("highlight-resource-")===0){b.removeClass(i)}});var g=this.project.getPhaseColorMap();var f=this.project.getTaskManagerColorMap();var o=this.project.getResourceColorMap();var k=g[this.project.getPhaseById(e.phaseId).name];if(k){b.addClass("has-phase-"+stringToHex(this.project.getPhaseById(e.phaseId).name.replace(/ /g,"")));b.addClass("has-phase-"+stringToHex(this.task.phaseId))}if(k&&$(".highlight-phases-popup .tool-item:eq("+(k-1)+")").find("input").is(":checked")){b.addClass("highlight-phase-"+k);updateLegend(true,k,$(".highlight-phases-popup .tool-item:eq("+(k-1)+")").find(".phase-name").text())}var c=f[e.manager];if(c){b.addClass("has-task-manager-"+stringToHex(e.manager.replace(/ /g,"")))}if(c&&$(".highlight-task-managers-popup .tool-item:eq("+(c-1)+")").find("input").is(":checked")){b.addClass("highlight-task-manager-"+c);updateLegend(true,c,$(".highlight-task-managers-popup .tool-item:eq("+(c-1)+")").find(".task-manager-name").text())}if(e.resources){e.resources.forEach(function(p){var i=o[p.resourceId];if(i){b.addClass("has-resource-"+p.resourceId);if(i&&$(".highlight-resources-popup .tool-item:eq("+(i-1)+")").find("input").is(":checked")){b.addClass("highlight-resource-"+i);updateLegend(true,i,$(".highlight-resources-popup .tool-item:eq("+(i-1)+")").find(".resource-name").text())}}})}b.find(".task-type select").select2("val",e.taskType);b.data("last-height",b.height());this.updateCCTaskColor(b,e);if(this.readOnly){b.addClass("readonly")}else{b.removeClass("readonly")}if(j){this.invalidateResourceCache();this.onTaskResourceChangeFromTableView(b,e)}if(this.phase.type!==STRING_NORMAL){if(!e.isAutolinked){e.isAutolinked=false}if(e.isAutolinked){b.find(".ms-autolink input").prop("checked",true)}else{b.find(".ms-autolink input").prop("checked",false)}}b.find(".milestone-color").css("background-color",e.taskColor);b.find(".milestone-quick-edit-color").css("background-color",e.taskColor);if(this.isSubtaskEnabled){e.remainingSubtasks=0;for(var h=0;h<e.subtasks.length;h++){var m=e.subtasks[h];if(m.status!="CO"){e.remainingSubtasks++}}e.subtaskCount=e.subtasks.length}this.processZeroDurationTask();if(e.status===STATUS_CO){this.disableMilestoneProperties(b,true)}else{this.disableMilestoneProperties(b,false)}this.setTooltip(this,e)},processZeroDurationTask:function(){var c=this.$el,b=this.task;if(this.project.checkIfZeroDurationMilestoneTask(b)){if(!this.removeAppendIPOptionAlreadyDone){this.removeIPOptionFromTaskStatus(c)}if(b.status==STATUS_IP){b.status==STATUS_NS;this.setTaskStatus(STATUS_NS,c)}}else{if(!this.removeAppendIPOptionAlreadyDone){this.appendIPOptionForTaskStatus(c)}}},setTooltip:function(c,b){c.$el[0].title=b.name},showSubtasksRegion:function(b){var c=b.find(".subtasks");if(!c.is(":visible")){c.show()}},hideSubtasksRegion:function(b){var c=b.find(".subtasks");if(c.is(":visible")){c.hide()}},onTaskZoomClick:function(b){if(this.task.bufferType!=="None"){return}if(this.$el.hasClass("quick-task-edit")){this.$el.removeClass("quick-task-edit")}$(this).trigger("zoom",[b]);b.stopPropagation()},onTaskIconMousedown:function(b){b.stopPropagation()},updateChecklistStatus:function(b){b.checklistStatus=0;var d=b.checklistItems;if(d.length>0){var c=0;var f=0;var e=true;d=d.map(function(h,g){c=1;if(!h.complete){e=false}else{f++}h.order=g;return h});if((c==1&e==true)){c=2}b.checklistStatus=c}},save:function(){var c=this,e=this.$el,d=e.data("model");if(!d){console.warn("Attempt to save task without data model",e);return}d.name=e.find(".task-name input").val();this.setQuickEditStatusBox(e);var b={uid:d.uid,name:d.name,type:d.taskType,taskType:d.taskType,startDate:d.startDate,endDate:d.endDate,date1:d.date1,bufferSize:"",status:d.status};Ext.getCmp("CCSummarygrid").updateMilestoneSheet(b);$(this).trigger("change");this.setTooltip(this,d)},render:function(f,d){var c=this,b=$("#templates div[role=ms-template]"),e=b.clone(true);this.$el=e;if(d&&d.length>0){d.after(e)}else{f.before(e)}this.$el.find(".task-name input").on({focus:function(g){if(c.$el.hasClass("task-zoom-normal")){g.stopPropagation();return}c.enterQuickEditMode()},change:function(g,h){c.$el.data("linkable-element-name",h);c.save()}});this.$el.find(".task-name-overflow-edit").on("keyup",function(g){if(g.which===13){c.exitQuickEditMode()}});e.on("click",this.onClick.bind(this));e.find(".status-indicator").on("click",this.onStatusIndicatorClick.bind(this));e.find(".task-type select").select2({dropdownAutoWidth:true,minimumResultsForSearch:-1}).on("change",this.onTaskTypeChange.bind(this));e.find(".duedate input").datepicker({format:ServerTimeFormat.getBootstrapPickerDateFormat(),assumeNearByYear:true,autoclose:true}).on("keypress",function(g){if(g.which==13){g.preventDefault()}}).on("changeDate",this.changeDueDate.bind(this)).on("hide",function(g){if(!g.date){this.$el.find(".duedate input").datepicker("setDate",ServerTimeFormat.getDateInLocaleFormat(this.task.date1))}}.bind(this));if(this.phase.type===STRING_NORMAL){DOMManipulatorWrapperInstance.findElementsByClsNames(e,"ms-autolink").hide()}else{e.find(".ms-autolink input").on({change:this.onAutoLinkAllChange.bind(this)})}e.find(".delete-task-button").on({click:this.onDeleteTaskButtonClick.bind(this),mousedown:this.onTaskIconMousedown.bind(this)});e.find(".ok-task-button").on({click:this.onOkTaskButtonClick.bind(this)});e.find(".add-task-plus-icon").on({click:this.onTaskAddButtonClick.bind(this),mousedown:this.onTaskIconMousedown.bind(this)});$(this.project).on("resourceschanged",this.invalidateResourceCache.bind(this))},onAutoLinkAllChange:function(b){var c=this;this.task.isAutolinked=b.currentTarget.checked;if(this.task.isAutolinked){$(b.target).closest(".ms").addClass("pinch-point")}else{$(b.target).closest(".ms").removeClass("pinch-point")}setTimeout(function(){$(c).trigger("autolinkallChange",[$(b.target).closest(".ms"),b.currentTarget.checked])},20)},changeDueDate:function(b){var c=$(b.target).closest(".ms"),f=c.data("model");var d=null;var i=stl.model.Project.project;try{var g=c.find(".duedate input").datepicker("getDate");if(!isNaN(g)){d=g}else{if(f.date1){d=new Date(f.date1)}else{d=ServerClientDateClass.getTodaysDate()}}}catch(h){}if(!isNaN(d)){f.date1=d}if(!isNaN(g)){c.find(".duedate input").val(d)}if(f.taskType==="PE"){i.dueDate=g}this.save();Ext.getCmp("CCSummarygrid").changeMilestoneDueDate(f,function(){f.type=f.taskType;$(document).trigger("milestoneupdate",[f,"date1"])})},onStatusIndicatorClick:function(c){if(this.readOnly){return}var b=this.task.status||"NS";switch(b){case STATUS_NS:if(this.task.taskType===IMS_SHORT&&parseInt(this.task.duration)>0){this.task.status=STATUS_IP}else{this.task.status=STATUS_CO}break;case STATUS_IP:this.task.status=STATUS_CO;break;case STATUS_CO:break}this.onStatusChange(b,true)},onStatusChange:function(d,g,c){if(this.readOnly){return}var f=this;var e=this.$el;if(!g){g=this.task.status}this.task.status=this.$el.find(".task-status select").select2("val");var b=this.task.status||STATUS_NS;switch(b){case STATUS_NS:this.task.status=STATUS_NS;f.task.actualStartDate=null;f.task.actualFinishDate=null;f.task.percentComplete=0;break;case STATUS_IP:this.task.status=STATUS_IP;f.task.actualStartDate=ServerClientDateClass.getTodaysDate();f.task.actualFinishDate=null;break;case STATUS_CO:this.task.status=STATUS_CO;f.task.actualStartDate=f.task.actualStartDate?f.task.actualStartDate:ServerClientDateClass.getTodaysDate();f.task.actualFinishDate=ServerClientDateClass.getTodaysDate();f.task.actualFinishDate.setHours(17,0,0);f.task.percentComplete=100;f.task.remainingDuration=0;f.disableMilestoneProperties(e,true);break}e.data("model").status=this.task.status;this.project.changeStatusForIPMSOrPEMS(this.task);f.setQuickEditStatusBox(e);f.save()},disableMilestoneProperties:function(b,c){b.find(":input").prop("disabled",c);b.find(".task-type select").select2("enable",!c)},taskStatusChangeValidations:function(e,b,c){var d=this;if(e=="NS"&&b=="IP"){ChangeTaskStatusFromNSToIP();c("yes")}else{if(e=="NS"&&b=="CO"){ChangeTaskStatusFromNSToCO(this.task.name,this.task,this.task.subtasks,null,function(f){if(f=="no"){d.task.status="NS";d.$el.find(".task-status select").select2("val",d.task.status);c("no")}else{d.setSubtaskStatus();c("yes")}})}else{if(e=="IP"&&b=="CO"){ChangeTaskStatusFromIPToCO(this.task.name,this.task,this.task.subtasks,null,function(f){if(f=="no"){d.task.status="IP";d.$el.find(".task-status select").select2("val",d.task.status);c("no")}else{d.setSubtaskStatus();c("yes")}})}else{if(e=="IP"&&b=="NS"){ChangeTaskStatusFromIPToNS(this.task.name,this.task,this.task.subtasks,function(f){if(f=="no"){d.task.status="IP";d.$el.find(".task-status select").select2("val",d.task.status);c("no")}else{d.setSubtaskStatus();c("yes")}})}else{if(e=="CO"&&b=="IP"){ChangeTaskStatusFromCOToIP(this.task.name,this.task.subtasks,null,function(){d.setSubtaskStatus();c("yes")})}else{if(e=="CO"&&b=="NS"){ChangeTaskStatusFromCOToNS(this.task.name,this.task.subtasks,null,function(f){if(f=="no"){d.task.status="CO";d.$el.find(".task-status select").select2("val",d.task.status);c("no")}else{d.setSubtaskStatus();c("yes")}})}else{c("yes")}}}}}}},setSubtaskStatus:function(){var h=this;if(h.isSubtaskEnabled){h.$el.find(".subtasks li.subtask:not(.proto-subtask)").remove();h.task.remainingSubtasks=0;var d=$("#templates li[data-role=subtask-template]"),e=h.$el.find("li.proto-subtask");for(var f=0;f<h.task.subtasks.length;f++){var g=h.task.subtasks[f],c=(h.includeCompletedSubtask)?true:!g.complete;if(c){var b=d.clone(true).removeClass("proto-subtask").removeAttr("data-role");h.bindSubtask(b,g);e.before(b);this.setDurationAndDatesForSubtask(g,b)}if(!g.complete){h.task.remainingSubtasks++}}h.task.subtaskCount=h.task.subtasks.length;h.refreshRemainingSubtasksIndicator()}},subtaskStatusChangeValidations:function(e,f,h,b,g,c){var d=this;if(e==="NS"&&f==="IP"){ChangeSubtaskStatusFromNSToIP(h,b,function(i){if(i=="no"){}else{d.setTaskStatus("IP",d.$el)}c()})}else{if(e==="NS"&&f==="CO"){ChangeSubtaskStatusFromNSToCO(h,b,null,function(j,i){if(j=="no"||i=="no"){d.setTaskStatus("IP",d.$el)}else{d.setTaskStatus("CO",d.$el)}c()})}else{if(e==="IP"&&f==="CO"){ChangeSubtaskStatusFromIPToCO(h,b,null,function(j,i){if(j=="no"||i=="no"){d.setTaskStatus("IP",d.$el)}else{d.setTaskStatus("CO",d.$el)}c()})}else{if(e==="IP"&&f==="NS"){ChangeSubtaskStatusFromIPToNS(h,b,null,function(j,i){if(j=="no"||i=="no"){d.setTaskStatus("IP",d.$el)}else{d.setTaskStatus("NS",d.$el)}c()})}else{if(e==="CO"&&f==="NS"){ChangeSubtaskStatusFromCOToNS(h,b,null,function(j,i){if(j=="no"||i=="no"){d.setTaskStatus("IP",d.$el)}else{d.setTaskStatus("NS",d.$el)}c()})}else{if(e==="CO"&&f==="IP"){ChangeSubtaskStatusFromCOToIP(h,b,function(i){if(i=="no"){d.setTaskStatus("IP",d.$el)}else{d.setTaskStatus("IP",d.$el)}c()})}else{}}}}}}},setTaskStatus:function(b,c){c.find(".task-status select").select2("val",b);c.find(".task-status select").trigger("change",[b,false])},bindSubtask:function(e,d){e.data("model",d);e.find(".subtask-name input").val(d.name);e.find(".subtask-duration input").val(ValidationClassInstance.getValidDurationString(d.remainingDuration,SUBTASK_DURATION_DEFAULT_STR,false));e.find(".subtask-duration input").on("change",this.onSubtaskDurationChange.bind(this));e.find(".subtask-duration input").on("keypress",this.onSubtaskDurationChange.bind(this));e.find(".subtask-checklist-icon").addClass(this.project.getChecklistStatus(d.checklistStatus));var b=new stl.view.ResourcePicker({el:e.find(".subtask-resources"),val:d.resources,project:this.project,readOnly:this.readOnly});e.find(".subtask-resources").on("change",this.onSubtaskResourcesChange.bind(this));e.find(".delete-subtask").on("click",this.onDeleteSubTaskButtonClick.bind(this));this.refreshSubtaskStatus(e);this.refreshChecklistIcon(e,d);e.find(".subtask-status").on("click",this.onSubtaskStatusClick.bind(this));var c=e.find(".subtask-owner");c.select2({placeholder:NONE_PLACEHOLDER,allowClear:true,query:this.managerDropDownQuery.bind(this),initSelection:this.managerDropDownInitSelection.bind(this)}).on("change",this.onGenericSubtaskPropertyChange.bind(this));c.select2("val",d.manager||"");c.select2("enable",!this.readOnly)},refreshSubtaskStatus:function(b){b.removeClass("subtask-status-NS subtask-status-IP subtask-status-CO").addClass("subtask-status-"+this.getSubtaskStatus(b.data("model").status))},refreshChecklistIcon:function(c,b){c.find(".subtask-checklist-icon").removeClass("none incomplete complete").addClass(this.project.getChecklistStatus(b.checklistStatus));c.data("model").checklistStatus=b.checklistStatus},getSubtaskStatus:function(b){try{switch(b){case"NS":case"0":return"NS";break;case"IP":case"1":return"IP";break;case"CO":case"2":return"CO";break}}catch(c){throw"Subtask status code not recognized: "+b}},saveSubtask:function(d){var b=d.data("model"),c=d.find(".subtask-duration input").val();$.extend(b,{name:d.find(".subtask-name input").val(),manager:d.find(".subtask-owner").select2("val"),remainingDuration:c==""?0:Math.round(juration.parse(d.find(".subtask-duration input").val())),startDate:d.data("model").startDate,endDate:d.data("model").endDate,status:d.data("model").status,resources:d.find(".subtask-resources").data("resourcePicker").getValue()})},onTaskTypeChange:function(b){var g=$(b.target).closest(".ms"),d=g.data("model"),f=g.data("view"),c=d.taskType;if(!this.project.validatePEandPPTypeConversion(d,b.val)){g.find(".task-type select").select2("val",d.taskType);return}d.taskType=b.val;var e={uid:d.uid,name:d.name,type:d.taskType,taskType:d.taskType,startDate:d.startDate,status:d.status,endDate:d.endDate,date1:d.date1,bufferSize:"",isAutolinked:g.find(".ms-autolink input").is(":checked")};if(e.date1==null){e.date1=ServerClientDateClass.getTodaysDate()}Ext.getCmp("CCSummarygrid").changeMilestoneNameByChangingType(e.type,e,e.name,c,function(){$(document).trigger("milestoneupdate",[e,"type",c])});if(this.project.getPhaseById(d.phaseId).type===STRING_MILESTONE_LOWER_CASE){$(this).trigger("autolinkallChange",[g,g.find(".ms-autolink input").is(":checked")])}this.save()},onTaskSubtaskTypeChange:function(b){var d=$(b.target).closest(".task"),c=d.data("model");c.subtaskType=b.val;this.bindSubtaskTypeSpecificProperties();this.project.reCalculateSubTaskStartDate(c);this.save()},onTaskDurationChange:function(d){if(d.type==KEYPRESS){if(d.which==13){d.preventDefault()}else{return}}var f=$(d.target),h=f.closest(".task"),e=h.data("model"),g=f.val();if(e.status=="CO"){g=0}var c=ValidationClassInstance.getValidDuration(g,TASK_DURATION_DEFAULT,true);f.val(ValidationClassInstance.getValidDurationString(c,TASK_DURATION_DEFAULT_STR,true));var b=this.task.status||"NS";this.setDurationField(b,e,c);if(this.project.checkIfZeroDurationMilestoneTask(e)){this.removeIPOptionFromTaskStatus(h)}else{this.appendIPOptionForTaskStatus(h)}this.removeAppendIPOptionAlreadyDone=true;this.save()},removeIPOptionFromTaskStatus:function(b){b.find(".task-status select option[value = 'IP']").remove()},appendIPOptionForTaskStatus:function(b){if(b.find(".task-status select option[value = 'IP']").length===0){b.find(".task-status select option[value = 'CO']").before('<option  data-resx-key = "IN_PROGRESS_Key"  value="IP">In progress</option>')}},onTaskDurationClick:function(b){if($(b.target).closest(".task").hasClass("quick-task-edit")){b.stopPropagation()}},onSubtaskDurationChange:function(d){if(d.type==KEYPRESS){if(d.which==13){d.preventDefault()}else{return}}var e=$(d.target),g=e.closest(".subtask").data("model"),f=e.closest(".subtask").closest(".task");val=e.val();if(g.status==="CO"){val=0}else{if(ZERO_DURATION_REGEX.test(e.val())){PPI_Notifier.info(getStringWithArgs(ZERO_DURATION_NOT_ALLOWED,SUBTASKS));val=SUBTASK_DURATION_DEFAULT}}var c=ValidationClassInstance.getValidDuration(val,SUBTASK_DURATION_DEFAULT,true);e.val(ValidationClassInstance.getValidDurationString(c,SUBTASK_DURATION_DEFAULT_STR,true));var b=g.status||"NS";this.setDurationField(b,g,c);this.project.reCalculateSubTaskStartDate(f.data("model"));this.save()},setDurationField:function(c,d,b){switch(c){case"NS":d.duration=Math.round(b);d.remainingDuration=Math.round(b);break;case"IP":d.remainingDuration=Math.round(b);break;case"CO":d.remainingDuration=0;break}},onSubtaskResourcesChange:function(b){var d=this,c=$(b.target).closest(".subtask"),f=c.data("model"),e=c.closest(".task");this.save();var g=f.resources.map(function(h){return d.getResourceById(h.resourceId)});this.project.onResourcesAssigned(g)},onGenericSubtaskPropertyChange:function(b){this.save()},refreshRemainingSubtasksIndicator:function(){var c=this.$el.find(".remaining-subtasks-indicator"),b=this.$el.find(".subtask-type");if(this.isSubtaskEnabled){c.text(this.task.remainingSubtasks).toggle(!!this.task.remainingSubtasks);if(this.task.subtasks.length>0){if(!this.$el.hasClass("quick-task-edit")){b.show()}}else{b.hide()}}else{c.hide();b.hide()}},refreshStatusIndicator:function(){if(!multipleORs(this.task.taskType,IPMS_SHORT,PEMS_SHORT)){this.$el.find(".status-indicator").hide();this.$el.find(".status-indicator-"+(this.task.status||"NS")).show()}},setQuickEditStatusBox:function(d){var c=d.find(".task-status select");var b=this.task;if(!this.initializedQuickEdit){c.select2({dropdownAutoWidth:true,minimumResultsForSearch:-1}).on("change",this.onStatusChange.bind(this))}c.select2("val",b.status);this.initializedQuickEdit=true},saveSubtaskTypeSpecificProperties:function(d,c){var b=d.find(".subtask-specific-properties");c.volume=b.find(".volume").val();c.wipLimit=b.find(".wip-limit").val();c.units=b.find(".units").val()},onSNETChange:function(b){var g=$(b.target).closest(".task"),c=g.data("model");var d=null;try{d=Ext.Date.parse($(b.target).val(),"m/d/y")}catch(f){}if(d){c.startNoEarlierThan=d}g.find(".snet input").val(Ext.Date.format(new Date(c.startNoEarlierThan||""),ServerTimeFormat.getExtDateformat()));this.save()},onGenericTaskPropertyInputChange:function(b){var c=$(b.target).closest(".task");this.save()},onTaskResourceChange:function(k,f){var h=this,b=$(k.target).closest(".task"),d=b.data("model");this.save();if(d.resources.length>0){for(var g=0;g<d.resources.length;g++){var j=d.resources[g],c=this.getResourceById(j.resourceId);Ext.getCmp("resGrid").updateResourceSheet(c,j.units,d)}}else{}this.updateTaskResourceColors(b,d);var e=d.resources.map(function(i){return h.getResourceById(i.resourceId)});this.project.onResourcesAssigned(e);$(this).trigger("resourcechange")},onTaskResourceChangeFromTableView:function(d,b){var c=this;this.updateTaskResourceColors(d,b);var e=b.resources.map(function(f){return c.getResourceById(f.resourceId)});this.project.onResourcesAssigned(e);$(this).trigger("resourcechange")},onTaskResourcePickerResize:function(b){var c=$(b.target).closest(".task");this.checkForTaskHeightChange(c)},checkForTaskHeightChange:function(d){var c=d.data("last-height"),b=d.height();if(b!==c){d.data("last-height",b);$(this).trigger("resize")}},managerDropDownQuery:function(b){b.callback({results:this.getAvailableManagerOptions()})},managerDropDownInitSelection:function(b,c){if(!this.cachedManagersById){this.getAvailableManagerOptions()}this.dropDownInitSelection(b,c,this.cachedManagersById,"FullName")},dropDownInitSelection:function(c,i,g,d){var h=c.select2("val"),f=null;if(h){var e=g[h],b=(e?e[d]:h);f={id:h,text:b}}i(f)},participantsDropDownQuery:function(b){b.callback({results:this.getAvailableManagerOptions()})},participantsDropDownInitSelection:function(b,e){var c=this;if(!this.cachedManagersById){this.getAvailableManagerOptions()}var d=b.select2("val").map(function(h){var g=c.cachedManagersById[h],f=(g?g.FullName:h);return{id:h,text:f}});e(d)},getManagerName:function(c){var d=this.project.getAvailableResources();for(var b=0;b<d.length;b++){if(d[b].id===c){return d[b].Name}}},onOkTaskButtonClick:function(b){this.exitQuickEditMode();b.stopPropagation()},onDeleteTaskButtonClick:function(c){var d=$(c.target).closest(".ms");var b=$(c.target).closest(".ms").data("model").uid;$(this).trigger("delete",[b,d])},onTaskAddButtonClick:function(b){if(this.$el.hasClass("quick-task-edit")){this.$el.removeClass("quick-task-edit")}$(this).trigger("addTask",[b]);b.stopPropagation()},onDeleteSubTaskButtonClick:function(c){if(this.readOnly){return}var e=this,b=$(c.target),g=b.closest("li"),f=g.data("model"),d=this.$el.data("model");g.remove();e.save();this.project.reCalculateSubTaskStartDate(d);$(this).trigger("deletesubtask",[f,d])},onSubtaskStatusClick:function(d){if(this.readOnly){return}var f=this,h=$(d.target).closest("li"),g=h.data("model");var e=this.completeSubtaskOnChecklistComplete?(g.checklistStatus==2||g.checklistStatus==0):true;var c="NS";var b=g.status;if(b=="0"){b="NS"}else{if(b=="1"){b="IP"}else{if(b=="2"){b="CO"}}}switch(g.status){case"0":case"NS":if(this.task.subtaskType=="2"){if(e){g.status="CO"}else{PPI_Notifier.info(SUBTASK_CANNOT_MARKED_COMPLETE)}}else{g.status="IP"}break;case"1":case"IP":if(e){g.status="CO"}else{PPI_Notifier.info(SUBTASK_CANNOT_MARKED_COMPLETE)}break;case"2":case"CO":g.status="NS";break}this.setDurationAndDatesForSubtask(g,h);this.subtaskStatusChangeValidations(b,g.status,g,this.task,h,function(){f.refreshSubtaskStatus(h);f.save()})},setDurationAndDatesForSubtask:function(b,c){switch(b.status){case"2":case"CO":b.endDate=Ext.Date.format(ServerClientDateClass.getTodaysDate(),ServerTimeFormat.getExtDateformat());b.duration=SUBTASK_DURATION_DEFAULT;b.remainingDuration=0;b.actualStartDate=b.actualStartDate?b.actualStartDate:ServerClientDateClass.getTodaysDate();b.actualFinishDate=ServerClientDateClass.getTodaysDate();c.find(".subtask-duration input").val(ValidationClassInstance.getValidDurationString(b.remainingDuration,SUBTASK_DURATION_DEFAULT_STR,false));break;case"1":case"IP":b.actualStartDate=ServerClientDateClass.getTodaysDate();b.actualFinishDate=null;b.remainingDuration=b.remainingDuration==0?SUBTASK_DURATION_DEFAULT_SEC:b.remainingDuration;c.find(".subtask-duration input").val(ValidationClassInstance.getValidDurationString(b.remainingDuration,SUBTASK_DURATION_DEFAULT_STR,false));break;case"0":case"NS":b.actualStartDate=null;b.actualFinishDate=null;b.remainingDuration=b.remainingDuration==0?SUBTASK_DURATION_DEFAULT_SEC:b.remainingDuration;b.duration=b.remainingDuration;c.find(".subtask-duration input").val(ValidationClassInstance.getValidDurationString(b.remainingDuration,SUBTASK_DURATION_DEFAULT_STR,false))}},bindTaskTypeSpecificProperties:function(){var i=this.$el,h=this.task;i.find(".task-specific-properties").hide();i.find(".task-specific-properties-"+h.taskType).css("display","inline-block");switch(h.taskType){case"normal":this.showSubtasksRegion(i);break;case"fullkit":var b=i.find(".fullkit-name");if(b.length===0){b=$('<div class="fullkit-name"></div>');i.find(".task-name").append(b)}var c="FK",g=this.project.phases.indexOf(this.project.getPhaseById(h.phaseId))+1,f=this.project.getRowById(h.rowId).tasks[this.project.phases[g].uid];if(f&&f.length>0){var e=f[0].name;if(e===null||e===""){var d=i.closest(".phase-column").next(".phase-column").find(".task").first();e=d.find(".task-name input").attr("placeholder")}c="FK"}b.text(c);i.on("click",this.onFullkitTaskClick.bind(this));break;case"purchasing":this.hideSubtasksRegion(i);break;case"snet":this.showSubtasksRegion(i);break}},onFullkitTaskClick:function(b){var c=stl.app.isProjectOpenInViewOnlyMode();if(c){return}$(".tool-popup").hide();$(b.target).closest(".task").find(".tool-popup").show();b.stopPropagation()},bindSubtaskTypeSpecificProperties:function(){var d=this.$el,c=this.task;d.find(".subtask-specific-property").hide();var b=d.find(".subtask-specific-property-"+this.getSubtaskTypeString(c.subtaskType));this.showHideSubtaskColumnsBySubtaskType(d,c);if(+this.task.subtaskType===2){d.addClass("subtask-type-rate")}else{d.removeClass("subtask-type-rate")}},getSubtaskTypeString:function(b){switch(b){case"1":return"sequential";break;case"2":return"volume";break;case"3":return"wip";break;case"4":return"resource";break}},showHideSubtaskColumnsBySubtaskType:function(){var c=this.$el,b=this.task;c.find(".subtask-header-duration, .subtask-header-resources").addClass("hidden");c.find(".subtask .subtask-duration, .subtask .subtask-resources").addClass("hidden");switch(b.subtaskType){case"1":c.find(".subtask-header-duration, .subtask-header-resources").removeClass("hidden");c.find(".subtask-duration, .subtask-resources").removeClass("hidden");break;case"2":break;case"3":c.find(".subtask-header-duration").removeClass("hidden");c.find(".subtask-duration").removeClass("hidden");break;case"4":c.find(".subtask-header-duration, .subtask-header-resources").removeClass("hidden");c.find(".subtask-duration, .subtask-resources").removeClass("hidden");break}},updateTaskResourceColors:function(){var c=this,d=this.getAvailableResourceOptions(),b=this.project.getResourceColorMap(),e=this.$el;e.attr("class").split(/\s+/).forEach(function(f){if(f.indexOf("has-resource-")===0){e.removeClass(f)}if(f.indexOf("highlight-resource-")===0){e.removeClass(f)}});this.task.resources.forEach(function(g){var f=b[g.resourceId];if(f){e.addClass("has-resource-"+g.resourceId)}})},updateCCTaskColor:function(d,b){var d=this.$el,c=this.task;if(b.isCritical){d.addClass("isCCTask")}},getAvailableResourceOptions:function(){this.cachedAvailableResourceOptions=this.project.getAvailableResources().map(function(b){return{id:b.uid,text:b.Name}});this.cachedResourcesById=this.project.getAvailableResourcesByUid();return this.cachedAvailableResourceOptions},invalidateResourceCache:function(){delete this.cachedResourcesById;delete this.cachedAvailableResourceOptions;delete this.resourceHighlightMenuIsCurrent},getGlobalResourceObjWithUpdateBaseCalendar:function(b){var c=jQuery.extend(true,{},b);c.BaseCalendarName=stl.app.ProjectDataFromServer.projectCalendarName;return c},getResourceObj:function(b){var c=jQuery.extend(true,{},b);return c},getResourceById:function(c){if(!this.cachedResourcesById){this.getAvailableResourceOptions()}var b;if(CalendarStore.GetInheritProjCalForResFlag()){b=this.getGlobalResourceObjWithUpdateBaseCalendar(this.cachedResourcesById[c])}else{b=this.getResourceObj(this.cachedResourcesById[c])}return b},getAvailableManagerOptions:function(){if(!this.cachedAvailableManagerOptions){var b={};this.cachedAvailableManagerOptions=this.availablePeopleAndTeams.sort(function(d,c){return d.FullName.localeCompare(c.FullName)}).map(function(c){var d=c.Name;b[d]=c;return{id:d,text:c.FullName}});this.cachedManagersById=b}return this.cachedAvailableManagerOptions},enterQuickEditMode:function(){if(stl.app.matrixView&&stl.app.matrixView.zoomLevel>2){return}var c=this.$el;c.after('<div class="task-spaceholder-ms"></div>');c.find(":input").prop("disabled",this.readOnly);this.wasAlreadyZoomSmall=c.hasClass("task-zoom-small");c.addClass("quick-task-edit task-zoom-small");c.find(".task-content-wrapper").width(a);c.find(".subtask-type").hide();var b=c.find(".task-name-overflow-edit");b.text(c.find(".task-name input").val()).css("background",c.find(".task-name").css("background"));if(!this.readOnly){b.focus()}this.hideSubtasksRegion(c);$(this).trigger("enterquickedit")},exitQuickEditMode:function(){var c=this;var d=this.$el;d.next(".task-spaceholder-ms").remove();d.removeClass("quick-task-edit");if(!this.wasAlreadyZoomSmall){d.removeClass("task-zoom-small")}d.find(".task-name-overflow-edit").css("background","transparent");if(!c.readOnly){this.$el.find(".task-name input").val(this.$el.find(".task-name-overflow-edit").text());var b=this.$el.find(".task-name input").val();d.data("linkable-element-name",b);this.save()}if(stl.app.matrixView.zoomLevel==0){d.find(".task-controls").css("display","")}$(this).trigger("exitquickedit")},onClick:function(b){var d=this,e=this.$el,c=this.task;if(this.readOnly){if(e.hasClass("task-zoom-normal")||e.hasClass("quick-task-edit")){return}d.enterQuickEditMode(e)}if(!this.readOnly&&!e.hasClass("quick-task-edit")&&!e.hasClass("task-zoom-normal")){d.enterQuickEditMode(e);e.find(".task-controls").css("display","inline")}},wireSubTaskEvents:function(){var b=this;this.$el.find(".subtasks li .subtask-name input").on("focus",function(c){var e=$(c.target),d=e.closest("li");if(d.hasClass("proto-subtask")){e.val("");e.removeClass("placeholdersjs")}c.stopPropagation()});this.$el.find(".subtasks li .subtask-name input").on("keypress",function(c){if(c.which==13){c.preventDefault();var e=$(c.target),d=e.closest("li");if(d.hasClass("proto-subtask")&&e.val()!=EMPTY_STRING){b.renderNewSubtask(d,e,true)}}c.stopPropagation()});this.$el.find(".subtasks li .subtask-name input").on("blur",function(d){var f=$(d.target),e=f.closest("li");if(e.hasClass("proto-subtask")&&f.val()!=EMPTY_STRING){b.renderNewSubtask(e,f,false)}else{if(!e.hasClass("proto-subtask")&&f.val()!=EMPTY_STRING){$(this).closest("li").data("model").name=f.val()}else{if(!e.hasClass("proto-subtask")&&f.val()===EMPTY_STRING){var c=$(this).closest("li").data("model").name;$(this).val(c)}}}Placeholders.enable();d.stopPropagation()})},renderNewSubtask:function(f,e,c){var d=this,b=f.clone(true);f.parent().append(b);b.find("input[type=text]").val("");d.bindSubtask(f,d.project.createSubtask({name:e.val()},d.$el.data("model")));f.removeClass("proto-subtask");f.closest(".subtasks ul").sortable("refresh");d.save();if(c){f.next("li").find(".subtask-name input").focus()}}})})());