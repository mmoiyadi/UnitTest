Ext.define("TreeFilter",{extend:"Ext.AbstractPlugin",alias:"plugin.treefilter",collapseOnClear:true,allowParentFolders:false,init:function(a){var b=this;b.tree=a;a.filter=Ext.Function.bind(b.filter,b);a.clearFilter=Ext.Function.bind(b.clearFilter,b)},filter:function(e,f,h){var c=this,j=c.tree,b=[],d=j.getRootNode(),f=f||"name",a=[],i;if(f!="resources"){var h=h||new RegExp(e.toString(),"ig")}if(Ext.isEmpty(e)){c.clearFilter();return}if(f=="participants"){f="participantsFullNames"}j.expandAll();if(f=="resources"){d.cascadeBy(function(o){if(!o.isRoot()){var p=o.get(f);if(p){var q=stl.app.getAvailableResourceOptions();var n=[];_.each(p,function(r){n.push(_.find(q,function(s){return s.id==r.resourceId}).text)});if(e.indexOf("(")!=-1){var l=e.slice(e.indexOf("(")+1,e.length-1);var k=e.slice(0,e.indexOf("("));if(l){for(var m=0;m<p.length;m++){if(n.toString().indexOf(k)!=-1&&p[m].units==l){b.push(o)}}}}else{if(n.length>0){if(n.toString().indexOf(e)!=-1){b.push(o)}}}}}})}else{if(f=="duration"){d.cascadeBy(function(k){if(!k.isRoot()){if(k.get(f)>=0){if(k.get(f).toString()==e.toString()){b.push(k)}}}})}else{if(f=="snet"||f=="startDate"||f=="endDate"){d.cascadeBy(function(l){if(!l.isRoot()){if(l.get(f)){var m=new Date(e);var k=l.get(f);if(k.getDate()==m.getDate()&&k.getMonth()==m.getMonth()&&k.getYear()==m.getYear()){b.push(l)}}}})}else{if(f=="manager"){var g=stl.app.availablePeopleAndTeams;d.cascadeBy(function(l){if(!l.isRoot()){var k=$.grep(g,function(n){return n.Name==l.get(f)});if(k.length>0){var m=k[0].FullName;if(m.match(h)){b.push(l)}}}})}else{if(f=="status"){d.cascadeBy(function(k){if(!k.isRoot()){if(k.get(f)!=""){if(getTaskStatusShort(k).match(h)){b.push(k)}}}})}else{d.cascadeBy(function(k){if(!k.isRoot()){if(k.get(f).toString().match(h)){b.push(k)}}})}}}}}if(c.allowParentFolders===false){Ext.each(b,function(k){if(!k.isLeaf()){Ext.Array.remove(b,k)}})}Ext.each(b,function(m,l,k){d.cascadeBy(function(n){if(n.contains(m)==true){a.push(n)}});if(c.allowParentFolders===true&&!m.isLeaf()){m.cascadeBy(function(n){a.push(n)})}a.push(m)});d.cascadeBy(function(k){i=Ext.fly(j.getView().getNode(k));if(i){i.setVisibilityMode(Ext.Element.DISPLAY);i.setVisible(Ext.Array.contains(a,k))}});return b},clearFilter:function(){var c=this,a=this.tree,b=a.getRootNode();if(c.collapseOnClear){a.collapseAll()}b.cascadeBy(function(d){viewNode=Ext.fly(a.getView().getNode(d));if(viewNode){viewNode.show()}})}});